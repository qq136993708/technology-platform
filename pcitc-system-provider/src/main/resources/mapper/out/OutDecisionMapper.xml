<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pcitc.mapper.out.OutDecisionMapper" >
  <resultMap id="BaseResultMap" type="com.pcitc.base.stp.out.OutProjectInfo" >
    <id column="data_id" property="dataId" jdbcType="VARCHAR" />
    <result column="nd" property="nd" jdbcType="VARCHAR" />
    <result column="xmid" property="xmid" jdbcType="VARCHAR" />
    <result column="hth" property="hth" jdbcType="VARCHAR" />
    <result column="xmmc" property="xmmc" jdbcType="VARCHAR" />
    <result column="xmjb" property="xmjb" jdbcType="VARCHAR" />
    <result column="jf" property="jf" jdbcType="VARCHAR" />
    <result column="fwdxbm" property="fwdxbm" jdbcType="VARCHAR" />
    <result column="fwdx" property="fwdx" jdbcType="VARCHAR" />
    <result column="zylbbm" property="zylbbm" jdbcType="VARCHAR" />
    <result column="zylb" property="zylb" jdbcType="VARCHAR" />
    <result column="fzdwbm" property="fzdwbm" jdbcType="VARCHAR" />
    <result column="fzdw" property="fzdw" jdbcType="VARCHAR" />
    <result column="jtfzdwbm" property="jtfzdwbm" jdbcType="VARCHAR" />
    <result column="jtfzdw" property="jtfzdw" jdbcType="VARCHAR" />
    <result column="fzrxm" property="fzrxm" jdbcType="VARCHAR" />
    <result column="jssxxm" property="jssxxm" jdbcType="VARCHAR" />
    <result column="yjsj" property="yjsj" jdbcType="VARCHAR" />
    <result column="zyly" property="zyly" jdbcType="VARCHAR" />
    <result column="zysx" property="zysx" jdbcType="VARCHAR" />
    <result column="sjid" property="sjid" jdbcType="VARCHAR" />
    <result column="lxbj" property="lxbj" jdbcType="VARCHAR" />
    <result column="yjnr" property="yjnr" jdbcType="VARCHAR" />
    <result column="jdap" property="jdap" jdbcType="VARCHAR" />
    <result column="yjmb" property="yjmb" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="create_person" property="createPerson" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="update_date" property="updateDate" jdbcType="TIMESTAMP" />
    <result column="project_id" property="projectId" jdbcType="VARCHAR" />
    <result column="parent_project_id" property="parentProjectId" jdbcType="VARCHAR" />
    <result column="project_type" property="projectType" jdbcType="VARCHAR" />
    <result column="erp_project_code" property="erpProjectCode" jdbcType="VARCHAR" />
    <result column="erp_project_name" property="erpProjectName" jdbcType="VARCHAR" />
    <result column="project_scope" property="projectScope" jdbcType="VARCHAR" />
    <result column="project_level" property="projectLevel" jdbcType="VARCHAR" />
    <result column="project_property" property="projectProperty" jdbcType="VARCHAR" />
    <result column="project_abc" property="projectAbc" jdbcType="VARCHAR" />
    <result column="project_source" property="projectSource" jdbcType="VARCHAR" />
    <result column="yjsjks" property="yjsjks" jdbcType="VARCHAR" />
    <result column="yjsjjs" property="yjsjjs" jdbcType="VARCHAR" />
    <result column="xmlbbm" property="xmlbbm" jdbcType="VARCHAR" />
    <result column="xmlbmc" property="xmlbmc" jdbcType="VARCHAR" />
    <result column="gsbmmc" property="gsbmmc" jdbcType="VARCHAR" />
    <result column="gsbmbm" property="gsbmbm" jdbcType="VARCHAR" />
    <result column="zycmc" property="zycmc" jdbcType="VARCHAR" />
    <result column="zycbm" property="zycbm" jdbcType="VARCHAR" />
    <result column="type_flag" property="typeFlag" jdbcType="VARCHAR" />
    <result column="define1" property="define1" jdbcType="VARCHAR" />
    <result column="define2" property="define2" jdbcType="VARCHAR" />
    <result column="define3" property="define3" jdbcType="VARCHAR" />
    <result column="define4" property="define4" jdbcType="VARCHAR" />
    <result column="define5" property="define5" jdbcType="VARCHAR" />
    <result column="define6" property="define6" jdbcType="VARCHAR" />
  </resultMap>
	
	<!-- 经费预算建议 集团公司总部科技经费预算（建议稿） -->
	<select id="getGroupCompanyStpMoneyForBudgetProposals" resultType="java.util.Map" parameterType="java.util.Map">
		select fzdw,xmlbmc,round(sum(case when nd = '2017' then jf else 0 end),2) as qnje,
			round(sum(case when nd = '2018' then jf else 0 end),2) as jnje,
			round(sum(case when nd = '2018' and xmlbmc='科研' then jf else 0 end),2) as jnkyje,
			round(sum(case when nd = '2018' and xmlbmc='重点实验室专项' then jf else 0 end),2) as jnsysje
		from out_project_info
		where 
			project_type != '1' and fzdw is not null and jf is not null
		group BY fzdw,xmlbmc
	</select>
	
	<!-- 预算分配,经费预算分析,股份公司总部科技经费预算（建议稿） -->
	<select id="getStockCompanyMoneyTable" resultType="java.util.Map" parameterType="java.util.Map">
		<!-- SELECT case when lbName = '10' then '直属研究院' when lbName = '20' then '分子公司' when lbName = '30' then '集团单位' when lbName = '40' then '外部单位' else lbName end,
			   realIndex,indexName,fyxje,zbxje,zje
		FROM (
			select
			    round(sum(case when define1 = '费用性' then jf else 0 end), 2) as fyxje,
			    round(sum(case when define1 = '资本性' then jf else 0 end), 2) as zbxje,
			    round(sum(jf), 2) as zje,
		    	SUBSTR(define2 FROM 4) lbName,SUBSTR(define2,1,3) realIndex, NULL as indexName
			from out_project_info
			where project_type != '1' and (project_scope = '新开课题' or project_scope = '结转课题') and define2 is not null
		    group by define2
		    
			union ALL
			select
			    round(sum(case when define1 = '费用性' then jf else 0 end), 2) as fyxje,
			    round(sum(case when define1 = '资本性' then jf else 0 end), 2) as zbxje,
			    round(sum(jf), 2) as zje,
		    	SUBSTR(define2,1,2) lbName,SUBSTR(define2,1,2) realIndex,SUBSTR(define2,1,1) indexName
			from out_project_info
			where project_type != '1' and (project_scope = '新开课题' or project_scope = '结转课题') and define2 is not null
		    group by SUBSTR(define2,1,2),SUBSTR(define2,1,1)
	    ) as tableA ORDER BY realIndex -->
	    
	    select show_index,unit_name,sum(zbx_money+fyx_money) as hj_money,zbx_money,fyx_money 
		from out_tem_money_total
		where 
			sheet_flag = '2018年预算总表'
		group by data_id
	</select>
	
	<!-- 预算分配,经费预算分析,各处、部门科技经费预算总表 -->
	<select id="getDepartmentBudgetMoneyTable" resultType="java.util.Map" parameterType="java.lang.String">
		select
			round(sum(case when project_scope = '新开课题' then jf else 0 end),2) as zxqje,
      		round(sum(case when project_scope = '结转课题' then jf else 0 end),2) as zlhtje,
			round(sum(jf),2) as zysje,
			round(sum(case when fwdx = '股份' and project_scope = '新开课题' then jf else 0 end),2) as gfxkje,
      		round(sum(case when fwdx = '股份' and project_scope = '结转课题' then jf else 0 end),2) as gfjzje,
			round(sum(case when fwdx = '股份' then jf else 0 end),2) as gfzje,
			round(sum(case when fwdx = '资产' and project_scope = '新开课题' then jf else 0 end),2) as zcxkje,
      		round(sum(case when fwdx = '资产' and project_scope = '结转课题' then jf else 0 end),2) as zcjzje,
			round(sum(case when fwdx = '资产' then jf else 0 end),2) as zczje,
			round(sum(case when fwdx = '集团' and project_scope = '新开课题' then jf else 0 end),2) as jtxkje,
      		round(sum(case when fwdx = '集团' and project_scope = '结转课题' then jf else 0 end),2) as jtjzje,
			round(sum(case when fwdx = '集团' then jf else 0 end),2) as jtzje,
			sum(case when fwdx = '集团' then jf else 0 end) as jtzje,
      		define4 as cbName
		from out_project_info
		where (project_type = '0' or project_type = '2') and 
			  (project_scope = '新开课题' or project_scope = '结转课题') and define4 is not null
    	group by define4
	</select>
	
	<!-- 知识产权分析,国际、国内专利数量统计 -->
	<select id="getPatentCountByCountryType" resultType="java.util.Map" parameterType="java.util.Map">
		select sum(case when SHOUQR like '2018%' then 1 else 0 end) sl1,
			   sum(case when SHOUQR like '2017%' then 1 else 0 end) sl2,
			   sum(case when SHOUQR like '2016%' then 1 else 0 end) sl3,
			   case when GBDM = 'CN' then '国内专利' else '国外专利' end  as patentName
		from out_patent
		where
			flztyj = '有效' and flztej = '授权'
		group by GBDM
	</select>
	
	<!-- 知识产权分析,各类型专利的数量，发明公布，发明授权，实用新型等 -->
	<select id="getPatentCountByPatentType" resultType="java.util.Map" parameterType="java.util.Map">
		select 
			 WXLX as typeName,COUNT(*) sl
		from out_patent
		where
		SHOUQR like '2018%' and flztyj = '有效' and flztej = '授权'
		group by WXLX
	</select>
	
	<!-- 知识产权分析,各类型专利的数量，8大研究院 -->
	<select id="getPatentCountByInstitute" resultType="java.util.Map" parameterType="java.util.Map">
		select 
			 SUBSTR(`STATUS` FROM 4) as unitName, COUNT(*) sl
		from out_patent
		where
		SHOUQR like '2018%' AND `STATUS` IS NOT NULL and flztyj = '有效' and flztej = '授权'
		group by `STATUS`
	</select>
	
	<!-- 知识产权分析,专利申报情况明细分析表 -->
	<select id="selectPatentDetailInfoByCond" resultType="java.util.Map" parameterType="java.util.Map">
		select 
			 ZLH as zlbm,ZHY as zlms,case when SQBZ = '1' then '国内' else '国外' end as gngw,
			 GBDM as zlszg,YXQH as yxq, FMR as dysqr, SHENQR as dyfmdw
		from out_patent
		where
		SHOUQR like '2018-05%' AND `STATUS` IS NOT NULL and flztyj = '有效' and flztej = '授权'
	</select>
	
	<!-- 处部门科技经费预算总表，各处、部门科技经费预算总表 -->
	<select id="selectJFYSZBForDepartment" resultType="java.util.Map" parameterType="java.util.Map">
		select xh,cb,jfyszjys,jfyszjlht,jfyszjxq,jtyshjys,jtyshjlht,jtyshxq,zcyshjys,zcyshjlht,zcyshjxq,gfyshjys,gfyshjlht,gfyshjxq
		from out_tem_money_decompose
	</select>
	
	<!-- 科技经费预算总表，集团经费预算明细表 -->
	<select id="selectJFYSForGroup" resultType="java.util.Map" parameterType="java.util.Map">
		select xh,zyc,yshj,jzxmjfhj,jzxmjfbkyf,jzxmjfbkjx,jzxmjfqt,jzxmjfjh,xkxmjfhj,xkxmjfbkyf,xkxmjfbkjx,xkxmjfqt,xkxmjfjh
		from out_tem_money_group
		where
		nd = '2018'
	</select>
	
	<!-- 科技经费预算总表，资产经费预算明细表 -->
	<select id="selectJFYSForAsset" resultType="java.util.Map" parameterType="java.util.Map">
		select xh,zyc,yshj,jzxmjfhj,jzxmjfzcb,jzxmjfhgb,xkxmjfhj,xkxmjfzcb,xkxmjfhgb
		from out_tem_money_asset
		where
		nd = '2018'
	</select>
	
	<!-- 科技经费预算总表，直属研究院科技经费预算表 -->
	<select id="selectJFYSForInstitute" resultType="java.util.Map" parameterType="java.util.Map">
		select xh,zyc,hj,kty,gcy,wty,sky,dly,bhy,shy,agy
		from out_tem_money_institute
		where
		nd = '2018'
	</select>
	
	<!-- 科技经费预算总表，股份支付集团、外系统及盈科经费预算表 -->
	<select id="selectJFYSForOther" resultType="java.util.Map" parameterType="java.util.Map">
		select xh,cb,gffjtys,gffjtlht,gffjtkxq,gffxtwys,gffxtwlht,gffxtwkxq,gffykys,gffyklht,gffykkxq
		from out_tem_money_other
		where
		nd = '2018'
	</select>
	
	<!-- 科技经费预算总表，分子公司科技经费预算表 -->
	<select id="selectJFYSForCompany" resultType="java.util.Map" parameterType="java.util.Map">
		select xh,cb,jfys,jzjf,kxq
		from out_tem_money_company
		where
		nd = '2018'
	</select>
	
	<!-- 科技经费预算总表，分子公司科技经费预算表 -->
	<select id="selectJFYSForB2c" resultType="java.util.Map" parameterType="java.util.Map">
		select xh,mc,lysybys,lysybjz,lysybkxq,hgsybys,hgsybjz,hgsybkxq
		from out_tem_money_b2c
		where
		nd = '2018'
	</select>
	
	<!-- 科技经费预算总表，股份公司科技专项经费预算表 -->
	<select id="selectJFYSForTech" resultType="java.util.Map" parameterType="java.util.Map">
		select ysxm,jtgs,kty,gcy,wty,sky,bhy,dly,shy,agy,zsyhj,fzgs,xtw
		from out_tem_money_tech
		where
		nd = '2018'
	</select>
	
	<!-- 辅助决策中心，近三年国内外专利的情况 -->
	<select id="getPatentInfoByHomeAbroad" resultType="java.util.Map" parameterType="java.util.Map">
		select
			REMARKS as showName,
			sum(case when LEFT(SHOUQR,4) = '2018' and (WXLX = '发明公布' or WXLX = '发明授权') then 1 else 0 end) as jnCount,
			sum(case when LEFT(SHOUQR,4) = '2017' and (WXLX = '发明公布' or WXLX = '发明授权') then 1 else 0 end) as qnCount,
			sum(case when LEFT(SHOUQR,4) = '2016' and (WXLX = '发明公布' or WXLX = '发明授权') then 1 else 0 end) as qiannCount
		from out_patent
		GROUP BY REMARKS
	</select>
	
	<!-- 辅助决策中心，各类型专利及涉外专利的情况 -->
	<select id="getPatentInfoByTypeAndAbroad" resultType="java.util.Map" parameterType="java.util.Map">
		select
			sum(case when LEFT(SHOUQR,4) = '2018' and (WXLX = '发明公布' or WXLX = '发明授权') then 1 else 0 end) as fmzlCount,
			sum(case when LEFT(SHOUQR,4) = '2018' and (WXLX = '外观设计') then 1 else 0 end) as wgsjCount,
			sum(case when LEFT(SHOUQR,4) = '2018' and (WXLX = '实用新型') then 1 else 0 end) as syxxCount,
			sum(case when LEFT(GKR,4) = '2018' and (REMARKS = '国际专利') then 1 else 0 end) as gjzlCount
		from out_patent
	</select>
	
	
</mapper>