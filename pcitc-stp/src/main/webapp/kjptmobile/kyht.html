<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>科技管理平台</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
<link rel="stylesheet" href="/kjptmobile/layuiadmin/layui/css/layui.css" media="all">
<link rel="stylesheet" href="/kjptmobile/css/mobileNew.css">
</head>
<body>
	<header>
		<div class="m_return child">
			<a href="/kjptmobile/temIndex">
				<img src="/kjptmobile/images/icon-back.png" />
			</a>
			<h4>科研合同（任务书）</h4>
		</div>
	</header>
	<main class="main">

	<div class="layui-card layui-form " lay-filter="component-form-element">
		<div class="layui-card-body layui-row layui-col-space10">
			<div class="layui-col-xs4">
				<input type="text" name="nd" placeholder="请选择年份" title="年份" value="${nd}" autocomplete="off" class="form-control layui-input" id="nd">
			</div>
			<div class="layui-col-xs2">
				<button class="layui-btn layui-btn-primary" onclick="search_Event()">搜索</button>
			</div>
		</div>
	</div>
	<div class="main-card first-card">
		<div class="main-card-header hasborder">
			<span class="layui_time"></span>
			年新开课题合同签订率
		</div>
		<div class="main-card-body">
			<div class="text-total">
				<span>
					计划签订数:
					<span class="text-total-blue" id="vdirect_contract_01_01" style="cursor: pointer">
						<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
				<span>
					实际签订数:
					<span class="text-total-blue" id="vdirect_contract_01_02" style="cursor: pointer">
						<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
				<span>
					签订率:
					<span class="text-total-blue" id="vdirect_contract_01_03" style="cursor: pointer">
						<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
			</div>
			<div class="main-chart" id="direct_contract_01" style="height: 270px; width: 100%;"></div>
		</div>
	</div>

	<div class="main-card first-card">
		<div class="main-card-header hasborder">
			<span class="layui_time"></span>
			年新开课题合同签订率
		</div>
		<div class="main-card-body">
			<div class="main-chart" id="direct_contract_01_01" style="height: 270px; width: 100%;"></div>
		</div>
	</div>


	<div class="main-card" id="isKJBPerson_id">
		<div class="main-card-header hasborder">
			<span class="layui_time"></span>
			年新开课题合同签订率
		</div>
		<div class="main-card-body">
			<div class="main-chart" id="direct_contract_04" style="height: 270px; width: 100%;"></div>
		</div>
	</div>

	<div class="main-card first-card">
		<div class="main-card-header hasborder">
			<span class="layui_time"></span>
			年直属研究院开课题合同签订率
		</div>
		<div class="main-card-body" style="height: 360px;">
			<div class="text-total">
				<span>
					已签订数:
					<span class="text-total-blue" id="direct_contract_chart_01" style="cursor: pointer">
						<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
				<span>
					未签订数:
					<span class="text-total-blue" id="direct_contract_chart_02" style="cursor: pointer">
						<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
				<span>
					签订率:
					<span class="text-total-blue" id="direct_contract_chart_03" style="cursor: pointer">
						<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
			</div>
			<div class="main-chart" id="direct_contract_chart" style="height: 270px; width: 100%;"></div>
		</div>
	</div>



	</main>
	<script type="text/javascript" src="/kjptmobile/plugins/jQuery/jQuery-2.2.0.min.js"></script>
	<script type="text/javascript" src="/kjptmobile/layuiadmin/layui/layui.js"></script>
	<script type="text/javascript" src="/kjptmobile/plugins/echarts/echarts.min.js"></script>
	<script type="text/javascript" src="/kjptmobile/plugins/echarts/walden.js"></script>
	<script type="text/javascript" src="/stp/hana/common/stp_common_line.js"></script>
	<script type="text/javascript" src="/stp/hana/common/stp_common_bar.js"></script>
	<script type="text/javascript" src="/stp/hana/common/stp_common_pie.js"></script>
	<script type="text/javascript" src="/stp/hana/home/direct_depart/direct_common.js"></script>
	<script type="text/javascript" src="/stp/hana/home/oneLevelMain/investment.js"></script>


	<script type="text/javascript">
		(function(doc, win) {
			var docEl = doc.documentElement, resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize', recalc = function() {
				var clientWidth = docEl.clientWidth;
				if (!clientWidth) return;
				docEl.style.fontSize = (clientWidth / 10.8) + 'px';
			};
			if (!doc.addEventListener) return;
			win.addEventListener(resizeEvt, recalc, false);
			doc.addEventListener('DOMContentLoaded', recalc, false);
		})(document, window);

		var echartchart_01_01;
		var echart2;
		var echart6;
		var table, treeGridCom;
		layui.config({
			base : '/kjptmobile/layuiadmin/lib/extend/'
		}).extend({
			treeGridCom : 'treeGridCom'
		}).use([ 'jquery', 'form', 'treeGridCom', 'laydate', 'table', 'laypage' ], function() {
			table = layui.table;
			treeGridCom = layui.treeGridCom;
			var $ = layui.jquery, form = layui.form, laydate = layui.laydate
			form.render(null, 'component-form-group');
			laydate.render({
				elem : '#nd',
				min : '2016-10-14',
				type : 'year',
				done : function(value, date, endDate) {
					$(".layui_time").html(date.year);
					$("#nd").val(date.year);
					search_Event();
				}
			});
			$(".layui_time").html($("#nd").val());
			var nd = $("#nd").val();
		});
		var v_date = (new Date()).getTime();
		var nd = $('#nd').val();
		function initEchart() {

			var ndstr = nd + "年";
			var yAxis = [ {
				type : 'value',
				name : '数量（个）',
				position : 'left',
				axisLabel : {
					formatter : '{value}'
				}
			} ];

			var yAxis2 = [ {
				type : 'value',
				name : '数量（个）',
				position : 'left',
				axisLabel : {
					formatter : '{value}'
				}
			}, {
				type : 'value',
				show : true,
				name : '百分比',
				position : 'right',
				axisLabel : {
					formatter : '{value}%'
				},
				splitLine : {
					show : false
				},//去除网格线

			} ];

			//表盘
			setGauge("direct_contract_01");
			setGauge_count();
			var chart_01_01 = "/one_level_main/contract_01_01?type=1&nd=" + nd + "&v_date=" + v_date + "";
			echartchart_01_01 = load_mutl_bar_down(chart_01_01, "direct_contract_01_01", "", "", yAxis2, 20, "");

			//
			var chart2_url = "/one_level_main/contract_02?type=1&nd=" + nd + "&v_date=" + v_date + "";
			echart2 = load_single_line(chart2_url, "direct_contract_04", "", "", yAxis);

			//直属研究院签订率
			$("#direct_contract_chart_01").html('<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#direct_contract_chart_02").html('<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#direct_contract_chart_03").html('<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">');

			var chart6_url = "/one_level_main/contract_03?type=1&nd=" + nd + "&v_date=" + v_date + "";
			var color2 = [ "#f3655b", "#8ab3cf", "#f19049" ];
			// echart6=load_mutl_bar_down(chart6_url,"direct_contract_chart","","",yAxis,15,color2);

			var color = [];
			echart6 = load_mutl_bar_down_r(chart6_url, "direct_contract_chart", "", "", yAxis, true, 20, color2);

		}

		//初始化图形
		initEchart();

		window.onresize = function() {
			echartchart_01_01.resize();
			echart6.resize();
			echart2.resize();
		}

		//查询
		function search_Event() {
			initEchart();

		}

		function setGauge_count() {

			$("#vdirect_contract_01_01").html('<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#vdirect_contract_01_02").html('<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#vdirect_contract_01_03").html('<img class="loadingImg" src="/kjptmobile/layuiadmin/layui/images/loadingImg04.gif" alt="">');

			var nd = $('#nd').val();
			var series = [];
			$.ajax({
				type : "POST",
				url : "/one_level_main/contract_01?type=1&nd=" + nd + "",
				timeout : 9000,
				dataType : "json",
				cache : false,
				headers : {
					'Content-Type' : 'application/json'
				},
				success : function(data, status) {
					if (data.success == true || data.success == 'true') {
						$("#vdirect_contract_01_01").html(data.data.zsl + "个");

						if (typeof (data.data.yqht) == "undefined") {
							$("#vdirect_contract_01_02").html("0个");
						} else {
							$("#vdirect_contract_01_02").html(data.data.yqht + "个");
						}

						$("#vdirect_contract_01_03").html(data.data.qdl + "%");
					}
				},
				error : function() {
				},
				complete : function(XMLHttpRequest, status) {
				}
			});

		}

		function setGauge(id) {
			var myChart2 = echarts.init(document.getElementById(id));
			var options = {
				title : {
					text : '',
					x : 'center',
					y : '10px',
					textStyle : {
						fontSize : 15,
						fontWeight : 'normal',
						color : '#000000'
					},
					subtextStyle : {
						color : '#7B7B7B'
					},
					subtext : ''
				},
				tooltip : {
					formatter : "{a} <br/>{b} : {c}%"
				},
				toolbox : {
					feature : {
						restore : {},
						saveAsImage : {}
					}
				},
				series : [ {

					data : []
				} ]
			};
			var nd = $('#nd').val();
			ajax_getGauge("/one_level_main/contract_01?type=2&nd=" + nd + "", myChart2, options);
		}

		function ajax_getGauge(url, echartsobj, options) {
			var series = [];
			$.ajax({
				type : "POST",
				url : url,
				timeout : 9000,
				dataType : "json",
				cache : false,
				headers : {
					'Content-Type' : 'application/json'
				},
				success : function(data, status) {
					if (data.success == true || data.success == 'true') {
						echartsobj.hideLoading();
						var data = data.data;
						echartsobj.setOption({
							series : [ {
								data : [ {
									value : data.value,
									name : '完成率'
								} ],
								name : '签订率',
								type : 'gauge',
								radius : "110%",
								center : [ '50%', '61%' ],
								detail : {
									formatter : '{value}%'
								},
							} ]
						});
					}
				},
				error : function() {
					layer.msg('图表加载失败');
				},
				complete : function(XMLHttpRequest, status) {
					if (status == 'timeout') {
						layer.msg('超时');
					}
				}
			});

		}
	</script>
</body>
</html>