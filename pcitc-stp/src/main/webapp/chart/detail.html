<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>科研人才</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="Shortcut Icon" href="/layuiadmin/layui/images/favicon.ico"/>
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/second.css" media="all">
    <script src="/layuiadmin/layui/layui.js"></script>
    <style>
        html {background: #f0f2f5;}
        .layui-col-md4{position: relative;display: block !important;padding:0 24px;margin-top: 20px;
            box-sizing: border-box; border-right: 1px dashed #1990FF;height: 96%}
        .layui-col-md8{height: 96%;}
        .lab-details-c h4{display: block;width: 100%;text-align: center;margin: 18px 0;float: none;}
        .lab-details-c .detail-p{display: block;width: 100%;float: none;height: 76%;}
        .layui-personnel .expert-i{border: 1px solid #1890FF;}
        .detail-p{text-indent: 2em;line-height: 24px;font-size: 14px;color: #666666;padding-top: 15px;
            border-top: 1px solid #1990FF;box-sizing: border-box; overflow-y: scroll;}
        .layui-personnel .expert-i{margin-top: 0;}
        .layui-tab-title li{height: 48px;line-height: 48px;font-size: 16px;
            border-radius: 6px;padding: 0 30px;}
        .layui-tab-title{height: 48px;border: 0;background: #F3F9FF;}
        .layui-card-body{margin-left: 5px;}
        .layui-tab-item{padding: 0;}
        .detail-j p{text-indent: 2em;line-height: 24px;color: #666666;}
        @media (max-width: 1504px) {
            .lab-details-c .detail-p{height: 65%;}
        }
    </style>
</head>
<body>
<div class=" layui-personnel lab-details">
    <div class="lab-details-m">
        <div class="breadcrumb">
            <a href="/" target="_parent">首页  /  </a><span>科研人才</span>
        </div>
    </div>
    <div class="layui-row lab-details-c">
        <div class="layui-col-md4">
            <div class="detail-left">
                <div class="expert-i">
                    <img id="photoAttach" src="/stp/expert/img/default.png" alt="" height="140">
                </div>
            </div>
            <h4>${expert.expertName}</h4>
            <div class="detail-p">${expert.userDesc}</div>
        </div>
        <div class="layui-col-md8">
            <div class="layui-card-body">
                <div class="layui-tab layui-tab-brief" lay-filter="component-tabs-hash">
                    <ul class="layui-tab-title">
                        <li class="layui-this" lay-id="11">人物成就</li>
                        <li lay-id="22">专利信息</li>
                        <!--<li lay-id="33">其他</li>-->
                    </ul>
                    <div class="layui-tab-content">
                        <div class="layui-tab-item layui-show">
                            <div class="detail-j" style="padding-top: 10px;">
                                ${expert.bak6}
                            </div>
                        </div>
                        <div class="layui-tab-item">
                            <div class="detail-j">
                                <table id="showTable" class="layui-table" lay-filter="tableData"></table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<input type="hidden" value="${expert.dataId}" name="dataId" id="dataId" />
<script>
    layui.use(['jquery', 'table', 'layer', 'laydate', 'publicMethods', 'element'], function () {
        var $ = layui.jquery, table = layui.table, laydate = layui.laydate, publicMethods = layui.publicMethods;
        // parent.$(".layui-leader .layui-body").css("left", "0px");
        //附件上传-start
        $(".lab-details-c").css("height",($(document).height()-66)+"px");
        $('#upload_File_photoAttach').click(function () {
            TimeFn = setTimeout(function () {
                var param = {};
                param.file_id_name = "headerImg";
                param.file_ids_value = $("input[name=dataId]").val();

                param.callback = "call_fun";//回调函数名称
                param.file_opt_flag = "1cf7678a240c42299313322d904ca7f0";//文件配置ID
                param.file_edit_detail = "edit";//新增、修改用edit, 显示用detail
                var temUrl = "/sysFilePage/uploadFile?param=" + encodeURIComponent(JSON.stringify(param));
                publicMethods.openBaseWin("文件上传", temUrl, "90%", "80%");
            }, 300);
        });
        renderTablePatent();
        $('#upload_File_photoAttach').dblclick(function () {
            showImg(photofilePath);
        });

        function call_fun(data, param) {
            for (var key in data) {
                var obj_file = data[key];
                photofilePath = key;
            }
            var photoStream = photoContent(photofilePath);
//设置photoAttach图片流
            $("#photoAttach").attr("src", photoStream);
            $("#photoAttach").attr("title", "双击查看大图");
        }

        function ajaxFile(url, data, callback) {
            var result = null;
            $.ajax({
                type: 'post',
                async: false,
                url: url,
                data: data,
                dataType: 'json',
                success: function (data, status) {
                    result = data;
                    if (callback) {
                        callback.call(this, data, status);
                    }
                },
                error: function (err, err1, err2) {
                    console.log("ajaxPost发生异常，请仔细检查请求url是否正确");
                }
            });
            return result;
        }

        //双击查看免冠照片
        function showImg(url) {
            var photoStream = photoContent(url);
            var img = "<img src='" + photoStream + "' height='100%' width='100%'/>";
            layer.open({
                type: 1,
                shade: false,
                title: false, //不显示标题
                area: [500 + 'px', 400 + 'px'],
                content: img, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
                cancel: function () {
//layer.msg('图片查看结束！', { time: 5000, icon: 6 });
                }
            });
        }

        //根据图片路径获取图片流
        function photoContent(picId) {
            var ret = getFileResult(picId);
            if (ret != null && ret.list.length > 0) {
                picId = ret.list[0].id;
            }
            var base64 = "";
            $.ajax({
                type: 'get',
                dataType: 'text',
                async: false,
                url: '/sysfile/viewPic/' + picId,
                success: function (data) {
                    base64 = data;
                },
                error: function (e) {
                    alert("出错了");
                }
            });
            return base64;
        }

        ////加载图片
        function getFileResult(fileIds) {
            var ret = null;
            ajaxFile("/sysfile/getFilesLayuiByFormId", {fileIds: fileIds}, function (result) {
                ret = result;
            });
            return ret;
        }

        //初始化数据
        $(function () {
//初始加载免冠照片
            var photoAttachId = $("#dataId").val();
            if (photoAttachId != 0) {
                photofilePath = photoAttachId;
                if (photofilePath != null && photofilePath != "") {
                    var photoStream = photoContent(photofilePath);
                    if (photoStream == "data:image/png;base64,PHNjcmlwdD4NCiBtb2RhbHMuaW5mbygnPz8/Pz8hJyk7DQo8L3NjcmlwdD4NCg==") {
                        return;
                    }
                    $("#photoAttach").attr("src", photoStream);
                    $("#photoAttach").attr("title", "双击查看大图");
                }
            }
        });
        //附件上传-end
        function renderTablePatent() {
            var param = JSON.parse(window.localStorage.getItem("param"));
            var lodingMsg = layer.msg('数据加载中....');

            //渲染
            table.render({
                elem: '#showTable',
                url: '/expertController/queryOutPatentList',
                method: "POST",
                where: {
                    param: {
                        "name": "${zjkBaseInfo.expertName}",
                    }
                },
                limit: param.selfRownum,
                id: 'showTable',
                height: commonDislodgeTable()-80,
                page: {
                    groups: 5,
                    limits: [param.selfRownum, 30, 45, 60],
                    // layout: ['count', 'limit', 'prev', 'page', 'next', 'skip'], //自定义分页布局
                    first: '首页', //不显示首页
                    last: '尾页', //不显示尾页
                    theme: '#0F9EE0'
                },
                cols: [[
                    // {type: 'checkbox', event: 'changeEvents'},
                    {title: '序号', type: 'numbers', width: 55},
                    {
                        field: "fmmc",
                        title: "名称", event: 'setActive', style: 'cursor: pointer;', width: '15%'
                    },
                    {
                        field: "wxlx",
                        title: "类型", event: 'setActive', style: 'cursor: pointer;', width: '7%'

                    },
                    // {
                    //     field: "zlh",
                    //     title: "专利号", event: 'setActive', style: 'cursor: pointer;'
                    // }
                    // ,
                    {
                        field: "qlyq",
                        title: "专利描述", event: 'setActive', style: 'cursor: pointer;'

                    }
                ]],
                done: function (res, curr, count) {
                    // 关闭等待刷新
                    layer.close(lodingMsg);
                    $("#zlCount").html(count);
                    // $("#cgCount").html(res.msg);
                    // 点击行联动选择框--单选
                    $('.layui-table-box').find('.layui-table-body').find("table").find("tbody").children("tr").on('click', function () {
                        var index = parseInt($(this).index() + 1);
                        $('tr').removeClass('layui-table-click');
                        $(this).addClass('layui-table-click');
                        $('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
                        $('tr:eq(' + index + ')').find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
                        selectRowData = res.data[index - 1];
                    });
                }
            });
        }

    });
</script>
<script>

</script>
</body>
</html>