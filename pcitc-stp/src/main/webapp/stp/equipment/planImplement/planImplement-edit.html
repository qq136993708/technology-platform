<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/style/common.css">
    <script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
    <script type="text/javascript" src="/layuiadmin/javascript/ckeditor5/ckeditor.js"></script>
    <script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
    <script type="text/javascript" src="/common/js/base.js"></script>
</head>
<body>
<div class="formBox">
    <form id="planlmplement" name="planlmplement" lay-filter="sysNews-form" class="form-horizontal layui-form">
        <input type="hidden" name="researchInstitute" id="researchInstitute" value="${researchInstitute}">
		<input type="hidden" name="unitPathIds" id="unitPathIds" value="${srePlanImplement.levelId}">
		<input type="hidden" name="parentUnitPathIds" id="parentUnitPathIds" value="${srePlanImplement.sonId}">
		<input type="hidden" name="applyDepartName" id="applyDepartName" value="${srePlanImplement.levelName}">
		<input type="hidden" name="selectState" id="selectState" value="${srePlanImplement.publicationState}">
		<input type="hidden" name="selectpublicationType" id="selectpublicationType" value="${srePlanImplement.publicationType}">
		<input type="hidden" name="dateStr" id="dateStr" value="${dateStr}">
		<input type="hidden" name="selectpuId" id="selectpuId" value="${srePlanImplement.id}">
        <div class="box-body">
            <input type="hidden" name="dataId" id="dataId"/>
            <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">规划标题<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="publicationTitle" id="publicationTitle" value="${srePlanImplement.publicationTitle}"
                                   lay-verify="required"  autocomplete="off" type="text" >
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">规划类型<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <select name="publicationType"  id="publicationType"  class="layui-form-label" value="${srePlanImplement.publicationType}">
							     <option value="1"> 研究院中长期规划</option>
							     <option value="2">研究室中长期规划</option>
							     <option value="3">课题中长期规划</option>
							     <option value="4">研究院滚动计划</option>
							     <option value="5">研究室滚动计划</option>
							     <option value="6"> 课题滚动计划</option>
							 </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">发布人<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="publisher" id="publisher" value="${srePlanImplement.publisher}"
                                   lay-verify="required" autocomplete="off">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label class="layui-form-label">是否发布<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <select name="publicationState"  id="publicationState"  class="layui-form-label" value="${srePlanImplement.publicationState}">
								     <option value="0" >否</option>
								     <option value="1" >是</option>
							 </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label class="layui-form-label">发布时间<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input" id="publicDate" name="publicDate" value="${dateStr}"  pattern='yyyy-MM-dd'>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-form-item layui-form-text">
                    <div class="layui-form-item">
                        <label class="layui-form-label">内容<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <textarea name="content" id="content" class="ckeditor">${srePlanImplement.publicationText}</textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-bottom">
                <div class="form-bottom-btns">
	                <a herf="javascript:void(0)" class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue"  data-type="addEvent" lay-filter="addEvent" id="addEvent">确定</a>
	             	 <button type="button" class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white" id="closeBtn">取消</button>
	             </div>
            </div>
        </div>
    </form>
</div>
<script>
   var selectState = $("#selectState").val();
	  $(document).ready(function(){
            var selectid = document.getElementById("selectState").value;/* 如果你用的“变量”是input的话，这里就要写成.value了 */
            if(selectid==1){
            	$("#publicationState").val("1");
            }else{
            	 $("#publicationState").val("0");
            }
        });
	  var selectpublicationType = $("#selectpublicationType").val();
	  $(document).ready(function(){
            var selectpublicationType = document.getElementById("selectpublicationType").value;/* 如果你用的“变量”是input的话，这里就要写成.value了 */
            if(selectpublicationType==1){
            	$("#publicationType").val("1");
            }else if(selectpublicationType==2){
            	 $("#publicationType").val("2");
            }else if(selectpublicationType==3){
            	 $("#publicationType").val("3");
            }else if(selectpublicationType==4){
            	 $("#publicationType").val("4");
            }else if(selectpublicationType==5){
            	 $("#publicationType").val("5");
            }else if(selectpublicationType==6){
            	 $("#publicationType").val("6");
            }
        });
	  var selectState = $("#selectState").val();
	  $(document).ready(function(){
            var selectid = document.getElementById("selectState").value;/* 如果你用的“变量”是input的话，这里就要写成.value了 */
            if(selectid==1){
            	$("#publicationState").val("1");
            }else{
            	 $("#publicationState").val("0");
            }
        });
    var id = "${id?default(0)}";
    if (id != "0") {
        $("#id").val(id);
    }
    layui.use(['jquery', 'form', 'laydate', 'table', 'layer', 'element'],
        function () {
            var $ = layui.jquery, admin = layui.admin, element = layui.element, layer = layui.layer, laydate = layui.laydate, form = layui.form;
            var myEditor = null;
            ClassicEditor.create(document.querySelector('#content'),{}).then(editor => {
                myEditor = editor;
            });
            form.render(null, 'sysNews-form');
            laydate.render({
                elem: '#publicDate'
                , position: 'fixed'
            });
            $("#closeBtn").click(function () {
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
            })
            
            $("#addEvent").click(function () {
            	selectpuId = $("#selectpuId").val();
            	publicationTitle = $("#publicationTitle").val();
            	publicationType = $("#publicationType").val();
            	content = myEditor.getData();
            	publicDate = $("#publicDate").val();
            	publicationState = $("#publicationState").val();
            	publisher = $("#publisher").val();
            	researchInstitute = $("#researchInstitute").val();
            	unitPathIds = $("#unitPathIds").val();
            	parentUnitPathIds = $("#parentUnitPathIds").val();
            	applyDepartName = $("#applyDepartName").val();
            	if(publicationTitle==""){
            		layer.msg('规划标题不能为空!');
            		return false;
            	}
            	if(publicationType ==""){
            		layer.msg('请选择规划类型!');
            		return false;
            	}
            	if(content==""){
            		layer.msg('内容不能为空!');
            		return false;
            	}
            	publicationTitle = publicationTitle.replace(/<script|<\/script/ig,function(publicationTitle){
     	   		    return "&lt;"+publicationTitle.substring(1);
     	   	  	});
            	publicationTitle = publicationTitle.replace("<","&lt;").replace(">","&gt");
            	$.ajax({
                    type : "POST",
                    url: "/sre-planImplement/update",
                    data: {"id": selectpuId,"publicationTitle": publicationTitle,"publicationType":publicationType,
	                       "content":content,"publicDate":publicDate,"publicationState":publicationState,
	                       "publisher":publisher,"unitPathIds":unitPathIds,"parentUnitPathIds":parentUnitPathIds,
	                       "parentUnitPathNames":researchInstitute,"applyDepartName":applyDepartName}, 
                    traditional : true,
                    async : true,   
                    dataType:"json",
                    success : function(resultsDate){
                    	if(resultsDate.resultsDate == "1") {
                    		layer.alert("修改成功!!", function(index){
                    			parent.location.href = '/sre-planImplement/to-list';
                    		});
                    	}else {
                    		layer.alert("添加失败,请联系管理员!!");
                    	}
                    },
                });    
            })
            $('.layui-btn').on('click', function(){
            	var type = $(this).data('type');
                active[type] ? active[type].call(this) : '';
            });
            $("#closeBtn").click(function () {
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
            })
        });
    
</script>
</body>
</html>