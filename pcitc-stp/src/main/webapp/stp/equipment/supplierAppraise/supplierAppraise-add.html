<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css">
    <script src="/common/js/jquery-1.11.3.min.js"></script>

    <script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
</head>
<body>
<div class="layer-box">
    <form id="planForm" class="layui-form" action="" lay-filter="component-form-group layui-container"></form>
    <div class="formBox">
        <div class="tableToolBox">
            <div class="tableBtns">
                <div class="tableTitle">基本信息<span class="red">（标*号为必填项）</span>
                </div>
            </div>
        </div>
    </div>
    <div class="">
        <table id="eqiu_table" class="layui-hide" lay-filter="tableEvent"></table>
    </div>
    <div class="box-body">
        <form class="layui-form" name="form1" id="form1" action="" method="POST"
              lay-filter="component-form-group layui-container">
            <input name="id" id="id" value="${sreSupplierAppraise.id}" type="hidden">
            <input name="sreDetailId" id="sreDetailId" value="${sreDetail.id}" type="hidden">
            <input id="supplierAppraise" value="${sreSupplierAppraise.supplierAppraise}" type="hidden">
            <!--<input id="supplierName" name="supplierName" value="${supplierName}" type="hidden">-->
            <input id="equipmentId" name="equipmentId" value="${sreEquipment.equipmentId}" type="hidden">

            <input id="flag" value="${flag}" type="hidden">

            <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">课题名称</label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="sreProjectName" readonly="readonly" id="sreProjectName"
                                   value="${sreProject.name}" lay-verify="required" autocomplete="off" type="text">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">合同号</label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="contractNum" readonly="readonly" id="contractNum"
                                   value="${sreProject.contractNum}" lay-verify="required" autocomplete="off" type="text">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">装备名称</label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="sreEquipmentName" readonly="readonly" id="sreEquipmentName"
                                   value="${sreEquipment.name}" lay-verify="required" autocomplete="off" type="text">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">供应商</label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="supplierName" readonly="readonly" id="supplierName"
                                   value="${supplierName}" lay-verify="required" autocomplete="off" type="text">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">装备分类</label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="type" readonly="readonly" id="type"
                                   value="${sreEquipment.type}" lay-verify="required" autocomplete="off" type="text">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">单价</label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="unitPrice" readonly="readonly" id="unitPrice"
                                   value="${sreEquipment.unitPrice}" lay-verify="required" autocomplete="off" type="text">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">供应商评价<span class="must-fill">*</span></label>
                <div class="layui-input-block">
                    <input type="radio"   name="supplierAppraise" value="A" title="优"/>
                    <input type="radio"   name="supplierAppraise" value="B" title="良"/>
                    <input type="radio"   name="supplierAppraise" value="C" title="中"/>
                    <input type="radio"   name="supplierAppraise" value="D" title="差"/>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label for="" class="layui-form-label">应用情况</label>
                <div class="layui-input-block">
                <textarea placeholder="请输入应用情况" name="applicationsSituation" id="applicationsSituation"
                          class="layui-textarea">${sreSupplierAppraise.applicationsSituation}</textarea>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label for="" class="layui-form-label">维修情况</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入维修情况" name="maintenanceSituation" id="maintenanceSituation"
                              class="layui-textarea">${sreSupplierAppraise.maintenanceSituation}</textarea>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label for="" class="layui-form-label">装备整体评价</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入装备整体评价" name="equipmentOverallAppraise" id="equipmentOverallAppraise"
                              class="layui-textarea">${sreSupplierAppraise.equipmentOverallAppraise}</textarea>
                </div>
            </div>
            <!-- 按钮组  -->
                <div class="form-bottom">
                    <div class="form-bottom-btns">
                        <button type="button" class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue"
                                lay-submit="" lay-filter="sub" id="sub">保存
                        </button>
                        <button type="button"
                                class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white"
                                id="closeBtn">关闭
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        var flag = $("#flag").val();
        if(flag=="1"){
            document.getElementById("sub").style.display = "none";
        }
    })
</script>
<script>
    var publicMethods;
    var form;
    var param = JSON.parse(window.localStorage.getItem("param"));
    var functionId = param.id;
    $('#functionId').val(functionId);
    var table, selectRowData;
    layui.use(['form', 'table', 'laypage', 'layer', 'laydate', 'laytpl', 'jquery', "publicMethods"], function () {

        var admin = layui.admin
        element = layui.element
            , table = layui.table
            , layer = layui.layer
            , laydate = layui.laydate
            , laypage = layui.laypage
            , $ = layui.jquery;

        form = layui.form;
        publicMethods = layui.publicMethods;
        form.render();
        laydate.render({
            elem: '#LAY-component-form-group-date'
        });


        $(function(){

            var supplierAppraise = $("#supplierAppraise").val()
            $("input[name=supplierAppraise][value='"+supplierAppraise+"']").prop("checked", "true");
        })



        //项目分类，项目性质
        var dicMap = ['ROOT_ZBGL_ZBFL'];
        publicMethods.ajaxPost("/dictionary/map/getMapListDictionarys",{"parentCodes":JSON.stringify(dicMap)}, function (data) {
            var type = $("#type").val()

            if (type=="ROOT_ZBGL_ZBFL_RJ") {

                $("#type").val(data.ROOT_ZBGL_ZBFL[0].name);
            }else if (type=="ROOT_ZBGL_ZBFL_YJ"){

                $("#type").val(data.ROOT_ZBGL_ZBFL[1].name);
            }
        });

        //添加到form.render()之后
        $("#file_div").load('/common/public/uploadlayuiload.html');
        form.render();
        /* 监听提交 */
        form.on('submit(sub)', function (data) {
            var supplierAppraise=$("input[name='supplierAppraise']:checked").val();

            if (supplierAppraise==undefined || supplierAppraise==""){
                layer.alert("请选择供应商评价")
            }else{
                var url="/sre-supplierAppraise/save";
                var backurl="/sre-detail/to-list";
                ajaxOpt(url,"form1","POST",backurl,"保存成功","保存失败");
                return false;
            }

        });
    });




    function ajaxOpt(url, formName, type, backurl, successMsg, failMsg) {
        $("#equipmentIds").val($("#equipmentIds").val());
        $.ajax({
            type: type,
            url: url,
            dataType: "json",
            data: $("#" + formName).serialize(),
            async: false,
            cache: false,
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function (data, status) {

                if (data.success == true || data.success == 'true') {


                    layer.alert(
                        successMsg,
                        {icon: 1, closeBtn: 0},
                        function () {
                            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                            parent.layer.close(index);  // 关闭layer
                            parent.location.href = backurl;
                        });

                } else {
                    layer.alert(failMsg);
                }

            },
            error: function () {
                layer.alert("网络访问错误");
            }

        });
    }

   // var index_close;

    //关闭事件
    $("#closeBtn").click(function () {
        var index = parent.layer.getFrameIndex(window.name);
        parent.layer.close(index);
    })
</script>
</body>
</html>