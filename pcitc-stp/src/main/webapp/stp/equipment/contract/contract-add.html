<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
  <!--[if lt IE 9]>
  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css">
  <link rel="stylesheet" type="text/css" href="/layuiadmin/ztree/css/metroStyle/metroStyle.css">
  <link rel="stylesheet" href="/layuiadmin/style/common.css">
</head>
<body>
<div class="layer-box">
	<form id="planForm" class="layui-form" action="" lay-filter="component-form-group layui-container"></form>
		<div class="formBox">
			<div class="tableToolBox">
				<div class="tableBtns">
					<div class="tableTitle">基本信息<span class="red">（标*号为必填项）</span>
					</div>
				</div>
			</div>
		</div>
  <div class="box-body">
      <form class="layui-form" name="form1" id="form1" action="" method="POST" lay-filter="component-form-group layui-container">
         <input type="hidden" name="contractId" id="contractId" value="${sreContract.contractId}">
        
	      <!--行有两个的情况-->
	      <div class="layui-row">
	        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
	          <div class="layui-form-item">
	            <label for="" class="layui-form-label">合同类型<span class="must-fill">*</span></label>
	            <div class="layui-input-block">
	                <select name="contractType"  id="contractType" lay-verify=""  lay-filter="test">
		              <option value="">---请选择合同类型---</option>
		              <option value="1">软件</option>
		              <option value="2">硬件</option>
		            </select>
	          </div>
	          </div>
	        </div>
	        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
	          <div class="layui-form-item">
	            <label for="" class="layui-form-label">支付类型<span class="must-fill">*</span></label>
	            <div class="layui-input-block">
	             <select name="paymentType"  id="paymentType" lay-verify=""  lay-filter="test">
		              <option value="">---请选择支付类型---</option>
		              <option value="1">一次性支付</option>
		              <option value="2">多次支付</option>
		            </select>
	          </div>
	          </div>
	        </div>
	      </div>
      
	      <div class="layui-row">
	        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
	          <div class="layui-form-item">
	            <label for="" class="layui-form-label">合同金额<span class="must-fill">*</span></label>
	            <div class="layui-input-block">
	              <input class="layui-input" id="contracMoney" name="contracMoney" lay-verify="required"  onkeyup="clearNoNum(this)" value="${sreContract.contracMoney}"  type="text">
               </div>
	          </div>
	        </div>
	        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
	          <div class="layui-form-item">
	            <label for="" class="layui-form-label">合同开始时间<span class="must-fill">*</span></label>
	            <div class="layui-input-block">
	              <input class="layui-input" name="contractStartTime" id="contractStartTime"  value="${(sreContract.contractStartTime?string('yyyy-MM-dd HH:mm:ss'))!''}"   autocomplete="off" type="text">
	          </div>
	          </div>
	        </div>
	      </div>
	      
	      <div class="layui-row">
	        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
	          <div class="layui-form-item">
	            <label for="" class="layui-form-label">合同结束时间 <span class="must-fill">*</span></label>
	            <div class="layui-input-block">
	               <input class="layui-input" name="contractEndTime" id="contractEndTime"  value="${(sreContract.contractEndTime?string('yyyy-MM-dd HH:mm:ss'))!''}" autocomplete="off" type="text">
	          </div>
	          </div>
	        </div>
	        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
	          <div class="layui-form-item">
	            <label for="" class="layui-form-label">到货时间<span class="must-fill">*</span></label>
	            <div class="layui-input-block">
	               <input class="layui-input" name="deliveryTime" id="deliveryTime"  value="${(sreContract.deliveryTime?string('yyyy-MM-dd HH:mm:ss'))!''}"  lay-verify="datetime"  autocomplete="off" type="text">
	          </div>
	          </div>
	        </div>
	      </div>
	      
	      <div class="layui-row">
	        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
	          <div class="layui-form-item">
	            <label for="" class="layui-form-label">验货时间 <span class="must-fill">*</span></label>
	            <div class="layui-input-block">
	               <input class="layui-input" name="contractEndTime" id="contractEndTime"  value="${(sreContract.contractEndTime?string('yyyy-MM-dd HH:mm:ss'))!''}" autocomplete="off" type="text">
	          </div>
	          </div>
	        </div>
	        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
	          <div class="layui-form-item">
	            <label for="" class="layui-form-label">合同编号<span class="must-fill">*</span></label>
	            <div class="layui-input-block">
	              <input class="layui-input" id="contractCode" name="contractCode" lay-verify="required"   value="${sreContract.contractCode}"  type="text">
               </div>
	          </div>
	        </div>
	      </div>
	      
    <!--行结束-->
    <div class="form-bottom">
  		<div class="form-bottom-btns">
    		<button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue" lay-submit="" lay-filter="sub">保存</button>
       		<button type="button"class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white" id="closeBtn">关闭</button>
  		</div>
	</div>
  </form>
 </div>
</div>
   
<script src="/common/js/jquery-1.11.3.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script type="text/javascript" >
var v_date=(new Date()).getTime();
var purchasePlanId="${purchasePlanId?default('')}";
layui.config({
    base: 'layuicommon/module/modules/' //静态资源所在路径
}).extend({
    index: 'layui/tableDemo' //主入口模块
}).use(['form', 'laydate','table','layer'], function(){
	  var admin = layui.admin
      ,element = layui.element
      ,layer = layui.layer
      ,laydate = layui.laydate
      ,form = layui.form;
	  form.render(null, 'component-form-group');
	  laydate.render({
	      elem: '#LAY-component-form-group-date'
	  });
	  
	  //初始赋值 component-form-group 当前form的lay-filter
      /* form.val("component-form-group", {
          "username": "" // "name": "value"
          ,"sex": "女"
      }) */
      /* 自定义验证规则  title 要验证的input的 lay-verify=""*/
      form.verify({
    	  /* contractCode: function(value)
    	  {
              if(value.length < 5)
              {
                  return '产品用途至少得5个字符啊';
              }
          } */
          //planMoney: [/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/,'计划金额格试不正确'] 
         /*  ,pass: [/(.+){6,12}$/, '密码必须6到12位']
          ,content: function(value){
              layedit.sync(editIndex);
          } */
      });
	  
      //开始日期
      var insStart = laydate.render({
          elem: '#contractStartTime'
          ,min: 0
          ,done: function(value, date){
              //更新结束日期的最小日期
              insEnd.config.min = lay.extend({}, date, {
                  month: date.month - 1
              });

              //自动弹出结束日期的选择器
              insEnd.config.elem[0].focus();
          }
      });

      //结束日期
      var insEnd = laydate.render({
          elem: '#contractEndTime'
          ,min: 0
          ,done: function(value, date){
              //更新开始日期的最大日期
              insStart.config.max = lay.extend({}, date, {
                  month: date.month - 1
              });
          }
      });

      //日期时间选择器
      laydate.render({
          elem: '#deliveryTime'
          ,type: 'date'
      });
      //日期时间选择器
      laydate.render({
          elem: '#acceptTime'
          ,type: 'date'
      });
      //关闭事件
      $("#closeBtn").click(function () {
          var index = parent.layer.getFrameIndex(window.name);
          parent.layer.close(index);
      })
      /* 监听提交 */
      form.on('submit(sub)', function(data){
          //JSON.stringify(data.field)  提交信息json格式
          /*parent.layer.alert(JSON.stringify(data.field), {
              title: '最终的提交信息'
          })*/
          var url='/sre-contract/save?v_date='+v_date+"&purchasePlanId="+purchasePlanId;
          var backurl="/sre-contract/to-list?v_date="+v_date;
          ajaxOpt(url,"form1","POST",backurl,"保存成功","保存失败");
          return false;
      });
});


function ajaxOpt(url,formName,type,backurl,successMsg,failMsg)
{
	 $.ajax({
  	     type:type,
  	     url: url,
  	     dataType:"json",
  	     data:$("#"+formName).serialize(),
  	     async: false, 
  	     cache: false,
  	     contentType: "application/x-www-form-urlencoded; charset=utf-8",
         success:function(data,status)
         {    
    	  
	          if(data.success==true ||data.success=='true')
	          {

	        	  
	        	          layer.alert(
	        			  successMsg, 
	                      {icon: 1,closeBtn: 0 },
	                      function () 
	                      {
	                    	  var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
	                          parent.layer.close(index);  // 关闭layer
	                    	  parent.location.href=backurl;
	                      });
	        	  
	          } else
	          {
	        	 layer.alert(failMsg);
	          }
	     
		   },
		   error:function()
		   {
		    	layer.alert("网络访问错误");
		   }
    
  });
}


function clearNoNum(obj){ 
    obj.value = obj.value.replace(/[^\d.]/g,"");  //清除“数字”和“.”以外的字符  
    obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的  
    obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$","."); 
    obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3');//只能输入两个小数  
    if(obj.value.indexOf(".")< 0 && obj.value !=""){//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额 
        obj.value= parseFloat(obj.value); 
    } 
}
	
	
</script>
</body>
</html>