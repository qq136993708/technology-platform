<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" type="text/css" href="/layuiadmin/layui/css/layui.css">
<link rel="stylesheet" type="text/css" href="/layuiadmin/style/common.css">

<script type="text/javascript" src="/plugins/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
<script type="text/javascript" src="/layuiadmin/modules/base.js"></script>

<script type="text/javascript">
var publicMethods;
var v_date=(new Date()).getTime();
    $(document).ready(function() {
    	layui.use([ 'jquery', 'form', 'laydate', 'table', 'layer', 'element','publicMethods' ],function() {
 			var $ = layui.jquery, admin = layui.admin, element = layui.element, layer = layui.layer, laydate = layui.laydate;
 			publicMethods=layui.publicMethods;
 			var form = layui.form;
 			var table = layui.table;
 			
 			  form.render();
 			 var setupYear = laydate.render({
 		           elem: '#g0YEARXM'
 		           ,type: 'year'
 		       });
 			 
 			 
	    	table.render({
	            elem: '#layer_table',
	            url: '/sre_project_task/getErpInfoList',
	            limit: 15,
	            method:"POST",
	            where: {param:{"g0YEARXM":$("#g0YEARXM").val(),"g0PROJTXT":$("#g0PROJTXT").val(),"g0GSJC":$("#g0GSJC").val(),"v_date":v_date}},
	        	id: 'layer_table',
	        	height: 350,
	        	page: {first: '首页',last: '尾页',theme: '#0F9EE0'},
	            cols: [[
	            	{type:'checkbox',event: 'changeEvents'}
	             	,{title:'序号', type:'numbers'},
	             	{field : 'g0YEARXM',          title : '项目年度', style : 'cursor: pointer;', align : 'left', width : '10%'},
	                {field : 'g0GSDM',            title : '责任单位', style : 'cursor: pointer;', align : 'left', width : '10%'},
	                {field : 'g0GSJC',            title : '责任单位描述',   style : 'cursor: pointer;', align : 'center', width : '10%'},
	                {field : 'g0PROJCODE',        title : '投资项目代码', style : 'cursor: pointer;', align : 'center', width : '10%'},
	                {field : 'g0PROJTXT',         title : '投资项目名称', style : 'cursor: pointer;', align : 'left', width : '30%'},
	                {field : 'g0XMLXMS',          title : '项目类型', style : 'cursor: pointer;', align : 'left', width : '15%'}
	            ]],
	            done: function (res, curr, count) {
	            	
	            	
	            	$('.layui-table-box').find('.layui-table-body').find("table" ).find("tbody").children("tr").on('click',function(){
	                	var index=parseInt($(this).index()+1);
	                    $('tr').removeClass('layui-table-click');
	                    $(this).addClass('layui-table-click');
	                    $('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
	                    $('tr:eq('+index+')').find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
	                    selectRowData=res.data[index-1];
	                    var g0PROJCODE=selectRowData.g0PROJCODE;
	                    $("#g0PROJCODE").val(g0PROJCODE)
	                });
	            	
	 				
	            }
	        });
	    	 $(".layui-table-header table thead th input").remove();  
		    	//多行点击事件
		        $(document).on("click", ".layui-table-body table.layui-table tbody tr", function () {
		     	   	var checkCell = $(this).parent().find("tr[data-index=" + $(this).attr('data-index') + "]").find("td div.laytable-cell-checkbox div.layui-form-checkbox");
		             if (checkCell.length > 0) {
		                 checkCell.click();
		             }
		         });
		         $(document).on("click", "td div.laytable-cell-checkbox div.layui-form-checkbox", function (e) {
		             e.stopPropagation();
		         });
	    	var $ = layui.$, active = {
	    		searchEvent: function() { 
                    table.reload("layer_table",{where:{param:{"g0YEARXM":$("#g0YEARXM").val(),"g0PROJTXT":$("#g0PROJTXT").val(),"g0GSJC":$("#g0GSJC").val()}}});
                },
                addEvent:function(){
                	var check = table.checkStatus('layer_table');
                	if(check.data.length == 0){
                		layer.msg('请点击选择供应商数据!');
                		return;
                	}
                	 var taskId=$("#taskId").val();
                	 var erpNum=$("#g0PROJCODE").val();
                	 
                	 layer.confirm('确定选择此项目吗？', { btn: ['确定','取消']}, function(){ 
                		 parent.createErpBack(taskId,erpNum)
                    	 var index = parent.layer.getFrameIndex(window.name);
        			     parent.layer.close(index); 
         			}, function(){
         			 
         			});
                	 
                	
                }
        	}
        	$('.layui-btn').on('click', function(){
            	var type = $(this).data('type');
                active[type] ? active[type].call(this) : '';
            });
	    	$("#close").click(function () {
			    var index = parent.layer.getFrameIndex(window.name);
			    parent.layer.close(index);
			});
    	});
    });
</script>
</head>
<body>
<div class="formBox">
	<input type="hidden" name="g0GSJC"         id="g0GSJC"        value="${g0GSJC}">
	<input type="hidden" name="taskId"         id="taskId"        value="${taskId}">
	<input type="hidden" name="g0PROJCODE"     id="g0PROJCODE"    >
	
	
	<div class="searchBox">
		<label class="dateInput">
        	<span>ERP项目名称</span>
        	<input type="text" name="g0PROJTXT" id="g0PROJTXT" placeholder="请输入ERP项目名称" autocomplete="off" class="form-control">
    	</label>
    	<label class="dateInput">
        	<span>年份</span>
        	<input type="text" name="g0YEARXM" id="g0YEARXM" value="${g0YEARXM}" readonly="readonly" style="cursor:pointer" placeholder="请选择年度" title="年度"  autocomplete="off" class="form-control">
    	</label>
    	
    	<div class="btnGroup">
        	<button class="layui-btn layui-btn-sm fontColor-white btn_search btnMyBgImg" data-type="searchEvent">查询</button>
    	</div>
	</div>
	<div class="tableBox">
    	<table id="layer_table" class="layui-hide"  lay-filter="layer_table"></table>
	</div>
	<div class="form-bottom">
      <div class="form-bottom-btns">
         <a herf="javascript:void(0)" class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue"  data-type="addEvent" lay-filter="addEvent">确定</a>
      	<a herf="javascript:void(0)" class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white" lay-submit="" id="close" lay-filter="closeBtn">关闭</a>
      </div>
    </div>
</div>
</body>
</html>