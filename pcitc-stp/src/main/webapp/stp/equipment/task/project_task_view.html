<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css">
    <script src="/common/js/jquery-1.11.3.min.js"></script>

    <script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
    <script type="text/javascript" src="/layuiadmin/modules/base.js"></script>
   <style>
        .layui-form-label {
            width: 120px;
        }

        .layui-input-block {
            margin-left: 145px;
        }

        .layui-row {
            margin-bottom: 15px;
        }

        .tableBox table tr td, .formBoxBody table tr td {
            border: 1px solid #e6e6e6;
            height: 24px;
            line-height: 24px;
        }

        .tableBox table tr td input {
            width: 88%;
            box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
            height: 20px;
            padding: 6px 12px;
            font-size: 12px;
            line-height: 1.42857143;
            color: #555;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        #task_assessment_content .layui-input, .layui-select{
            height: 34px !important;
            width: 100% !important;
        }
        .layui-select-title input{width: 100% !important;}
    </style>
</head>
<body>


<div class="formBox">
    <div class="box-body">
        <form class="layui-form" name="form1" id="form1" action="" method="POST"
              lay-filter="component-form-group layui-container">
            <div class="layer-box">
                <input name="id" id="id" value="${id}" type="hidden">
                <input name="equipmentIds" id="equipmentIds" value="${sreProjectBasic.equipmentIds}" type="hidden">
                <input name="documentDoc" id="documentDoc" value="${documentDoc}" type="hidden">
                <input name="yearFeeStr" id="yearFeeStr" value="${sreProjectBasic.yearFeeStr}" type="hidden">
                <input name="functionId" id="functionId" type="hidden">
                <input name="userIds" id="userIds" type="hidden">
                
                  <input  name="taskContent"               id="taskContent"              value="${sreProjectTask.taskContent}"            type="hidden">
			   <input  name="taskAssessmentContent"     id="taskAssessmentContent"    value="${sreProjectTask.taskAssessmentContent}"   type="hidden">
			   <input  name="budgetTable"               id="budgetTable"           value="${sreProjectTask.budgetTable}"         type="hidden">
			   <input  name="fundsSourcesTable"         id="fundsSourcesTable"     value="${sreProjectTask.fundsSourcesTable}"   type="hidden">
                
                
                
                 <div class="layui-row" >
                    <div class="tableToolBox">
                        <div class="tableBtns">
                            <div class="tableTitle">基本信息
                            </div>
                        </div>
                    </div>
                    <div class="box-body" style="padding-left:10px;padding-right:10px">
                    
                    
			                    <div class="layui-row">
			                    <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
			                        <div class="layui-form-item">
			                            <label for="" class="layui-form-label">课题名称</label>
			                            <div class="layui-input-block">
			                                 <input class="layui-input readOnlyBox" onclick="view_project('${sreProject.id}')" title="点击查看课题信息" style="color:blue;cursor:pointer" name="name" id="name" readonly="readonly"
							                               value="${sreProject.name}" autocomplete="off" type="text">
			                            </div>
			                        </div>
			                    </div>
			                    <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
			                        <div class="layui-form-item">
			                            <label for="" class="layui-form-label">总金额(¥万元)</label>
			                            <div class="layui-input-block">
			                                <input class="layui-input readOnlyBox" style="color:red" name="projectMoney" id="projectMoney"
			                                       value="${sreProject.projectMoney}"
			                                       autocomplete="off" type="text">
			                            </div>
			                        </div>
			                    </div>
			                 </div>
			                 
                           <#if sreProjectTask.contractNum !=null> 
                            <div class="layui-form-item layui-form-text">
				                    <label class="layui-form-label">合同编号</label>
				                    <div class="layui-input-block">
				                        <input class="layui-input readOnlyBox"  style="color:green" name="contractNum" id="contractNum" readonly="readonly"
				                               value="${sreProjectTask.contractNum}" autocomplete="off" type="text">
				                    </div>
				                </div> 
				            </#if>
				            
				            
				            
				             <div class="layui-row">
				                    <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				                        <div class="layui-form-item">
				                            <label class="layui-form-label">归属部门</label>
				                            <div class="layui-input-block">
				                               
				                                <select name="belongDepartmentName" id="belongDepartmentName" disabled="disabled"
				                                        lay-filter="getDepartNameByUnitName" style="width:200px">
				                                    <option value="">--请选择部门--</option>
				                                    <#list unitFieldList as vo>
				                                    <option value="${vo.unitName}"
				                                    <#if vo.unitName == sreProjectTask.belongDepartmentName> selected="selected" </#if> >${vo.unitName}</option>
				                            </#list>
				                            </select>
				                        </div>
				                    </div>
				                </div>
				
				
				                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				                    <div class="layui-form-item">
				                        <label for="" class="layui-form-label">专业处</label>
				                        <div class="layui-input-block">
				                            <select id="professionalDepartName" name="professionalDepartName"  disabled="disabled"
				                                    lay-filter="getProfessionalNameListByUnitNameAndDept"
				                                    style="width:200px"></select>
				                        </div>
				                    </div>
				                </div>
				
				                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				                    <div class="layui-form-item">
				                        <label for="" class="layui-form-label">专业领域</label>
				                        <div class="layui-input-block">
				                            <select id="professionalFieldName" name="professionalFieldName"  disabled="disabled"
				                                    style="width:200px"></select>
				                        </div>
				                    </div>
				                </div>
                
                
                
				            
				                <div class="layui-form-item layui-form-text">
				                    <label class="layui-form-label">项目执行年限</label>
				                    <div class="layui-input-block">
				                        <div class="layui-input-inline" style="float:left">
				                            <input type="text" class="layui-input readOnlyBox" name="beginProjectMonth"
				                                   id="beginProjectMonth" value="${sreProjectTask.beginProjectMonth}"
				                                   style="width:150px;float:left" placeholder="开始月份">
				                            <div class="layui-form-mid" style="width:8px;float:left"> -</div>
				                            <input type="text" class="layui-input readOnlyBox" id="endProjectMonth" name="endProjectMonth"
				                                   value="${sreProjectTask.endProjectMonth}" style="width:150px;float:left"
				                                   placeholder="结束月份">
				                        </div>
				                    </div>
				                </div>
				
				
				                <div class="layui-form-item layui-form-text">
				                    <label class="layui-form-label">目标和主要任务</label>
				                    <div class="layui-input-block">
				                    <textarea placeholder="请简述目标和主要任务，原则上不超过500字" name="taskMainTaskContent" id="taskMainTaskContent"
				                              class="layui-textarea readOnlyBox">${sreProjectTask.taskMainTaskContent}</textarea>
				                    </div>
				                </div>
				                
				                
				                
				                
				                 <div class="layui-row">
					                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					                    <div class="layui-form-item">
					                        <label for="" class="layui-form-label">牵头单位</label>
					                        <div class="layui-input-block">
					                            <input class="layui-input readOnlyBox" name="leadUnitName" id="leadUnitName" value="${sreProjectTask.leadUnitName}"
					                                   lay-verify="required" autocomplete="off" type="text">
					                        </div>
					                    </div>
					                </div>
					                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					                    <div class="layui-form-item">
					                        <label for="" class="layui-form-label">参与单位</label>
					                        <div class="layui-input-block">
					                            <input class="layui-input readOnlyBox" name="joinUnitName" id="joinUnitName" value="${sreProjectTask.joinUnitName}"
					                                   autocomplete="off" type="text">
					                        </div>
					                    </div>
					                </div>
					            </div>
				                
				                
				                
				                 <div class="layui-row">
					                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					                    <div class="layui-form-item">
					                        <label for="" class="layui-form-label">填写单位</label>
					                        <div class="layui-input-block">
					                            <input class="layui-input readOnlyBox" name="parentUnitPathNames" id="parentUnitPathNames" value="${sreProjectTask.parentUnitPathNames}"
					                                   lay-verify="required" autocomplete="off" type="text">
					                        </div>
					                    </div>
					                </div>
					                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					                    <div class="layui-form-item">
					                        <label for="" class="layui-form-label">填写部门</label>
					                        <div class="layui-input-block">
					                            <input class="layui-input readOnlyBox" name="unitPathNames" id="unitPathNames" value="${sreProjectTask.unitPathNames}"
					                                   autocomplete="off" type="text">
					                        </div>
					                    </div>
					                </div>
					            </div>
					            
					            <div class="layui-row">
					                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					                    <div class="layui-form-item">
					                        <label for="" class="layui-form-label">填写人</label>
					                        <div class="layui-input-block">
					                            <input class="layui-input readOnlyBox" name="createUserName" id="createUserName" value="${sreProjectTask.createUserName}"
					                                   lay-verify="required" autocomplete="off" type="text">
					                        </div>
					                    </div>
					                </div>
					                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					                    <div class="layui-form-item">
					                        <label for="" class="layui-form-label">任务填写时间</label>
					                        <div class="layui-input-block">
					                         <input class="layui-input readOnlyBox" name="createDate" id="createDate" value="${sreProjectTask.createDate?string("yyyy-MM-dd HH:mm:ss")}"     autocomplete="off" type="text">
				                            </div>
					                           
					                    </div>
					                </div>
					            </div>
				                <div class="layui-row">
				                    <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				                        <div class="layui-form-item">
				                            <label for="" class="layui-form-label">上报人</label>
				                            <div class="layui-input-block">
				                                  <input class="layui-input readOnlyBox" name="applyUserName" id="applyUserName" value="${sreProjectTask.applyUserName}"
					                                   autocomplete="off" type="text">
					                        </div>
				                        </div>
				                    </div>
				                </div>
				                <div class="layui-row">
					                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					                    <div class="layui-form-item">
					                        <label for="" class="layui-form-label">上报单位</label>
					                        <div class="layui-input-block">
					                            <input class="layui-input readOnlyBox" name="parentApplyUnitPathName" id="parentApplyUnitPathName" value="${sreProjectTask.parentApplyUnitPathName}"
					                                   lay-verify="required" autocomplete="off" type="text">
					                        </div>
					                    </div>
					                </div>
					                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					                    <div class="layui-form-item">
					                        <label for="" class="layui-form-label">上报部门</label>
					                        <div class="layui-input-block">
					                            <input class="layui-input readOnlyBox" name="applyUnitName" id="applyUnitName" value="${sreProjectTask.applyUnitName}"
					                                   autocomplete="off" type="text">
					                        </div>
					                    </div>
					                </div>
					            </div>
					            
					            
					            
					          
					            
					            
					            
					            
					            <div class="layui-row">
					                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					                    <div class="layui-form-item">
					                        <label for="" class="layui-form-label">任务院内确认</label>
					                        <div class="layui-input-block">
					                           <select name="innerAuditStatus" id="innerAuditStatus" disabled="disabled"  style="color:red;width:200px">
					                                          <option value="">--未确认--</option>
					                                           <#list dicList as vo> 
																  <option value="${vo.numValue}" <#if vo.numValue ==sreProjectTask.innerAuditStatus> selected="selected" </#if> >${vo.name}</option>
																</#list>
					                            </select>
					                        </div>
					                    </div>
					                </div>
					                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
					                    <div class="layui-form-item">
					                        <label for="" class="layui-form-label">任务总部上报</label>
					                        <div class="layui-input-block">
					                           <select name="auditStatus" id="auditStatus" disabled="disabled"  style="color:red;width:200px">
					                                          <option value="">--未上报--</option>
					                                           <#list dicList as vo> 
																  <option value="${vo.numValue}" <#if vo.numValue ==sreProjectTask.auditStatus> selected="selected" </#if> >${vo.name}</option>
																</#list>
					                            </select>
					                        </div>
					                    </div>
					                </div>
					            </div>
					            
					            
				                
				                
				                
				                
                    </div>
                </div>
                
                

                


                <div class="layui-row" id="task_content">
                    <div class="tableToolBox">
                        <div class="tableTitle">项目内容和主要图表</div>
                        <div class="tableBtns">
                        </div>
                    </div>
                    <table class="layui-table">
                        <thead>
                        <tr>
                            <td width="4%">编号</td>
                            <td width="20%">单项设备名称</td>
                            <td width="28%">单项设备立项背景</td>
                            <td width="8%">经费（万元）</td>
                            <td width="8%">备注</td>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="layui-row" id="task_assessment_content">
                    <div class="tableToolBox">
                        <div class="tableTitle">
                            计划进度和考核目标
                        </div>
                        <div class="tableBtns">
                        </div>
                    </div>
                    <table class="layui-table">
                        <thead>
                        <tr>
                            <td width="15%">进度安排</td>
                            <td width="15%">考核目标</td>
                            <td width="15%">考核目标</td>
                            <td width="15%">备注</td>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>


                <div class="layui-row" id="budget_table">
                    <div class="tableToolBox">
                        <div class="tableBtns">
                            <div class="tableTitle">应提交验收的内容
                            </div>
                        </div>
                    </div>
                    <div class="box-body" style="padding-left:10px;padding-right:10px;overflow:hidden">
                        <#list checkList as vo>
                          <div style="width:200px;margin:5px;float:left;">
                            <input  disabled="disabled" type="checkbox" name="taskCheckContents" lay-skin="primary" title="${vo.name}"
                            <#list "${sreProjectTask.taskCheckContents}"?split(",") as itemValue>
                                <#if itemValue == vo.code>checked="checked"</#if>
                            </#list> value="${vo.code}">
                            </div>
                        </#list>
                    </div>
                </div>
                <div class="layui-row" id="budget_tableNew">
                    <div class="tableToolBox">
                        <div class="tableTitle">资金概算表</div>
                    </div>
                    <table class="layui-table">
                        <thead>
                        <tr>
                            <td width="15%">支出类别</td>
                            <td>项目</td>
                            <td>台套</td>
                            <td>预算金额（万元）</td>
                            <td>小计（万元）</td>
                        </tr>
                        </thead>
                        <tbody>
                        <tr class="capital">
                            <td rowspan="13">资本性支出</td>
                            <td>静止设备</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="capital">
                            <td class="layui-hide"></td>
                            <td>机械设备</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="capital">
                            <td class="layui-hide"></td>
                            <td>仪器</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="capital">
                            <td class="layui-hide"></td>
                            <td>自控仪表</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="capital">
                            <td class="layui-hide"></td>
                            <td>计算机及外围设备</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="capital">
                            <td class="layui-hide"></td>
                            <td>计算机软件</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="capital">
                            <td class="layui-hide"></td>
                            <td>备品、配件</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="capital">
                            <td class="layui-hide"></td>
                            <td>土建</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="capital">
                            <td class="layui-hide"></td>
                            <td>配套工程</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="capital">
                            <td class="layui-hide"></td>
                            <td>设计费</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="capital">
                            <td class="layui-hide"></td>
                            <td>安装费</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>

                        <tr class="capital">
                            <td class="layui-hide"></td>
                            <td>其它</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>

                        <tr class="capitalT">
                            <td class="layui-hide"></td>
                            <td>小计</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>


                        <tr class="cost">
                            <td rowspan="7">费用性支出</td>
                            <td>会议费</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="cost">
                            <td class="layui-hide"></td>
                            <td>差旅费</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="cost">
                            <td class="layui-hide"></td>
                            <td>试车、试用费</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="cost">
                            <td class="layui-hide"></td>
                            <td>外事费</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="cost">
                            <td class="layui-hide"></td>
                            <td>外协费</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="cost">
                            <td class="layui-hide"></td>
                            <td>其它费</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr class="costT">
                            <td class="layui-hide"></td>
                            <td>小计</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>合计</td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="layui-row" id="funds_sources_table">
                    <div class="tableToolBox">
                        <div class="tableTitle"> 资金来源表</div>
                        <div class="tableBtns">
                        </div>
                    </div>
                    <table class="layui-table">
                        <thead>
                        <tr>
                            <td width="20%">来源</td>
                            <td width="8%">国家拨款(万)</td>
                            <td width="8%">总部拨付(万)</td>
                            <td width="8%">负责单位自筹(万)</td>
                            <td width="8%">其它(万)</td>
                            <td width="8%">合计(万)</td>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>


                <div class="layui-row" id="project_funds_table">
                    <div class="tableToolBox">
                        <div class="tableBtns">
                            <div class="tableTitle">项目资金安排
                            </div>
                        </div>
                    </div>
                    <div class="box-body" style="padding-left:10px;padding-right:10px">

                        <label class="layui-form-label" style="width: 100%;text-align: left;margin-left: 0;">
                            ${sreProject.leadUnitName?default('')}</label>
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <td width="20%">年 度</td>
                                <td width="8%">费用性支出(万元)</td>
                                <td width="8%">资本性支出(万元)</td>
                                <td width="8%">小 计(万元)</td>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <div id="units"></div>
                    </div>
                </div>


                <div class="layui-form-item" style="position: relative;">
                    <label class="layui-form-label" style="    position: absolute;z-index: 11;text-align: left;font-size: 14px;color: #666666;left: 8px;">附件</label>
                    <div id="file_div" class="layui-input-block" style="margin-left: 0;"></div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    var param = JSON.parse(window.localStorage.getItem("param"));
    var functionId = param.id;
    var equipmentIds = $("#equipmentIds").val();

    var file_ids = "documentDoc";
    //detail:详情，edit：编辑
    file_edit_detail = "detail";
    //统管理-附件管理-附件配置：页面标识
    file_opt_flag = "b3a52bbe7087419c80813d7716f37674";
    var equipmentIds = $("#equipmentIds").val();
    //牵头单位名称
    var leadUnitName = "${sreProject.leadUnitName?default('')}";
    //牵头单位--表格
    var yearFeeStr = "${sreProject.yearFeeStr?default('')}";
    //参与单位名称
    var joinUnitName = "${sreProject.joinUnitName?default('')}";
    //参与单位名称--表格
    var yearFeeStrJoinUnit = "${sreProject.yearFeeStrJoinUnit?default('')}";

    //项目资金安排= 牵头单位 + 参与单位
    /*alert(yearFeeStr);
    alert(yearFeeStrJoinUnit);*/
    //项目内容和主要图表
    var taskContent = "${sreProjectTask.taskContent?default('')}";
    //计划进度和考核目标
    var taskAssessmentContent = "${sreProjectTask.taskAssessmentContent?default('')}";
    //资金概算表
    var budgetTable = "${sreProjectTask.budgetTable?default('')}";
    //资金来源表
    var fundsSourcesTable = "${sreProjectTask.fundsSourcesTable?default('')}";

    //alert(fundsSourcesTable);

     var belongDepartmentName="${sreProjectTask.belongDepartmentName?default('')}";
     var professionalDepartName="${sreProjectTask.professionalDepartName?default('')}";
     var professionalFieldName="${sreProjectTask.professionalFieldName?default('')}";
    var beginYear = $("#beginYear").val();
    var v_date = (new Date()).getTime();
    var equipmentIds = $("#equipmentIds").val();
    var table, selectRowData;
    layui.config({
        //base: 'layuicommon/module/modules/' //静态资源所在路径
    }).extend({
        index: 'layui/tableDemo' //主入口模块
    }).use(['form', 'table', 'laypage', 'layer', 'laydate', 'laytpl', 'jquery', "publicMethods"], function () {

        var admin = layui.admin
        element = layui.element
            , table = layui.table
            , layer = layui.layer
            , laydate = layui.laydate
            , laypage = layui.laypage
            , $ = layui.jquery
            , form = layui.form;
        var publicMethods = layui.publicMethods;
        
        
        
        
        
        form.on('select(getDepartNameByUnitName)',function(data){
        	getDepartNameByUnitName(data.value);
        })

         form.on('select(getProfessionalNameListByUnitNameAndDept)',function(data){
        	 getProfessionalNameListByUnitNameAndDept(data.value);
        })


			getDepartNameByUnitName($("#belongDepartmentName").val());
			function getDepartNameByUnitName(belongDepartmentName)
			{
				 $("#belongDepartmentName").val(belongDepartmentName);
				 $("#professionalDepartName").empty();

				 var v_date=(new Date()).getTime();
				 $.ajax({
						url : "/unitField/getDepartmentNameListByUnitName?v_date="+v_date+"&unitName="+belongDepartmentName,
						type : "post",
						async: false,
						dataType : "json",
						success : function(data)
						{
							$("#professionalDepartName").append("<option value=''>--请选择--</option>");
							$.each(data, function(i, el)
							{
								var content='<option value="'+ el.departmentName +'" ';
								if(professionalDepartName==el.departmentName)
								{
									content+=' selected="selected" ';
								}
								content+=' >' + el.departmentName+ '</option>';
								$("#professionalDepartName").append(content);

							});
							form.render('select');
						},
						error : function()
						{
							alert("发生未知错误 ,请重新操作.");
						}
					});




				getProfessionalNameListByUnitNameAndDept(professionalDepartName);
			}


			function getProfessionalNameListByUnitNameAndDept(professionalDepartName)
			{
				 var belongDepartmentName= $("#belongDepartmentName").val();
				 $("#professionalFieldName").empty();
				 var v_date=(new Date()).getTime();
				 $.ajax({
						url : "/unitField/getProfessionalNameListByUnitNameAndDept?v_date="+v_date+"&unitName="+belongDepartmentName+"&departmentName="+professionalDepartName,
						type : "post",
						async: false,
						dataType : "json",
						success : function(data)
						{
							$("#professionalFieldName").append("<option value=''>--请选择--</option>");

							$.each(data, function(i, el)
							{
								var content='<option value="'+ el.professionalFieldName +'" ';
								if(professionalFieldName==el.professionalFieldName)
								{
									content+=' selected="selected" ';
								}
								content+=' >' + el.professionalFieldName+ '</option>';

								$("#professionalFieldName").append(content);
							});
							form.render('select');
						},
						error : function()
						{
							alert("发生未知错误 ,请重新操作.");
						}
					});
			}


			
			
			

        form.render();

        renderTable(equipmentIds);
        laydate.render({
            elem: '#LAY-component-form-group-date'
        });
        
        publicMethods.createTable('', '', "project_funds_table", 2, yearFeeStr, true);
        
        var arrD = yearFeeStrJoinUnit.split(";");
        if (arrD == '') {

        } else {
            $.each(arrD, function (i, val) {
                var arrDV = arrD[i].split("#");
                var yearFeeStrN = arrD[i].substring(arrD[i].indexOf('#') + 1);
                var html = ' <div class="layui-form-item layui-form-text" >' +
                    '        <div class="layui-input-block" id="yearTr' + i + '" style="margin-left: 0;">' +
                    '        <label class="layui-form-label" style="width: 100%;text-align: left;margin-left: 0;">' + arrDV[0].split(",")[1] + '</label>' +
                    '            <table class="layui-table">' +
                    '             <thead>' +
                    '             <tr>' +
                    '                <td width="20%">年  度</td>' +
                    '                <td width="8%">费用性支出(万元)</td>' +
                    '                <td width="8%">资本性支出(万元)</td>' +
                    '                <td width="8%">小  计(万元)</td>' +
                    '             </tr>' +
                    '            </thead>' +
                    '            <tbody></tbody>' +
                    '          </table>' +
                    '        </div>' +
                    '       </div>';
                $("#units").append(html);
                publicMethods.createTable("", "", "yearTr" + i, 2, yearFeeStrN, true);
            });
        }
        
        
        //添加到form.render()之后
        $("#file_div").load('/common/public/uploadlayuiload.html');
        if(taskContent!='')
        {
            $.each(taskContent.split("|"), function (i, val) {
                var taskVal = val.split("#");
                var tr = "<tr><td>" + taskVal[0] + "</td>" +
                    "<td>" + taskVal[1] + "</td>" +
                    "<td>" + taskVal[2] + "</td> " +
                    "<td>" + taskVal[3] + " </td>" +
                    "<td>" + (taskVal[4]=='null' ? '':taskVal[4]) + "</td>" +
                    "</tr>";

                $("#task_content table tbody").append(tr);
            });
        }
        if(taskAssessmentContent!='')
        {
            $.each(taskAssessmentContent.split("|"), function (i, val) {
                var assessmentVal = val.split("#");
                var tr = "<tr><td>" + assessmentVal[0] + "</td>" +
                    "<td>" + assessmentVal[1] + "</td>" +
                    "<td>" + assessmentVal[2] + "</td>" +
                    "<td>" + assessmentVal[3] + "</td>" +
                    "</tr>";

                $("#task_assessment_content table tbody").append(tr);
            });
        }
        if(fundsSourcesTable!='')
        {
            $.each(fundsSourcesTable.split("|"), function (i, val) {
                var fundsVal = val.split("#");
                var tr = "<tr><td>"+fundsVal[0]+"</td>" +
                    "<td>"+fundsVal[1]+"</td>" +
                    "<td>"+fundsVal[2]+" </td>" +
                    "<td>"+fundsVal[3]+" </td>" +
                    "<td>"+fundsVal[4]+" </td>" +
                    "<td>"+fundsVal[5]+"</td></tr>";
                $("#funds_sources_table table tbody").append(tr);
            });
        }
        publicMethods.createTable($("#beginYear").val(), $("#endYear").val(), "yearTr", 2, yearFeeStr, true);
        if (budgetTable != '') {
            $("#budget_tableNew table tbody").empty();
            $.each(budgetTable.split("|"), function (i, val) {
                var budgetVal = val.split("#");
                if (budgetVal[0] == "资本性支出") {
                    if (i == 0) {
                        var html = '<tr class="capital">' +
                            '        <td rowspan="13">' + budgetVal[0] + '</td>' +
                            '        <td>' + budgetVal[1] + '</td>' +
                            '        <td>'+budgetVal[2]+'</td>' +
                            '        <td>'+budgetVal[3]+'</td>' +
                            '        <td>' + budgetVal[4] + '</td>' +
                            '     </tr>'
                    } else if (budgetVal[1] == "小计") {
                        var html = '<tr class="capitalT">' +
                            '        <td class="layui-hide"></td>' +
                            '        <td>' + budgetVal[1] + '</td>' +
                            '        <td>' + budgetVal[2] + '</td>' +
                            '        <td>' + budgetVal[3] + '</td>' +
                            '        <td>' + budgetVal[4] + '</td>' +
                            '     </tr>'
                    } else {
                        var html = '<tr class="capital">' +
                            '        <td class="layui-hide"></td>' +
                            '        <td>' + budgetVal[1] + '</td>' +
                            '        <td>'+budgetVal[2]+'</td>' +
                            '        <td>'+budgetVal[3]+'</td>' +
                            '        <td>' + budgetVal[4] + '</td>' +
                            '     </tr>'
                    }
                } else {
                    if (i == 13) {
                        var html = '<tr class="cost">' +
                            '        <td rowspan="7">' + budgetVal[0] + '</td>' +
                            '        <td>' + budgetVal[1] + '</td>' +
                            '        <td>'+budgetVal[2]+'</td>' +
                            '        <td>'+budgetVal[3]+'</td>' +
                            '        <td>' + budgetVal[4] + '</td>' +
                            '     </tr>'
                    } else if (budgetVal[1] == "小计") {
                        var html = '<tr class="costT">' +
                            '        <td class="layui-hide"></td>' +
                            '        <td>' + budgetVal[1] + '</td>' +
                            '        <td>' + budgetVal[2] + '</td>' +
                            '        <td>' + budgetVal[3] + '</td>' +
                            '        <td>' + budgetVal[4] + '</td>' +
                            '     </tr>'
                    } else {
                        var html = '<tr class="cost">' +
                            '        <td class="layui-hide"></td>' +
                            '        <td>' + budgetVal[1] + '</td>' +
                            '        <td>'+budgetVal[2]+'</td>' +
                            '        <td>'+budgetVal[3]+'</td>' +
                            '        <td>' + budgetVal[4] + '</td>' +
                            '     </tr>'
                    }
                }
                $("#budget_tableNew table tbody").append(html);
            });
            var htmlT = $("#budget_tableNew table tbody tr:eq(12) td:eq(2)").text() + $("#budget_tableNew table tbody tr:eq(12) td:eq(19)").text();
            var htmlTr = $("#budget_tableNew table tbody tr:eq(12) td:eq(3)").text() + $("#budget_tableNew table tbody tr:eq(12) td:eq(19)").text();
            var htmlF = $("#budget_tableNew table tbody tr:eq(12) td:eq(4)").text() + $("#budget_tableNew table tbody tr:eq(12) td:eq(19)").text();
            var html = '<tr>' +
                '       <td></td>' +
                '        <td>合计</td>' +
                '        <td>' + htmlT + '</td>' +
                '        <td>' + htmlTr + '</td>' +
                '        <td>' + htmlTr + '</td>' +
                '      </tr>';
            $("#budget_tableNew table tbody").append(html);
        }

        //关闭事件
        $("#closeBtn1").click(function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        })
    });

    function formVerify(){
        form.verify({
            validateNumber: function (value, item) {
                if (value <= 0 || value > 2000) {
                    return '请填写正确的值';
                }
            },
            specialCharacters:function (value, item) {

                if(value.indexOf("#")>=0 || value.indexOf("|")>=0){
                    return "不能填写#与|两个字符。";
                }
            }
        });
    }
    function renderTable(equipmentIds) {
        $("#equipmentIds").val(equipmentIds);
        table.render({
            elem: '#join_apply_table',
            url: '/sre-equipment/chooseEquipmentByIds?equipmentIds=' + equipmentIds,
            //  limit: 15,
            method: "GET",
            id: 'join_apply_table',
            //  height: 200,
            //page: {first: '首页',last: '尾页',theme: '#0F9EE0'},
            cols: [[
                {title: '序号', type: 'numbers'},
                {field: 'name', title: '装备名称', style: 'cursor: pointer;', align: 'center', width: '20%'},
                {field: 'type', title: '装备分类', style: 'cursor: pointer;', align: 'center', width: '10%'},
                {field: 'unitPrice', title: '单价（万元）', style: 'cursor: pointer;', align: 'center', width: '10%'},
                {field: 'applyAcount', title: '申请数量', style: 'cursor: pointer;', align: 'center', width: '10%'},
                {
                    field: 'allPrice',
                    title: '总价¥（万元）',
                    style: 'cursor: pointer;',
                    align: 'center',
                    width: '10%',
                    templet: function (d) {
                        return '<span style="color:red">' + d.allPrice + '</span>'
                    }
                },
                {field: 'applyDepartName', title: '申报部门', style: 'cursor: pointer;', align: 'center', width: '10%'},
                {field: 'firstApplyUser', title: '第一申报人', style: 'cursor: pointer;', align: 'center', width: '10%'}

            ]]
        });
    }

    function view_project(id) 
    {
    	 var temUrl="/sre-project-basic/get/" + id;
		 layer.open({
            title:'课题详情',
            skin: 'layui-layer-lan',
            shadeClose: true,
            type: 2,
            fixed: false,
            maxmin: false,
            area: ['90%', '90%'],
            content:  temUrl
        });
    }
</script>
</body>
</html>