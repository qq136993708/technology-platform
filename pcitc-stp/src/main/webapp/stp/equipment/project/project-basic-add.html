<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css">
    <script src="/common/js/jquery-1.11.3.min.js"></script>

    <script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
</head>
<body>
<div class="layer-box">

    <div class="">
        <table id="eqiu_table" class="layui-hide" lay-filter="tableEvent"></table>
    </div>
    <div class="formBox">
        <div class="tableToolBox">
            <div class="tableBtns">
                <div class="tableTitle">基本信息<span class="red">（标*号为必填项）</span>
                </div>
            </div>
        </div>
        <div class="box-body">
            <form class="layui-form" name="form1" id="form1" action="" method="POST"
              lay-filter="component-form-group layui-container">
                <input name="id" id="id" value="${id}" type="hidden">
                <input name="equipmentIds" id="equipmentIds" value="${sreProjectBasic.equipmentIds}" type="hidden">
                <input name="documentDoc" id="documentDoc" value="${documentDoc}" type="hidden">
                <input name="yearFeeStr" id="yearFeeStr" value="${sreProjectBasic.yearFeeStr}" type="hidden">
                <input name="functionId" id="functionId" type="hidden">
                <input name="userIds" id="userIds" type="hidden">
                <input name="leadUnitCode" id="leadUnitCode" value="${sreProjectBasic.leadUnitCode}" type="hidden">
                <input name="joinUnitCode" id="joinUnitCode" value="${sreProjectBasic.joinUnitCode}" type="hidden">
                <input name="entrustUnitCode" id="entrustUnitCode" value="${sreProjectBasic.entrustUnitCode}" type="hidden">
                <!-- <input name="belongDepartmentCode" id="belongDepartmentCode" value="${sreProjectBasic.belongDepartmentCode}"
                       type="hidden"> -->
                <input name="yearFeeStrJoinUnit" id="yearFeeStrJoinUnit" value="${sreProjectBasic.yearFeeStrJoinUnit}"
                       type="hidden">
                <input name="joinUnitIds" id="joinUnitIds" value="${sreProjectBasic.joinUnitIds}" type="hidden">
                <!--<input name="yearFeeStrJoinUnit" id="yearFeeStrJoinUnit"
                       value="2019-2020,苏州大学,014ef79138eb4fc49f24e4439419a5a9#2019,22,null#2020,0,null;2019-2020,北京经贸大学,01a180d1fac8465a9f283f7628dbf498#2019,0,null#2020,0,null" type="hidden">-->
                <input name="applyUnitCode" id="applyUnitCode" value="${applyUnitCode}"
                       type="hidden">
                <input name="applyUnitName" id="applyUnitName" value="${applyUnitName}" type="hidden">
                <input name="applyUnitId"   id="applyUnitId"   value="${applyUnitId}" type="hidden">       
                <input name="parentUnitPathIds"   id="parentUnitPathIds"   value="${parentUnitPathIds}" type="hidden">       
                <input name="parentUnitPathNames"   id="parentUnitPathNames"   value="${parentUnitPathNames}" type="hidden">       
                <input name="unitPathNames"   id="unitPathNames"   value="${unitPathNames}" type="hidden">       
                <input name="unitPathIds"     id="unitPathIds"   value="${unitPathIds}" type="hidden">       
                
                       
                
                 <div class="layui-form-item">
                    <label class="layui-form-label">课题名称<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                        <input class="layui-input" name="name" id="name" value="${sreProjectBasic.name}"
                                       lay-verify="required" autocomplete="off" type="text">
                    </div>
                </div>
                
                 <div class="layui-form-item" id="equipment">
                    <label class="layui-form-label">选择装备<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                        <div class="tableBox">
                            <div class="tableToolBox">
                                <div class="whiteLine"></div>
                                <div class="tableBtns">
                                    <a href="javascript:void(0)"
                                       class="layui-btn layui-btn-sm fontColor-blue borderColor-blue btn_add btnMyBgImg"
                                       data-type="selectEvent">选择</a>
                                </div>
                            </div>
                            <table id="join_apply_table" class="layui-hide" lay-filter="JoinEvent"></table>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">装备总金额(万元)</label>
                    <div class="layui-input-block">
                       <input class="layui-input readOnlyBox" placeholder="系统自动生成" style="color:red;"  readonly="readonly" name="projectMoney"  id="projectMoney" value="${sreProjectBasic.projectMoney}"
                                       autocomplete="off" type="text">提示：选择装备=装备总金额=牵头单位+参加单位
                    </div>
                </div>
            
                
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">建设年限<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                        <div class="layui-input-inline" style="float:left">
                            <input type="text" class="layui-input" name="beginYear" id="beginYear" value="${beginYear}"
                                   style="width:80px;float:left" placeholder="开始年份">
                            <div class="layui-form-mid" style="width:8px;float:left"> -</div>
                            <input type="text" class="layui-input" id="endYear" name="endYear" value="${endYear}"
                                   style="width:80px;float:left" placeholder="结束年份">
                        </div>
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                        <div class="layui-form-item">
                            <label for="" class="layui-form-label">牵头单位<span class="must-fill">*</span></label>
                            <div class="layui-input-block">
                                <input class="layui-input" readonly="readonly" onclick="chooseUnitRaio('setCompanyData')" style="cursor:pointer"  name="leadUnitName" id="leadUnitName" value="${sreProjectBasic.leadUnitName}"
                                       lay-verify="required" autocomplete="off" type="text">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label"></label>
                    <div class="layui-input-block" id="yearTr">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <td width="20%">年 度</td>
                                <td width="8%">费用性支出(万元)</td>
                                <td width="8%">资本性支出(万元)</td>
                                <td width="8%">小 计(万元)</td>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                        <label class="layui-form-label">参加单位</label>
                        <div class="layui-input-block" style="margin-bottom: 10px;">
                            <input class="layui-input" name="joinUnitName" id="joinUnitName"
                                   onclick="chooseUnitMulti('choose_joinUnitName_callback')" placeholder="请选择"
                                   value="${sreProjectBasic.joinUnitName}"  autocomplete="off" type="text">
                        </div>
                        <div id="units"></div>
                    </div>
                    
                    
                 
                <div class="layui-row">
                    <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                        <div class="layui-form-item">
                           <label class="layui-form-label">归属部门<span class="must-fill">*</span></label>
                            <div class="layui-input-block">
                              <select name="belongDepartmentCode" id="belongDepartmentCode" lay-filter="belongDepartmentCode"   style="width:200px" >
                                 <option value="ROOT_ZGSHJT_ZBJG_KJB" >科技部</option>
                              </select>
                            </div>
                        </div>
                    </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                        <div class="layui-form-item">
                            <label for="" class="layui-form-label"><span class="must-fill">*</span>专业处</label>
                            <div class="layui-input-block">
                               <select id="professionalDepartCode" name="professionalDepartCode" lay-filter="professionalDepartCode"    style="width:200px"></select>
                            </div>
                        </div>
                    </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                        <div class="layui-form-item">
                            <label for="" class="layui-form-label"><span class="must-fill">*</span>专业领域</label>
                            <div class="layui-input-block">
                              <select id="professionalFieldCode" name="professionalFieldCode"   style="width:200px"></select>
                            </div>
                        </div>
               </div>
                    
                <!--行有两个的情况-->
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label layui-form-labelH">课题开发及投资目标<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                        <textarea placeholder="请简述开发及投资目标，原则上不超过500字" name="remarks" id="remarks" lay-verify="required"
                                  class="layui-textarea">${sreProjectBasic.remarks}</textarea>
                    </div>
                </div>
                
                
                <div class="layui-form-item">
                        <label class="layui-form-label">附件</label>
                        <div id="file_div" class="layui-input-block"></div>
                    </div>
                <div class="form-bottom">
                        <div class="form-bottom-btns">
                            <button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue"
                                    lay-submit="" lay-filter="sub">保存
                            </button>
                            <button type="button"
                                    class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white"
                                    id="closeBtn">关闭
                            </button>
                        </div>
                    </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript">

</script>
<script>
    var publicMethods;
    var form;
    var param = JSON.parse(window.localStorage.getItem("param"));
    var functionId = param.id;
    $('#functionId').val(functionId);
    var roleCodes = "";
    var unitCodes = "";
    var postCodes = "";
    var belongDepartmentCode="${sreProjectBasic.belongDepartmentCode?default('')}";
    var professionalDepartCode="${sreProjectBasic.professionalDepartCode?default('')}";
    var professionalFieldCode="${sreProjectBasic.professionalFieldCode?default('')}";
    var v_date = (new Date()).getTime();
    var file_ids = "documentDoc";
    //detail:详情，edit：编辑
    file_edit_detail = "edit";
    //统管理-附件管理-附件配置：页面标识
    file_opt_flag = "b3a52bbe7087419c80813d7716f37674";
    var equipmentIds = $("#equipmentIds").val();
    var yearFeeStr = $("#yearFeeStr").val();
    var beginYear = $("#beginYear").val();

    var table, selectRowData;
    layui.use(['form', 'table', 'laypage', 'layer', 'laydate', 'laytpl', 'jquery', "publicMethods"], function () {

        var admin = layui.admin
        element = layui.element
            , table = layui.table
            , layer = layui.layer
            , laydate = layui.laydate
            , laypage = layui.laypage
            , $ = layui.jquery;

        form = layui.form;
        publicMethods = layui.publicMethods;
        form.render();
        laydate.render({
            elem: '#LAY-component-form-group-date'
        });


	         form.on('select(belongDepartmentCode)',function(data){
	        	getDepartNameByUnitName(data.value);
	         });
	         
	         form.on('select(professionalDepartCode)',function(data){
	        	 getProfessionalNameListByParentCode(data.value);
	         });

			 getDepartNameByUnitName($("#belongDepartmentCode").val());
			 function getDepartNameByUnitName(depp_code)
			 {
				 $("#professionalDepartCode").empty();
                // alert(belongDepartmentCode);
                if(depp_code!=null && depp_code!='')
                {
                	 var v_date=(new Date()).getTime();
    				 $.ajax({
    						url : "/sre-project-basic/getDicListByParentCode?v_date="+v_date+"&parentCode="+depp_code,
    						type : "post",
    						async: false,
    						dataType : "json",
    						success : function(data)
    						{
    							$("#professionalDepartCode").append("<option value=''>--请选择--</option>");
    							$.each(data, function(i, el)
    							{
    								var content='<option value="'+ el.code +'" ';
    								var name=el.name;
    								if(professionalDepartCode==el.code)
    								{
    									content+=' selected="selected" ';
    								}
    								content+=' >' + el.name+ '</option>';
    								var name=el.name;
    								//if(name!='综合计划处')
    								//{
    									$("#professionalDepartCode").append(content);
    								//}
    								
    								

    							});
    							
    						},
    						error : function()
    						{
    							alert("发生未知错误 ,请重新操作.");
    						}
    					});
                }
                var code_temp=$("#professionalDepartCode").val();
                getProfessionalNameListByParentCode(code_temp);
                form.render('select');
			}
			
			
			
			

			function getProfessionalNameListByParentCode(parentCode)
			{
				if(parentCode==null || parentCode=='')
				{
					parentCode='-1';
				}
				 $("#professionalFieldCode").empty();
				 var v_date=(new Date()).getTime();
				 $.ajax({
						url : "/sre-project-basic/getDicListByParentCode?v_date="+v_date+"&parentCode="+parentCode,
						type : "post",
						async: false,
						dataType : "json",
						success : function(data) 
						{
							$("#professionalFieldCode").append("<option value=''>--请选择--</option>");
							$.each(data, function(i, el) 
							{
								
								var content='<option value="'+ el.code +'" ';
								if(professionalFieldCode==el.code)
								{
									content+=' selected="selected" ';
								}
								content+=' >' + el.name+ '</option>';
								$("#professionalFieldCode").append(content);
								
							});
						},
						error : function() 
						{
							alert("发生未知错误 ,请重新操作.");
						}
					});
				 form.render('select');
			}


		


        var equipmentIds = $("#equipmentIds").val();
        renderTable(equipmentIds)

        publicMethods.createTable($("#beginYear").val(), $("#endYear").val(), "yearTr", 2, yearFeeStr);


        //添加到form.render()之后
        $("#file_div").load('/common/public/uploadlayuiload.html');


        /* 自定义验证规则  title 要验证的input的 lay-verify=""*/
        form.verify({
            name: function (value) {
                if (value.length < 5) {
                    return '装备名称至少得5个字符啊';
                }
            },
            planMoney: [/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/, '计划金额格试不正确']
            /*  ,pass: [/(.+){6,12}$/, '密码必须6到12位']
             ,content: function(value){
                 layedit.sync(editIndex);
             } */
        });


        //开始日期
        var insStart = laydate.render({
            elem: '#beginYear'
            , min: 0, type: 'year'
            , done: function (value, date) {
                //更新结束日期的最小日期
                insEnd.config.min = lay.extend({}, date, {
                    month: date.month - 1
                });
                //自动弹出结束日期的选择器
                insEnd.config.elem[0].focus();
            }
        });

        //结束日期
        var insEnd = laydate.render({
            elem: '#endYear'
            , min: 0, type: 'year'
            , done: function (value, date) {
                //更新开始日期的最大日期
                insStart.config.max = lay.extend({}, date, {
                    month: date.month - 1
                });
                publicMethods.createTable($("#beginYear").val(), date.year, "yearTr", 2, yearFeeStr);
            }
        });
        $('.layui-btn').on('click', function () {
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
        var $ = layui.$, active = {
            selectEvent: function () {
                //var temUrl = "/intl_project/plant_edit_selectapply?equipmentIds="+$("#equipmentIds").val();
                var temUrl = '/sre-equipment/chooseEquipmentByUser?equipmentIds=' + $("#equipmentIds").val()+"&isLinkedProject=0";
                publicMethods.openBaseWin("选择装备", temUrl, "90%", "80%");

            }

        }
        form.verify({
            validateNumber: function (value, item) {
            	
            	if(isNaN(value))
            	{
            		 return '请输入整数';
            	}else if (value <= 0) 
                {
                    return '请输入费用';
                }else if (value > 2000) 
                {
                    return '费用不能大于2000万';
                }
            }
        });
       
        var arrD = $("#yearFeeStrJoinUnit").val().split(";");
        if(arrD==''){

        }else {
            $.each(arrD, function (i, val) {
                var arrDV=arrD[i].split("#");
                var yearFeeStrN=arrD[i].substring(arrD[i].indexOf('#')+1);
                var html = ' <div class="layui-form-item layui-form-text" >' +
                    '        <div class="layui-input-block" id="yearTr'+i+'">' +
                    '        <label class="layui-form-label" style="width: 100%;text-align: left;margin-left: 0;">' + arrDV[0].split(",")[1] + '</label>' +
                    '            <table class="layui-table">' +
                    '             <thead>' +
                    '             <tr>' +
                    '                <td width="20%">年  度</td>' +
                    '                <td width="8%">费用性支出(万元)</td>' +
                    '                <td width="8%">资本性支出(万元)</td>' +
                    '                <td width="8%">小  计(万元)</td>' +
                    '             </tr>' +
                    '            </thead>' +
                    '            <tbody></tbody>' +
                    '          </table>' +
                    '        </div>' +
                    '       </div>';
                $("#units").append(html);
                publicMethods.createTable($("#beginYear").val(), $("#endYear").val(), "yearTr"+i, 2, yearFeeStrN);
                formVerify();
            });
        }

        window.chooseUnitMulti=function (choose_leadUnitName_callback) {
            v_date = (new Date()).getTime();
            var temUrl = "/unit/chooseUnitMulti?v_date=" + v_date + "&funcName=" + choose_leadUnitName_callback;//funcName(unitId,unitName) 选择机构后的回调方法名(自定义 ),回调方法里面有两个参数，unitId是机构ID,unitName是机构名
            layer.open({
                title: '选择机构',
                skin: 'layui-layer-lan',
                shadeClose: true,
                type: 2,
                fixed: false,
                //若使用小窗口形式，则修改 maxmin 值为 true，则注释掉area:[100%,100%]属性,同时设置area: ['900px', '450px']
                maxmin: true,
                //若直接弹出页面 ，则修改 area;[100%,100%]，同时设置 maxmin 为false
                area: ['500px', '500px'],
                content: temUrl,
                end: function () {
                    var arrJ = $("#joinUnitName").val().split(",");
                    if(arrJ=='undefined'|| arrJ=='')
                    {
                      
                    }else {
                        $("#units").empty();
                        $.each(arrJ, function (i, val) {
                            var html = ' <div class="layui-form-item layui-form-text" >' +
                                '        <div class="layui-input-block" id="yearTr'+i+'">' +
                                '        <label class="layui-form-label" style="width:100%;text-align: left;margin-left: 0;">' + arrJ[i] + '</label>' +
                                '            <table class="layui-table">' +
                                '             <thead>' +
                                '             <tr>' +
                                '                <td width="20%">年  度</td>' +
                                '                <td width="8%">费用性支出(万元)</td>' +
                                '                <td width="8%">资本性支出(万元)</td>' +
                                '                <td width="8%">小  计(万元)</td>' +
                                '             </tr>' +
                                '            </thead>' +
                                '            <tbody></tbody>' +
                                '          </table>' +
                                '        </div>' +
                                '       </div>';
                            $("#units").append(html);
                            publicMethods.createTable($("#beginYear").val(), $("#endYear").val(), "yearTr"+i, 2, yearFeeStr);
                        });
                    }
                }
            });
        }
        /* 监听提交 */
        form.on('submit(sub)', function (data) {
            //JSON.stringify(data.field)  提交信息json格式
            /*parent.layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            })*/
            /*选择装备总值*/
            var equipmentT=0;
            for(var i=0;i<$("#equipment table tbody tr").length;i++){
                equipmentT+=parseInt($("#equipment table tbody tr").eq(i).find("td:eq(5)").text());
            }
            /*牵头单位+参与单位总值*/
            var qT=parseInt($("#yearTr table tbody tr:last td:last").text());
            var cT=0;
            $("#units .layui-form-item").each(function (k,val) {
                cT+=parseInt($("#units .layui-form-item").eq(k).find("table tbody tr:last td:last").text());
            });
            var qcT=qT+cT;
            
            /*获取参与单位的数据*/
           var joinUnitName= $("#joinUnitName").val();
           //alert(joinUnitName);
           if(joinUnitName!=null && joinUnitName!='')
       	   {
        	   var arrJ = $("#joinUnitName").val().split(",");
               var arrId=$("#joinUnitIds").val().split(",");
               var yearFeeStrJoinUnit='';
               $.each(arrJ, function (i, val) {
                   var year=$("#beginYear").val()+"-"+$("#endYear").val();
                   var name=arrJ[i],id=arrId[i];
                   yearFeeStrJoinUnit+=year+","+name+","+id+"#"+publicMethods.getVal("yearTr"+i, 4)+";"
               });
               $("#yearFeeStrJoinUnit").val(yearFeeStrJoinUnit.substring(0,yearFeeStrJoinUnit.length-1));
       	   }
           
            $("#yearFeeStr").val(publicMethods.getVal("yearTr", 4));
            var yearFee_Str = $("#yearFeeStr").val();
            var belongDepartmentCode = $("#belongDepartmentCode").val();
            var professionalDepartCode = $("#professionalDepartCode").val();
            var professionalFieldCode = $("#professionalFieldCode").val();
            console.log("专业处:"+professionalDepartCode);
            
            var equipmentIds = $("#equipmentIds").val();
            if (equipmentIds == null || equipmentIds == '')
            {
                layer.alert("请选择装备");
            }else
            if (yearFee_Str == null || yearFee_Str == '')
            {
                layer.alert("建设年限为空");
            }else if (belongDepartmentCode == null || belongDepartmentCode == '')
            {
                layer.alert("请选择所属部门");
            }else if (professionalDepartCode == null || professionalDepartCode == '')
            {
                layer.alert("请选择专业处");
            }else if (professionalFieldCode == null || professionalFieldCode == ''){
            	 layer.alert("请选择专业领域");
            }else if(equipmentT!=qcT)
           	{
           	   layer.alert("所选装备总金额("+equipmentT+"万元)与建设年限总金额("+qcT+"万元)不相等，请重新调整");
          	}else
            {
          		$("#projectMoney").val(equipmentT);
                var url="/sre-project-basic/save?v_date="+v_date;
                var backurl="/sre-project-basic/to-list?v_date="+v_date;
                ajaxOpt(url,"form1","POST",backurl,"保存成功","保存失败");
          		
            }
            return false;
        });

    });




    function ajaxOpt(url, formName, type, backurl, successMsg, failMsg) {
        $("#equipmentIds").val($("#equipmentIds").val());
        $.ajax({
            type: type,
            url: url,
            dataType: "json",
            data: $("#" + formName).serialize(),
            async: false,
            cache: false,
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function (data, status) {

                if (data.success == true || data.success == 'true') {


                    layer.alert(
                        successMsg,
                        {icon: 1, closeBtn: 0},
                        function () {
                            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                            parent.layer.close(index);  // 关闭layer
                            parent.location.href = backurl;
                        });

                } else {
                    layer.alert(failMsg);
                }

            },
            error: function () {
                layer.alert("网络访问错误");
            }

        });
    }

    function renderTable(equipmentIds) {
        $("#equipmentIds").val(equipmentIds);
        table.render({
            elem: '#join_apply_table',
            url: '/sre-equipment/chooseEquipmentByIds?equipmentIds=' + equipmentIds,
            limit: 15,
            method: "GET",
            id: 'join_apply_table',
            height: 300,
            //page: {first: '首页',last: '尾页',theme: '#0F9EE0'},
            cols: [[

                {title: '序号', type: 'numbers'},
                {field: 'name', title: '装备名称', style: 'cursor: pointer;', align: 'center', width: '30%'},
                {field: 'type', title: '装备分类', style: 'cursor: pointer;', align: 'center', width: '10%'},
                {field: 'unitPrice', title: '单价（万元）', style: 'cursor: pointer;', align: 'center', width: '10%'},
                {field: 'applyAcount', title: '申请数量', style: 'cursor: pointer;', align: 'center', width: '10%'},
                {
                    field: 'allPrice',
                    title: '总价￥（万元）',
                    style: 'cursor: pointer;',
                    align: 'center',
                    width: '10%',
                    templet: function (d) {
                        return '<span style="color:red">' + d.allPrice + '</span>'
                    }
                },
                {field : 'parentUnitPathNames', title : '申报单位', style : 'cursor: pointer;', align : 'left', width : '30%'},
                {field : 'applyDepartName', title : '申报部门', style : 'cursor: pointer;', align : 'left', width : '20%'},
                {field: 'firstApplyUser', title: '申报人', style: 'cursor: pointer;', align: 'center', width: '10%'}

            ]],
            done: function (res, curr, count) {

                //项目分类，项目性质
                var dicMap = ['ROOT_ZBGL_ZBFL'];
                var dicVal = {};
                publicMethods.ajaxPost("/dictionary/map/getMapListDictionarys", {"parentCodes": JSON.stringify(dicMap)}, function (data) {
                    $.each(data, function (key, val) {
                        $.each(val, function (i, dt) {
                            dicVal[dt.code] = dt.name;
                        });
                    });
                });
                $.each(res.data, function (i, dt) {
                    $("tr[data-index='" + i + "'] td[data-field='type'] div").html(dicVal[res.data[i].type]);
                });

            }
        });
    }

    var index_close;




    //参加单位--多个
    function choose_joinUnitName_callback(unitIds, unitNames,unitCode) {
    	console.log("joinUnitCode="+unitIds+" joinUnitName="+unitNames+" unitCode="+unitCode);
        $("#joinUnitName").val(unitNames);
        $("#joinUnitCode").val("");
        $("#joinUnitIds").val(unitIds);
    }

    function choose_belongDepartmentName_callback(unitId, unitName) {
        //$("#belongDepartmentName").val(unitName);
        $("#belongDepartmentCode").val(unitId);
    }

    function choose_leadUnitName_callback(unitId, unitName) {
        $("#leadUnitName").val(unitName);
        $("#leadUnitCode").val(unitId);
    }

    function clearNoNum(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, "");  //清除“数字”和“.”以外的字符
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');//只能输入两个小数
        if (obj.value.indexOf(".") < 0 && obj.value != "") {//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
            obj.value = parseFloat(obj.value);
        }
    }

    //关闭事件
    $("#closeBtn").click(function () {
        var index = parent.layer.getFrameIndex(window.name);
        parent.layer.close(index);
    })
  function formVerify(){
        	form.verify({
                validateNumber: function (value, item) {
                	if(isInteger(value)==false)
                	{
                		 return '请输入整数';
                	}else  if (value <= 0 || value > 2000) {
                        return '请填写正确的值';
                    }
                },
                specialCharacters:function (value, item) {
                    if(value.indexOf("#")>=0 || value.indexOf("|")>=0){
                        return "不能填写#与|两个字符。";
                    }
                }
            });
        }
        function isInteger(str) {
        	return /^\d+$/.test(str);
        }
    
    //金额： 所选装备=牵头单位+参与单位
    function checkAllMoney(mainUnitMoney, joinUnitMoney) {
        var flag = false;
        var url = "/sre-equipment/get_money_by_ids?v_date=" + v_date + "&equipmentIds=" + $("#equipmentIds").val();
        $.ajax({
            type: 'get',
            url: url,
            dataType: "json",
            async: false,
            cache: false,
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function (data, status) {
                if (data.success == true || data.success == 'true') {
                    var money = data.data;
                    alert(money);
                    var temp = parseInt(mainUnitMoney) + parseInt(joinUnitMoney);//所选装备=牵头单位+参与单位
                    if (money == temp) {
                        flag = true;
                    }
                }

            },
            error: function () {
                layer.alert("网络访问错误");
            }

        });
        return flag;
    }

    
    
    function chooseUnitRaio(callback_funcName) 
    {
    	 var v_date=(new Date()).getTime();
	    layer.open({
	        title: '选择单位'
	        , skin: 'layui-layer-lan'
	        , shadeClose: true
	        , type: 2
	        , fixed: false
	        //若使用小窗口形式，则修改 maxmin 值为 true，则注释掉area:[100%,100%]属性,同时设置area: ['900px', '450px']
	        , maxmin: false
	        //若直接弹出页面 ，则修改 area;[100%,100%]，同时设置 maxmin 为false
	        , area: ['80%', '90%']
	        , content: "/unit_select_radio?v_date="+v_date+"&funcName="+callback_funcName
	    }); 
    
    }
    
    
    
    function setCompanyData(leadUnitCode,leadUnitName) 
    {
    	$("#leadUnitName").val(leadUnitName);
    	$("#leadUnitCode").val(leadUnitCode);
    }


</script>
</body>
</html>