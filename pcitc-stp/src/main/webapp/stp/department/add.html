<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/ztree/css/metroStyle/metroStyle.css">
    <link rel="stylesheet" href="/layuiadmin/style/common.css">
    <script type="text/javascript" src="/layuiadmin/javascript/ckeditor5/ckeditor.js"></script>
</head>
<body>
<div class="layer-box">
    <!--<input type="hidden" name="meetingDoc" id="meetingDoc" value="${meetingDoc}">-->
    <!--<form id="planForm" class="layui-form" action="" lay-filter="component-form-group layui-container"></form>-->
    <div class="formBox">
        <div class="tableToolBox">
            <div class="tableBtns">
                <div class="tableTitle">基本信息<span class="red">（标*号为必填项）</span>
                </div>
            </div>
        </div>
        <div class="box-body">
            <form class="layui-form" name="form1" id="form1" action="" method="POST"
                  lay-filter="component-form-group layui-container">
                <input type="hidden" name="id" id="id" value="${department.id}">

                <div class="layui-form-item">
                    <label class="layui-form-label">标题<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                         <select name="type" id="type" >
		                      <option value="" >--请选择--</option>
				              <#list list as vo> 
						          <option  value="${vo.name}" <#if department.type==vo.name>selected="selected"</#if> >${vo.name}</option>
						      </#list>
		              </select>
                    </div>
                </div>
                

                <div class="layui-form-item">
                    <label class="layui-form-label">简介<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                    <textarea placeholder="请输入简介" name="breif" id="breif" lay-verify="breif" class="layui-textarea">${department.breif}</textarea>
                    </div>
                </div>
                
                <div class="layui-form-item">
                    <label class="layui-form-label">发展历程<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                    <textarea placeholder="请输入发展历程" name="developHistory" id="developHistory" lay-verify="developHistory" class="layui-textarea">${department.developHistory}</textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">组织<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                    <textarea placeholder="请输入组织" name="organization" id="organization" lay-verify="organization" class="layui-textarea">${department.organization}</textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">人员<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                    <textarea placeholder="请输入简介" name="personnel" id="personnel" lay-verify="personnel" class="layui-textarea">${department.personnel}</textarea>
                    </div>
                </div>
                
                <div class="layui-form-item">
                    <label class="layui-form-label">荣誉<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                    <textarea placeholder="请输入荣誉" name="honor" id="honor" lay-verify="honor" class="layui-textarea">${department.honor}</textarea>
                    </div>
                </div>
                <!-- <div class="layui-form-item">
                    <label class="layui-form-label">主要装备<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                    <textarea placeholder="请输入简介" name="major" id="major" lay-verify="major" class="layui-textarea">${department.major}</textarea>
                    </div>
                </div> -->
                

                <div class="layui-form-item">
                    <label class="layui-form-label">备注</label>
                    <div class="layui-input-block">
                        <textarea name="notes" id="notes" class="layui-textarea">${department.notes}</textarea>
                    </div>
                </div>


                <!--行结束-->
                <div class="form-bottom">
                    <div class="form-bottom-btns">
                        <button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue"
                                lay-submit="" lay-filter="sub">保存
                        </button>
                        <button type="button"
                                class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white"
                                id="closeBtn">关闭
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script type="text/javascript">
    var v_date = (new Date()).getTime();
    var id = "${id?default('')}";


    layui.config({
        base: 'layuicommon/module/modules/' //静态资源所在路径
    }).extend({
        index: 'layui/tableDemo' //主入口模块
    }).use(['form', 'laydate', 'table', 'layer'], function () {
        var admin = layui.admin
            , element = layui.element
            , layer = layui.layer
            , laydate = layui.laydate
            , form = layui.form;
        form.render(null, 'component-form-group');

        var myEditor = null;
        ClassicEditor.create(document.querySelector('#breif'),{
        	   language:"zh-cn"
                ,image: {
                    toolbar: [ 'imageTextAlternative' ]
                }
                ,
                ckfinder: {
                    uploadUrl: '/sysfile/ckupload5?type=Image'
                }
        	
        }).then(editor => {
            myEditor = editor;
    	});
        
        
        
        var myEditor_developHistory = null;
        ClassicEditor.create(document.querySelector('#developHistory'),{
        	language:"zh-cn"
                ,image: {
                    toolbar: [ 'imageTextAlternative' ]
                }
                ,
                ckfinder: {
                    uploadUrl: '/sysfile/ckupload5?type=Image'
                }
        	
        }).then(editor => {
        	myEditor_developHistory = editor;
    	});
        
        
        var myEditor_organization = null;
        ClassicEditor.create(document.querySelector('#organization'),{
        	language:"zh-cn"
                ,image: {
                    toolbar: [ 'imageTextAlternative' ]
                }
                ,
                ckfinder: {
                    uploadUrl: '/sysfile/ckupload5?type=Image'
                }
        	
        }).then(editor => {
        	myEditor_organization = editor;
    	});
        
        
        
        var myEditor_personnel = null;
        ClassicEditor.create(document.querySelector('#personnel'),{
        	language:"zh-cn"
                ,image: {
                    toolbar: [ 'imageTextAlternative' ]
                }
                ,
                ckfinder: {
                    uploadUrl: '/sysfile/ckupload5?type=Image'
                }
        }).then(editor => {
        	myEditor_personnel = editor;
    	});
        
        
        
        var myEditor_honor = null;
        ClassicEditor.create(document.querySelector('#honor'),{
        	language:"zh-cn"
                ,image: {
                    toolbar: [ 'imageTextAlternative' ]
                }
                ,
                ckfinder: {
                    uploadUrl: '/sysfile/ckupload5?type=Image'
                }
        }).then(editor => {
        	myEditor_honor = editor;
    	});
        
        
      /*   var myEditor_major = null;
        ClassicEditor.create(document.querySelector('#major'),{}).then(editor => {
        	myEditor_major = editor;
    	});  */

        /* 自定义验证规则  title 要验证的input的 lay-verify=""*/
        form.verify({
            title: function (value) {
                if (value.length < 5) {
                    return '地点至少得5个字符啊';
                }
            }
        });

        //关闭事件
        $("#closeBtn").click(function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        })

        /* 监听提交 */
        form.on('submit(sub)', function (data) {
            //JSON.stringify(data.field)  提交信息json格式
            /*parent.layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            })*/
            console.log("--breif\n"+myEditor.getData());
             $("#breif").val(myEditor.getData());
            $("#developHistory").val(myEditor_developHistory.getData());
            $("#organization").val(myEditor_organization.getData());
            
            $("#personnel").val(myEditor_personnel.getData());
            $("#honor").val(myEditor_honor.getData());
            //$("#major").val(myEditor_major.getData()); 
            
            var url = '/department/save?v_date=' + v_date + "&id=" + id;
            var backurl = "/department/to-list?v_date=" + v_date;
            ajaxOpt(url, "form1", "POST", backurl, "保存成功", "保存失败");
            return false;
        });
    });


    function ajaxOpt(url, formName, type, backurl, successMsg, failMsg) {
        $.ajax({
            type: type,
            url: url,
            dataType: "json",
            data: $("#" + formName).serialize(),
            async: false,
            cache: false,
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function (data, status) {

                if (data.success == true || data.success == 'true') {


                    layer.alert(
                        successMsg,
                        {icon: 1, closeBtn: 0},
                        function () {
                            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                            parent.layer.close(index);  // 关闭layer
                            parent.location.href = backurl;
                        });

                } else {
                    layer.alert(failMsg);
                }

            },
            error: function () {
                layer.alert("网络访问错误");
            }

        });
    }

    function clearNoNum(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, "");  //清除“数字”和“.”以外的字符
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');//只能输入两个小数
        if (obj.value.indexOf(".") < 0 && obj.value != "") {//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
            obj.value = parseFloat(obj.value);
        }
    }

</script>
</body>
</html>