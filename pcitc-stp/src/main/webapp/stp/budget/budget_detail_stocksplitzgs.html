<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>经费预算-集团经费预算详情</title>
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css?+Math.random()">
    <script src="/layuiadmin/layui/layui.js"></script>
    <style>
        body{color: #666666;}
        .headline-box{box-sizing: border-box;padding-top: 10px;height: 106px;width: 100%;margin-bottom: 15px;}
        .headline-title{height: 58px;line-height: 58px;text-align: center;font-size: 20px;color: #000000;}
        .headline-tool{position: relative;height: 52px;margin: 0 10px;}
        .headline-tool .tool-left{position: absolute;left: 0;top: 12px;height: 28px;line-height: 28px;}
        .tool-left input{width: 96px;border: 1px solid #e6e6e6;}
        .tool-left select{width: 150px;border: 1px solid #e6e6e6;}
        .tool-left .dateInput{position: relative;}
        .dateInput i{position: absolute; top: -4px; right: 6px;}
        .headline-tool .tool-center{position: absolute;left: 50%;top: 6px;margin-left: -47px;}
        .headline-tool .tool-right{position: absolute;right: 0;top: 12px;}
        .num-box{float: left;padding-left: 10px; color: red;margin-top: 4px;}
        .num-box input{width: 90px;padding-left: 6px; background: #ffffff; border: 1px solid #e6e6e6;color: red;}
        .content-box{height: 42px; line-height: 42px;margin: 0 10px;}
        .content-box .items{float: left; margin-right: 18px;}
        .content-box .items span{color: #000000;}
        .doc-box{margin: 0 10px;}
        .doc-box p {height: 26px;line-height: 26px;}
        .doc-box ul li{line-height: 26px;}
        .layui-table-header table thead tr th div{text-align: center;}
    </style>
</head>
<body>
    <div class="headline-box">
        <div class="headline-title" title="集团经费预算总表">
            	<span class="nd">${nd}</span>年股份分子公司经费预算表
        </div>
        <div class="headline-tool" style="display: none;">
            <div class="tool-left">
                <label class="dateInput">
                    <span>编制年度</span>
                    <input type="text" readonly="readonly" id="choose-year">
                    <i class="layui-icon layui-icon-date"></i>
                </label>
            </div>
        </div>
    </div>
    <div class="tableBox">
        <div class="tableToolBox">
        	<div class="num-box">
	                <label class="dateInput">
	                    <span>单位：万元</span>
	                </label>
	         </div>
        </div>
        <div id="tableBox">
            <table id="dataTable" class="layui-table" lay-filter="dataTable" lay-data="{ID:'dataTable',height: '400',limit:100, url:'',totalRow: true}">
                <thead>
	                <tr>
	                	<th lay-data="{type:'numbers',align: 'center', width: '5%',totalRowText: '合计'}" rowspan="2">序号</th>
	                    <th lay-data="{field:'organName', width: '15%'}" rowspan="2">专业处/部门</th>
	                    <!--  <th lay-data="{field:'total', width: '6%',align: 'center',totalRow: true}" rowspan="2">合计</th> -->
	                    <#list items as item>
	                    	<#list item?keys as key> 
	                    		<th lay-data="{field:'${key}_total', align: 'right',totalRow: true}" colspan="3">${item[key]}</th>
	                    	</#list> 
	                    </#list>
	                </tr>
	                 <tr>
	                    <#list items as item>
	                    	<#list item?keys as key> 
	                    		<th lay-data="{field:'${key}_total',align: 'right',totalRow: true}">预算</th>
	                    		<th lay-data="{field:'${key}_jz', align: 'right',totalRow: true}">老合同</th>
	                    		<th lay-data="{field:'${key}_xq', align: 'right',totalRow: true}">可新签</th>
	                    	</#list> 
	                    </#list>
	                </tr>
                </thead>
            </table>
        </div>
    </div>
    

    <script>
	    var cu_date = "${nd?default(0)}";
	    var dataId = "${dataId}";
	    var unitCodes = "${unitCodes?default(0)}";
	    var budget_info_map=null;
	    var curent_tabel_data = null;//当前表格数据
	    var curent_budget_info = null;//当前报表
	    var selectRowData=null;
        layui.use(['jquery', 'table', 'laydate', 'layer','publicMethods'], function () {
            var $ = layui.jquery, table = layui.table, laydate = layui.laydate, layer = layui.layer,publicMethods=layui.publicMethods; 
            var param = JSON.parse(window.localStorage.getItem("param"));
            renderfunc = function(){
            	$(".layui-table-header table thead th .layui-unselect").remove();  //移除表头的复选框,去掉全选
	        	//行单击选中事件绑定
	        	$('.layui-table-box').find('.layui-table-body').find("table" ).find("tbody").children("tr").on('click',function(){
	              	  var index=parseInt($(this).index()+1);
	                  $('tr').removeClass('layui-table-click');
	                  $(this).addClass('layui-table-click');
	                  $('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
	                  $(this).find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
	            }); 
	        }
            if(cu_date != 0){
            	$(".headline-tool").css("display","block");
            	laydate.render({elem: '#choose-year',value: cu_date,type: 'year'
                    ,done:function (val, date, endDate) {
                    	if(unitCodes == 0){
                    		window.location.href="/budget/budget_detail_stocksplitzgs_nd?nd="+val;
                    	}else{
                    		window.location.href="/budget/budget_detail_stocksplitzgs_unit?nd="+val;
                    	}
                    }            
                });
            }
            
            initDateView = function(){
				$(".nd").html(cu_date);
			
			}
            reloadTable = function(tableId,tableData){
				table.reload(tableId, {data: tableData});
				//格式化求和
				$.each($(".layui-table-total tr td"),function(i,d){
					if(i>=2){
						var val = $(this).find("div").html();
						$(this).find("div").html(parseInt(val));
					}
				});
			}
			//数据版本选择
	        publicMethods.ajaxAsyncPost("/budget/budget-stocksplit-zgs-items",{page:1,limit:100,param: {"budget_info_id":dataId,"unitCodes":unitCodes}}, function (data) {
       			reloadTable('dataTable', data.data);
            	if(data.data.length >0){
            		cu_date = data.data[0].nd;
            	}
       			
       			renderfunc();
            	initDateView();
		   	}); 
        });
    </script>
</body>
</html>