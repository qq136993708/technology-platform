<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<link rel="stylesheet" type="text/css" href="/layuiadmin/layui/css/layui.css">
	<link rel="stylesheet" type="text/css" href="/layuiadmin/ztree/css/metroStyle/metroStyle.css">
	<link rel="stylesheet" type="text/css" href="/layuiadmin/style/common.css">
	
	<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
	<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
	<script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.core.js"></script>
	<script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.excheck.min.js"></script>
	<script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.all.js"></script>
    <script type="text/javascript" src="/layuiadmin/modules/selectTree.js"></script>
    <script type="text/javascript" src="/layuiadmin/modules/base.js"></script>
	
	<style>
	.tree-content {
	  position: absolute;
	  z-index: 998;
	  background: #ffffff;
	  max-height: 400px;
	  width: 100%;
	  border: 1px solid #ccc;
	  overflow-y: scroll;
	}
	.layui-select-title input{display:inline-block}
	.searchBox .layui-input{
		width: 18%;
	  min-width: 160px;
	  display: inline-block !important;
	  font-size: 12px !important;
	  height: 24px !important;
	  line-height: 24px !important;
	  font-weight: normal !important;
	  padding-left: 6px !important;
	  padding-right: 6px !important;
	  border-radius: 2px !important;
	  vertical-align: middle;
	  color: #555;
	  background-color: #fff;
	  background-image: none;
	  border: 1px solid #ccc;
	  padding-top:0px;
	}
	.num-box{float: left;padding-left: 10px; color: red;margin-top: 4px;font-size: 14px !important;;}
	</style>
	<script type="text/javascript">
	var table,selectRowData,renderfunc,param;
	layui.config({
		base : '../../layuiadmin/' //静态资源所在路径
	}).extend({
		index : 'lib/index' //主入口模块
	}).use(['index','jquery', 'form', 'laydate', 'table', 'layer', 'element',"publicMethods" ], function(){
    	var $ = layui.jquery, admin = layui.admin, element = layui.element, layer = layui.layer, laydate = layui.laydate,table = layui.table,publicMethods=layui.publicMethods,selectRowData;
    	var param = JSON.parse(window.localStorage.getItem("param"));
    	var cu_date = "${nd}";
    	var where = {param:{"nd":cu_date}};
    	laydate.render({elem: '#choose-year',value: cu_date,min:'2018-01-01',type: 'year',done:function (val, date, endDate) {
            	cu_date = val;
            	renderTable({param:{"nd":cu_date}});
            }            
        });
    	window.modifyBudget = function(nd,budgetType,dataId)
    	{
    		 layer.confirm('确定要对预算进行调整吗？', function(index){
             	layer.close(index);
	    		publicMethods.ajaxPost("/budget/budget-info-create-bytemplate",{"nd":nd,"budgetType":budgetType,"dataId":dataId}, function (dt) {
	    			//提示消息
		    		layer.alert("数据克隆成功，开始调整！", {title : '提示'},function(i){
						layer.close(i);
						//跳转到编辑页面
						if(budgetType==101){
							parent.layui.index.openTabsPage("/budget/budget_main_grouptotal?nd="+nd+"&dataId="+dt.dataId, "集团公司预算表");
						}else if(budgetType==102){
							parent.layui.index.openTabsPage("/budget/budget_main_assettotal?nd="+nd+"&dataId="+dt.dataId, "资产公司预算表");
						}else if(budgetType==103){
							parent.layui.index.openTabsPage("/budget/budget_main_stocktotal?nd="+nd+"&dataId="+dt.dataId, "股份公司预算表");
						}else if(budgetType==203){
							parent.layui.index.openTabsPage("/budget/budget_main_groupsplit?nd="+nd+"&dataId="+dt.dataId, "集团公司预算分解表");
						}else if(budgetType==204){
							parent.layui.index.openTabsPage("/budget/budget_main_assetsplit?nd="+nd+"&dataId="+dt.dataId, "资产公司预算分解表");
						}else if(budgetType==205){
							parent.layui.index.openTabsPage("/budget/budget_main_stocksplit_zsy?nd="+nd+"&dataId="+dt.dataId, "股份公司预算分解表（直属院）");
						}else if(budgetType==206){
							parent.layui.index.openTabsPage("/budget/budget_main_stocksplit_xtw?nd="+nd+"&dataId="+dt.dataId, "股份公司预算分解表（集团单位、外部单位、盈科）");
						}else if(budgetType==207){
							parent.layui.index.openTabsPage("/budget/budget_main_stocksplit_zgs?nd="+nd+"&dataId="+dt.dataId, "股份公司预算分解表（分子公司等）");
						}else{
							console.log("......");
						}
		    		});
	 		   	});
    		 });
    	}
    	window.renderTable = function(where){
    		var lodingMsg = layer.msg('数据加载中....');
    		var cols = [
    			{
    				type:'numbers',
                    title: "序号", event: 'setActive', style: 'cursor: pointer;',align:'center',width: 80
                },
                {
                    field: "budgetName",
                    title: "预算项目", event: 'setActive',align:'left', style: 'cursor: pointer;'
               	},
    			{
                     field: "dataVersion",
                     title: "预算版本号", event: 'setActive',align:'center', style: 'cursor: pointer;',width: 150
                },
                {
                    field: "createrName",
                    title: "创建人", event: 'setActive', style: 'cursor: pointer;',align:'left',width: 200
                },
                {
                    field: "createTime",
                    title: "创建时间", event: 'setActive', style: 'cursor: pointer;',align:'center',width: 200
                },
                {
                    field: "status",
                    title: "审批状态", event: 'setActive', style: 'cursor: pointer;',align:'center',width: 150
                },
                {	
                	title : '操作',style : 'cursor: pointer;', align: 'center',width: 200, templet:function(d){
                		return '<a class="layui-btn layui-btn-sm fontColor-blue borderColor-blue btn_edit btnMyBgImg demo-delete" target="_top" onclick="modifyBudget(\''+d.nd+'\','+d.budgetType+',\''+d.dataId+'\')">预算调整</a>'
                	}
                }
                
    		];
    		
    		publicMethods.tableRender("organTable","organTable","/budget/budget-modify-list",false,cols,where,true,function(res, curr, count){
    			layer.close(lodingMsg);
    			$('.layui-table-box').find('.layui-table-body').find("table" ).find("tbody").children("tr").on('click',function(){
                	var index=parseInt($(this).index()+1);
                    selectRowData=res.data[index-1];
                    console.log(selectRowData);
                }); 
    		});
	        $(".layui-table-header table thead th input").remove();  //移除表头的复选框,去掉全选
		}
    	renderTable(where);
        //监听表格复选框选择
        table.on('checkbox(organEvent)', function(obj){
            console.log(obj);
        });
        table.on('rowDouble(organEvent)', function(obj){
        	var temUrl;
        	if(obj.data.budgetType == 101){
        		temUrl = "/budget/budget_detail_grouptotal?dataId="+obj.data.dataId;
        	}else if(obj.data.budgetType == 102){
        		temUrl = "/budget/budget_detail_assettotal?dataId="+obj.data.dataId;
        	}else if(obj.data.budgetType == 103){
        		temUrl = "/budget/budget_detail_stocktotal?dataId="+obj.data.dataId;
        	}else if(obj.data.budgetType == 203){
        		temUrl = "/budget/budget_detail_groupsplit?dataId="+obj.data.dataId;
        	}else if(obj.data.budgetType == 204){
        		temUrl = "/budget/budget_detail_assetsplit?dataId="+obj.data.dataId;
        	}else if(obj.data.budgetType == 205){
        		temUrl = "/budget/budget_detail_stocksplitzsy?dataId="+obj.data.dataId;
        	}else if(obj.data.budgetType == 206){
        		temUrl = "/budget/budget_detail_stocksplitxtw?dataId="+obj.data.dataId;
        	}else if(obj.data.budgetType == 207){
        		temUrl = "/budget/budget_detail_stocksplitzgs?dataId="+obj.data.dataId;
        	}
        	if(temUrl){
        		publicMethods.openBaseWinFull("详情",temUrl);
        	}
        });
    });
</script>

</head>
<body>
<div class="tableBox">
    <div class="tableToolBox">
    	<div class="num-box">
            <label class="dateInput">
                <span>预算年度：</span>
                <input type="text" id="choose-year" readonly="readonly">
            </label>
        </div>
        <div class="whiteLine"></div>
        <div  class="tableBtns">
            <!-- <button class="layui-btn layui-btn-sm fontColor-blue borderColor-blue btn_download btnMyBgImg" data-type="relaseEvent">下发</button>
            <button class="layui-btn layui-btn-sm fontColor-blue borderColor-blue btn_delete btnMyBgImg" data-type="noRelaseEvent">取消下发</button> -->
        </div>
    </div>
    <table id="organTable" class="layui-hide"  lay-filter="organEvent"></table>
</div>
</body>
</html>
