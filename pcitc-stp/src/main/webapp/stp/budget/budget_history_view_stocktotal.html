<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>历年参考数据</title>
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css?+Math.random()">
    <script src="/layuiadmin/layui/layui.js"></script>
    <style>
        .con-box{margin: auto 20px;}
        .table-title{height: 30px;line-height: 30px;}
        .margin-bot30{margin-bottom: 30px;}
    </style>
</head>
<body>
<div class="con-box">
    <#list tb_datas as tb>
	    <p class="table-title">&nbsp;&nbsp;</p>
	    <div class="bottom-table-box">
	        <table id="${tb.dataId}" class="layui-table" lay-filter="${tb.dataId}" lay-data="{limit:100,totalRow: true,height: '200'}">
	            <thead>
	                <tr>
	                	<th lay-data="{field:'no', width: '10%', align:'center',totalRowText: '合计'}" rowspan="2">序号</th>
	                	<th lay-data="{field:'displayName', width: '20%'}" rowspan="2">类别</th>
	                	<th lay-data="{align:'center'}" colspan="3">上年预计完成</th>
	                	<th lay-data="{align:'center'}" colspan="3">${tb.nd}年经费预算</th>
		            </tr>
		            <tr>
	                    <th lay-data="{field:'yjwcTotal',align: 'right',totalRow: true}">合计</th>
	                    <th lay-data="{field:'yjwcZbx', align: 'right',totalRow: true}">资本性</th>
	                    <th lay-data="{field:'yjwcFyx', align: 'right',totalRow: true}">费用性</th>
	                    <th lay-data="{field:'xmjfTotal',align: 'right',totalRow: true}">合计</th>
	                    <th lay-data="{field:'xmjfZbx', align: 'right',totalRow: true}">资本性</th>
	                    <th lay-data="{field:'xmjfFyx', align: 'right',totalRow: true}">费用性</th>
	                </tr>
	            </thead>
	        </table>
	    </div>
    </#list>
    
</div>
<div class="form-bottom">
    <div class="form-bottom-btns">
        <button type="button"
                class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white"
                id="cancel">关闭
        </button>
    </div>
</div>
    <script>
        layui.use(['jquery', 'table', 'laydate', 'layer','publicMethods'], function () {
            var $ = layui.jquery, table = layui.table, laydate = layui.laydate, layer = layui.layer,publicMethods=layui.publicMethods;
            publicMethods.ajaxPost("/budget/search-stocktotal-final-history-list",null, function (data) {
            	$.each(data,function(index,dt){
       				table.reload(dt.dataId, {data: dt.items});
       				var t3=t4=t5=t6=t7=t8=t9=t10=0;
       				$.each(dt.items,function(i,dt){
    					var align = dt.level == 0?"left":"right";
    					var no = dt.level == 0?dt.no:"";
    					$(".layui-table-body").eq(index).find("tr").eq(i).find('td').eq(1).attr("align",align);
    					$(".layui-table-body").eq(index).find("tr").eq(i).find('td').eq(0).find("div").html(no);
    					if(dt.level == 0){
              				t3 += parseInt(dt.last_year_end);
              				t4 += parseInt(dt.plan_money);
              				t5 += parseInt(dt.yjwcTotal);
              				t6 += parseInt(dt.yjwcZbx);
              				t7 += parseInt(dt.yjwcFyx);
              				t8 += parseInt(dt.xmjfTotal);
              				t9 += parseInt(dt.xmjfZbx);
              				t10 += parseInt(dt.xmjfFyx);
              			}
    				});
       				$(".layui-table-total").eq(index).find("tr").find('td').eq(2).find("div").html(t5);
          			$(".layui-table-total").eq(index).find("tr").find('td').eq(3).find("div").html(t6);
          			$(".layui-table-total").eq(index).find("tr").find('td').eq(4).find("div").html(t7);
          			$(".layui-table-total").eq(index).find("tr").find('td').eq(5).find("div").html(t8);
          			$(".layui-table-total").eq(index).find("tr").find('td').eq(6).find("div").html(t9);
          			$(".layui-table-total").eq(index).find("tr").find('td').eq(7).find("div").html(t10);
       			});
            	
 		   	});
            $("#cancel").click(function () {
    	        var index = parent.layer.getFrameIndex(window.name);
    	        parent.layer.close(index);
    	    });
        });
    </script>
</body>
</html>