<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<link rel="stylesheet" type="text/css" href="/layuiadmin/layui/css/layui.css">
	<link rel="stylesheet" type="text/css" href="/layuiadmin/ztree/css/metroStyle/metroStyle.css">
	<link rel="stylesheet" type="text/css" href="/layuiadmin/style/common.css">
	
	<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
	<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
	<script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.core.js"></script>
	<script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.excheck.min.js"></script>
	<script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.all.js"></script>
    <script type="text/javascript" src="/layuiadmin/modules/selectTree.js"></script>
    <script type="text/javascript" src="/layuiadmin/modules/base.js"></script>
	
	<style>
	.tree-content {
	  position: absolute;
	  z-index: 998;
	  background: #ffffff;
	  max-height: 400px;
	  width: 100%;
	  border: 1px solid #ccc;
	  overflow-y: scroll;
	}
	.layui-select-title input{display:inline-block}
	.searchBox .layui-input{
		width: 18%;
	  min-width: 160px;
	  display: inline-block !important;
	  font-size: 12px !important;
	  height: 24px !important;
	  line-height: 24px !important;
	  font-weight: normal !important;
	  padding-left: 6px !important;
	  padding-right: 6px !important;
	  border-radius: 2px !important;
	  vertical-align: middle;
	  color: #555;
	  background-color: #fff;
	  background-image: none;
	  border: 1px solid #ccc;
	  padding-top:0px;
	}
	</style>
	<script type="text/javascript">
	var table,selectRowData,renderfunc,param;
    layui.use([ 'jquery', 'form', 'laydate', 'table', 'layer', 'element',"publicMethods" ], function(){
    	var $ = layui.jquery, admin = layui.admin, element = layui.element, layer = layui.layer, laydate = layui.laydate;
    	table = layui.table;
    	var publicMethods=layui.publicMethods;
    	var param = JSON.parse(window.localStorage.getItem("param"));
    	function renderTable(where){
    		var lodingMsg = layer.msg('数据加载中....');
    		var cols = [
    			 {
                     field: "organName",
                     title: "名称", event: 'setActive', style: 'cursor: pointer;'
                 }
    		];
    		publicMethods.tableRender("organTable","organTable","/budget/budget-organ-table",false,cols,where,true,function(res, curr, count){
    			console.log("----------------");
    		});
	        $(".layui-table-header table thead th input").remove();  //移除表头的复选框,去掉全选
		}
    	renderTable();
        //监听表格复选框选择
        table.on('checkbox(organEvent)', function(obj){
            console.log(obj);
        });
        table.on('rowDouble(organEvent)', function(obj){
        	var temUrl = '/intl_project/apply_view?applyId='+obj.data.applyId;
         	openFullWin("详情",temUrl);
        });
        // 触发不同的按钮事件
        var $ = layui.$, active = {
            searchEvent: function() { //点击查询按钮
                renderTable({param: {"applyName":$("#applyName").val()},sorts:{"plant_money":"desc"}});
            },resetEvent: function() { 
            	//点击重置按钮
                $("#applyName").val("");
                renderTable({param: {"applyName":$("#applyName").val()},sorts:{"plant_money":"desc"}});
            },addEvent: function(){ 
            	//点击新增按钮
            	var temUrl = '/intl_project/apply_edit';
            	openFullWin("新增",temUrl);
            },editEvent: function(){  
            	//点击编辑按钮
            	if(!selectRowData){
            		layer.msg('请点击选择一行数据!');
            		return;
            	}
            	var temUrl = '/intl_project/apply_edit?applyId='+selectRowData.applyId;
            	openFullWin("编辑",temUrl);
            },detailEvent:function(){
            	if(!selectRowData){
            		layer.msg('请点击选择一行数据!');
            		return;
            	}
            	var temUrl = '/intl_project/apply_view?applyId='+selectRowData.applyId;
            	openFullWin("详情",temUrl);
            },exportEvent:function(){
            	if(!selectRowData){
            		layer.msg('请点击选择一行数据!');
            		return;
            	}
            	window.open("/intl_project/report_download/apply/"+selectRowData.applyId);
            },commitEvent:function(){
            	if(!selectRowData){
            		layer.msg('请点击选择一行数据!');
            		return;
            	}
            	layer.confirm('提交后将不可再编辑，确定要提交吗？',{title:"提交确认"},function(index){
					layer.close(index);
					publicMethods.ajaxAsyncPost("/project/apply-start-workflow",{applyId: selectRowData.applyId,functionId:param.id}, function (data) {
          		   		if (data.success) {
          	        	 	renderTable({param: {"applyName":$("#applyName").val()}});
          	        		layer.msg('操作成功!');
          	           } else {
          	        	 	layer.msg(data.message);
          	           }
          	       });
          	   });
            },closeEvent:function(){
            	if(!selectRowData){
            		layer.msg('请点击选择一行数据!');
            		return;
            	} 
            	layer.confirm('确定要删除吗？',{title:"删除确认"},function(index){
					layer.close(index);
					publicMethods.ajaxAsyncPost("/project/apply-close/" + selectRowData.applyId, null, function (data) {
	                     if (data.success) {
	                    	 renderTable({param: {"applyName":$("#applyName").val()}});
	                    	 layer.msg('操作成功!');
	                     } else {
	                    	 layer.msg(data.message);
	                     }
	                });
            	});
            },deleteEvent: function(){  //点击删除按钮
            	//var dt = table.checkStatus('userTable').data;
            	if(!selectRowData){
            		layer.msg('请选择要删除的数据!');
            		return;
            	}
				layer.confirm('确定要删除吗？',{title:"删除确认"},function(index){
					layer.close(index);
					publicMethods.ajaxAsyncPost("/project/apply-delete/"+selectRowData.applyId, null, function (data) {
	                     if (data.success) {
	                    	 renderTable({param: {"applyName":$("#applyName").val()}});
	                    	 layer.msg('操作成功!');
	                     } else {
	                    	 layer.msg('操作异常，请重试!');
	                     }
	                });
            	});
            }
        };
        //区别按钮属性
        $('.layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
</script>

</head>
<body>
<div class="tableBox">
    <div class="tableToolBox">
        <div class="whiteLine"></div>
        <div  class="tableBtns">
            <button class="layui-btn layui-btn-sm fontColor-blue borderColor-blue btn_add btnMyBgImg" data-type="addEvent">新增</button>
            <button class="layui-btn layui-btn-sm fontColor-blue borderColor-blue btn_edit btnMyBgImg" data-type="editEvent">编辑</button>
            <button class="layui-btn layui-btn-sm fontColor-blue borderColor-blue btn_details btnMyBgImg" data-type="detailEvent">查看</button>
            <button class="layui-btn layui-btn-sm fontColor-blue borderColor-blue btn_download btnMyBgImg" data-type="exportEvent">导出</button>
            <button class="layui-btn layui-btn-sm fontColor-blue borderColor-blue btn_save2 btnMyBgImg" data-type="commitEvent">提交</button>
            <button class="layui-btn layui-btn-sm fontColor-blue borderColor-blue btn_delete btnMyBgImg" data-type="closeEvent">删除</button>
            <!-- <button class="layui-btn layui-btn-sm fontColor-blue borderColor-blue btn_delete btnMyBgImg" data-type="deleteEvent">删除</button> -->
        </div>
    </div>
    <table id="organTable" class="layui-hide"  lay-filter="organEvent"></table>
</div>
</body>
</html>
