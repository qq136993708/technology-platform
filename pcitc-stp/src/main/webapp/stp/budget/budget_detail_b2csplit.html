<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>经费预算-事业部预算表</title>
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css?+Math.random()">
    <script src="/layuiadmin/layui/layui.js"></script>
    <style>
        body{color: #666666;}
        .headline-box{box-sizing: border-box;padding-top: 10px;height: 106px;width: 100%;margin-bottom: 15px;}
        .headline-title{height: 58px;line-height: 58px;text-align: center;font-size: 20px;color: #000000;}
        .headline-tool{position: relative;height: 52px;margin: 0 10px;}
        .headline-tool .tool-left{position: absolute;left: 0;top: 12px;height: 28px;line-height: 28px;}
        .tool-left input{width: 96px;border: 1px solid #e6e6e6;}
        .tool-left select{width: 150px;border: 1px solid #e6e6e6;}
        .tool-left .dateInput{position: relative;}
        .dateInput i{position: absolute; top: -4px; right: 6px;}
        .headline-tool .tool-center{position: absolute;left: 50%;top: 6px;margin-left: -47px;}
        .headline-tool .tool-right{position: absolute;right: 0;top: 12px;}
        .num-box{float: left;padding-left: 10px; color: red;margin-top: 4px;}
        .num-box input{width: 90px;padding-left: 6px; background: #ffffff; border: 1px solid #e6e6e6;color: red;}
        .content-box{height: 42px; line-height: 42px;margin: 0 10px;}
        .content-box .items{float: left; margin-right: 18px;}
        .content-box .items span{color: #000000;}
        .doc-box{margin: 0 10px;}
        .doc-box p {height: 26px;line-height: 26px;}
        .doc-box ul li{line-height: 26px;}
        .layui-table-header table thead tr th div{text-align: center;}
    </style>
</head>
<body>
    <div class="headline-box">
        <div class="headline-title" title="集团经费预算总表">
            	<span class="nd">${nd}</span>股份炼油事业部、化工事业部B2、C类科技经费预算表(建议稿)
        </div>
        <div class="headline-tool" style="display: none;">
            <div class="tool-left">
                <label class="dateInput">
                    <span>编制年度</span>
                    <input type="text" id="choose-year">
                    <i class="layui-icon layui-icon-date"></i>
                </label>
            </div>
        </div>
    </div>
    <div class="tableBox">
        <div class="tableToolBox">
        </div>
        <div id="tableBox">
            <table id="dataTable" class="layui-table" lay-filter="dataTable" lay-data="{ID:'dataTable',height: '400',limit:100, url:'',totalRow: true}">
               <thead>
	                <tr>
	                	<th lay-data="{field:'no',align: 'center', width: 45,totalRowText: '合计'}" rowspan="2">序号</th>
	                    <th lay-data="{field:'displayName', width: '30%'}" rowspan="2">名称</th>
	                    <th lay-data="{align:'center'}", colspan="3"><span>&nbsp;</span>其中：炼油事业部</th>
	                    <th lay-data="{align:'center'}", colspan="3"><span>&nbsp;</span>其中：化工事业部</th>
	                </tr>
	                <tr>
	                    <th lay-data="{field:'lyTotal',align: 'right',totalRow: true}">预算</th>
	                    <th lay-data="{field:'lyJz', edit:true,align: 'right',totalRow: true}">结转</th>
	                    <th lay-data="{field:'lyXq', edit:true,align: 'right',totalRow: true}">可新签</th>
	                    <th lay-data="{field:'hgTotal',align: 'right',totalRow: true}">预算</th>
	                    <th lay-data="{field:'hgJz', edit:true,align: 'right',totalRow: true}">结转</th>
	                    <th lay-data="{field:'hgXq', edit:true,align: 'right',totalRow: true}">可新签</th>
	                </tr>
                </thead>
            </table>
        </div>
    </div>
    

    <script>
	    var cu_date = "${nd?default(0)}";
	    var dataId = "${dataId}";
	    var budget_info_map=null;
	    var curent_tabel_data = null;//当前表格数据
	    var curent_budget_info = null;//当前报表
	    var selectRowData=null;
        layui.use(['jquery', 'table', 'laydate', 'layer','publicMethods'], function () {
            var $ = layui.jquery, table = layui.table, laydate = layui.laydate, layer = layui.layer,publicMethods=layui.publicMethods; 
            var param = JSON.parse(window.localStorage.getItem("param"));
            renderfunc = function(){
            	$(".layui-table-header table thead th i").remove();  //移除表头的复选框,去掉全选
	        	//行单击选中事件绑定
	        	$('.layui-table-box').find('.layui-table-body').find("table" ).find("tbody").children("tr").on('click',function(){
	              	  var index=parseInt($(this).index()+1);
	                  $('tr').removeClass('layui-table-click');
	                  $(this).addClass('layui-table-click');
	                  $('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
	                  $(this).find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
	            }); 
	        }
            if(cu_date != 0){
            	$(".headline-tool").css("display","block");
            	laydate.render({elem: '#choose-year',value: cu_date,type: 'year'
                    ,done:function (val, date, endDate) {
                    	window.location.href="/budget/budget_detail_b2csplit_nd?nd="+val;
                    }            
                });
            }
            
            initDateView = function(){
				$(".nd").html(cu_date);
			}
            reloadTable = function(tableId,tableData){
				table.reload(tableId, {data: tableData});
				//格式化求和
				$.each($(".layui-table-total tr td"),function(i,d){
					if(i>=3){
						var val = $(this).find("div").html();
						$(this).find("div").html(parseInt(val));
					}
				});
				$.each(tableData,function(index,dt){
					var align = dt.level == 0?"left":"right";
					var no = dt.level == 0?dt.no:"";
					$(".layui-table-body").find("tr").eq(index).find('td').eq(1).attr("align",align);
					$(".layui-table-body").find("tr").eq(index).find('td').eq(0).find("div").html(no);
				});
			}
			//数据版本选择
	        publicMethods.ajaxAsyncPost("/budget/budget-b2csplit-items",{page:1,limit:100,param: {"budget_info_id":dataId}}, function (data) {
       			reloadTable('dataTable', data.data);
            	if(data.data.length >0){
            		cu_date = data.data[0].nd;
            	}
       			
       			renderfunc();
            	initDateView();
		   	}); 
        });
    </script>
</body>
</html>