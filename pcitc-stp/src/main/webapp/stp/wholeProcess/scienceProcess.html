<!DOCTYPE html>
<html style="background-color: #f1f2f7;">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css?+Math.random()">
    <script src="/layuiadmin/layui/layui.js"></script>
</head>
<body>
<div class="cycle">
    <p class="cycle-title">重点项目</p>
    <div class="cycle-search">
        <div class="layui-input-inline">
            <input type="text" class="layui-input" id="start" placeholder="启动时间">
        </div>
        <div class="layui-input-inline">
            <input type="text" class="layui-input" id="end" placeholder="结束时间">
        </div>
        <div class="layui-input-inline">
            <select name="" id="">
                <option>负责人</option>
            </select>
        </div>
        <div class="btnGroup">
            <button class="layui-btn layui-btn-sm fontColor-white btn_search btnMyBgImg" data-type="searchEvent">查询
            </button>
            <button class="layui-btn layui-btn-sm fontColor-default border-default btn_reset btnMyBgImg" data-type="resetEvent">重置
            </button>
        </div>
    </div>
    <div class="cycle-c">
        <#if sciList?exists> <#list sciList as sci>
        <div class="cycle-cont" id="${sci.XMID}">
            <div class="cycle-item">
                <div class="cycle-cont-left">
                    <p>${sci.FZDW}</p>
                    <p>${sci.XMMC}</p>
                    <p>${sci.YJSJ}</p>
                </div>
                <!--灰色-->
                <div class="cycle-cont-right">
                    <p>项目计划<span></span></p>
                    <p>计划年度：${sci.ND}</p>
                    <p class="cycle-mey">专业类别：${sci.ZYLB}</p>
                </div>
                <#if sci.contractFlag?? && sci.contractFlag != "">
                	<div class="cycle-cont-right">
	                	<p>项目启动<span></span></p>
	                    <p>启动日期：${sci.kssj}</p>
                        <p class="cycle-mey">总金额：${sci.jf}万元</p>
	                </div>
	                <#else>
	                <div class="cycle-cont-midd">
	                	<p>项目启动<span></span></p>
	                </div>
                </#if>
                
                <div class="cycle-cont-midd">
                    <p>过程管理<span></span></p>
                </div>
                <div class="cycle-cont-midd">
                    <p>结题<span></span></p>
                </div>
            </div>
        </div>
    </#list> </#if>
    </div>
</div>

<script>
    layui.use(['jquery', 'form', 'laydate', 'table', 'laypage','laytpl','publicMethods'], function () {
        var table = layui.table, util = layui.laytpl, form = layui.form, laydate = layui.laydate, $ = layui.jquery,
            laytpl = layui.laytpl, publicMethods = layui.publicMethods;
        $(".cycle-cont").each(function (i,val) {
            var widthDiv=(86/($(".cycle-cont:eq("+i+") .cycle-item>div").length-1));
            $(".cycle-cont:eq("+i+") .cycle-cont-midd,.cycle-cont:eq("+i+") .cycle-cont-right").css("width",widthDiv+"%");
        });

        //开始日期
        var insStart = laydate.render({
            elem: '#start'
            ,min: 0
            ,done: function(value, date){
                //更新结束日期的最小日期
                insEnd.config.min = lay.extend({}, date, {
                    month: date.month - 1
                });
                //自动弹出结束日期的选择器
                insEnd.config.elem[0].focus();
            }
        });
        //结束日期
        var insEnd = laydate.render({
            elem: '#end'
            ,min: 0
            ,done: function(value, date){
                //更新开始日期的最大日期
                insStart.config.max = lay.extend({}, date, {
                    month: date.month - 1
                });
            }
        });
        $(".cycle-c").css("height",parent.$("#LAY_app_body").height()-155+"px");
        $(".cycle-cont-right").click(function () {
            //当前id
            var id=$(this).parents(".cycle-cont").attr("id");
            layer.open({
                title:'项目进展详情'
                ,skin: 'layui-layer-lan'
                ,shadeClose: false
                ,type: 2
                ,id:"cycle"
                ,fixed: false
                //若使用小窗口形式，则修改 maxmin 值为 true，则注释掉area:[100%,100%]属性,同时设置area: ['900px', '450px']
                ,maxmin: true
                //若直接弹出页面 ，则修改 area;[100%,100%]，同时设置 maxmin 为false
                ,area: ['70%', '90%'],
                content: "/whole-process/science/details?xmid="+id,
                success: function (layero, index) {
                    var iframe = window['layui-layer-iframe' + index];
                    var iframeH=$(layero).find("iframe");
                    $(iframeH).contents().find(".cycle-img").css("height",$(iframe).height()+"px");
                }
            });
        });
    });

</script>

</body>
</html>