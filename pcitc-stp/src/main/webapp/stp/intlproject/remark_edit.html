<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>新增/编辑</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" type="text/css" href="/layuiadmin/layui/css/layui.css">
<link rel="stylesheet" type="text/css" href="/layuiadmin/style/common.css">

<script type="text/javascript" src="/plugins/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="/plugins/jQuery/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
<script type="text/javascript" src="/layuiadmin/modules/base.js"></script>

<script type="text/javascript">
var file_ids = "appendFiles";
	//detail:详情，edit：编辑
	file_edit_detail = "edit";
	//统管理-附件管理-附件配置：页面标识
	file_opt_flag = "4c20bd28057543839c0db8754f417c6a";
$(document).ready(function() {
	layui.use([ 'jquery', 'form', 'laydate', 'table', 'layer', 'element',"publicMethods" ],
			function() {
				var $ = layui.jquery, admin = layui.admin, element = layui.element, layer = layui.layer, laydate = layui.laydate;
				var form = layui.form;
				var remarkId = "${remarkId?default(0)}";
				var publicMethods=layui.publicMethods;
				var editor = CKEDITOR.replace("remarkContent");
				//加载项目
	    		publicMethods.ajaxPost("/project/apply-list-all",null, function (data) {
					$.each(data,function(i,val){
						$("#projectId").append('<option value="'+data[i].applyId+'">'+data[i].applyName+'</option>');
					});
			   	});
			 	if(remarkId != 0)
		        {
			 		$("#remarkId").val(remarkId);
			 		publicMethods.ajaxPost('/project/get-remark', {"remarkId":remarkId}, function (data, status) {
		        		form.val("remark-form",data);
		        		editor.setData(data.remarkContent);
		            });
		        }
			 	form.render();
			 	laydate.render({elem: '#createTime',type: 'date',value: new Date()});
			 	//添加到form.render()之后
			 	$("#file_div").load('/common/public/uploadlayuiload.html');
				/* 自定义验证规则  title 要验证的input的 lay-verify=""*/
				form.verify({
				});
				/* 监听提交 */
				form.on('submit(submitBtn)', function(data) {
					data.field.remarkContent = editor.getData();
                    ajaxPost('/project/remark-saveorupdate', data.field, function (data, status) {
                        if (data.success) {
                        	parent.layui.table.reload('remarkTable',null);
                        	parent.renderfunc();//隐藏全选按钮
                        	var index = parent.layer.getFrameIndex(window.name);
					       	parent.layer.close(index);
                        }else{
                        	parent.layer.alert(data.message, {
								title : '信息'
							});
							return;
                        }
                    });
					return false;
				});
		});
		$("#cancel").click(function () {
		    var index = parent.layer.getFrameIndex(window.name);
		    parent.layer.close(index);
		})
});
</script>
</head>
<body>
<div class="formBox">
	<form id="remark-form" name="remark-form" lay-filter="remark-form" class="form-horizontal layui-form">
	<input type="hidden" name="remarkId" id="remarkId">
	<div class="box-body">
		<input type="hidden" name="appendFiles" id="appendFiles">
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
				  <label class="layui-form-label">签约项目<span class="must-fill">*</span></label>
		          <div class="layui-input-block">
					<select name="projectId" id="projectId" lay-verify="required"  lay-filter="">
	                	<option value="">请选择</option>
	             	</select>
				  </div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item"  id="password" >
					<label for="" class="layui-form-label">纪要标题<span class="must-fill">*</span></label>
					<div class="layui-input-block">
					 	<input type="text" lay-verify="required" class="layui-input" id="remarkTitle" name="remarkTitle" placeholder="纪要标题">
					</div>
				</div>
			</div>
		</div>
		
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item"  id="password" >
					<label for="" class="layui-form-label">纪要类别<span class="must-fill">*</span></label>
					<div class="layui-input-block">
					 	<input type="text" lay-verify="required" class="layui-input" id="remarkType" name="remarkType" placeholder="纪要类别">
					</div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item"  id="password" >
					<label for="" class="layui-form-label">纪要负责人<span class="must-fill">*</span></label>
					<div class="layui-input-block">
					 	<input type="text" lay-verify="required" class="layui-input" id="remarkPeople" name="remarkPeople" placeholder="纪要负责人">
					</div>
				</div>
			</div>
		</div>
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item"  id="password" >
					<label for="" class="layui-form-label">纪要日期<span class="must-fill">*</span></label>
					<div class="layui-input-block">
					 	<input type="text" lay-verify="required" class="layui-input" id="createTime" name="createTime" placeholder="纪要日期">
					</div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item"  id="password" >
					<label for="" class="layui-form-label">联系人电话<span class="must-fill">*</span></label>
					<div class="layui-input-block">
					 	<input type="text" lay-verify="required" class="layui-input" id="authorPhone" name="authorPhone" placeholder="纪要联系人">
					</div>
				</div>
			</div>
		</div>
		
		<div class="layui-form-item">
	      	 <label class="layui-form-label">内容</label>
	         <div class="layui-input-block">
	         	   <textarea class="layui-textarea" id="remarkContent" name="remarkContent" placeholder=""></textarea>
	         </div>
       </div>
       <div class="layui-form-item">
	      	 <label class="layui-form-label">附件</label>
	         <div id="file_div" class="layui-input-block"></div>
       </div>
	</div>
	<div class="form-bottom">
      <div class="form-bottom-btns">
      	<button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue" lay-submit="" lay-filter="submitBtn">保存</button>
      	<!-- <button type="reset" class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white">重置</button> -->
      	<button type="button" class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white"  id="cancel">取消</button>
      </div>
    </div>
</form>
</div>
</body>
</html>