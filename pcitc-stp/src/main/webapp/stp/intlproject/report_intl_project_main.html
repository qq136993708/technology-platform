<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <title>国际合作</title>
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/adminStp.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/mainStp.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/second.css" media="all">
    <script src="/layuiadmin/layui/layui.js"></script>
    <script type="text/javascript" src="/plugins/echarts/echarts.min.js"></script>
    <script src="/layuiadmin/lib/extend/world.js"></script>
</head>
<body>
<div class="layui-fluid">
    <!-- <h3>国际合作</h3> -->
    <div class="layui-row layui-col-space10">
        <div class="layui-col-md5">
            <div class="layui-card">
                <div class="layui-card-header">
                    2018国际合作申报项目情况一览
                </div>
                <div class="layui-row-main">
                    <div class="main-chart" id="main1" style="height:250px;width: 100%;"></div>
                </div>
            </div>
        </div>
        <div class="layui-col-md5">
            <div class="layui-card">
                <div class="layui-card-header">
                    2018国际合作项目申报数量占比图
                </div>
                <div class="layui-row-main">
                    <div class="main-chart" id="main2" style="height:250px;width: 100%;"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-row layui-col-space10">
        <div class="layui-col-md5">
            <div class="layui-card">
                <div class="layui-card-header">年度申报项目数量/项目金额趋势图
                </div>
                <div class="layui-row-main">
                    <div class="main-chart" id="main3" style="height:250px;width: 100%;"></div>
                </div>
            </div>
        </div>
        <div class="layui-col-md5">
            <div class="layui-card">
                <div class="layui-card-header">
                    汇总表
                </div>
                <div class="layui-row-main">
                    <table id="intlDataTable" class="layui-table" lay-filter="tableData"></table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    layui.config({
        base: '/layuiadmin/lib/extend/' //静态资源所在路径
    }).extend({
        echarts: 'echarts' //主入口模块
    }).use([ 'jquery','form', 'laydate','table','layer','element'], function() {
        var $ = layui.jquery
            , laydate = layui.laydate
            , form = layui.form
            , table = layui.table;
        function renderTable(where){
    		var param = JSON.parse(window.localStorage.getItem("param"));
	        table.render({
	            elem: '#intlDataTable',
	            url: '/project/report/total_byunit',
	            limit : param.selfRownum,
	            method:"POST",
	            where: where,
	        	id: 'intlDataTable',
	            height: "250px",
	            cols: [[
	            	{title:'序号', type:'numbers'}
	                ,{field:'unitName',   title:'单位名称',    width: '20%',  style:'cursor: pointer;'}
	                ,{field:'projectNum',title:'申报项目',	width: '30%',   style:'cursor: pointer;'}
	                ,{field:'money',title:'项目金额(万元)',	width: '20%',   style:'cursor: pointer;'}
	                ,{field:'realMoney',title:'实际使用(万元)',  style:'cursor: pointer;'}
	            ]],
	            done: function (res, curr, count) {
	            }
	        });
	        renderfunc = function removeHeaderCheckbox(){
	        	$(".layui-table-header table thead th input").remove();  //移除表头的复选框,去掉全选
	        }
	        renderfunc();
		}
        renderTable();
        // 基于准备好的dom，初始化echarts图表
        var myChart1 = echarts.init(document.getElementById("main1")),
            myChart2 = echarts.init(document.getElementById('main2')),
            myChart3 = echarts.init(document.getElementById('main3'));

        /*
            关于国家的经纬度，可以用首都的经纬度或者其他城市的经纬度
            获取经纬度的方法：https://jingyan.baidu.com/article/d45ad148b3deaa69542b8057.html
        */
        var geoCoordMap = {
            '中国': [116.416199, 39.905578],
            '芬兰': [24.909912, 60.169095],
            '美国': [-100.696295, 33.679979],
            '澳大利亚': [135.193845, -25.304039],
            '英国': [-0.126608, 51.208425],
            '加拿大': [-102.646409, 59.994255]
        };

        /*
            记录下起点城市和终点城市的名称，以及权重
            数组第一位为终点城市，数组第二位为起点城市，以及该城市的权重，就是图上圆圈的大小
         */

        // 中国
        var CQData = [
            [{name: '中国'}, {name: "芬兰",value: 20}],
            [{name: '中国'}, {name: "英国",value: 20}],
            [{name: '中国'}, {name: "加拿大",value: 30}],
            [{name: '中国'}, {name: "澳大利亚",value: 40}],
            [{name: '中国'}, {name: "美国",value: 40}]
        ];

        var color  = ['#FB0000', '#FB0000'];    // 自定义图中要用到的颜色
        var series = [];                        // 用来存储地图数据

        [['中国', CQData]].forEach(function(item, i) {
            series.push( { // 散点效果
                type: 'effectScatter',
                coordinateSystem: 'geo',       // 表示使用的坐标系为地理坐标系
                zlevel: 3,
                rippleEffect: {
                    brushType: 'stroke'        // 波纹绘制效果
                },
                label: {
                    normal: {                  // 默认的文本标签显示样式
                        show: true,
                        position: 'left',      // 标签显示的位置
                        formatter: '{b}'       // 标签内容格式器
                    }
                },
                itemStyle: {
                    normal: {
                        color: color[0]
                    }
                },
                data: item[1].map(function(dataItem) {
                    return {
                        name: dataItem[1].name,
                        value: geoCoordMap[dataItem[1].name],  // 起点的位置
                        symbolSize: dataItem[1].value / 4,  // 散点的大小，通过之前设置的权重来计算，val的值来自data返回的value
                    };
                })
            });
        });

        // 显示终点位置,类似于上面最后一个效果，放在外面写，是为了防止被循环执行多次
        series.push({
            type: 'effectScatter',
            coordinateSystem: 'geo',
            zlevel: 3,
            rippleEffect: {
                brushType: 'stroke'
            },
            label: {
                normal: {
                    show: true,
                    position: 'left',
                    formatter: '{b}'
                }
            },
            symbolSize: function(val) {
                return val[2] / 8;
            },
            itemStyle: {
                normal: {
                    color: color[1]
                }
            },
            data: [{
                // 这里面的数据，由于一开始就知道终点位置是什么，所以直接写死，如果通过ajax来获取数据的话，还要进行相应的处理
                name: "中国",
                value: [116.416199, 39.905578],
                label: {
                    normal: {
                        position: 'top'
                    }
                }
            }]
        });

        // 最后初始化世界地图中的相关数据
        myChart1.setOption({
            geo: {
                map: 'world',       // 与引用进来的地图js名字一致
                roam: false,        // 禁止缩放平移
                itemStyle: {        // 每个区域的样式
                    normal: {
                        areaColor: '#9FE0E6'
                    },
                    emphasis: {
                        areaColor: '#00ACE8'
                    }
                },
                regions: [{        // 选中的区域
                    name: 'China',
                    selected: true,
                    itemStyle: {   // 高亮时候的样式
                        emphasis: {
                            areaColor: '#FFCA42'
                        }
                    },
                    label: {    // 高亮的时候不显示标签
                        emphasis: {
                            show: false
                        }
                    }
                }]
            },
            series: series,   // 将之前处理的数据放到这里
            textStyle: {
                fontSize: 12
            }
        });

        var option2 = {
            /*title : {
                text: '2018国际合作项目申报数量占比图',
                textStyle: {
                    color: '#000000',
                    fontStyle: 'normal',
                    fontWeight: 800,
                    fontFamily: 'sans-serif',
                    fontSize: 18,
                    textBorderColor: 'transparent',
                    textBorderWidth: 0
                },
                x:'center'
            },*/
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                y : 'bottom'
            },
            /*toolbox: {
                show : true,
                feature : {
                   /!*  mark : {show: true},
                    dataView : {show: true, readOnly: false},
                    magicType : {show: true, type: ['line', 'bar']},
                    restore : {show: true}, *!/
                    saveAsImage : {show: true}
                }
            },*/
            /* toolbox: {
                show : true,
                feature : {
                    dataView : {show: true, readOnly: false},
                    magicType : {
                        show: true,
                        type: ['pie', 'funnel'],
                        option: {
                            funnel: {
                                x: '25%',
                                width: '50%',
                                funnelAlign: 'left',
                                max: 1548
                            }
                        }
                    },
                    restore : {show: true}
                }
            }, */
            calculable : true,
            series : [
                {
                    name:'访问来源',
                    type:'pie',
                    radius: ['20%', '60%'],
                    center: ['50%','40%'],
                    avoidLabelOverlap: true,   //是否启用防止标签重叠策略
                    data:[
                        {value:10, name:'勘探院'},
                        {value:12, name:'物探院'},
                        {value:18, name:'工程院'},
                        {value:15, name:'石科院'},
                        {value:15, name:'大连院'},
                        {value:10, name:'北化院'},
                        {value:10, name:'上海院'},
                        {value:10, name:'安工院'}
                    ],
                    itemStyle:{
                        normal: {
                            // color: 各异,
                            borderColor: '#fff',
                            borderWidth: 1,
                            label: {
                                show: true,
                                position: 'outer'
                            },
                            labelLine: {
                                show: true,
                                length: 20,
                                lineStyle: {
                                    // color: 各异,
                                    width: 1,
                                    type: 'solid',
                                }
                            }
                        }
                    }
                }
            ],
            color:['#87d359','#70b1aa','#f3cc42','#e79579','#349bd2', '#9799ec','#c3c784','#f4964a']
        };

        var option3 = {
            /*title : {
                 text: '2018国际合作申报项目情况一览',
                 x : 'center'
             },*/
            grid:{
                x:35,
                y:30,
                x2:20,
                y2:20,
                borderWidth:1
            },
            tooltip: {
                trigger: 'axis'
            },

            xAxis: [
                {
                    type: 'category',
                    data: ['勘探院','物探院','工程院','石科院','大连院','北化院','上海院','安工院']
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    name: '金额（万元）',
                    min: 0,
                    max: 50,
                    interval: 50
                }
            ],
            series: [
                {
                    name:'项目数量（个）',
                    type:'bar',
                    /*设置柱状图颜色*/
                    itemStyle: {
                        normal: {
                            color: function(params) {
                                // build a color map as your need.
                                var colorList = [
                                    '#6592b2'
                                ];
                                return colorList[params.dataIndex]
                            },
                            /*信息显示方式*/
                            label: {
                                show: true,
                                position: 'top',
                                formatter: '{b}\n{c}'
                            }
                        }
                    },
                    data:[5, 3, 13, 15, 4, 7, 9, 11]
                },
                {
                    name:'项目金额',
                    type:'line',
                    itemStyle : {  /*设置折线颜色*/
                        normal : {
                            color:'#f4964a'
                        }
                    },
                    data:[15, 6, 10, 15, 20, 25, 15,23]
                }
            ]
        };

        // 为echarts对象加载数据
        myChart2.setOption(option2);
        myChart3.setOption(option3);
    })
</script>
</body>
</html>