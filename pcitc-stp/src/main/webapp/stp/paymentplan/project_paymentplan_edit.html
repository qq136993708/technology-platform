<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新增编制单位</title>
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css?+Math.random()">
    <script src="/layuiadmin/layui/layui.js"></script>
    <style>
        .con-box{margin: 5px auto;margin-bottom: 0;margin-right: 50px;}
        .layui-form-label {width: 108px !important;}
        .layui-input-block {margin-left: 129px !important;}
        .btn-line {height: 36px;line-height: 36px;}
        .btn-line a{float: left;margin-left: 20px;}
        .layui-textarea {min-height: 50px;}
        .layui-table-header table thead tr th div{text-align: center;}
        
		.formOperate{width: 200px;}
    	.formOperate i{font-size: 18px;cursor: pointer;height: 32px;line-height: 32px;}
    	.formOperate i:hover{color: #0f9ee0;}
    </style>
</head>
<body>
<form action="" id="budget-form" name="budget-form" lay-filter="budget-form" class="layui-form">
	<input type="hidden" name="dataId" value="${dataId}">
	<input type="hidden" name="nd" id="nd" value="${nd}">
    <div class="con-box">
        <div class="formBox">
        
        	<div class="layui-row">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">拨付批次<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                       		<select name="define17" id="define17" lay-verify="required"  lay-filter="define17">
								<option value="">请选择</option>
							</select>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">拨付状态<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" type="text" readonly="readonly" name="define17" id="define17" placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">项目ID<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" readonly="readonly" id="xmid" name="xmid" placeholder="" autocomplete="off" type="text">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">项目名称<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" type="text" readonly="readonly" name="xmmc" id="xmmc" placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="layui-row">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">合同号<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" id="hth" name="hth" placeholder="" autocomplete="off" type="text">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">经费来源<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" type="text" id="define11" name="define11"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">部门<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" type="text" id="gsbmmc" name="gsbmmc"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">处室<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" type="text" id="define10" name="define10"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">承担单位<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" type="text" id="define8" name="define8"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">项目金额<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" type="text" id="ysje" name="ysje"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">资本性拨付<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" type="text" id="yszbxje" name="yszbxje"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">费用性拨付<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" type="text" id="ysfyxje" name="ysfyxje"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label class="layui-form-label">是否开具发票<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input type="radio" lay-filter="radioEvent" name="sex" value="0" title="是">
				          	<input type="radio" lay-filter="radioEvent" name="sex" value="1" title="否" checked>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">公司名称<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" type="text" id="yszbxje" name="yszbxje"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">纳税人识别号<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" type="text" id="ysfyxje" name="ysfyxje"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">开户行名称<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" type="text" id="yszbxje" name="yszbxje"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">开户行账号<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" type="text" id="ysfyxje" name="ysfyxje"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">联系人电话<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" type="text" id="yszbxje" name="yszbxje"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">联系地址<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" type="text" id="ysfyxje" name="ysfyxje"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">联系人邮箱<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" type="text" id="yszbxje" name="yszbxje"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">拨付分组<span class="must-fill"></span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" type="text" id="ysfyxje" name="ysfyxje"  placeholder="" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="form-bottom">
        <div class="form-bottom-btns">
            <button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue" lay-submit lay-filter="saveEvent">拨付</button>
            <button type="button" class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white" id="cancel">关闭 </button>
        </div>
    </div>
</form>
<script>
    var dataId = "${dataId}";
    var nd = "${nd}";
    var parentInfo = null;
    var company_map = {};
   layui.use(['jquery', 'table', 'form','laydate', 'layer','publicMethods'], function () {
        var $ = layui.jquery,form = layui.form,table = layui.table,laydate = layui.laydate,layer = layui.layer,publicMethods=layui.publicMethods;
        var layTableId = "dataTable";
      	//报销批次字典
      	publicMethods.ajaxPost("/paymentplan/project-paymentplan-batchs",{"ysnd":$("#ysnd").val()}, function (data) {
   			$("#define17").html("<option value=''>--请选择--</option>");
   			$.each(data,function(index,dt){
   				$("#define17").append("<option value='"+dt.numValue+"'>"+dt.name+"</option>");
   			});
   			form.render();
   		}); 
        /* publicMethods.ajaxPost('/dictionary/list/ROOT_YSGL_JFBFPCZD', null, function (data, status) {
      		$.each(data,function(i,dt){
  	    		$("#define17").append("<option value='"+data[i].code+"'>"+data[i].name+"</option>");
  	    	});
	    }); */
        publicMethods.ajaxPost("/out/project-info-detail",{"dataId":dataId}, function (data) {
        	console.log(data);
			form.val("budget-form",data);
   		});
        //监听select下拉选中事件
        form.on('select(type)', function(data){
            var elem = data.elem; //得到select原始DOM对象
            $(elem).prev("a[lay-event='type']").trigger("click");
        });
        $('.layui-btn').on('click', function () {
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
        var $ = layui.$, active = {
       		createEvent: function () { 
                  
            }	
        }
        // 点击保存按钮
        form.on('submit(saveEvent)', function(data){
            var formData = JSON.stringify(data.field);
            console.log("表单数据："+formData + '\n' +"表格数据:" + getTableData());
            var lodingMsg = layer.msg('处理中....');
            //保存预算项目
            publicMethods.ajaxAsyncPost('/budget/save-grouptotal-item', data.field, function (data, status) {
                if (data.success) {
                	parent.initDataVersion("${budgetInfoId}");
                	parentInfo = data.data;
                	//保存预算项目子项
                	publicMethods.ajaxAsyncPost('/budget/save-grouptotal-childitems', {"items":JSON.stringify(viewObj.tbData),"item":JSON.stringify(parentInfo)}, function (dt, status) {
                		var index = parent.layer.getFrameIndex(window.name);
    			       	parent.layer.close(index);
                	});
                }else{
                	parent.layer.alert(data.message, {title : '信息'});
					return;
                }
                layer.close(lodingMsg);
            }); 
            //一定要加return false -- 2018.07.08
            return false;
        });

        /*点击取消按钮*/
        $("#cancel").click(function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        })
    })
</script>
</body>
</html>