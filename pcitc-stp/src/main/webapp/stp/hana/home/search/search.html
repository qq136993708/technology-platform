<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css">
    <script src="/layuiadmin/layui/layui.js"></script>
</head>
<body>

<div class="layui-tab layui-tab-brief" lay-filter="component-tabs-hash">

    <input type="text" name="keyword"  value="${keyword}"  id="keyword">
    <!--按钮组-->
    <div class="btnGroup">
        <button class="layui-btn layui-btn-sm fontColor-white btn_search btnMyBgImg"  onclick="search()">查询</button>
    </div>


    <ul class="layui-tab-title">
        <li class="layui-this" lay-id="11">科研</li>
        <li lay-id="22">成果</li>
    </ul>
    <div class="layui-tab-content">
        <div class="layui-tab-item layui-tab-i layui-show">
            <iframe src="/fullSearch/query_scientific?keyword=${keyword}" style="border: 0;width: 100%;height: 100%;margin-top: 15px"></iframe>
        </div>

        <div class="layui-tab-item layui-tab-i">
            <iframe src="/fullSearch/query_achievement?keyword=${keyword}" style="border: 0;width: 100%;height: 100%;margin-top: 15px"></iframe>
        </div>
    </div>
</div>

<!--选择器-->


</body>
</html>
<!--表格数据操作js-->
<script src="/common/js/jquery-1.11.3.min.js"></script>
<script>
    var table,selectRowData;
    var xmmc=$('#xmmc').val();

    layui.config({
        base: '/layuiadmin/lib/extend/'
    }).use(['jquery','form', 'laydate','table','laypage','element'], function(){
        $ = layui.jquery
            ,table = layui.table
            ,form = layui.form
            ,laydate = layui.laydate,
            form.render(null, 'component-form-group');
        // laydate.render({
        //     elem: '#nd'
        //     ,type: 'year'
        // });
        //加载表格
        // renderTable();
        //移除表头的复选框,去掉全选
        $(".layui-table-header table thead th input").remove();

        // 触发不同的按钮事件
        var $ = layui.$, active = {
        };
        //监听排序
        table.on('sort(model-table)', function(obj){
            console.log(this, obj.field, obj.type)
            //return;
            //服务端排序
            table.reload('model-table', {
                initSort: obj,
                page: {curr: 1}, //重新从第一页开始
                where: { //重新请求服务端
                    key: obj.field, //排序字段
                    order: obj.type //排序方式
                }
            });
        });
        //区别按钮属性
        $('.layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

        if($(".specialty ul li").length>=25){
            $(".specialty .selector-right").css({"height":"80px","overflow-y":"scroll"})
        }

        /*选择器*/
        /*循环生成*/
        //费用类别
        /* $(".cost ul").append("<li><a href='javascript:;'>"+"资本性"+"</a> </li>");
        //研究院
        $(".institute ul").append("<li><a href='javascript:;'>"+"资本性"+"</a> </li>");
        //其他系统标识
        $(".system ul").append("<li><a href='javascript:;'>"+"资本性"+"</a> </li>");
        //专业类别
        $(".specialty ul").append("<li><a href='javascript:;'>"+"资本性"+"</a> </li>"); */
        $(".selector>div ul li a").click(function () {
            if($(this).parents("li").hasClass("layui-this")){
                $(this).parents("li").removeClass("layui-this");
                var htmlThis=$(this).html();
                $(".conditionNew ul li a").each(function () {
                    if(htmlThis.indexOf($(this).html())!= -1 ){
                        $(this).parents("li").remove();
                        return false;
                    }
                });
            }else {
                $(this).parents("li").addClass("layui-this");
                var htmlName=$(this).parents(".selector-right").prev().html();
                var htmlThis=$(this).html();
                $(".conditionNew").removeClass("layui-hide");
                $(".conditionNew ul").append("<li>"+htmlName+"<a href='javascript:;'>"+htmlThis+"</a></li>");
                $(".conditionNew ul li a").click(function () {
                    $(this).parents("li").remove();
                });
                $(".conditionNew ul li a").click(function () {
                    var htmlThis=$(this).html();
                    $(".selector-right ul li a").each(function () {
                        if(htmlThis.indexOf($(this).html())!= -1 ){
                            $(this).parents("li").removeClass("layui-this");
                            return false;
                        }
                    });
                });
                $(".conditionNew .dele").click(function () {
                    $(".conditionNew ul li").remove();
                    $(".selector-right ul li").removeClass("layui-this");
                    $(".conditionNew").addClass("layui-hide");
                });
            }
        });
    });


    function renderTable()
    {

        var costSelectedItem="",instituteSelectedItem="",systemSelectedItem="",specialtySelectedItem="";
        $(".cost ul li").each(function () {
            if($(this).attr("class")=="layui-this"){
                costSelectedItem+=$(this).find("a").html()+',';
            }
        });
        $(".institute ul li").each(function () {
            if($(this).attr("class")=="layui-this"){
                instituteSelectedItem+=$(this).find("a").html()+',';
            }
        });
        $(".system ul li").each(function () {
            if($(this).attr("class")=="layui-this"){
                systemSelectedItem+=$(this).find("a").html()+',';
            }
        });
        $(".specialty ul li").each(function () {
            if($(this).attr("class")=="layui-this"){
                specialtySelectedItem+=$(this).find("a").html()+',';
            }
        });
        costSelectedItem=costSelectedItem.slice(0,costSelectedItem.length-1);
        instituteSelectedItem=instituteSelectedItem.slice(0,instituteSelectedItem.length-1);
        systemSelectedItem=systemSelectedItem.slice(0,systemSelectedItem.length-1);
        specialtySelectedItem=specialtySelectedItem.slice(0,specialtySelectedItem.length-1);
        //alert("specialtySelectedItem="+specialtySelectedItem);

        var index = layer.load(1, {
            shade: [0.1,'#fff'] //0.1透明度的白色背景
        });

        //渲染
        table.render({
            elem: '#processdef-table',
            url: '/fullSearch/getTableDataScientific',
            method:"POST",
            where: {param: {
                    "nd":$("#nd").val(),
                    "xmmc":$("#xmmc").val(),
                    "define1":costSelectedItem,
                    "define2":instituteSelectedItem,
                    "type_flag":systemSelectedItem,
                    "zycmc":$("#zycmc").val(),
                    "zylb":specialtySelectedItem,
                    "project_scope":$("#project_scope").val(),
                    "project_property":$("#project_property").val(),
                    "keyword":$("#keyword").val(),
                    "projectId":$("#projectId").val()

                }},
            limit: 15,
            id: 'processdef-table',
            height: commonDislodgeTable(),
            page: {
                groups: 5,
                limits: [15,30,45,60],
                layout: ['count', 'limit', 'prev', 'page', 'next', 'skip'], //自定义分页布局
                first: '首页', //不显示首页
                last: '尾页', //不显示尾页
                theme: '#0F9EE0'
            },
            cols: [[
                {title:'序号',               type:'numbers', width: '4%'},
                {field:'nd',               title:'年度',             style:'cursor: pointer;',align: 'center', width: '150'},
                {field:'hth',              title:'合同号',            style:'cursor: pointer;',align: 'center', width: '150'},
                {field:'xmmc',             title:'项目名称',           style:'cursor: pointer;',align: 'left', width: '380'},
                {field:'jf',               title:'项目经费总额（万元）',        style:'cursor: pointer;',align: 'center', width: '150'},
                {field:'define1',          title:'资本/费用',           style:'cursor: pointer;',align: 'center', width: '150'},
                {field:'define2',          title:'研究院',            style:'cursor: pointer;',align: 'left', width: '150'},
                {field:'define3',          title:'其他系统标识',        style:'cursor: pointer;',align: 'left', width: '150'},
                {field:'zylb',             title:'专业类别',          style:'cursor: pointer;',align: 'left', width: '150'},
                {field:'fzdw',             title:'项目类别描述',        style:'cursor: pointer;',align: 'left', width: '150'},
                {field:'parentName',       title:'父项目名',     style:'cursor: pointer;',align: 'left', width: '150'}

            ]],
            done: function (res, curr, count) {
                // 点击行联动选择框--单选
                $('.layui-table-box').find('.layui-table-body').find("table" ).find("tbody").children("tr").on('click',function(){
                    var index=parseInt($(this).index()+1);
                    $('tr').removeClass('layui-table-click');
                    $(this).addClass('layui-table-click');
                    $('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
                    $('tr:eq('+index+')').find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
                    selectRowData=res.data[index-1];
                });

                layer.close(index);
            }
        });
    }
</script>

</body>
</html>
