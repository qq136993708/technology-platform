<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/adminStp.css"  media="all">
    <link rel="stylesheet" href="/layuiadmin/style/mainStp.css"   media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css"    media="all">
    <link rel="stylesheet" href="/layuiadmin/style/second.css"    media="all">
    <style>
        .btn_details{background:url(/layuiadmin/layui/images/operation_03.png) 2px 4px #fff no-repeat;}
        .btnMyBgImg:hover{background-size:inherit;background-position: 2px;}
        .searchBox{background:none;}
    </style>
</head>
<body>
<div class="layui-fluid">
    <div class="">
        <div class="fluid-top">
          <#if userLevel=="1">
            <div class="breadcrumb" >
                <a href="/stpHome" target="_parent">首页 > </a>
                <a href="/instituteIndex?url=/home_ld/direct_depart" target="_parent">直属研究院概况 > </a>
                <span>经费支出</span>
            </div>
            </#if>
            <div class="searchBox">
                <input type="hidden" name="companyCode"  value="${companyCode}"   id="companyCode">
                <label class="dateInput" style="margin-right: 6px;">
                    <span>月份</span>
                    <input type="text" name="month" placeholder="请选择月份" title="月份" value="${month}"  autocomplete="off" class="form-control" id="month">
                    <i class="layui-icon layui-icon-date" style="margin-left:-35px"></i>
                </label>
                <!--按钮组-->
                <!-- <div class="btnGroup">
                     <button class="layui-btn layui-btn-sm fontColor-white btn_search btnMyBgImg" onclick="search_Event()">查询</button>
                 </div>-->
                <div class="btnGroup"  style="margin-left:10px;display:none">
                    <button id="knowledge_table" class="layui-btn layui-btn-sm fontColor-blue borderColor-blue  btnMyBgImg btn_details"
                    >详情</button>
                </div>
            </div>
        </div>

        
         <div class="ayui-row layui-col-space15">
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                      <span class="layui-time"></span>科研支出
                    </div>
                    <div class="layui-card-body btn-function">
                        <div class="text-total">
                            <span>总计:<span class="text-total-blue"    id="pay_chart1_01"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>新开课题:<span class="text-total-blue" id="pay_chart1_02"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>结转课题:<span class="text-total-blue" id="pay_chart1_03"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                        </div>
                        <div  style="height:270px;width: 100%;" id="pay_chart1"></div>
                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                       <span class="layui-time"></span>直属研究院各课题类型经费使用占比
                    </div>
                    <div class="layui-card-body btn-function" style="height: 296px;">
                    <table id="processdef-table" class="layui-hide" lay-filter="processdef-table"></table> 
                    </div>
                </div>
            </div>
        </div>
        
        
        
        <div class="ayui-row layui-col-space15">
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>直属研究院科研支出
                    </div>
                    <div class="layui-card-body btn-function">

                        <div class="text-total">
                            <span>总计:<span class="text-total-blue"    id="pay_chart3_01"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>资本性:<span class="text-total-blue" id="pay_chart3_02"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>费用性:<span class="text-total-blue" id="pay_chart3_03"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                        </div>
                        <div  style="height:270px;width: 100%;" id="pay_chart3"></div>
                    </div>
                </div>
            </div>

            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>直属研究院科研经费使用比率
                    </div>
                    <div class="layui-card-body btn-function" style="height: 296px;">
                    
            
                     <table id="myTable233" class="layui-table"  lay-filter="myTable233">
                            <thead>
                            <tr>
                                <th lay-data="{field:'g0GSJC', width:'16%'}" rowspan="2" >研究院</th>
                                <th lay-data="{align:'center'}" colspan="3">总计</th>
                                <th lay-data="{align:'center'}" colspan="3">费用性</th>
                                <th lay-data="{align:'center'}" colspan="3">资本性</th>
                            </tr>
                            <tr>
                                <th lay-data="{field:'zysje', width:'10%'}">实际拨款(亿元)</th>
                                <th lay-data="{field:'k0BNYSJHJE', width:'10%',templet:function(d){return d.k0BNYSJHJE.toFixed(2)}}">实际支出(亿元)</th>
                                <th lay-data="{field:'zRate', width:'8%'}">使用比率</th>

                                <th lay-data="{field:'fyxysje', width:'10%'}">实际拨款(亿元)</th>
                                <th lay-data="{field:'k0BNFYJE', width:'10%',templet:function(d){return d.k0BNFYJE.toFixed(2)}}">实际支出(亿元)</th>
                                <th lay-data="{field:'fyxRate', width:'8%'}">使用比率</th>

                                <th lay-data="{field:'zbxysje', width:'10%'}">实际拨款(亿元)</th>
                                <th lay-data="{field:'k0BNZBJE', width:'10%',templet:function(d){return d.k0BNZBJE.toFixed(2)}}">实际支出(亿元)</th>
                                <th lay-data="{field:'zbxRate', width:'8%'}">使用比率</th>
                            </tr>
                            </thead>
                        </table> 
                        
                    <!-- <table id="processdef-tabled" class="layui-hide" lay-filter="processdef-table"></table>  -->
                    </div>
                </div>
            </div>
         </div>
    </div>
</div>

<script src="/common/js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
<script type="text/javascript" src="/plugins/echarts/echarts.min.js"></script>
<script type="text/javascript" src="/plugins/echarts/walden.js"></script>	
<script type="text/javascript" src="/stp/hana/common/stp_common_line.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_bar.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_pie.js"></script>
<script type="text/javascript" src="/stp/hana/home/direct_depart/direct_common.js"></script>

<script type="text/javascript">
var layer;
var companyCode=$("#companyCode").val(); 
var editObj=null,ptable=null,tableId='processdef-table';
var table,treeGridCom;
layui.config({
	base: '/layuiadmin/lib/extend/'
}).extend({
	treeGridCom:'treeGridCom'
}).use(['jquery', 'layer','form','treeGridCom', 'laydate','table','laypage'], function(){
	table = layui.table;
	layer = layui.layer;
	treeGridCom = layui.treeGridCom;
	var $ = layui.jquery
      ,form = layui.form
      ,laydate = layui.laydate
    
   
      
      if(companyCode==null || companyCode=='')
      {
      	layer.alert("请配置直属院数据权限");
      }
	
    var monthValY=$("#month").val().substring(4,0);
    var monthValM=$("#month").val().substring(5);
    $(".layui-time").html(monthValY+"年"+monthValM+"月");
    form.render(null, 'component-form-group');
    laydate.render({
        elem: '#month'
        	,type: 'month'
        ,done: function(value, date, endDate){
            $(".layui-time").html(date.year+"年"+date.month+"月");
            $("#month").val(date.year+""+PrefixInteger(date.month, 2)); 
            search_Event();
        }
    });
   
    renderTable();
    renderTable2();
    $("#knowledge_table").click(function () {
    	window.open("/reportNew/reportPageStp?name=1673442773d_74f124ab&jsonparam=g0_type_flag,g0_project_scope");
    });
  
}); 

function PrefixInteger(num, length) {
	  return (num/Math.pow(10,length)).toFixed(length).substr(2);
	}
	
	
function initEchart()
{
	
	
	var v_date=(new Date()).getTime();
	var month=$('#month').val();
	month=month.replace("-","");
	
	var yAxis= [
        {
            type: 'value',
            name: '金额(亿元)',
            min: 0,
            axisLabel: {
                formatter: '{value}'
            }
        }
    ];
	
	
	//科研支出
    $("#pay_chart1_01").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#pay_chart1_02").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#pay_chart1_03").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    //直属研究院科研支出
    $("#pay_chart3_01").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#pay_chart3_02").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#pay_chart3_03").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    
    

    var color=["#37a2da","#72c376"];
    var chart1_url="/direct/pay_01?month="+month+"&v_date="+v_date+"&companyCode="+companyCode;
	var echart1=load_mutl_bar_down(chart1_url,"pay_chart1","","",yAxis,50,color);
	echart1.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		var g0XMDL="";
		if(xName=='资本性')
    	{
    	  g0XMDL="Z";
    	}else
   		{
   		g0XMDL="F";
   		}
		window.open("/direct/actualPay_detail?companyCode="+companyCode+"&month="+month+"&g0XMDL="+g0XMDL);
    });
	
	
	//
    var colorNew=["#8278e9","#f7d454"];
    var chart7_url="/direct/pay_03?type=1&month="+month+"&v_date="+v_date+"&companyCode="+companyCode;
	var echart7=load_mutl_bar_down_color(chart7_url,"pay_chart3","","",yAxis,colorNew);
	echart7.on('click', function (params) {
		var companyName=params.name;
		var legentName=params.seriesName;
		var g0XMDL="";
		if(legentName=='资本性')
	    {
			g0XMDL="Z";
	    }else
    	{
    	  g0XMDL="F";
    	}
		window.open("/direct/actualPay_detail?companyName="+companyName+"&month="+month+"&g0XMDL="+g0XMDL);
    });
	 //
	var setPay_count_count_url="/direct/pay_03?type=3&month="+month+"&v_date="+v_date+"&companyCode="+companyCode;
	setPay_count(setPay_count_count_url);
	
}

//初始化图形
initEchart();
//查询
function search_Event()
{
	initEchart();
	renderTable();
	renderTable2();
}




function setPay_count(url) 
{
	
   $.ajax({
	     type:"GET",
	     url: url,
	     dataType:"json",
	     timeout : 11000,
	     cache: false,
	     contentType: "application/x-www-form-urlencoded; charset=utf-8",
         success:function(data,status)
         {    
	          if(data.success==true ||data.success=='true')
	          {
       	           $("#pay_chart3_01").html(data.data.k0BNYSJHJE.toFixed(2)+"亿元");
       	           $("#pay_chart3_02").html(data.data.k0BNZBJE.toFixed(2)+"亿元");
       	           $("#pay_chart3_03").html(data.data.k0BNFYJE.toFixed(2)+"亿元");
	          } 
		   },
		   error:function()
		   {
		   },
		   complete: function (XMLHttpRequest, status) 
		   {
	       }
		  
  });
} 
function renderTable()
{  
	
	  var month=$("#month").val();
	  month=month.replace("-","");
	  var url='/direct/pay_02?month='+month+"&companyCode="+companyCode;
	 var  ptable=treeGridCom.render({
	        id:tableId
	        ,elem: '#processdef-table'
	        ,url:url
	        // ,cellMinWidth: 200
	        ,idField:'id'//必須字段
	        ,treeId:'id'//树形id字段名称
	        ,treeUpId:'pId'//树形父id字段名称
	        ,treeShowName:'name'//以树形式显示的字段
	        // ,heightRemove:[".dHead",10]//不计算的高度,表格设定的是固定高度，此项不生效
	        ,height:280
	        ,isFilter:false
	        ,iconOpen:false
	        ,isOpenDefault:true
	        ,loading: false
	        ,method:'get'
	        ,cols: [[
	            {field:'name',  title: '名称',edit:'text'},
	            {field:'extend02',  title:'实际拨款(亿元)',  style:'cursor: pointer;',align: 'left', width: '35%'},
	            {field:'extend01',  title:'实际支出(亿元)',  style:'cursor: pointer;',align: 'right',  templet: '<div>{{ layui.laytpl.milliFormat(d.extend01,2) }}</div>'},
	            {field:'extend03',  title:'使用比率',       style:'cursor: pointer;',align: 'left', width: '35%'}
	            
	        ]]
	        ,isPage:false
	        ,parseData:function (res) {
	            return res;
	        }
	        ,onClickRow:function (index, o) {
	            console.log(index,o,"单击！");
	        }
	        ,onDblClickRow:function (index, o) {
	            console.log(index,o,"双击");
	        }
	    }); 
}
 function renderTable2()
{

	var month=$("#month").val();
	month=month.replace("-","");
    var url= '/direct/pay_03?month='+month+"&type=2&companyCode="+companyCode;
    table.init('myTable233', {
		  url: url
		  ,height:"295px"
		  ,where: {} 
		  
		});
    
} 
        
</script>
</body>
</html>