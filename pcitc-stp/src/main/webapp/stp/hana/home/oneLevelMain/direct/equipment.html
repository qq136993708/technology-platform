<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/adminStp.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/mainStp.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/second.css" media="all">
    <style>
        .btn_details{background:url(/layuiadmin/layui/images/operation_03.png) 2px 4px #fff no-repeat;}
        .btnMyBgImg:hover{background-size:inherit;background-position: 2px;}
        .searchBox{background:none;}
    </style>
</head>
<body>
<div class="layui-fluid">
   <input type="hidden" name="companyCode"  value="${companyCode}"   id="companyCode">
    <div class="">
        <div class="fluid-top">
            <div class="breadcrumb">
                <a href="/stpHome" target="_parent">首页 > </a>
                <a href="/instituteIndex?url=/home_ld/direct_depart" target="_parent">直属研究院概况 > </a>
                <span>科研装备</span>
            </div>
            <div class="searchBox" style="margin-right: 6px;">
                <label class="dateInput">
                    <span>月份</span>
                    <input type="text" name="month" placeholder="请选择年份" title="年份" value="${month}"  autocomplete="off" class="form-control" id="month">
                    <i class="layui-icon layui-icon-date" style="margin-left:-35px"></i>
                </label>
            </div>
        </div>

        <div class="layui-row layui-col-space15">
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time1"></span>年直属研究院科研装备课题数量
                    </div>
                    <div class="layui-row-main">
                       <div class="text-total">
                            <span>总计:<span    class="text-total-blue"    id="equipment_chart1_01" onclick="equipment_chart1('')"     style="cursor:pointer"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>新开课题:<span class="text-total-blue"    id="equipment_chart1_02" onclick="equipment_chart1('新开课题')"     style="cursor:pointer"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>结转课题:<span class="text-total-blue"    id="equipment_chart1_03" onclick="equipment_chart1('结转课题')"     style="cursor:pointer"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                        </div>
                        
                        <div class="main-chart" id="equipment_chart1" style="height:280px;width: 100%;"></div>
                    </div>
                </div>
            </div>
            
            
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time1"></span>直属研究院科研课题数量占比
                    </div>
                    <div class="layui-row-main myTable" >
                        <table id="myTable" class="layui-table" lay-filter="myTable"  >
                            <thead>
                            <tr>
                                <th lay-data="{field:'define2', width:'22%',align:'center'}" rowspan="2">项目</th>
                                <th lay-data="{align:'center'}" colspan="2">总计</th>
                                <th lay-data="{align:'center'}" colspan="2">新开课题</th>
                                <th lay-data="{align:'center'}" colspan="2">结转课题</th>
                            </tr>
                            <tr>
                                <th lay-data="{field:'zsl', width:'13%',align:'right'}">数量（个）</th>
                                <th lay-data="{field:'zslRate', width:'13%',align:'right',templet:function(d){return d.zslRate.toFixed(2)+'%'}}">占比</th>

                                <th lay-data="{field:'xksl', width:'13%',align:'right'}">数量（个）</th>
                                <th lay-data="{field:'xkRate', width:'13%',align:'right',templet:function(d){return d.xkRate.toFixed(2)+'%'}}">占比</th>

                                <th lay-data="{field:'xjsl', width:'13%',align:'right'}">数量（个）</th>
                                <th lay-data="{field:'xjRate', width:'13%',align:'right',templet:function(d){return d.xjRate.toFixed(2)+'%'}}">占比</th>

                            </tr>

                            </thead>
                        </table>

                    </div>
                </div>
            </div>
        </div>




         <div class="layui-row layui-col-space15">
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>直属研究院科研装备数量
                    </div>
                    <div class="layui-row-main">
                        <div class="text-total" style="font-size: 12px;">
                             <span>大型分析仪器:<span class="text-total-blue" id="bar4_1_count"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>中型实验装置:<span class="text-total-blue" id="bar4_2_count"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>单台值大于500万:<span class="text-total-blue" id="bar4_3_count"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>专业软件（外购）:<span class="text-total-blue" id="bar4_4_count"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                        </div>
                        <div class="main-chart" id="equipment_chart3" style="height:280px;width: 100%;"></div>
                    </div>
                </div>
            </div>


            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>科研课题数量占比
                    </div>
                     <div class="layui-row-main processdef_table_02" >
                        <table id="processdef_table_02" class="layui-hide" lay-filter="processdef_table_02"></table>
                    </div>
                </div>
            </div>
        </div>



         <div class="layui-row layui-col-space15">
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>直属研究院科研装备数量
                    </div>
                    <div class="layui-row-main">
                     <div class="text-total">
                            <span>大型分析仪器:<span class="text-total-blue"    id="equipment_chart5_01"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>中型实验装置:<span class="text-total-blue"    id="equipment_chart5_02"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>单台值大于500万:<span class="text-total-blue" id="equipment_chart5_03"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>专业软件（外购）:<span class="text-total-blue" id="equipment_chart5_04"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                        </div>
                        <div class="main-chart" id="equipment_chart5" style="height:280px;width: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>





    </div>
</div>

<script src="/common/js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
<script type="text/javascript" src="/plugins/echarts/echarts.min.js"></script>
<script type="text/javascript" src="/plugins/echarts/walden.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_line.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_bar.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_pie.js"></script>
<script type="text/javascript" src="/stp/hana/home/direct_depart/direct_common.js"></script>

<script type="text/javascript">
var companyCode=$('#companyCode').val();
var layer;
var table;
layui.config({
    base: '/layuiadmin/'
}).extend({
    index: 'lib/index'
}).use(['index', 'layer','jquery','form', 'laydate','table','laypage'], function(){
	layer = layui.layer;
	  $ = layui.jquery
      ,table = layui.table
      ,form = layui.form
      ,laydate = layui.laydate;
	  if(companyCode==null || companyCode=='')
      {
      	layer.alert("请配置直属院数据权限");
      }
	  
	  form.render(null, 'component-form-group');
        laydate.render({
        	 elem: '#month',type: 'month'
            ,done: function(value, date, endDate){
                $(".layui-time1").html(date.year);
                $(".layui-time").html(date.year+"年"+date.month+"月");
                $("#month").val(date.year+"-"+PrefixInteger(date.month, 2));
                search_Event();
            }
        });


        var monthValY=$("#month").val().substring(4,0);
        var monthValM=$("#month").val().substring(5);
        $(".layui-time").html(monthValY+"年"+monthValM+"月");
        $(".layui-time1").html(monthValY);

        renderTable2();
        myTable();
});

function PrefixInteger(num, length) {
	  return (num/Math.pow(10,length)).toFixed(length).substr(2);
	}

function initEchart()
{


	var month=$('#month').val();
	month=month.replace("-","");
	var nd=month.substr(0,4);
	

	var v_date=(new Date()).getTime();
	var ndstr=nd+"年";
	var yAxis= [
        {
            type: 'value',
            name: '数量（个）',
            position: 'left',
            axisLabel: {
                formatter: '{value}'
            }
        }
    ];



	//直属研究院科研装备课题数量
    $("#equipment_chart1_01").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#equipment_chart1_02").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#equipment_chart1_03").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    //直属研究院科研装备数量
    $("#bar4_1_count").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#bar4_2_count").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#bar4_3_count").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#bar4_4_count").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    //直属研究院科研装备数量
    $("#equipment_chart5_01").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#equipment_chart5_02").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#equipment_chart5_03").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
    $("#equipment_chart5_04").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');




   
    

	var chart1_url="/direct/equipment_01?type=1&nd="+nd+"&v_date="+v_date+"&xmlbbm=kyzb";
	var echart1=load_mutl_bar_down_color(chart1_url,"equipment_chart1","","",yAxis);
	echart1.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		var monthv=$('#month').val();
		var ndv=monthv.substr(0,4);
		
		var nd_temp=ndv;
		if(legentName=='结转课题')
		{
			nd_temp="";
		}
		
		var url=encodeURIComponent("/one_level_main/count_table?define2="+xName+"&nd="+nd_temp+"&ysnd="+ndv+"&define1=资本性&ktlx="+legentName);
        window.open("/instituteIndex?url="+url);
    });

	var url_01="/direct/equipment_02?type=1&companyCode="+companyCode+"&month="+month+"&v_date="+v_date;
	var data7=load_bar_zhengfu_callback(url_01,"equipment_chart3","","",function(data){

		var bCount_4=getDataCountForName_t(data,'大型分析仪器');
    	var zCount_4=getDataCountForName_t(data,'中型实验装置');
    	var dCount_4=getDataCountForName_t(data,'单台值大于500万');
    	var zyCount_4=getDataCountForName_t(data,'专业软件（外购）');
        var allCount_4=bCount_4+zCount_4+dCount_4+zyCount_4;
        //alert(bCount_4);
        $("#bar4_1_count").html(bCount_4+"套");
        $("#bar4_2_count").html(zCount_4+"台");
        $("#bar4_3_count").html(dCount_4+"台");
        $("#bar4_4_count").html(zyCount_4+"套");

	});
	data7.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		 
		 var url=encodeURIComponent("/one_level_main/equipment_03_detail?month="+$("#month").val()+"&companyName="+xName);
		 window.open("/instituteIndex?url="+url);
    });

	var chart5_url="/direct/equipment_03?companyCode="+companyCode+"&v_date="+v_date+"&month="+month;
	var echart5=load_mutl_bar_stack_02(chart5_url,"equipment_chart5","","",yAxis,1,function(data){

		var bCount_4=getDataCountForName_t(data,'大型分析仪器');
    	var zCount_4=getDataCountForName_t(data,'中型实验装置');
    	var dCount_4=getDataCountForName_t(data,'单台值大于500万');
    	var zyCount_4=getDataCountForName_t(data,'专业软件（外购）');
        var allCount_4=bCount_4+zCount_4+dCount_4+zyCount_4;
        //alert(bCount_4);
        $("#equipment_chart5_01").html(bCount_4+"套");
        $("#equipment_chart5_02").html(zCount_4+"台");
        $("#equipment_chart5_03").html(dCount_4+"台");
        $("#equipment_chart5_04").html(zyCount_4+"套");
	});
	echart5.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		var url=encodeURIComponent("/one_level_main/equipment_03_detail?month="+$("#month").val()+"&companyName="+xName);
		 window.open("/instituteIndex?url="+url);
    });


}

function getDataCountForName_t(data,strName)
{
	var seriesList=data.seriesList;
	//alert(data);
    var xkCount=0;
    if (typeof(seriesList) == "undefined")
    {

    }else
    {
    	 for(var i=0;i<seriesList.length;i++)
         {
         	var arr=seriesList[i].data;
         	var name=seriesList[i].name;
         	if(name==strName)
         	{
         		var name_count=0;
         		for(var j=0;j<arr.length;j++)
 	            {
         			name_count=name_count+parseInt(arr[j]);
 	            }
         		xkCount=name_count;
         	}
         }

    }
    return parseInt(xkCount);

}



function equipment_chart1(ktlx)
{


	var month=$('#month').val();
	month=month.replace("-","");
	var nd=month.substr(0,4);
	var v_date=(new Date()).getTime();
	
	var nd_temp=nd;
	if(ktlx=='' || ktlx=='结转课题')
	{
		nd_temp="";
	}
	var url=encodeURIComponent("/one_level_main/count_table?nd="+nd_temp+"&ysnd="+nd+"&define1=资本性&v_date="+v_date+"&ktlx="+ktlx);
    window.open("/instituteIndex?url="+url);
}




//初始化图形
initEchart();
//查询
function search_Event()
{
	initEchart();
	myTable();
	renderTable2();
}


//集团重大项目
function renderTable2()
{
	var month=$('#month').val();
	
	month=month.replace("-","");
	  var v_date=(new Date()).getTime();
	  var tableOne=table.render({
	  elem: '#processdef_table_02',
	  url:'/direct/equipment_02?type=2&companyCode='+companyCode+'&v_date='+v_date+'&month='+month+"&xmlbbm=kyzb",
	  method:"GET",
      height:302,
	  where: {param: {"month":$("#month").val()}},
	  limit: 15,
	  id: 'processdef_table_02',

	  cols: [[
	  	   {field:'g0GSJC',           title: '研究院',    edit:'text', width: '20%',align: 'center'},
	       {field:'g0SBSL1',          title:'大型分析仪器（套）',style:'cursor: pointer;',align: 'right', width: '20%',templet:function(d){return parseInt(d.g0SBSL1)}},
	       {field:'g0SBSL2',          title:'中型实验装置（台）',style:'cursor: pointer;',align: 'right', width: '20%',templet:function(d){return parseInt(d.g0SBSL2)}},
	       {field:'g0SBSL3',          title:'单台值大于500万（台）',   style:'cursor: pointer;',align: 'right', width: '20%',templet:function(d){return parseInt(d.g0SBSL3)}},
	       {field:'g0SBSL4',          title:'外购专业软件（套）',   style:'cursor: pointer;',align: 'right', width: '20%',templet:function(d){return parseInt(d.g0SBSL4)}}




	  ]],
	  done: function (res, curr, count) {
	  	layer.closeAll('loading');
	      // 点击行联动选择框--单选
	      $('.processdef_table_02 .layui-table-box').find('.layui-table-body').find("table" ).find("tbody").children("tr").on('click',function(){
	          var index=parseInt($(this).index()+1);
	          $('tr').removeClass('layui-table-click');
	          $(this).addClass('layui-table-click');
	          $('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
	          $('tr:eq('+index+')').find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
	          selectRowData=res.data[index-1];
	          
	          var companyName=selectRowData.g0GSJC;
	          var url=encodeURIComponent("/one_level_main/equipment_03_detail?month="+$("#month").val()+"&companyName="+companyName);
	 		  window.open("/instituteIndex?url="+url);
	 		 
	      });
	  }
	});

}

function myTable()
{
	var month=$('#month').val();
	month=month.replace("-","");
	var nd=month.substr(0,4);
	var v_date=(new Date()).getTime();
	var url= '/direct/equipment_01?type=2&v_date='+v_date+"&nd="+nd+"&xmlbbm=kyzb";
    table.init('myTable', {
		  url: url
		  ,height:"300px"
		  ,where: {}
	});


    //监听行单击事件
    table.on('row(myTable)', function(obj){
        console.log(obj.tr) //得到当前行元素对象
        console.log(obj.data) //得到当前行数据
        var selectRowData=obj.data;
		var url=encodeURIComponent("/one_level_main/count_table?define2="+selectRowData.define2+"&nd=&ysnd="+nd+"&define1=资本性&v_date="+v_date);
        window.open("/instituteIndex?url="+url);
    });
    
}

        
</script>

</body>
</html>