<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/adminStp.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/mainStp.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/second.css" media="all">
    <style>
        .btn_details{background:url(/layuiadmin/layui/images/operation_03.png) 2px 4px #fff no-repeat;}
        .btnMyBgImg:hover{background-size:inherit;background-position: 2px;}
        .searchBox{background:none;}
    </style>
</head>
<body>
<div class="layui-fluid">
   <input type="hidden" name="month"        value="${month}"         id="month">
   <input type="hidden" name="companyCode"  value="${companyCode}"   id="companyCode">
    <div class="">
        <div class="searchBox">
            <label class="dateInput">
                <span>月份</span>
                <input type="text" name="year" placeholder="请选择月份" title="月份" value="${year}"  autocomplete="off" class="form-control" id="year">
            </label>
            <!--按钮组-->
            <div class="btnGroup">
                <button class="layui-btn layui-btn-sm fontColor-white btn_search btnMyBgImg"
                        onclick="search_Event()">查询</button>
            </div>
            <div class="btnGroup" style="float:right">
                <button id="knowledge_table" class="layui-btn layui-btn-sm fontColor-blue borderColor-blue  btnMyBgImg btn_details"
                >详情</button>
            </div>
        </div>

        <div class="layui-row layui-col-space15">
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>年直属研究院科研装备数量分布
                    </div>
                    <div class="layui-row-main">
                       <div class="text-total">
                            <span>总计:<span    class="text-total-blue"    id="equipment_chart1_01"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>新开课题:<span class="text-total-blue"    id="equipment_chart1_02"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>结转课题:<span class="text-total-blue"    id="equipment_chart1_03"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                        </div>
                        
                        <div class="main-chart" id="equipment_chart1" style="height:280px;width: 100%;"></div>
                    </div>
                </div>
            </div>
            
            
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                        ${year}年直属研究院科研装备数量占比
                        <div class="layui-tool">
                            <button type="button" class="btn btn-tool collapse"></button>
                            <button type="button" class="btn btn-tool remove"></button>
                        </div>
                    </div>
                    <div class="layui-card-body btn-function" >
                        <table id="myTable" class="layui-table" lay-data="{url:'/direct/equipment_01?type=2',height:'309'}">
                            <thead>
                            <tr>
                                <th lay-data="{field:'define2', width:'22%'}" rowspan="2">项目</th>
                                <th lay-data="{align:'center'}" colspan="2">总计</th>
                                <th lay-data="{align:'center'}" colspan="2">新开课题</th>
                                <th lay-data="{align:'center'}" colspan="2">结转课题</th>
                            </tr>
                            <tr>
                                <th lay-data="{field:'zsl', width:'13%'}">数量（个）</th>
                                <th lay-data="{field:'zslRate', width:'13%'}">占比</th>

                                <th lay-data="{field:'xksl', width:'13%'}">数量（个）</th>
                                <th lay-data="{field:'xkRate', width:'13%'}">占比</th>

                                <th lay-data="{field:'xjsl', width:'13%'}">数量（个）</th>
                                <th lay-data="{field:'xjRate', width:'13%'}">占比</th>

                            </tr>

                            </thead>
                        </table>

                    </div>
                </div>
            </div>
        </div>
        
        
        
        
         <div class="layui-row layui-col-space15">
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>年直属研究院科研装备数量
                    </div>
                    <div class="layui-row-main">
                        <div class="text-total">
                             <span>大型分析仪器:<span class="text-total-blue" id="bar4_1_count"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>中型实验装置:<span class="text-total-blue" id="bar4_2_count"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>单台值大于500万:<span class="text-total-blue" id="bar4_3_count"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>专业软件（外购）:<span class="text-total-blue" id="bar4_4_count"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                        </div>
                        <div class="main-chart" id="equipment_chart3" style="height:280px;width: 100%;"></div>
                    </div>
                </div>
            </div>
            
            
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                        ${year}年直属研究院科研装备数量占比
                        <div class="layui-tool">
                            <button type="button" class="btn btn-tool collapse"></button>
                            <button type="button" class="btn btn-tool remove"></button>
                        </div>
                    </div>
                     <div class="layui-card-body btn-function" >
                        <table id="processdef_table_02" class="layui-hide" lay-filter="processdef_table"></table>
                    </div>
                </div>
            </div>
        </div>
         
         
         
         
         <div class="layui-row layui-col-space15">
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>年直属研究院科研装备数量
                    </div>
                    <div class="layui-row-main">
                        <div class="main-chart" id="equipment_chart5" style="height:280px;width: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        
       
        
        
    </div>
</div>

<script src="/common/js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
<script src="/common/js/layer-v3.1.1/layer.js"></script>
<script type="text/javascript" src="/plugins/echarts/echarts.min.js"></script>
<script type="text/javascript" src="/plugins/echarts/walden.js"></script>	
<script type="text/javascript" src="/stp/hana/common/stp_common_line.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_bar.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_pie.js"></script>
<script type="text/javascript" src="/stp/hana/home/direct_depart/direct_common.js"></script>

<script type="text/javascript">
var table;
layui.config({
    base: '/layuiadmin/'
}).extend({
    index: 'lib/index' 
}).use(['index','jquery','form', 'laydate','table','laypage'], function(){
	  $ = layui.jquery
      ,table = layui.table
      ,form = layui.form
      ,laydate = layui.laydate
	  form.render(null, 'component-form-group');
        laydate.render({
           elem: '#year'
           ,format: 'yyyy'
        });
        $(".layui-time").html($("#year").val());
        $("#knowledge_table").click(function () {
        	window.open("/reportNew/reportPageStp?name=1673442773d_74f124ab&jsonparam=g0_type_flag,g0_project_scope");
        });
        renderTable2();
});


function initEchart()
{
	
	
	var month=$('#month').val();
	var companyCode=$('#companyCode').val();
	
	var v_date=(new Date()).getTime();
	var nd=$('#year').val();
	var ndstr=nd+"年";
	var yAxis= [
        {
            type: 'value',
            name: '数量',
            min: 0,
            max:'dataMax',
            position: 'left',
            axisLabel: {
                formatter: '{value}'
            }
        }
    ];
	
    $(".layui-time").html($("#year").val());
	var chart1_url="/direct/equipment_01?type=1&nd="+nd+"&v_date="+v_date;
	var echart1=load_mutl_bar_down_color(chart1_url,"equipment_chart1","","",yAxis);
	echart1.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		window.open("/reportNew/reportPageStp?name=1673442773d_74f124ab&jsonparam=g0_type_flag,g0_project_scope");
          
    });
	
	var url_01="/direct/equipment_02?type=1&companyCode="+companyCode+"&month="+month+"&v_date="+v_date;
	load_bar_zhengfu_callback(url_01,"equipment_chart3","","",function(data){

		var bCount_4=getDataCountForName_t(data,'大型分析仪器');
    	var zCount_4=getDataCountForName_t(data,'中型实验装置');
    	var dCount_4=getDataCountForName_t(data,'单台值大于500万');
    	var zyCount_4=getDataCountForName_t(data,'专业软件（外购）'); 
        var allCount_4=bCount_4+zCount_4+dCount_4+zyCount_4;
        //alert(bCount_4);
        $("#bar4_1_count").html(bCount_4);
        $("#bar4_2_count").html(zCount_4);
        $("#bar4_3_count").html(dCount_4);
        $("#bar4_4_count").html(zyCount_4);
		
	});
	
	
	var chart5_url="/direct/equipment_03?companyCode="+companyCode+"&v_date="+v_date+"&month="+month;
	var echart5=load_mutl_bar_stack_02(chart5_url,"equipment_chart5","","",yAxis,1);
	echart5.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		window.open("/reportNew/reportPageStp?name=1673442773d_74f124ab&jsonparam=g0_type_flag,g0_project_scope");
    });
	
	
}

function getDataCountForName_t(data,strName)
{
	var seriesList=data.seriesList;
	//alert(data);
    var xkCount=0;
    if (typeof(seriesList) == "undefined") 
    { 
    	
    }else
    {
    	 for(var i=0;i<seriesList.length;i++)
         {
         	var arr=seriesList[i].data;
         	var name=seriesList[i].name;
         	if(name==strName)
         	{
         		var name_count=0;
         		for(var j=0;j<arr.length;j++)
 	            {
         			name_count=name_count+parseInt(arr[j]);
 	            }
         		xkCount=name_count;
         	}
         } 
        
    }   
    return parseInt(xkCount);
       
}
//初始化图形
initEchart();
//查询
function search_Event()
{
	initEchart();
}
        

//集团重大项目
function renderTable2()
{
	var month=$('#month').val();
	var companyCode=$('#companyCode').val();
	
	var v_date=(new Date()).getTime();
	  var tableOne=table.render({
	  elem: '#processdef_table_02',
	  url:'/direct/equipment_02?type=2&companyCode='+companyCode+'&v_date='+v_date+'&month='+month,
	  method:"GET",
      height:309,
	  where: {param: {"month":$("#month").val()}},
	  limit: 15,
	  id: 'processdef_table_02',
	  
	  cols: [[
	  	   {field:'g0GSJC',        title: '研究院',    edit:'text', width: '20%'},
	       {field:'g0SBSL1',            title:'大型分析仪器（套）',style:'cursor: pointer;',align: 'left', width: '20%'},
	       {field:'g0SBSL2',         title:'中型实验装置（台）',style:'cursor: pointer;',align: 'left', width: '20%'},
	       {field:'g0SBSL3',          title:'单台值大于500万（台）',   style:'cursor: pointer;',align: 'left', width: '20%'},
	       {field:'g0SBSL4',          title:'外购专业软件（套）',   style:'cursor: pointer;',align: 'left', width: '20%'}
		      
	       
   
	       
	  ]],
	  done: function (res, curr, count) {
	  	layer.closeAll('loading');
	      // 点击行联动选择框--单选
	      $('.layui-table-box').find('.layui-table-body').find("table" ).find("tbody").children("tr").on('click',function(){
	      	var index=parseInt($(this).index()+1);
	          $('tr').removeClass('layui-table-click');
	          $(this).addClass('layui-table-click');
	          $('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
	          $('tr:eq('+index+')').find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
	          selectRowData=res.data[index-1];
	      });
	  }
	});

}

        
</script>

</body>
</html>