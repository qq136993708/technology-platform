<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/adminStp.css"  media="all">
    <link rel="stylesheet" href="/layuiadmin/style/mainStp.css"   media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css"    media="all">
    <link rel="stylesheet" href="/layuiadmin/style/second.css"    media="all">
    <style>
        .loadingImg{width: 24px;}
        .btn_details{background:url(/layuiadmin/layui/images/operation_03.png) 2px 4px #fff no-repeat;}
        .btnMyBgImg:hover{background-size:inherit;background-position: 2px;}
        .searchBox{background:none;}
        .layui-card-body .layui-table-body .layui-table tr:nth-child(1){background: #def4ff;}
        th{font-weight:bold}
    </style>
</head>
<body>
<div class="layui-fluid">
<input type="hidden" name="companyCode"  value="${companyCode}"   id="companyCode">

    <div class="">
        <div class="searchBox">
            <label class="dateInput">
                <span>年份</span>
                <input type="text" name="year" placeholder="请选择年份" title="年份" value="${year}"  autocomplete="off" class="form-control" id="year">
            </label>

            <!-- <div class="layui-input-inline">
                <select name="companyCode" id="companyCode"  >
                    <#list companyCodeList as vo>
                    <#if vo.g0GSJC == '全部'>
                    <option value="${vo.g0GSDM}"  selected="selected">${vo.g0GSJC}</option>
                </#if>
                <#if vo.g0GSJC != '全部'>
                <option value="${vo.g0GSDM}">${vo.g0GSJC}</option>
                    </#if>
                </#list>
                </select>
            </div> -->
            <!--按钮组-->
            <div class="btnGroup">
                <button class="layui-btn layui-btn-sm fontColor-white btn_search btnMyBgImg" onclick="search_Event()">查询</button>
            </div>
            <div class="btnGroup" style="float:right">
                <button id="knowledge_table" class="layui-btn layui-btn-sm fontColor-blue borderColor-blue  btnMyBgImg btn_details"
                >明细</button>
            </div>
        </div>

        <div class="layui-row layui-col-space15">

            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                       <span class="layui-time"></span>集团科研投资完成率
                        <div class="layui-tool">
                            <button type="button" class="btn btn-tool collapse"></button>
                            <button type="button" class="btn btn-tool remove"></button>
                        </div>
                    </div>
                    <div class="layui-card-body btn-function">

                        <div class="text-total" style="font-size: 13px;">
                            <span>年度预算总计:<span class="text-total-blue"    id="chart1_01"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>费用性实际下达:<span class="text-total-blue"   id="chart1_02"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>资本性实际下达:<span class="text-total-blue"   id="chart1_03"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>投资完成率:<span class="text-total-blue"      id="chart1_04"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                        </div>
                        <div  style="height:272px;width: 100%;" id="chart1"></div>
                    </div>
                </div>
            </div>

            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">
                       <span class="layui-time"></span>集团科研投资完成率（万元）
                        <div class="layui-tool">
                            <button type="button" class="btn btn-tool collapse"></button>
                            <button type="button" class="btn btn-tool remove"></button>
                        </div>
                    </div>
                    <div class="layui-card-body btn-function" >
                        <table id="myTable" class="layui-table" lay-data="{url:'/one_level_main/investment_01_01',height:'295'}">
                            <thead>
                            <tr>
                                <th lay-data="{field:'define3', width:'16%'}" rowspan="2" >企业类型</th>
                                <th lay-data="{align:'center'}" colspan="3">总计</th>
                                <th lay-data="{align:'center'}" colspan="3">费用性</th>
                                <th lay-data="{align:'center'}" colspan="3">资本性</th>
                            </tr>
                            <tr>
                                <th lay-data="{field:'zysje', width:'10%'}">年度预算</th>
                                <th lay-data="{field:'zsjje', width:'10%'}">实际下达</th>
                                <th lay-data="{field:'zRate', width:'8%',templet:function(d){return d.zRate+'%'}}">完成率</th>

                                <th lay-data="{field:'fyxysje', width:'10%'}">年度预算</th>
                                <th lay-data="{field:'fyxsjje', width:'10%'}">实际下达</th>
                                <th lay-data="{field:'fyxRate', width:'8%',templet:function(d){return d.fyxRate+'%'}}">完成率</th>

                                <th lay-data="{field:'zbxysje', width:'10%'}">年度预算</th>
                                <th lay-data="{field:'zbxsjje', width:'10%'}">实际下达</th>
                                <th lay-data="{field:'zbxRate', width:'8%',templet:function(d){return d.zbxRate+'%'}}">完成率</th>
                            </tr>

                            </thead>
                        </table>

                    </div>
                </div>
            </div>
        </div>
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>直属研究院科研投资完成率
                    </div>
                    <div class="layui-card-body btn-function">

                          <div class="text-total">
                            <span>年度预算总计:<span class="text-total-blue"     id="chart7_01"><img class="loadingImg" style="" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>实际下达总计:<span class="text-total-blue"     id="chart7_02"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>未下达总计:<span class="text-total-blue"       id="chart7_03"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                            <span>投资完成率:<span class="text-total-blue"       id="chart7_04"><img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span></span>
                        </div>

                        <div class="main-chart" id="chart7" style="height:280px;width: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/common/js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
<script type="text/javascript" src="/plugins/echarts/echarts.min.js"></script>
<script type="text/javascript" src="/plugins/echarts/walden.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_chart.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_line.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_bar.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_pie.js"></script>
<script type="text/javascript" src="/stp/hana/home/direct_depart/direct_common.js"></script>
<script type="text/javascript" src="/stp/hana/home/oneLevelMain/investment.js"></script>
<script type="text/javascript">
var tableOne=null,tableTwo=null,selectRowData;
layui.config({
    base: '/layuiadmin/lib/extend/'
}).extend({
    treeGridCom:'treeGridCom'
}).use(['jquery','table','form', 'laydate','layer'], function(){
    var $=layui.jquery;
    table = layui.table;
    layer=layui.layer;
    laydate = layui.laydate;
    form = layui.form;
    var year=$("#year").val();
    $(".layui-time").html(year+"年");
    form.render(null, 'component-form-group');
    laydate.render({
    	
    	 elem: '#year'
    	      ,type: 'year'

    	      
    });
   
    $("#knowledge_table").click(function () {
    	window.open("/reportNew/reportPageStp?name=167305d0060_d4723a52");
        // parent.layui.index.openTabsPage("/home/project-list?define1=费用性", "科研项目明细"); 
    });
  
});

function initEchart()
{
	
	 var year=$("#year").val();
     $(".layui-time").html(year+"年");
	 var companyCode=$("#companyCode").val();
	 var v_date=(new Date()).getTime();
	 var month=$('#year').val();
	 
	 
	  var  yAxis1= [
          {
          	 type: 'value',
          	 name: '亿元',
               min: 0,
               interval: 10,
               max:'dataMax',
               position: 'left',
               axisLabel: {
                   formatter: '{value}'
               }
          } 
      ];
	  
	  
	  var  yAxis2= [
          {
          	 type: 'value',
          	 name: '亿元',
               //min: 0,
               //interval: 10,
               //max:'dataMax',
               splitLine:{show: false},//去除网格线
               position: 'left',
               axisLabel: {
                   formatter: '{value}'
               }
          } ,
          {
              type: 'value',
              show: true ,
              name: '百分比',
              //min: 0,
              //max: 100,
              //interval: 20,
             // splitLine:{show: false},//去除网格线
              position: 'right',
              axisLabel: {
                  formatter: '{value}%'
              }
          } 
      ];
	  
	  
	 
	 
	 
	
	 

		var chart1_url="/one_level_main/investment_01?month="+month+"&v_date="+v_date+"&companyCode="+companyCode;
		var color=["#bee5d2","#6bdf9e"];
		var echart=load_mony_line_dt_investment(chart1_url,"chart1","","",yAxis1,1,color);
		echart.on('click', function (params) {
			var xName=params.name;
			var legentName=params.seriesName;
			window.open("/reportNew/reportPageStp?name=1673442773d_74f124ab&jsonparam=g0_type_flag,g0_project_scope");
	    }); 
		
		
		var investment_0101_url="/one_level_main/investment_0101?month="+month+"&v_date="+v_date+"&companyCode="+companyCode;
		setinvestmentCount(investment_0101_url);
		
		
		
		var chart7_url="/one_level_main/investment_02?month="+month+"&v_date="+v_date+"&companyCode="+companyCode;
		var color=["#f3655b","#8ab3cf","#f19049"];
		var echart7=load_mutl_bar_investment(chart7_url,"chart7","","",yAxis2,color,60,function (data){
		});
		echart7.on('click', function (params){
			var xName=params.name;
			var legentName=params.seriesName;
			window.open("/reportNew/reportPageStp?name=1673442773d_74f124ab&jsonparam=g0_type_flag,g0_project_scope");
	    });

		var investment_02_count_url="/one_level_main/investment_02_count?month="+month+"&v_date="+v_date+"&companyCode="+companyCode;
		setInvestment_02_count(investment_02_count_url);
		
		
 	
}

//初始化图形
initEchart();
//查询
function search_Event()
{
	initEchart();
	myTable();
}


function myTable()
{
	table.reload('myTable', {
		  url: '/one_level_main/investment_01_01'
		  ,where: {} 
		  
		});
}




function setinvestmentCount(url) 
{
	
   $.ajax({
	     type:"GET",
	     url: url,
	     dataType:"json",
	     timeout : 11000,
	     cache: false,
	     contentType: "application/x-www-form-urlencoded; charset=utf-8",
         success:function(data,status)
         {    
	          if(data.success==true ||data.success=='true')
	          {
	        	           var zysje_count=0;
	        	           var fyxsjje_count=0;
	        	           var zbxsjje_count=0;
	        	           var list=data.data;
	        	           
	        	           for(var i=0;i<list.length;i++)
	        	           {
	        	        	  var zysje=list[i].zysje/10000;//预算总计 
	        	        	  var fyxsjje=list[i].fyxsjje/10000;//费用性实际下达
	        	        	  var zbxsjje=list[i].zbxsjje/10000;//资本性实际下达
	        	        	  // alert(fyxsjje);
	        	        	  zysje_count=zysje_count+parseFloat(zysje);
	        	        	  fyxsjje_count=fyxsjje_count+parseFloat(fyxsjje);
	        	        	  zbxsjje_count=zbxsjje_count+parseFloat(zbxsjje);
	        	           }
	        	           
	        	           
	        	           
	        	           $("#chart1_01").html(zysje_count.toFixed(2)+"亿元");
	        	           $("#chart1_02").html(fyxsjje_count.toFixed(2)+"亿元");
	        	           $("#chart1_03").html(zbxsjje_count.toFixed(2)+"亿元");
	        	           $("#chart1_04").html(percentNum(zbxsjje_count+fyxsjje_count,zysje_count));
	        	           
	        	           
	        	       
	          } 
		   },
		   error:function()
		   {
		   },
		   complete: function (XMLHttpRequest, status) 
		   {
	            
	       }
		  
  });
} 



function setInvestment_02_count(url) 
{
	
   $.ajax({
	     type:"GET",
	     url: url,
	     dataType:"json",
	     timeout : 11000,
	     cache: false,
	     contentType: "application/x-www-form-urlencoded; charset=utf-8",
         success:function(data,status)
         {    
	          if(data.success==true ||data.success=='true')
	          {
	        	  
	        	           var zysje_count=0;
	        	           var zsjje_count=0;
	        	           var wxdje_count=0;
	        	           
	        	           var list=data.data;
	        	           for(var i=0;i<list.length;i++)
	        	           {
	        	        	  var zysje=list[i].zysje;//预算总计 
	        	        	  var zsjje=list[i].zsjje;//实际下达
	        	        	  var wxdje=list[i].wxdje;//未下达
	        	        	  //alert(fyxsjje);
	        	        	  zysje_count=zysje_count+parseFloat(zysje);
	        	        	  zsjje_count=zsjje_count+parseFloat(zsjje);
	        	        	  wxdje_count=wxdje_count+parseFloat(wxdje);
	        	           }
	        	           
	        	           $("#chart7_01").html(zysje_count.toFixed(2)+"亿元");
	        	           $("#chart7_02").html(zsjje_count.toFixed(2)+"亿元");
	        	           $("#chart7_03").html(wxdje_count.toFixed(2)+"亿元");
	        	           $("#chart7_04").html(percentNum(zsjje_count,zysje_count));
	        	           
	        	           
	        	       
	          } 
		   },
		   error:function()
		   {
		   },
		   complete: function (XMLHttpRequest, status) 
		   {
	            
	       }
		  
  });
} 

function percent_Num(num,num2) {
	
   return (Math.round(num / num2 * 10000) / 100.00); 
}


//小数点后两位百分比
function percentNum(num,num2) {
	
	//return Math.floor(num / num2 * 100) / 100+"%";
   return (Math.round(num / num2 * 10000) / 100.00 + "%"); 
}
        
</script>
</body>
</html>