<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
<link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
<link rel="stylesheet" href="/layuiadmin/style/common.css">
<script src="/layuiadmin/layui/layui.js"></script>
<style>
.searchBox {
	margin: 10px 10px 0;
}

.searchBox .dateInput span {
	font-size: 14px;
	color: #666;
}
</style>
</head>
<body>
<!-- 各个处室 -->
		<input type="hidden" name="projectId" value="${projectId}" id="projectId">
		<!--新开、结转课题标志-->
		<input type="hidden" name="ktlx" value="${ktlx}" id="ktlx">
 <div class="layui-fluid">
    <div class="layui-card">
      <div class="layui-form layui-card-header layuiadmin-card-header-auto" style="padding:0px">
          <div class="layui-form-item">
          
          
            <div class="layui-inline">
            <label class="layui-form-label">项目名称：</label>
            <div class="layui-input-inline">
              <input type="text" name="xmmc" title="项目名称" placeholder="请输入项目名称" autocomplete="off" class="layui-input" id="xmmc"  >
            </div>
          </div>
          
           
          <div class="layui-inline">
            <label class="layui-form-label">项目年度：</label>
            <div class="layui-input-inline">
              <input type="text" name="nd" readonly="readonly" style="cursor:pointer" placeholder="请选择项目年度" title="项目年度" value="${nd}" autocomplete="off" class="layui-input" id="nd" width="100px" >
            </div>
          </div>
          <div class="layui-inline">
            <label class="layui-form-label">预算年度：</label>
            <div class="layui-input-inline">
            <input type="text" name="ysnd" readonly="readonly" style="cursor:pointer" placeholder="请选择预算年度" title="预算年度" value="${ysnd}" autocomplete="off" class="layui-input" id="ysnd" width="100px" >
            </div>
          </div>
          
          
          <div class="layui-inline">
            <label class="layui-form-label">费用类别：</label>
            <div class="layui-input-inline">
               <select name="define1" id="define1"  >
                      <option value="" >--请选择--</option>
	              <#list fylbList as vo> 
			          <option  value="${vo.numValue}" <#if define1==vo.numValue>selected="selected"</#if> >${vo.name}</option>
			      </#list>
              </select>
            </div>
          </div>
          
          <div class="layui-inline">
            <label class="layui-form-label">研究院：</label>
            <div class="layui-input-inline">
               <select name="define2" id="define2"  lay-filter="select_define11"  >
                     <option value="" >--请选择--</option>
		             <#list define2List as vo> 
				          <option value="${vo.name}"  <#if define2=vo.name>selected="selected"</#if>>${vo.name}</option>
				      </#list>
              </select>
            </div>
          </div>
          
          
       
        <div class="layui-inline">
            <button class="layui-btn layuiadmin-btn-list" data-type="searchEvent">
                <i class="layui-icon layui-icon-search layuiadmin-button-btn">查询</i>
            </button>
          </div>
       
       
       
       
       
          
       </div>
      </div>  
      <div class="tableBox" style="clear: both">
		<table id="processdef-table" class="layui-hide" lay-filter="processdef-table">
	  </div>
 </div>
</div>  



	
			<!--表格数据操作js-->
			<script src="/common/js/jquery-1.11.3.min.js"></script>
			<script>
				var table, selectRowData;
				var xmmc = $('#xmmc').val();

				layui.config({
					base : '/layuiadmin/lib/extend/'
				}).use([ 'jquery', 'form', 'laydate', 'table', 'laypage' ], function() {
					$ = layui.jquery, table = layui.table, form = layui.form, laydate = layui.laydate, form.render(null, 'component-form-group');
					laydate.render({
						elem : '#nd',
						type : 'year',
						done : function(value, date, endDate) {
							$("#nd").val(date.year);
						}
					});
					laydate.render({
						elem : '#ysnd',
						type : 'year',
						done : function(value, date, endDate) {
							$("#ysnd").val(date.year);
						}
					});
					//加载表格      
					renderTable();
					//移除表头的复选框,去掉全选
					$(".layui-table-header table thead th input").remove();

					// 触发不同的按钮事件
					var $ = layui.$, active = {
							searchEvent: function() { //点击查询按钮
				            	 renderTable();
				            }
					};

					//区别按钮属性
					$('.layui-btn').on('click', function() {
						var type = $(this).data('type');
						active[type] ? active[type].call(this) : '';
					});

				});
				
				function renderTable() 
				{
					//渲染
					table.render({
						elem : '#processdef-table',
						url : '/one_level_main/country_table_data',
						method : "POST",
						where : {
							param : {
								"nd" : $("#nd").val(),
								"ysnd" : $("#ysnd").val(),
								"xmmc" : $("#xmmc").val(),
								"ktlx" : $("#ktlx").val(),
								"define1" : $("#define1").val(),
								"define2" :  $("#define2").val(),
								"projectId" : $("#projectId").val()

							}
						},
						limit : 15,
						id : 'processdef-table',
						height : commonDislodgeTable()-100,
						page : {
							groups : 5,
							limits : [ 15, 30, 45, 60 ],
							layout : [ 'count', 'limit', 'prev', 'page', 'next', 'skip' ], //自定义分页布局
							first : '首页', //不显示首页
							last : '尾页', //不显示尾页
							theme : '#0F9EE0'
						},
						cols : [ [ {
							title : '序号',
							type : 'numbers',
							width : '45'
						}, {
							field : 'nd',
							title : '项目年度',
							style : 'cursor: pointer;',
							align : 'center',
							width : '80',
							sort : true
						}, {
							field : 'ysnd',
							title : '预算年度',
							style : 'cursor: pointer;',
							align : 'center',
							width : '10%',
							sort : true
						}, {
							field : 'hth',
							title : '合同号',
							style : 'cursor: pointer;',
							align : 'center',
							width : '10%',
							sort : true
						}, {
							field : 'xmmc',
							title : '项目名称',
							style : 'cursor: pointer;',
							align : 'left',
							width : '28%',
							sort : true
						}, {
							field : 'jf',
							title : '总额（万元）',
							style : 'cursor: pointer;',
							align : 'right',
							width : '10%',
							sort : true
						}, {
							field : 'ysje',
							title : '年度预算（万元）',
							style : 'cursor: pointer;',
							align : 'right',
							width : '10%',
							sort : true
						}, {
							field : 'define1',
							title : '资本/费用',
							style : 'cursor: pointer;',
							align : 'center',
							width : '10%',
							sort : true
						}, {
							field : 'fzdw',
							title : '负责单位',
							style : 'cursor: pointer;',
							align : 'center',
							width : '15%',
							sort : true
						}

						] ],
						done : function(res, curr, count) {
							// 点击行联动选择框--单选
							$('.layui-table-box').find('.layui-table-body').find("table").find("tbody").children("tr").on('click', function() {
								var index = parseInt($(this).index() + 1);
								$('tr').removeClass('layui-table-click');
								$(this).addClass('layui-table-click');
								$('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
								$('tr:eq(' + index + ')').find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
								selectRowData = res.data[index - 1];
							});

							layer.close(index);
						}
					});

					//监听排序
					table.on('sort(processdef-table)', function(obj) {
						console.log(this, obj.field, obj.type)
						//return;
						//服务端排序
						table.reload('processdef-table', {
							initSort : obj,
							page : {
								curr : 1
							}, //重新从第一页开始
							where : { //重新请求服务端
								orderKey : obj.field, //排序字段
								orderType : obj.type
							//排序方式
							}
						});
					});

				}

			</script>
</body>
</html>
