<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
<link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
<link rel="stylesheet" href="/layuiadmin/style/adminStp.css" media="all">
<link rel="stylesheet" href="/layuiadmin/style/mainStp.css" media="all">
<link rel="stylesheet" href="/layuiadmin/style/common.css" media="all">
<link rel="stylesheet" href="/layuiadmin/style/second.css" media="all">
<style>
.btn_details {
	background: url(/layuiadmin/layui/images/operation_03.png) 2px 4px #fff
		no-repeat;
}

.btnMyBgImg:hover {
	background-size: inherit;
	background-position: 2px;
}

.searchBox {
	background: none;
}
</style>
</head>
<body>
	<div class="layui-fluid">
		<div class="fluid-top">
			<div class="searchBox" style="margin-right: 6px;">
				<label class="dateInput">
					<span>年份</span>
					<input type="text" name="nd" placeholder="请选择年份" title="年份" value="${nd}" autocomplete="off" class="form-control" id="nd">
					<i class="layui-icon layui-icon-date" style="margin-left: -35px"></i>
				</label>
				<div class="btnGroup" style="display: none">
					<button id="knowledge_table" class="layui-btn layui-btn-sm fontColor-blue borderColor-blue  btnMyBgImg btn_details">详情</button>
				</div>
			</div>
		</div>


		<div class="layui-row layui-col-space15">
			<div class="layui-col-md12">
				<div class="layui-card">
					<div class="layui-card-header">
						<span class="layui-time"></span>
						直属研究院成果数量
					</div>
					<div class="layui-row-main">
						<div class="text-total">
							<span>
								成果数量总计：
								<span class="text-total-blue" id="chart_title_01" onclick="achievementTotalUrl('直属研究院', 'unit')" style="cursor: pointer">
									<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
								</span>
							</span>
						</div>
						<div class="main-chart" id="chart1" style="height: 280px; width: 100%;"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="layui-row layui-col-space15">
			<div class="layui-col-md6">
				<div class="layui-card">
					<div class="layui-card-header">
						<span class="layui-time"></span>
						年成果类型分布
					</div>
					<div class="layui-row-main">
						<div class="text-total">
							<span>
								成果数量总计：
								<span class="text-total-blue" id="chart_title_02" onclick="achievementTotalUrl('', 'unit')" style="cursor: pointer">
									<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
								</span>
							</span>
						</div>
						<div class="main-chart" id="chart4" style="height: 280px; width: 100%;"></div>
					</div>
				</div>
			</div>
			<div class="layui-col-md6  layui-col-space15" style="padding-right: 0;">
				<div class="layui-col-md6">
					<div class="layui-card">
						<div class="layui-card-header">
							<span class="layui-time"></span>
							年直属研究院成果类型-工业化分布统计
						</div>
						<div class="layui-row-main">
							<div class="text-total">
								<span>
									总计:
									<span class="text-total-blue" id="chart_title_03">
										<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
									</span>
								</span>
							</div>
							<div class="main-chart" id="chart5" style="height: 280px; width: 100%;"></div>
						</div>
					</div>
				</div>
				<div class="layui-col-md6" style="padding-right: 0;">
					<div class="layui-card">
						<div class="layui-card-header">
							<span class="layui-time"></span>
							年直属研究院成果类型-工业试验分布统计
						</div>
						<div class="layui-row-main">
							<div class="text-total">
								<span>
									总计:
									<span class="text-total-blue" id="chart_title_04">
										<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
									</span>
								</span>
							</div>
							<div class="main-chart" id="chart6" style="height: 280px; width: 100%;"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="layui-row layui-col-space15">
			<div class="layui-col-md12">
				<div class="layui-card">
					<div class="layui-card-header">
						<span class="layui-time"></span>
						年成果所属技术专业分布统计
					</div>
					<div class="layui-row-main">
						<div class="text-total">
							<span>
								成果数量总计：
								<span class="text-total-blue" id="chart_title_05" onclick="achievementTotalUrl('', 'unit')" style="cursor: pointer">
									<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
								</span>
							</span>
						</div>
						<div class="main-chart" id="chart7" style="height: 280px; width: 100%;"></div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript" src="/common/js/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
	<script type="text/javascript" src="/plugins/echarts/echarts.min.js"></script>
	<script type="text/javascript" src="/plugins/echarts/walden.js"></script>
	<script type="text/javascript" src="/stp/hana/common/stp_common_line.js"></script>
	<script type="text/javascript" src="/stp/hana/common/stp_common_bar.js?v=2"></script>
	<script type="text/javascript" src="/stp/hana/common/stp_common_pie.js?v=2"></script>

	<script type="text/javascript">
		var nd = $('#nd').val();
		var editObj = null, ptable = null, treeGridCom = null, layer = null;
		var ptable02 = null, treeGridCom = null, tableId02 = 'processdef_table_02';
		layui.config({
			base : '/layuiadmin/lib/extend/'
		}).extend({
			treeGridCom : 'treeGridCom'
		}).use([ 'jquery', 'form', 'laydate', 'treeGridCom', 'layer' ], function() {
			// var $=layui.jquery;
			treeGridCom = layui.treeGridCom;//很重要
			layer = layui.layer;
			laydate = layui.laydate;
			form = layui.form;

			form.render(null, 'component-form-group');
			laydate.render({
				elem : '#nd',
				min : '2016-10-14',
				type : 'year',
				done : function(value, date, endDate) {
					$(".layui-time").html(date.year);
					$("#nd").val(date.year);
					search_Event();
				}
			});

			$(".layui-time").html($("#nd").val());
			$("#knowledge_table").click(function() {
				//window.open("");
			});
		});

		function initEchart() {

			var v_date = (new Date()).getTime();
			var ndstr = nd + "年";
			var yAxis = [ {
				type : 'value',
				name : '数量（个）',
				position : 'left',
				axisLabel : {
					formatter : '{value}'
				}
			} ];

			$("#chart_title_01").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#chart_title_02").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#chart_title_03").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#chart_title_04").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#chart_title_05").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');

			var chart1_url = "/direct_second/direct_second_data_01?nd=" + nd + "&v_date=" + v_date;
			var echart1 = load_single_bar(chart1_url, "chart1", "", "", yAxis, [ "#87d359" ], 70, "", function(data) {
				var total_count = 0;
				$.each(data.data.seriesDataList, function(index, dt) {
					total_count += dt;
				});
				$("#chart_title_01").html(total_count + "个");
			});
			echart1.on('click', function(params) {
				var xName = params.name;
				var legentName = params.seriesName;
				var url = encodeURIComponent("/one_level_main/achievement_table?define1="+xName+"&nd=" + nd+"&groupFlag=jdh,sqjddw");
				window.open("/instituteIndex?url=" + url);

			});

			var chart4_url = "/direct_second/direct_second_data_02?type=1&nd=" + nd + "&v_date=" + v_date;
			var echart4 = load_single_bar(chart4_url, "chart4", "", "", yAxis, [ "#ff9f7f" ], 70, "", function(data) {
				var total_count = 0;
				$.each(data.data.seriesDataList, function(index, dt) {
					total_count += dt;
				});
				$("#chart_title_02").html(total_count + "个");
			});
			echart4.on('click', function(params) {
				var xName = params.name;
				var legentName = params.seriesName;
				var url = encodeURIComponent("/one_level_main/achievement_table?cglx="+xName+"&nd=" + nd+"&groupFlag=jdh,sqjddw");
				window.open("/instituteIndex?url=" + url);
			});

			var chart5_url = "/direct_second/direct_second_data_03?type=2&nd=" + nd + "&v_date=" + v_date;
			var echart5 = loadPie_02(chart5_url, "chart5", "", "", function(data) {
				var total_count = 0;
				$.each(data.data.dataList, function(index, dt) {
					total_count += dt.value;
				});
				$("#chart_title_03").html(total_count + "个");
			});
			echart5.on('click', function(params) {
				var xName = params.name;
				var url = encodeURIComponent("/one_level_main/achievement_table?define3=直属研究院&cglx=A.工业化&define1="+xName+"&nd=" + nd+"&groupFlag=jdh,sqjddw");
				window.open("/instituteIndex?url=" + url);

			});

			var chart6_url = "/direct_second/direct_second_data_04?nd=" + nd + "&v_date=" + v_date;
			var echart6 = loadPie_02(chart6_url, "chart6", "", "", function(data) {
				var total_count = 0;
				$.each(data.data.dataList, function(index, dt) {
					total_count += dt.value;
				});
				$("#chart_title_04").html(total_count + "个");
			});
			echart6.on('click', function(params) {
				var xName = params.name;
				var legentName = params.seriesName;
				var url = encodeURIComponent("/one_level_main/achievement_table?define3=直属研究院&cglx=B.工业试验&define1="+xName+"&nd=" + nd+"&groupFlag=jdh,sqjddw");
				window.open("/instituteIndex?url=" + url);

			});

			var chart7_url = "/direct_second/direct_second_data_05?nd=" + nd + "&v_date=" + v_date;
			var echart7 = load_single_bar(chart7_url, "chart7", "", "", yAxis, [ "#9799ec" ], 70, "", function(data) {
				var total_count = 0;
				$.each(data.data.seriesDataList, function(index, dt) {
					total_count += dt;
				});
				$("#chart_title_05").html(total_count + "个");
			});
			echart7.on('click', function(params) {
				var xName = params.name;
				var url = encodeURIComponent("/one_level_main/achievement_table?zy="+xName+"&nd=" + nd+"&groupFlag=jdh,sqjddw");
				window.open("/instituteIndex?url=" + url);

			});

		}

		//初始化图形
		initEchart();
		//查询
		function search_Event() {
			initEchart();
		}
		
		
		function achievementTotalUrl(showFlag, unitFlag) {
			var groupFlag = 'jdh';
			if (unitFlag == 'unit') {
				groupFlag = 'jdh,sqjddw';
			}
			var url = encodeURIComponent("/one_level_main/achievement_table?define3="+showFlag+"&nd=" + nd+"&groupFlag="+groupFlag);
			window.open("/instituteIndex?url=" + url);
		}
	</script>
</body>
</html>