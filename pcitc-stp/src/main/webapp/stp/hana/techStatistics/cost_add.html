<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/ztree/css/metroStyle/metroStyle.css">
    <link rel="stylesheet" href="/layuiadmin/style/common.css">
    <style type="text/css">
.demo_line_05{
    letter-spacing: -1px;
    color: #ddd;
    width:100%;
    margin-top:30px;
    margin-bottom:30px;
}
.demo_line_05 span{
    letter-spacing: 0;
    color: #222;
    margin:0 20px;
}
    </style>
</head>
<body>
<div class="layer-box">
<form class="layui-form" name="form1" id="form1" action="" method="POST"  lay-filter="component-form-group layui-container">
<input type="hidden" name="id" id="id" value="${techCost.id}">
<input type="hidden" name="attachmentDoc" id="attachmentDoc" value="${attachmentDoc}">
<input type="hidden" name="type" id="type" value="${type}">
<input type="hidden" name="unitCode" id="unitCode" value="">
 <input type="hidden" name="allUnitName" id="allUnitName" value="${allUnitName}">
 
 
    <div class="formBox">
        <div class="tableToolBox">
            <div class="tableBtns">
                <div class="tableTitle"><span class="red">（金额为万元，标*号为必填项）</span>
                </div>
            </div>
        </div>
        <div class="box-body">
        
        
        
           <div class="layui-form-item">
                    <label class="layui-form-label">年份：<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                        <input class="layui-input"  style="cursor:pointer" readonly="readonly" id="year" name="year" lay-verify="required"
                               value="${year}" type="text">
                    </div>
             </div>
             
        
             <!-- 2行begin-->
             <div id="funds_sources_table">
             <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">科技项目费支出：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" placeholder="￥（万元）" name="techProjectCost" id="techProjectCost"
                                   value="${techCost.techProjectCost}" lay-verify="required" autocomplete="off" type="text"
                                    onkeyup="clearNoNum(this)">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">人工成本：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input"  placeholder="￥（万元）" name="techResearcherCost" id="techResearcherCost"
                                   value="${techCost.techResearcherCost}" lay-verify="required" autocomplete="off" type="text"
                                   onkeyup="clearNoNum(this)">
                        </div>
                    </div>
                </div>
             </div>
             
               <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">科技相关折旧费：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" placeholder="￥（万元）" name="techSubsidyCost" id="techSubsidyCost"
                                   value="${techCost.techSubsidyCost}" lay-verify="required" autocomplete="off" type="text"
                                  onkeyup="clearNoNum(this)">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">科技设施投资：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="techFacilitiesCost" id="techFacilitiesCost"
                                   value="${techCost.techFacilitiesCost}" placeholder="￥（万元）"  lay-verify="required" autocomplete="off" type="text"
                                   onkeyup="clearNoNum(this)">
                        </div>
                    </div>
                </div>
             </div>
              <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">其它科技支出：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" placeholder="￥（万元）" name="techOtherCost" id="techOtherCost"
                                   value="${techCost.techOtherCost}" lay-verify="required" autocomplete="off" type="text"
                                    onkeyup="clearNoNum(this)">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">合计：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" placeholder="￥（万元）系统自动计算"  readonly="readonly" name="techSubtotalCost" id="techSubtotalCost"
                                   value="${techCost.techSubtotalCost}" lay-verify="required" autocomplete="off" type="text"
                                    onkeyup="clearNoNum(this)">
                        </div>
                    </div>
                </div>
             </div>
             </div>
              <!-- 2行结束-->
              
                <div class="demo_line_05" style="text-align:center;">———————————<span>承担和参加国家级科技项目情况</span>————————————</div>
             <!-- 3行begin-->
             
             <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">牵头项目数量：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input"  name="countryLeadCount" id="countryLeadCount"
                                   value="${techCost.countryLeadCount}" lay-verify="number" autocomplete="off" type="text"
                                   onkeyup="this.value=this.value.replace(/\D/g,'')"
                                   onafterpaste="this.value=this.value.replace(/\D/g,'')">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">参加项目数量：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="countryJoinCount" id="countryJoinCount"
                                   value="${techCost.countryJoinCount}" lay-verify="number" autocomplete="off" type="text"
                                   onkeyup="this.value=this.value.replace(/\D/g,'')"
                                   onafterpaste="this.value=this.value.replace(/\D/g,'')">
                        </div>
                    </div>
                </div>
             </div>
              <div class="layui-form-item">
                    <label class="layui-form-label">国家投入经费：<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                        <input class="layui-input" id="countryFunds" placeholder="￥（万元）"  name="countryFunds" lay-verify="required"
                               value="${techCost.countryFunds}" type="text"  onkeyup="clearNoNum(this)">
                    </div>
             </div>
             <!-- 3行begin-->
             
             
            <div class="demo_line_05" style="text-align:center;">———————————<span>承担和参加地方（省级）科技项目情况</span>————————————</div>
             <!-- 4行begin-->
             
             <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">牵头项目数量：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="provinceLeadCount" id="provinceLeadCount"
                                   value="${techCost.provinceLeadCount}" lay-verify="number" autocomplete="off" type="text"
                                   onkeyup="this.value=this.value.replace(/\D/g,'')"
                                   onafterpaste="this.value=this.value.replace(/\D/g,'')">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">参加项目数量：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="provinceJoinCount" id="provinceJoinCount"
                                   value="${techCost.provinceJoinCount}" lay-verify="number" autocomplete="off" type="text"
                                   onkeyup="this.value=this.value.replace(/\D/g,'')"
                                   onafterpaste="this.value=this.value.replace(/\D/g,'')">
                        </div>
                    </div>
                </div>
             </div>
              <div class="layui-form-item">
                    <label class="layui-form-label">地方政府投入经费<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                        <input class="layui-input" id="provinceFunds" placeholder="￥（万元）"  name="provinceFunds" lay-verify="required"
                               value="${techCost.provinceFunds}" type="text"  onkeyup="clearNoNum(this)">
                    </div>
             </div>
             <!-- 4行begin-->
             
             
             
              <div class="demo_line_05" style="text-align:center;">———————————<span>单位信息</span>————————————</div>
         
             <div class="layui-form-item">
                    <label class="layui-form-label">您所在单位名称：<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                        <input class="layui-input readOnlyBox" onclick="chooseUnitRaio()" style="cursor:pointer" readonly="readonly" id="unitName" name="unitName" lay-verify="required"
                               value="${unitName}" type="text">
                    </div>
             </div>
                
              <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">子公司负责人：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" placeholder="分（子）公司科技负责人" name="techChargeMan" id="techChargeMan"
                                   value="${techCost.techChargeMan}" lay-verify="required" autocomplete="off" type="text" >
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">主管部门负责人<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="chargeDepartMan" id="chargeDepartMan"
                                   value="${techCost.chargeDepartMan}" lay-verify="required" autocomplete="off" type="text">
                        </div>
                    </div>
                </div>
             </div>
             <div class="layui-row">
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">填表人：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input readOnlyBox" readonly="readonly" placeholder="填表人" name="createUserName" id="createUserName"
                                   value="${createUserName}" lay-verify="required" autocomplete="off" type="text">
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                    <div class="layui-form-item">
                        <label for="" class="layui-form-label">填表人联系电话：<span class="must-fill">*</span></label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="createUserMobile" id="createUserMobile"
                                   value="${techCost.createUserMobile}" lay-verify="required" autocomplete="off" type="text">
                        </div>
                    </div>
                </div>
             </div>
             
              <!--行结束-->
            
            
             
             
                <div class="layui-form-item">
                    <label class="layui-form-label">附件：</label>
                    <div id="file_div" class="layui-input-block"></div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">备注：</label>
                    <div class="layui-input-block">
                        <textarea name="remark" id="remark" class="layui-textarea">${techCost.remark}</textarea>
                    </div>
                </div>
               
        </div>
    </div>
     <!-- 1行结束-->
    
    
    
           <div class="form-bottom">
                    <div class="form-bottom-btns">
                        <button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue"
                                lay-submit="" lay-filter="sub">保存
                        </button>
                        <button type="button"
                                class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white"
                                id="closeBtn">关闭
                        </button>
                    </div>
                </div>
                
</form>                
</div>

<script src="/common/js/jquery-1.11.3.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script type="text/javascript">
    var v_date = (new Date()).getTime();
    var id = "${id?default('')}";
    var file_ids = "attachmentDoc";
    //detail:详情，edit：编辑
    file_edit_detail = "edit";
    //统管理-附件管理-附件配置：页面标识
    file_opt_flag = "172a639c63bc4f54bc8572186e2f10cc";


    layui.config({
        base: 'layuicommon/module/modules/' //静态资源所在路径
    }).extend({
        index: 'layui/tableDemo' //主入口模块
    }).use(['form', 'laydate', 'table', 'layer'], function () {
        var admin = layui.admin
            , element = layui.element
            , layer = layui.layer
            , laydate = layui.laydate
            , form = layui.form;
        form.render(null, 'component-form-group');
        laydate.render({
            elem: '#LAY-component-form-group-date'
        });

        //日期时间选择器
        laydate.render({
            elem: '#year' , type: 'year'
        });

        //添加到form.render()之后
        $("#file_div").load('/common/public/uploadlayuiload.html');

        /* 自定义验证规则  title 要验证的input的 lay-verify=""*/
        form.verify({
             techProjectCost: function (value) {
                if (value==null || value=='') {
                    return '请输入';
                }
            } 
        });

        //关闭事件
        $("#closeBtn").click(function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        })

        /* 监听提交 */
        form.on('submit(sub)', function (data) {
            //JSON.stringify(data.field)  提交信息json格式
            /*parent.layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            })*/
            
            var allUnitName=$("#allUnitName").val();
            var unitName=$("#unitName").val();
            var arr= unitName.split(",");
            if(unitName==null || unitName=='')
           	{
            	 layer.alert("单位名称为空");
            	 return false;
           	}else if(arr.length>=2)
           	{
           	 layer.alert("单位名过多，请选择一个");
        	   return false;
           	}/* else if(allUnitName.indexOf(unitName)== -1)
           	{
               layer.alert("只能选择一个您所在的单位");
         	   return false;
            } */else
       		{
           		var url = '/tech_cost/save?v_date=' + v_date + "&id=" + id;
                var backurl = "/tech_cost/to-list?v_date=" + v_date;
                ajaxOpt(url, "form1", "POST", backurl, "保存成功", "保存失败");
                return false;
       		}
            
           
            
        });
        
        
        
        $("#funds_sources_table  input").change(function () {
        	//alert($("#techSubsidyCost").val());
            $("#techSubtotalCost").val(
            	parseFloat($("#techProjectCost").val()   =='' ? 0 : $("#techProjectCost").val()) +
            	parseFloat($("#techResearcherCost").val()=='' ? 0 : $("#techResearcherCost").val()) +
                parseFloat($("#techSubsidyCost").val()   =='' ? 0 : $("#techSubsidyCost").val()) +
                parseFloat($("#techFacilitiesCost").val()=='' ? 0 : $("#techFacilitiesCost").val()) +
                parseFloat($("#techOtherCost").val()     =='' ? 0 : $("#techOtherCost").val())
            );
        });
        
    });


    function ajaxOpt(url, formName, type, backurl, successMsg, failMsg) {
        $.ajax({
            type: type,
            url: url,
            dataType: "json",
            data: $("#" + formName).serialize(),
            async: false,
            cache: false,
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function (data, status) {

                if (data.success == true || data.success == 'true') {


                    layer.alert(
                        successMsg,
                        {icon: 1, closeBtn: 0},
                        function () {
                            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                            parent.layer.close(index);  // 关闭layer
                            parent.location.href = backurl;
                        });

                } else {
                    layer.alert(failMsg);
                }

            },
            error: function () {
                layer.alert("网络访问错误");
            }

        });
    }

    function chooseUnitRaio() 
    {
    
	    layer.open({
	        title: '选择单位'
	        , skin: 'layui-layer-lan'
	        , shadeClose: true
	        , type: 2
	        , fixed: false
	        //若使用小窗口形式，则修改 maxmin 值为 true，则注释掉area:[100%,100%]属性,同时设置area: ['900px', '450px']
	        , maxmin: false
	        //若直接弹出页面 ，则修改 area;[100%,100%]，同时设置 maxmin 为false
	        , area: ['80%', '90%']
	        , content: "/unit_select_radio?company=search-group-company-tree"
	    }); 
    
    }
    
    
    
    function setCompanyData(unitCode,unitName) 
    {
    	$("#unitName").val(unitName);
    	$("#unitCode").val(unitCode);
    }
    
    
    
    
    
    
    
    
    
    
    
    function clearNoNum(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, "");  //清除“数字”和“.”以外的字符
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');//只能输入两个小数
        if (obj.value.indexOf(".") < 0 && obj.value != "") {//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
            obj.value = parseFloat(obj.value);
        }
    }

</script>
</body>
</html>