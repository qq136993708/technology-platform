<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css?+Math.random()">
    <link rel="stylesheet" href="/layuiadmin/style/second.css">
    <script src="/layuiadmin/layui/layui.js"></script>
    <style>
        ul li {
            float: left;
        }

        ul li.task-item {
            position: relative;
        }

        ul li img {
            width: 46px;
            height: 46px;
            margin: 6px 0;
        }

        ul li span {
            display: block;
            font-size: 12px;
            text-indent: 10px;
        }
    </style>
</head>
<body>
<div class="task-view">
    <div class="task-view-cont">
        <p>基本信息</p>
        <div class="layui-row">
            <div class="layui-col-md10">
                <div class="item">
                    <div class="layui-col-sm5">
                        <span>标题:</span>
                        <span id="workOrderName"></span>
                    </div>
                    <div class="layui-col-sm7">
                        <span>创建单位:</span>
                        <span id="unitName"></span>
                    </div>
                </div>
                <div class="item">
                    <div class="layui-col-sm5">
                        <span>类型:</span>
                        <span class="red" id="workOrderType"></span>
                    </div>
                    <div class="layui-col-sm7">
                        <span>当前处理人:</span>
                        <span id="workOrderAllotUserName"></span>
                    </div>
                </div>
                <div class="item">
                    <div class="layui-col-sm5">
                        <span>完成比例:</span>
                        <span id="bl"></span>
                    </div>
                    <div class="layui-col-sm7">
                        <span>转发:</span>
                        <span id="bak3"></span>
                    </div>
                </div>
                <div class="item">
                    <div class="layui-col-sm5">
                        <span>权重:</span>
                        <span id="announcements"></span>
                    </div>
                    <!--<div class="layui-col-sm7">-->
                    <!--<span>查看附件:</span>-->
                    <!--<span></span>-->
                    <!--</div>-->
                </div>
                <div class="item">
                    <div class="layui-col-md12">
                        <span>任务描述:</span>
                        <span id="remarks"></span>
                    </div>
                </div>
            </div>
            <!--<div class="layui-col-md2">-->
                <!--<div class="chart"></div>-->
            <!--</div>-->
        </div>
    </div>

    <div class="task-view-cont">
        <p>当前处理情况</p>
        <div id = "sonlist">

        </div>
    </div>
</div>

<script>
    var param = JSON.parse(window.localStorage.getItem("param"));
    var $;
    var publicMethods;
    layui.config({
        base: '/layuiadmin/lib/extend/' //静态资源所在路径
    }).extend({
        enhanceform: 'enhanceform'
    }).use(['form', 'laydate', 'table', 'jquery', 'layer', 'element', 'enhanceform', 'publicMethods'], function () {
        $ = layui.jquery;
        var admin = layui.admin, element = layui.element, layer = layui.layer, laydate = layui.laydate, table = layui.table, form = layui.form, enhanceForm = layui.enhanceform;
        // var enhance = new enhanceForm({
        //     elem: '#workOrderForm' //表单选择器
        // });
        publicMethods = layui.publicMethods, form.render(null, 'component-form-group');
        //关闭事件
        $("#closeBtn").click(function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        });

        //添加修改取值
        var dataId = '${dataId}';

        $.ajax({
            type: 'post',
            dataType: 'json',
            async: false,
            url: '/plan/viewBotWorkOrder?dataId=' + dataId,
            success: function (data) {
                console.log(data);
                dataJson = JSON.parse(JSON.stringify(data));
                selectData = data;
                $("#workOrderName").html(selectData.workOrderName);
                $("#unitName").html(selectData.unitName);
                $("#workOrderAllotUserName").html(selectData.workOrderAllotUserName);
                $("#bl").html(selectData.bl+"%");
                $("#bak3").html(selectData.bak3);
                $("#announcements").html(selectData.announcements);
                $("#remarks").html(selectData.remarks);
                $.ajax({
                    url: '/pageCommon/dic/ROOT_RWGL_RWLX',
                    dataType: 'json',
                    type: 'post',
                    success: function (data) {
                        $.each(data, function (index, item) {
                            if (dataJson.workOrderType == item.code) {
                                $("#workOrderType").html(item.name);
                            }
                        })
                        // form.render();
                    }
                });
            },
            error: function (e) {
                console.log(e);
            }
        });
        $.ajax({
            type: 'get',
            // dataType: 'json',
            async: false,
            // url: '/plan/tree-datas-list?dataId=8e222d5e6408404694e8dd20b15f186b',
            // url: '/plan/tree-datas?dataId=d3d68f5a2fd5405591fd05393f9497fa',
            url: '/plan/tree-datas?dataId=' + dataId,
            success: function (data) {
                data = eval(data);
                console.log("tree");
                console.log(data.length);
                var html = "";
                for (let i = 0; i < data.length; i++) {
                    var obj = data[i];
                    console.log(obj);
                    var d = obj.name.split("|");
                    html = html+"       <div class=\"item\">\n" +
                        "                <div class=\"layui-col-sm5\">\n" +
                        "                    <span>事项内容:</span>\n" +
                        "                    <span>"+d[0]+"</span>\n" +
                        "                </div>\n" +
                        "                <div class=\"layui-col-sm7\">\n" +
                        "                    <span>当前处理人:</span>\n" +
                        "                    <span>"+d[1]+d[2]+"</span>\n" +
                        "                </div>\n" +
                        "            </div>";

                }
                $("#sonlist").html(html);
                console.log(data);
            }
        });
    });
</script>

</body>
</html>