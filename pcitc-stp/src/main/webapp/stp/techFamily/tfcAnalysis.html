<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/ztree/css/metroStyle/metroStyle.css">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/style/common.css">

    <script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
    <script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
    <script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.core.js"></script>
    <script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.excheck.min.js"></script>
    <script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.all.js"></script>
    <script type="text/javascript" src="/layuiadmin/modules/selectTree.js"></script>
    <script type="text/javascript" src="/layuiadmin/modules/base.js"></script>
    <style>
        .tree-content {
            position: absolute;
            z-index: 998;
            background: #ffffff;
            max-height: 400px;
            width: 100%;
            border: 1px solid #ccc;
            overflow-y: scroll;
        }

        .layui-select-title input {
            display: inline-block
        }

        .searchBox .layui-input {
            width: 18%;
            min-width: 160px;
            display: inline-block !important;
            font-size: 12px !important;
            height: 24px !important;
            line-height: 24px !important;
            font-weight: normal !important;
            padding-left: 6px !important;
            padding-right: 6px !important;
            border-radius: 2px !important;
            vertical-align: middle;
            color: #555;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
            padding-top: 0px;
        }
    </style>
</head>
<body>
<body>
<div class="skill">
    <div class="skill-left">
        <ul>
            <li class="layui-this" onclick="changeTfcCode('@10@10001@');">勘探开发</li>
            <li onclick="changeTfcCode('@10@10002@');">石油炼制</li>
            <li onclick="changeTfcCode('@10@10003@');">石油化工</li>
            <li onclick="changeTfcCode('@10@10004@');">催化剂</li>
        </ul>
        <div class="layui-tab-item layui-show">
            <div class="layui-card-body">
                <div class="layui-tab">
                    <ul class="layui-tab-title">
                        <li class="layui-this">项目</li>
                        <li>成果</li>
                        <li>专利</li>
                        <li>人员</li>
                        <li>费用</li>
                    </ul>
                    <div class="layui-tab-content">
                        <div class="layui-tab-item layui-show">
                            <div class="lan">
                                <table id="indexOutProjectInfoTableId" class="layui-hide" lay-filter="tableEvent"></table>
                            </div>
                        </div>
                        <div class="layui-tab-item">
                            <table id="indexOutAppraisalTableId" class="layui-hide" lay-filter="tableEvent"></table>
                        </div>
                        <div class="layui-tab-item">
                            <table id="indexOutPatentTableId" class="layui-hide" lay-filter="tableEvent"></table>
                        </div>
                        <div class="layui-tab-item">
                            <div style="display:none;">
                                <table id="indexOutProjectInfoTableIdRy" class="layui-hide" style="display: none" lay-filter="tableEvent"></table>
                            </div>
                            <div id="indexOutProjectInfoTableIdRyShow"></div>
                        </div>
                        <div class="layui-tab-item">
                            <div style="display:none;">
                                <table id="indexOutProjectInfoTableIdFy" class="layui-hide" lay-filter="tableEvent"></table>
                            </div>
                            <div id="indexOutProjectInfoTableIdFyShow"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--右侧-->
    <div class="skill-right">111</div>
</div>

<script>
    var tfcCode = "@10@10001@";

    function changeTfcCode(code) {
        tfcCode = code;
        renderTable();
        renderTableZl();
        renderTableCg();
        renderTableRy();
        renderTableJf();
    }
</script>
<script>
    var param = JSON.parse(window.localStorage.getItem("param"));
    var table, selectRowData, workOrderStatus, publicMethods;
    layui.use(['jquery', 'form', 'laydate', 'table', 'layer', 'publicMethods', 'element', 'treeGridCom'], function () {
        table = layui.table;
        publicMethods = layui.publicMethods;
        var $ = layui.jquery, layer = layui.layer, laypage = layui.laypage, treeGridCom = layui.treeGridCom;
        ;
        $(".skill-left>ul li").click(function () {
            $(".skill-left>ul li").removeClass("layui-this");
            $(this).addClass("layui-this");
        });
        $(".layui-tab-content").css("height", (parseInt(parent.$("#LAY_app_body .layui-show iframe").height()) - 132) + "px");
        //人员
        var colsRy =
            [
                {type: 'checkbox', event: 'changeEvents', width: 55},
                {title: '序号', type: 'numbers', width: 55},
                {
                    field: "fzrxm",
                    title: "负责人", event: 'setActive', style: 'cursor: pointer;'
                },
                {
                    field: "xmmc",
                    title: "项目名称", event: 'setActive', style: 'cursor: pointer;', width: 300
                }
            ];

        function renderTableRy() {
            var where = {
                param:
                    {
                        "typeIndex": tfcCode
                        , "type": "ry"
                    }
            };
            treeGridCom.render({
                id: "indexOutProjectInfoTableIdRy"
                , elem: '#indexOutProjectInfoTableIdRy'
                , url: '/indexOutProjectInfo/getTableDataTree'
                , where: where
                , cellMinWidth: 100
                , idField: 'dataId'//必須字段
                , treeId: 'dataId'//树形id字段名称
                , treeUpId: 'nd'//树形父id字段名称
                , treeShowName: 'fzrxm'//以树形式显示的字段
                , heightRemove: [".dHead", 10]//不计算的高度,表格设定的是固定高度，此项不生效
                , height: commonDislodgeTable()
                , isFilter: false
                , iconOpen: true//是否显示图标【默认显示】
                , isOpenDefault: true//节点默认是展开还是折叠【默认展开】
                , loading: true
                , method: 'POST'
                , page: {
                    groups: 5
                    , limits: [param.selfRownum, 15, 30, 45, 60]
                    , layout: ['count', 'limit', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                    , first: '首页' //不显示首页
                    , last: '尾页' //不显示尾页
                    , theme: '#0F9EE0'
                },
                cols: [colsRy],
                done: function (res, curr, count) {
                }
            });
            // publicMethods.tableRender('indexOutProjectInfoTableIdRy', 'indexOutProjectInfoTableIdRy', '/indexOutProjectInfo/getTableData', false, colsRy, where, false, function (res, curr, count) {
            //     var user = "";
            //     var total=0;
            //     for (let i = 0; i < res.data.length; i++) {
            //         if (typeof res.data[i].fzrxm!="undefined"){
            //             total++;
            //             user = (user==""?"":(user+","))+res.data[i].fzrxm;
            //         }
            //     }
            //     console.log("总人数:"+total+"---参与人员:"+user);
            //     $("#indexOutProjectInfoTableIdRyShow").html("参与人员:<br>"+user+"<br>总人数:"+total);
            // });
        }

        renderTableRy();
        window.renderTableRy = renderTableRy;
        //经费
        var colsJf =
            [
                {type: 'checkbox', event: 'changeEvents', width: 55},
                {title: '序号', type: 'numbers', width: 55},
                {
                    field: "xmmc",
                    title: "项目名称", event: 'setActive', style: 'cursor: pointer;', width: 300
                },
                {
                    field: "yshf",
                    title: "实际花费", event: 'setActive', style: 'cursor: pointer;'
                },
                {
                    field: "jf",
                    title: "项目经费总额", event: 'setActive', style: 'cursor: pointer;', width: 100
                }
            ];

        function renderTableJf() {
            var where = {
                param:
                    {
                        "typeIndex": tfcCode
                        , "type": "fy"
                    }
            };
            publicMethods.tableRender('indexOutProjectInfoTableIdFy', 'indexOutProjectInfoTableIdFy', '/indexOutProjectInfo/getTableData', false, colsJf, where, false, function (res, curr, count) {
                // $('.layui-table-box').find('.layui-table-body').find("table").find("tbody").children("tr").on('click', function () {
                //     var index = parseInt($(this).index() + 1);
                //     $('tr').removeClass('layui-table-click');
                //     $(this).addClass('layui-table-click');
                //     $('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
                //     $('tr:eq(' + index + ')').find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
                //     selectRowData = res.data[index - 1];
                // });
                // selectRowData = "";
                var totalFy = 0.00;
                for (let i = 0; i < res.data.length; i++) {
                    if (typeof res.data[i].jf != "undefined") {
                        totalFy = res.data[i].jf * 1 + totalFy;
                    }
                }
                totalFy = totalFy.toFixed(2);
                $("#indexOutProjectInfoTableIdFyShow").html("总费用:" + totalFy);
                console.log("------------" + totalFy);
            });
        }

        renderTableJf();
        window.renderTableJf = renderTableJf;
        //项目
        var cols =
            [
                {type: 'checkbox', event: 'changeEvents', width: 55},
                {title: '序号', type: 'numbers', width: 55},
                {
                    field: "nd",
                    title: "年度", event: 'setActive', style: 'cursor: pointer;', width: 55
                },
                {
                    field: "hth",
                    title: "合同号", event: 'setActive', style: 'cursor: pointer;', width: 100
                },
                {
                    field: "xmmc",
                    title: "项目名称", event: 'setActive', style: 'cursor: pointer;', width: 300
                },
                {
                    field: "jf",
                    title: "项目经费总额", event: 'setActive', style: 'cursor: pointer;', width: 100
                },
                {
                    field: "kssj",
                    title: "开始时间", event: 'setActive', style: 'cursor: pointer;', width: 100
                }
            ];

        function renderTable() {
            var where = {
                param:
                    {
                        "typeIndex": tfcCode
                    }
            };
            publicMethods.tableRender('indexOutProjectInfoTableId', 'indexOutProjectInfoTableId', '/indexOutProjectInfo/getTableData', false, cols, where, true, function (res, curr, count) {
                $('.layui-table-box').find('.layui-table-body').find("table").find("tbody").children("tr").on('click', function () {
                    var index = parseInt($(this).index() + 1);
                    $('tr').removeClass('layui-table-click');
                    $(this).addClass('layui-table-click');
                    $('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
                    $('tr:eq(' + index + ')').find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
                    selectRowData = res.data[index - 1];
                });
                selectRowData = "";
            });
        }

        renderTable();
        window.renderTable = renderTable;

        //成果
        var colsCg =
            [
                {type: 'checkbox', event: 'changeEvents', width: 55},
                {title: '序号', type: 'numbers', width: 55},
                {
                    field: "nd",
                    title: "申请年度", event: 'setActive', style: 'cursor: pointer;', width: 100
                },
                {
                    field: "cgmc",
                    title: "成果名称", event: 'setActive', style: 'cursor: pointer;'
                },
                {
                    field: "sqjddw",
                    title: "申请单位", event: 'setActive', style: 'cursor: pointer;'
                },
            ];

        function renderTableCg() {
            var where = {
                param:
                    {
                        "typeIndex": tfcCode
                    }
            };
            publicMethods.tableRender('indexOutAppraisalTableId', 'indexOutAppraisalTableId', '/indexOutAppraisal/getTableData', false, colsCg, where, true, function (res, curr, count) {
                $('.layui-table-box').find('.layui-table-body').find("table").find("tbody").children("tr").on('click', function () {
                    var index = parseInt($(this).index() + 1);
                    $('tr').removeClass('layui-table-click');
                    $(this).addClass('layui-table-click');
                    $('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
                    $('tr:eq(' + index + ')').find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
                    selectRowData = res.data[index - 1];
                });
            });
        }

        renderTableCg();
        window.renderTableCg = renderTableCg;

        var colsZl =
            [
                {type: 'checkbox', event: 'changeEvents', width: 55},
                {title: '序号', type: 'numbers', width: 55},
                {
                    field: "sqri",
                    title: "申请日", event: 'setActive', style: 'cursor: pointer;', width: 100, templet: function (d) {
                        return d.sqri.substring(0, 10);
                    }
                },
                {
                    field: "fmmc",
                    title: "发明名称", event: 'setActive', style: 'cursor: pointer;', width: 200
                },
                {
                    field: "shenqr",
                    title: "申请人", event: 'setActive', style: 'cursor: pointer;', width: 150
                },
                {
                    field: "fmr",
                    title: "发明人", event: 'setActive', style: 'cursor: pointer;', width: 150
                },
                {
                    field: "zlh",
                    title: "专利号", event: 'setActive', style: 'cursor: pointer;', width: 150
                }
            ];

        function renderTableZl() {

            var where = {
                param:
                    {
                        "typeIndex": tfcCode
                    }
            };
            publicMethods.tableRender('indexOutPatentTableId', 'indexOutPatentTableId', '/indexOutPatent/getTableData', false, colsZl, where, true, function (res, curr, count) {
                $('.layui-table-box').find('.layui-table-body').find("table").find("tbody").children("tr").on('click', function () {
                    var index = parseInt($(this).index() + 1);
                    $('tr').removeClass('layui-table-click');
                    $(this).addClass('layui-table-click');
                    $('tr').find("td").find(".layui-unselect").removeClass("layui-form-checked")
                    $('tr:eq(' + index + ')').find("td").eq(0).find(".layui-unselect").addClass("layui-form-checked");
                    selectRowData = res.data[index - 1];
                });
            });
        }

        renderTableZl();
        window.renderTableZl = renderTableZl;
    });
</script>

</body>
</html>