<#include "/common/public/publicImportIndex.html"/>
<style>
    .file-preview,.file-caption-main{width: 80%;margin: 5px auto;}
    .content .radio input[type=radio], .box-body label input[type=radio]{opacity: 1;}
</style>
<section class="content">
    <form id="defaultForm" class="form-horizontal">
        <div class="form-group">
            <div class="col-sm-4">
                <input type="hidden" class="form-control" name="parentId" id="parentId" placeholder="文件种类"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">权限类型</label>
            <div class="col-sm-4">
                <div class="radio">
                    <!--icheck-radio-->
                    <input type="radio" name="bak1" data-flag="urlSelector" checked="true"  data-value="code" data-text="name" data-src="/dictionary/list/ROOT_XTGL_WJQX">
                    <!--<label>
                        <input id="r1" type="radio" value="0" name="gender" />
                        <label name="gender" class="checked radio" for="r1">男</label>
                        <input id="r2" type="radio" value="1" name="gender" />
                        <label name="gender" for="r2" class="radio">女</label>
                    </label>-->
                </div>
            </div>
        </div>
        <div class="form-group" id="file_container">
            <input type="file" name="file" class="file" id="attachment">
        </div>
        <input type="hidden" name="fileIds" id="fileIds" value="">

        <div class="form-group">
            <div class="col-sm-9 col-sm-offset-3">
                <button type="submit" class="btn btn-primary">保存</button>
                <button type="button" class="btn btn-default" data-btn-type="cancel" data-dismiss="modal">取消</button>
            </div>
        </div>
    </form>
</section>
<script type="text/javascript">
    var form = null;
    var id = "${id?default(0)}";
    if(id!=0){
        $("#fileIds").val(id);
    }
    var parentId = "${parentId?default(0)}";
    console.log(parentId);
    if (parentId != 0) {
        $("#parentId").val(parentId);
    }
    $(function () {
        form = $('#defaultForm').form();
        //初始化校验
        $('#defaultForm').bootstrapValidator({
            message: '请输入有效值',
            container: 'tooltip',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            submitHandler: function (validator, functionform, submitButton) {
                modals.confirm('确认保存？', function () {
                    var params = form.getFormSimpleData();
                    ajaxPost('/sysfilekind/savesysFileKindUpload', params, function (data, status) {
                        if (data == '200') {
                            modals.info("数据保存成功");
                            //移除弹出框
                            var modalId = "";
                            if ($(".modal").css("display") == "block") {
                                modalId = $(".modal").attr("id")
                            }
                            parent.$('#' + modalId).remove();
                            //刷新列表页面
                            $("#" + index.pageOnlyId)[0].contentWindow.updaTable();
                        }
                    });
                    // modals.closeWin(winId);
                });
            }
        });
        $('button[data-btn-type="cancel"]').click(function () {
            var modalId = "";
            if ($(".modal").css("display") == "block") {
                modalId = $(".modal").attr("id")
            }
            parent.$('#' + modalId).remove();
        });


        if (id != "0") {
            ajaxPost("/sysfile/get/"+id, {id: id}, function (data) {
                console.log(data);
                form.initFormData(data);
            })
        }
        form.initComponent();
    });

    function resetForm() {
        form.clearForm();
        $("#sysModule-form").data('bootstrapValidator').resetForm();
    }
</script>

<script>
    var filedflag = "1642149f56f_260e41d5";
    var str_showType = "edit";//显示文件类型 edit=可编辑  detail=明细 默认为明细

    //    var fileIds="";//编辑页面传此参数'b0792a7d-1fb2-43ff-8a80-10a96a4e3010'
    $("#attachment").file({
        title: "请上传附件",
        fileinput: {
            theme: "explorer"//,
        },
        //如果已经有部分文件(编辑)，在此传文件ids
        fileIds: $("#fileIds").val(),
        fileIdContainer: "[name='fileIds']",
        //showContainer:'#attachment',
        //显示文件类型 edit=可编辑  detail=明细 默认为明细
        showType: str_showType,
        window: false
    });
</script>
