<#include "/common/public/publicImportIndex.html"/>
<div class="container">
    <div class="row">
        <section>
            <form id="defaultForm" class="form-horizontal">

                <div class="form-group">
                <label class="col-sm-3 control-label">名称</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" name="kindName" placeholder="名称"/>
                    <input type="hidden" class="form-control" name="parentId" id="parentId" />
                </div>
            </div>

                <div class="form-group">
                    <div class="col-sm-9 col-sm-offset-3">
                        <button type="submit" class="btn btn-primary">保存</button>
                        <button type="button" class="btn btn-default" data-btn-type="cancel" data-dismiss="modal">取消</button>
                    </div>
                </div>
            </form>
        </section>
    </div>
</div>

<script type="text/javascript">
    var form = null;
    var id = "${id?default(0)}";
    var parentId = "${parentId?default(0)}";
    console.log(parentId);
    if(parentId!=0){
        $("#parentId").val(parentId);
    }
    $(function () {
        form = $('#defaultForm').form();
        //初始化校验
        $('#defaultForm').bootstrapValidator({
            message: '请输入有效值',
            container: 'tooltip',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            submitHandler: function (validator, functionform, submitButton) {
                modals.confirm('确认保存？', function () {
                    var params = form.getFormSimpleData();
                    ajaxPost('/sysfilekind/savesysFileKind', params, function (data, status) {
                        if (data == '200') {
                            modals.info("数据保存成功");
                            //移除弹出框
                            var modalId="";
                            if($(".modal").css("display")=="block"){
                                modalId=$(".modal").attr("id")
                            }
                            parent.$('#'+modalId).remove();
                            //刷新列表页面
                            $("#"+index.pageOnlyId)[0].contentWindow.updaTable();
                        }
                    });
                    // modals.closeWin(winId);
                });
            },
            fields: {
                kindName: {
                    validators: {
                        notEmpty: {
                            message: '请输入名称'
                        }
                    }
                }
            }
        });
        $('button[data-btn-type="cancel"]').click(function () {
            var modalId="";
            if($(".modal").css("display")=="block"){
                modalId=$(".modal").attr("id")
            }
            parent.$('#'+modalId).remove();
        });
        form.initComponent();
        if (id != "0") {
            ajaxPost("/sysfilekind/getsysFileKindInfo", {id: id}, function (data) {
                form.initFormData(data);
            })
        }
    });

    function resetForm() {
        form.clearForm();
        $("#sysModule-form").data('bootstrapValidator').resetForm();
    }
</script>
