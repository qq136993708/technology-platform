<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="Shortcut Icon" href="/layuiadmin/layui/images/favicon.ico" />
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/adminStp.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/oneLevel_.css" media="all">
    <link rel="stylesheet" href="/common/css/echart-common.css">
    <script src="/layuiadmin/layui/layui.js"></script>
    <style>
        html{background: #013660;}
    </style>
</head>
<body>
<input type="hidden" name="companyCode"  value="${companyCode}"   id="companyCode">
<input type="hidden" name="month"  value="${month}"   id="month">
<div class="layui-fluid layui-level-admin">
    <div class="layui-top">
        <div class="layui-header">
            <img src="/layuiadmin/layui/images/logo-leader-new.png"/>
            <div class="layui-search">
                <input type="text" placeholder="请输入关键字">
                <button class="btn"></button>
            </div>
        </div>
    </div>
    <div class="layui-main">
        <div class="layui-level-main">
            <div class="main-left">
                <div class="main-agency">
                    <p class="main-left-p">待办事项<span id="agency">23</span></p>
                    <ul>
                        <li class="state_1">
                            <span>03/20</span><span>09：00</span><span>AM</span>
                            <p>项目组组建</p>
                        </li>
                        <li class="state_1">
                            <span>03/20</span><span>09：00</span><span>AM</span>
                            <p>项目组组建</p>
                        </li>
                        <li class="state_1">
                            <span>03/20</span><span>09：00</span><span>AM</span>
                            <p>项目组组建</p>
                        </li>
                        <li class="state_1">
                            <span>03/20</span><span>09：00</span><span>AM</span>
                            <p>项目组组建</p>
                        </li>
                        <li class="state_1">
                            <span>03/20</span><span>09：00</span><span>AM</span>
                            <p>项目组组建</p>
                        </li>
                    </ul>
                </div>
                <div class="main-task"></div>
            </div>
            <div class="main-midd"></div>
            <div class="main-right"></div>
           <!-- <div class="layui-row">
                <div class="layui-left">
                    <div class="layui-row-pic">
                        <div class="layui-carousel" id="test-carousel-img">
                            <div carousel-item="">
                                <div>
                                    <img src="/layuiadmin/layui/images/pic.png"/>
                                    <p></p>
                                </div>
                                <div>
                                    <img src="/layuiadmin/layui/images/pic1.jpg"/>
                                    <p></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-news">
                        <p>科技要闻<span><a href="/expertController/leader_speech" target="_blank">更多></a></span></p>
                        <ul id="news">
                          &lt;!&ndash;   <li><a href="javascript:void(0);">武汉石化开发监控模块强化安全生产管控</a>
                                <span>2018-11-12 </span></li>
                            <li><a href="javascript:void(0);">武汉石化开发监控模块强化安全生产管控</a>
                                <span>2018-11-12 </span></li>
                            <li><a href="javascript:void(0);">武汉石化开发监控模块强化安全生产管控</a>
                                <span>2018-11-12 </span></li>
                            <li><a href="javascript:void(0);">武汉石化开发监控模块强化安全生产管控</a>
                                <span>2018-11-12 </span></li>
                            <li><a href="javascript:void(0);">武汉石化开发监控模块强化安全生产管控</a>
                                <span>2018-11-12 </span></li>
                            <li><a href="javascript:void(0);">武汉石化开发监控模块强化安全生产管控</a>
                                <span>2018-11-12 </span></li> &ndash;&gt;
                        </ul>
                    </div>
                </div>
                <div class="layui-right layui-row-text">
                    <ul class="layui-row" id="moduleConfig">
                        &lt;!&ndash;<li class="layui-col-md3" data-power="1">
                            <div class="layui-text-icon layui-leader">
                                <p>领导讲话</p>
                            </div>
                        </li>
                        <li class="layui-col-md3" >
                            <div class="layui-text-icon layui-textTop-two"  id="home_budget">
                                <p>科研投入</p>
                                <span id="textTopTwo">0</span><span class="layui-text-span">亿</span>
                                <img src="/layuiadmin/layui/images/level-close.png" class="dele" alt="">
                            </div>
                        </li>
                        <li class="layui-col-md3">
                            <div class="layui-text-icon layui-textTop-three" id="equipment">
                                <p>科研装备</p>
                                <span class="layui-box-number" id="K0BNGLFPHJECB_t">
                                <img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt=""></span>
                                <img src="/layuiadmin/layui/images/level-close.png" class="dele" alt="">
                            </div>
                        </li>
                        <li class="layui-col-md3">
                            <div class=" layui-text-icon layui-textBottom-four">
                                <p>科研人才</p>
                                &lt;!&ndash;<span id="textBottomFour">0</span><span class="layui-text-span">个</span>&ndash;&gt;
                                <img src="/layuiadmin/layui/images/level-close.png" class="dele" alt="">
                            </div>
                        </li>
                        <li class="layui-col-md6">
                            <div class="layui-text-icon layui-textTop-one"  id="porject">
                                <p>集团重点项目及十条龙科技攻关 </p>
                                &lt;!&ndash;  <span id="textTopOne">50</span><span class="layui-text-span">个</span> &ndash;&gt;
                                <span class="layui-box-number">
                                    <img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
                                </span>
                                <img src="/layuiadmin/layui/images/level-close.png" class="dele" alt="">
                            </div>
                        </li>
                        <li class="layui-col-md3">
                            <div class="layui-text-icon layui-contract" id="contract">
                                <p>科研合同</p>
                                &lt;!&ndash;  <span id="textTopThree"></span><span class="layui-text-span">个</span> &ndash;&gt;
                                <span class="layui-box-number" id="kyxm">
                                    <img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
                                </span>
                                <img src="/layuiadmin/layui/images/level-close.png" class="dele" alt="">
                            </div>
                        </li>
                        <li class="layui-col-md3">
                            <div class="layui-text-icon layui-icon_p" id="mainLeader">
                                <p>直属研究院概况</p>
                                <img src="/layuiadmin/layui/images/level-close.png" class="dele" alt="">
                            </div>
                        </li>
                        <li class="layui-col-md6">
                            <div class="layui-agency-left">
                                <p>待办督办</p>
                                <ul>
                                    <li>
                                        <img src="/layuiadmin/layui/images/agencyOne.png" alt="">
                                        <span class="layui-agency-left-span">待办事项</span>
                                        <span class="layui-agency-span" id="agencyOne">1</span>
                                    </li>
                                    <li>
                                        <img src="/layuiadmin/layui/images/agencyFour.png" alt="">
                                        <span class="layui-agency-left-span">任务督办</span>
                                        <span class="layui-agency-span" id="agencyFour">1</span>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li class="layui-col-md3">
                            <div class="layui-text-icon layui-party-four" id="achievements">
                                <p>科技成果</p>
                                <span class="layui-box-number" id="appraisalId">
                                     <img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
                                 </span>
                            </div>
                        </li>
                        <li class="layui-col-md3">
                            <div class="layui-text-icon layui-textBottom-three"  id="knowledge_right">
                                <p>知识产权</p>
                                <span class="layui-box-number" id="patentId">
                                    <img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
                                </span>
                                <img src="/layuiadmin/layui/images/level-close.png" class="dele" alt="">
                            </div>
                        </li>
                        <li class="layui-col-md3">
                            <div class="layui-text-icon layui-textBottom-two">
                                <p>重点实验室</p>
                                <span id="textBottomTwo">48</span><span class="layui-text-span">个</span>
                                <img src="/layuiadmin/layui/images/level-close.png" class="dele" alt="">
                            </div>
                        </li>
                        <li class="layui-col-md3">
                            <div class="layui-text-icon layui-icon_p">
                                <p>国际合作年度报告</p>
                                <img src="/layuiadmin/layui/images/level-close.png" class="dele" alt="">
                            </div>
                        </li>
                        <li class="layui-col-md3">
                            <div class="layui-text-icon layui-party-shi">
                                <p>中国石化标准化</p>
                                <span id="petrifaction">0</span><span class="layui-text-span">个</span>
                                <img src="/layuiadmin/layui/images/level-close.png" class="dele" alt="">
                            </div>
                        </li>
                        <li class="layui-col-md3">
                            <div class="layui-col-md" id="layui-add">
                                <div class="layui-add">
                                    <img src="/layuiadmin/layui/images/icon-puls.png"/>
                                </div>
                            </div>
                        </li>&ndash;&gt;
                    </ul>
                </div>
            </div>
            <div class="layui-row layui-row-special" style="margin-top: 20px;display: flex;">
                <ul class="layui-row">

                </ul>
            </div>-->
        </div>
    </div>
</div>
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script type="text/javascript" src="/layuiadmin/lib/extend/Sortable.min.js"></script>
<script>
var nd=$("#month").val().substring(4,0);

    layui.use([ 'carousel', 'form','jquery','publicMethods'], function(){
        var carousel = layui.carousel,$=layui.jquery,publicMethods=layui.publicMethods
            ,form = layui.form;
        /*搜索*/
        $(".layui-search .btn").click(function () {
            window.open("fullSearch/search?keyword="+$(".layui-search input").val(),"_target");
        });
        $(document).keyup(function(event){
            if(event.keyCode ==13){
                window.open("fullSearch/search?keyword="+$(".layui-search input").val(),"_target");
            }
        });
        //图片轮播
        carousel.render({
            elem: '#test-carousel-img'
            ,width: '100%'
            ,height: '277px'
            ,interval: 5000
        });
        /*配置模块*/
        $.ajax({
            type: 'GET',
            dataType: 'json',
            headers: {
                'Content-Type': 'application/json;charset=UTF-8',
            },
            url: "/layuiadmin/json/data.json",
            success: function (data, status) {
                publicMethods.moduleConfigs(data.data);
                //删除模块

                //领导讲话
                $("#layui_leader").on("click",function () {
                    window.open("/expertController/leader_speech","_target");
                });
                //直属研究院
                $("#mainLeader").on("click",function () {
                    window.open("/instituteIndex?url="+"/home_ld/direct_depart","_target");
                });
                //科研投入
                $("#home_budget").on("click",function () {
                	window.open("/instituteIndex?url="+"/one_level_main/investment","_target");
                });
                //十条龙-项目
                $("#porject").on("click",function () {
                    window.open("/instituteIndex?url="+"/one_level_main/dragon","_target");
                });
                //科技成果
                $("#achievements").on("click",function () {
                    window.open("/instituteIndex?url="+"/one_level_main/achievement","_target");
                });
                //知识产权
                $("#knowledge_right").on("click",function () {
                    window.open("/instituteIndex?url="+"/one_level_main/knowledge","_target");
                });
                //合同
                $("#contract").on("click",function () {
                    window.open("/instituteIndex?url="+"/one_level_main/contract","_target");
                });
                //重点实验室
                $("#laboratory").on("click",function () {
                    window.open("/instituteIndex?url=/chart/lab.html","_target");
                });
                //装备
                $("#equipment").on("click",function () {
                    window.open("/instituteIndex?url="+"/one_level_main/equipment","_target");
                });
                //科研人才
                $("#personnel").on("click",function () {
                    window.open("expertController/personnel","_target");
                });
	            init();
                $("#textBottomTwo").html("48");
                window.addLast=function () {
                    $("#layui-add").click(function() {
                        var temUrl = "/user/show/config";
                        publicMethods.openBaseWin("模块配置", temUrl, "50%", "80%")
                    });
                }
                addLast();
                var fooU = document.getElementById("moduleConfig");
                Sortable.create(fooU, {draggable:'.item',disabled: false});
            },
            error : function(err, err1, err2) {
                console.log("ajaxPost发生异常，请仔细检查请求url是否正确");
            }
        });
    });

	//合同
	function getContract() {
		$.ajax({
			type : 'GET',
			url : "/one_level_main/contract_count?nd="+nd,
			dataType : 'json',
			headers : {
				'Content-Type' : 'application/json'
			},
			timeout : 3000,
			error : function(XMLHttpRequest, status) {
				
			},
			success : function(data) {
				var projectCount = data.data.projectCount;
				$("#contract_id").html(projectCount+ "<small style='font-size:14px'>(个)</small>");
			}
		});

	}
	//科研装备
	function getEquipment() {
		
		var v_date=(new Date()).getTime();
		var month=$("#month").val();
		//alert(month);
		var companyCode=$("#companyCode").val();
		var chart1_url="/one_level_main/equipment_01?month="+month+"&v_date="+v_date+"&companyCode="+companyCode;
		$.ajax({
			type : 'GET',
			url : chart1_url,
			dataType : 'json',
			headers : {
				'Content-Type' : 'application/json'
			},
			timeout : 3000,
			error : function(XMLHttpRequest, status) {
			
			},
			success : function(data) {
				var xkCount_1=getDataCountForName(data.data,'500万以上');
		    	var jzCount_2=getDataCountForName(data.data,'300-500万');
		    	var jzCount_3=getDataCountForName(data.data,'100-300万');
		    	var jzCount_4=getDataCountForName(data.data,'100万以下');
		        var allCount=xkCount_1+jzCount_2+jzCount_3+jzCount_4;
				$("#equipment_id").html(allCount+ "<small style='font-size:14px'>(台)</small>");
			}
		});

	}
	
	
	//专利
	function patentCount() {
		$.ajax({
			type : 'POST',
			url : "/admin/patent-count?nd="+nd,
			dataType : 'json',
			headers : {
				'Content-Type' : 'application/json'
			},
			timeout : 3000,
			error : function(XMLHttpRequest, status) {
				
			},
			success : function(data) {
				var patentCount = data.patentCount;
				$("#patentId").html(patentCount + "<small style='font-size:14px'>(个)</small>");
			}
		});

	}

	//成果
	function appraisalCount() {
		$.ajax({
					type : 'POST',
					url : "/admin/appraisal-count?nd="+nd,
					dataType : 'json',
					headers : {
						'Content-Type' : 'application/json'
					},
					timeout : 3000,
					error : function(XMLHttpRequest, status) {
						
					},
					success : function(data) {
						var appraisalCount = data.appraisalCount;
						$("#appraisalId").html(appraisalCount + "<small  style='font-size:14px'>(个)</small>");
					}
				});

	}

	//十条龙-项目
	function setdragon_count() {
		$.ajax({
			type : 'GET',
			url : "/one_level_main/dragon_count?nd="+nd,
			dataType : 'json',
			headers : {
				'Content-Type' : 'application/json'
			},
			timeout : 3000,
			error : function(XMLHttpRequest, status) {
				
			},
			success : function(data) {
				var zsl = data.data.zsl;
				$("#dragon_id").html(zsl + "<small  style='font-size:14px'>(个)</small>");
			}
		});
	}

	//科研投入
	function setinvestment_count() {
		$.ajax({
					type : 'GET',
					url : "/one_level_main/investment_first_page_count?nd="+nd,
					dataType : 'json',
					headers : {
						'Content-Type' : 'application/json'
					},
					timeout : 3000, //超时时间设置，单位毫秒
					error : function(XMLHttpRequest, status) {
						
					},
					success : function(data) {
						var projectMoney=data.data.projectMoney;
						var tt =parseFloat(projectMoney)/10000;
						
						$("#textTopTwo").html(tt.toFixed(2) + "<small style='font-size:14px'>(亿元)</small>");
					}
				});
	}

	//新闻
	function get_news() {
		$.ajax({
			type : 'GET',
			url : "/one_level_main/get_news",
			dataType : 'json',
			headers : {
				'Content-Type' : 'application/json'
			},
			timeout : 3000,
			error : function(XMLHttpRequest, status) {
			},
			success : function(data) {
				 var list = data.data;
				 $.each(list, function(index, dt) {
					if (index < 6) {
						var html = "<li><a href='/instituteIndex?url=/sysNews/getNewsIndexTypeDetail?dataId="+dt.id+"' target='_blank'>"
								+ dt.title + "</a><span>" + dt.createtimestr
								+ "</span></li>"
						$("#news").append(html);
					}
				}); 
			}
		});
	}

	function init() {
		appraisalCount();
		patentCount();
		getContract();
		getEquipment();
		setdragon_count();
		setinvestment_count();
		get_news();
	}
	
	
	
	
	function getDataCountForName(data,strName)
	{
		var seriesList=data.seriesList;
		//alert(seriesList.length);
		
	    var xkCount=0;
	    for(var i=0;i<seriesList.length;i++)
	    {
	    	var arr=seriesList[i].data;
	    	var name=seriesList[i].name;
	    	if(name==strName)
	    	{
	    		var name_count=0;
	    		for(var j=0;j<arr.length;j++)
	            {
	    			name_count=name_count+parseInt(arr[j]);
	            }
	    		xkCount=name_count;
	    	}
	    } 
	    return parseInt(xkCount);
	}
</script>
</body>
</html>