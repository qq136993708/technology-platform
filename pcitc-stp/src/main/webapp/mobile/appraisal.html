<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>科技管理平台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/mobile/css/mobileNew.css">
    <style>
         .layui-tab-content:nth-child(1){    background: url(/mobile/images/mobile-line.png) no-repeat center bottom;height: auto;overflow: hidden;padding-bottom: .1rem;background-size: 100%;padding-top: .1rem;}
    </style>
</head>
<body>
<header>
    <div class="m_return child">
        <a href="/mobile/indexTest"><img src="/mobile/images/icon-back.png"/> </a>
        <h4>成果鉴定</h4>
        <input id="nd" type="text" value="${nd}" >
    </div>
    <div class="search">
        <input type="text" value="" placeholder="请输入成果名称或单位"  name="key" id="key" />
        <img src="/mobile/images/icon-search.png" alt="" id="search">
    </div>
</header>
<main class="main project appraisal">
    <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
            <ul id="list_div">
            </ul>
        </div>
    </div>
</main>
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script src="/mobile/js/rolldate.min.js"></script>
<script src="/mobile/js/mobile.js"></script>
<script>
    var layer;
    (function(doc, win) {
        var docEl = doc.documentElement,
            resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
            recalc = function() {
                var clientWidth = docEl.clientWidth;
                if (!clientWidth) return;
                docEl.style.fontSize = 100 * (clientWidth / 414) + 'px';
            };
        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener('DOMContentLoaded', recalc, false);
    })(document, window);
    layui.use(['jquery','layer','element','laydate'], function(){
        var $=layui.jquery;layer=layui.layer,element=layui.element,laydate = layui.laydate;
        laydate.render({
            elem: '#test-laydate-normElem'
            ,type: 'year'
            ,value:$("#nd").val()
        });
        new Rolldate({
            el: '#nd',
            format: 'YYYY',
            beginYear: 2017,
            endYear:  $("#nd").val(),
            value: $("#nd").val(),
            confirm: function (date) {
                $("#nd").val(date);
                search();
            }
        })
        $(".more-condition").css("height",document.body.clientHeight/100+"rem");
        $(".more-bg ul li").click(function () {
            $(this).addClass("layui-this")
        });
        $("#reset").click(function () {
            $(".more-bg ul li").removeClass("layui-this");
        });
        $("#more").click(function () {
            $(".more-condition").slideToggle("slow");
        });
        
        
        $("#search").click(function () {
        	search();
        });
        
        $(".layui-tab-item ul li").click(function () {
            layer.open({
                title : '详情',
                skin : 'layui-layer-mobile',
                shadeClose : false,
                type : 2,
                fixed : false,
                maxmin : true,
                area : [ '95%', '72.5%' ],
                content : '/mobile/project_details.html'
            });
        });
    });
    
    
    function search()
    {
    	 var key=$("#key").val();
    	 var nd=$("#nd").val();
    	 var v_date = (new Date()).getTime();
    	 queryAll("/mobile/one_level_main/achievement_table_data?nd="+nd+"&key="+key,"list_div","POST");
    	 
    	 page("list_div","/mobile/one_level_main/achievement_table_data?v_date="+(new Date()).getTime()+"&key="+$("#key").val()+"&nd="+nd,"POST","queryAll");
    	 
    }
    search();
    
    
    function queryAll(url,id,type)
    {
    	
    	$.ajax({
    		type : type,
    		url : url,
    		timeout : 9000,
    		dataType:'json', 
    		cache : false,
    		success : function(data, status) 
    		{
    			//console.log(data);
    			var count="";
    			$("#other_count").html("("+data.count+")"); 	
    			if(parseInt(data.data.length)>0)
   			    {
    				
   				  for(var i=0;i<data.data.length;i++)
       			  {
   					 var dataId= data.data[i].dataId;
   					 var cgmc= data.data[i].cgmc;
   					 var sqjddw= data.data[i].sqjddw;
   					 var jdjg= data.data[i].jdjg;
   					 
   					   var temp="<li  >"+
			                     "<p>"+
			                         "<span>"+cgmc+"</span>"+
			                         "<span>一等奖</span>"+
			                      "</p>"+
			                      "<dl>"+
			                        " <dd>成果单位: "+sqjddw+"</dd>"+
			                      "</dl>"+
			                    "</li>";
   					
					 count=count+temp;
       			  }
   			   }
    		   $("#"+id).html(count); 	
    		},
    		error : function() {
    		},
    		complete : function(XMLHttpRequest, status) {
    		}
    	});

    }
</script>
</body>
</html>