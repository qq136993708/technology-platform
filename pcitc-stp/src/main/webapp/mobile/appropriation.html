<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>科技管理平台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/mobile/css/mobileNew.css">
    <style>
        .layui-tab-content:nth-child(1){    background: url(/mobile/images/mobile-line.png) no-repeat center bottom;
            height: auto;
            overflow: hidden;
            padding-bottom: .1rem;
            background-size: 100%;
            padding-top: .1rem;}
            li{list-sytle:none}
    </style>
</head>
<body>
<input type="hidden" name="nd" id="nd" value="${nd}">
<header>
    <div class="m_return child">
        <a href="/mobile/indexTest"><img src="/mobile/images/icon-back.png"/> </a>
        <h4>科研拨款</h4>
        <div id="test-laydate-normElem" placeholder="yyyy" class="laydate-c"></div>
    </div>
</header>
<main class="main contract appropriation">
    <div class="layui-row">
        <div class="layui-tab-content">
            <h4>总计拨款 <span id="appropriation_sum">-亿</span></h4>
        </div>
    </div>
    <div id="chart"></div>
    <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
            <ul id="appropriation_list"> </ul>
        </div>
    </div>
</main>
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script>
    var layer;
    (function(doc, win) {
        var docEl = doc.documentElement,
            resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
            recalc = function() {
                var clientWidth = docEl.clientWidth;
                if (!clientWidth) return;
                docEl.style.fontSize = 100 * (clientWidth / 414) + 'px';
            };
        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener('DOMContentLoaded', recalc, false);
    })(document, window);
    layui.use(['jquery','layer','element','laydate'], function(){
        var $=layui.jquery;layer=layui.layer,element=layui.element,laydate = layui.laydate;
        laydate.render({
            elem: '#test-laydate-normElem'
            ,type: 'year'
            ,max: $("#nd").val()+1
            ,value:$("#nd").val(),
            done : function(value, date, endDate) 
            {
            	    $("#nd").val(date.year);
					search_Event();
			}
        });
    });
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    //科研拨款
	 function setBKCount(v_date,nd) 
	 {
		 
		    var url = "/mobile/investment_02?functionId=984b64b13cf54222bf57bd840759fabe&nd=" + nd + "&v_date=" + v_date;
	        $.ajax({
	            type: "GET",
	            url: url,
	            dataType: "json",
	            timeout: 11000,
	            cache: false,
	            headers : {
					'Content-Type' : 'application/json'
				},
	            success: function (data, status)
	            {
	            	console.log("科研拨款\n"+JSON.stringify(data));
	            	var count=0;
	            	var countStr="";
	            	for (var i = 0; i < data.data.length; i++) 
	            	{
						var zsjje = data.data[i].zsjje;//实际科研投入
						var define2 = data.data[i].define2;
						count = count + parseFloat(zsjje);
						
						    var temp="<li style='list-sytle:none'>"+
					    				"<p>"+
					    				    "<span>"+define2+"</span>"+
					                        "<span style='float:right'> "+setNumStr(zsjje)+"</span>"+
					                    "</p>"+
				                       "</li>";
			               countStr=countStr+temp;
					}
	            	 $("#appropriation_list").html(countStr); 
	            	 
					$("#appropriation_sum").html((count/ 10000).toFixed(2)+"<lable >亿<lable>");
	            },
	            error: function () {
					
				},
	            complete: function (XMLHttpRequest, status) {

	            }

	        });
	}
	 
    
    
	    function search_Event()
	    {
	    	var v_date = (new Date()).getTime();
	    	var nd = $("#nd").val();
		    setBKCount(v_date,nd)
	    }
	    search_Event();
	    
	    
	    
	    
	    
	    
	    
	    
	    
	    
	    
	    
	    
	    
	    function setNumStr(num)
	    {
	    	
	    	var result="";
	    	
	    	if(num=='0.00')
			{
	    		num=0;
			}
			if(parseFloat(num)>10000)//亿
			{
				var  temp=parseFloat(num/10000).toFixed(2);
				var  endstr=temp.substring(temp.length-3);
				//alert(temp);
				if(endstr=='.00')
				{
					temp= temp.substring(0,temp.length-3);
				}
				result="<lable style='color:red'>"+temp+"<lable><lable style='font-size:14px;font-weight:normal'>亿<lable>";
			}else//万
			{
				
				var  temp=parseFloat(num).toFixed(2);
				var  endstr=temp.substring(temp.length-3);
				if(endstr=='.00')
				{
					//temp= temp.replace(".00","")
					temp= temp.substring(0,temp.length-3);
				}
				result="<lable style='color:red'>"+temp+"<lable><lable style='font-size:14px;font-weight:normal'>万<lable>";
			}
			return result;
	    }
</script>
</body>
</html>