<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>科技管理平台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/mobile/css/mobileNew.css">
    <style>
        .layui-tab-content:nth-child(1){    background: url(/mobile/images/mobile-line.png) no-repeat center bottom;height: auto;overflow: hidden;padding-bottom: .1rem;background-size: 100%;padding-top: .1rem;}
    </style>
</head>
<body>
<header>
    <div class="m_return child">
        <a href="/mobile/indexTest"><img src="/mobile/images/icon-back.png"/> </a>
        <h4>科研项目</h4>
        <div id="test-laydate-normElem" placeholder="yyyy" class="laydate-c"></div>
    </div>
    <div class="search">
        <input type="text" name="xmmc" id="xmmc" value="请输入合同号或项目名" />
        <img src="/mobile/images/icon-search.png" alt="">
    </div>
</header>
<form action="" name="form1" id="form1" >
<input type="hidden" name="nd" id="nd" value="${nd}">
<input type="hidden" name="limit" id="limit" value="${limit}">
<input type="hidden" name="page"  id="page"  value="${page}">
<input type="hidden" name="qdbz"  id="qdbz"  value="${qdbz}">
<input type="hidden" name="fzdwflag"  id="fzdwflag"  value="牵头单位">


<input type="hidden" name="functionId"  id="functionId"  value="984b64b13cf54222bf57bd840759fabe">
</form>
<main class="main contract project">
    <div class="layui-row">
        <div class="layui-tab-content">
            <div class="layui-col-xs4">
                <span id="finished_id">-个</span>
                <span>已签约</span>
                <span></span>
            </div>
            <div class="layui-col-xs4">
                <span  id="not_finished_id">-个</span>
                <span>未签约</span>
                <span></span>
            </div>
            <div class="layui-col-xs4">
                <button id="more">更多条件</button>
            </div>
        </div>
    </div>
    <div class="more-condition">
        <div class="more-bg">
            <div class="item">
                <p><span>& </span>专业处</p>
                <ul>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                </ul>
            </div>
            <div class="item">
                <p><span>& </span>研究院</p>
                <ul>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                </ul>
            </div>
            <div class="item">
                <p><span>& </span>部门</p>
                <ul>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                    <li>勘探条件</li>
                </ul>
            </div>
        </div>
        <div class="button-g">
            <button>确定</button>
            <button id="reset">重置</button>
        </div>
    </div>
    <div id="chart"></div>
    <div class="layui-tab">
        <div>
            <ul class="layui-tab-title">
                <li class="layui-this">已签</li>
                <li>未签</li>
                <li>全部</li>
            </ul>
        </div>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <ul id="qdbz_ed_id"></ul>
            </div>
            <div class="layui-tab-item">
             <ul id="qdbz_not_id"></ul>
            </div>
            <div class="layui-tab-item">
                <ul id="qdbz_all_id"></ul>
            </div>
        </div>
    </div>
</main>
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script>
    var layer;
    (function(doc, win) {
        var docEl = doc.documentElement,
            resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
            recalc = function() {
                var clientWidth = docEl.clientWidth;
                if (!clientWidth) return;
                docEl.style.fontSize = 100 * (clientWidth / 414) + 'px';
            };
        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener('DOMContentLoaded', recalc, false);
    })(document, window);
    layui.use(['jquery','layer','element','laydate'], function(){
        var $=layui.jquery;layer=layui.layer,element=layui.element,laydate = layui.laydate;
        laydate.render({
            elem: '#test-laydate-normElem'
            ,type: 'year'
           	 ,value:$("#nd").val()
               ,max: $("#nd").val()+1
               ,done : function(value, date, endDate) 
               {
           	    $("#nd").val(date.year);
   				search_Event();
   		    }
        });
        $(".more-condition").css("height",document.body.clientHeight/100+"rem");
        $(".more-bg ul li").click(function () {
            $(this).addClass("layui-this")
        });
        $("#reset").click(function () {
            $(".more-bg ul li").removeClass("layui-this");
        });
        $("#more").click(function () {
            $(".more-condition").slideToggle("slow");
        });
        $(".layui-tab-item ul li").click(function () {
            layer.open({
                title : '详情',
                skin : 'layui-layer-mobile',
                shadeClose : false,
                type : 2,
                fixed : false,
                maxmin : true,
                area : [ '95%', '72.5%' ],
                content : '/mobile/project_details.html'
            });
        });
    });
    
    
    
    //总预览
    /* function allLook()
    {
    	var nd = $('#nd').val();
    	$.ajax({
    		type : "POST",
    		url : "/one_level_main/contract_01?functionId=984b64b13cf54222bf57bd840759fabe&type=1&nd=" + nd + "",
    		timeout : 9000,
    		dataType : "json",
    		cache : false,
    		headers : {
    			'Content-Type' : 'application/json'
    		},
    		success : function(data, status) {
    			if (data.success == true || data.success == 'true') 
    			{
    				$("#plan_id").html(data.data.zsl + "个");

    				if (typeof (data.data.yqht) == "undefined") 
    				{
    					$("#finished_id").html("0个");
    				} else 
    				{
    					$("#finished_id").html(data.data.yqht + "个");
    				}
    			}
    		},
    		error : function() {
    		},
    		complete : function(XMLHttpRequest, status) {
    		}
    	});

    } */
   
    
    
    function queryTabel(qdbz,id)
    {
    	$("#qdbz").val(qdbz);
    	var v_date = (new Date()).getTime();
    	$.ajax({
    		type : "POST",
    		url : "/mobile/common_table_data_mobile?v_date="+v_date,
    		timeout : 9000,
    		data: $("#form1").serialize(),
    		dataType:'json', 
    		cache : false,
    		success : function(data, status) 
    		{
    			console.log(data.data);
    			
    			
    			
    			if(qdbz=='已签订')
    			{
    				$("#finished_id").html(data.count+"个");
    			}
    			if(qdbz=='未签订')
    			{
    				$("#not_finished_id").html(data.count+"个");
    			}
				
    			var count="";
    			if(data.data.length>0)
   			    {
   				  for(var i=0;i<data.data.length;i++)
       			  {
   					 var xmmc= data.data[i].xmmc;
   					 var ysje= data.data[i].ysje;//预算金额
   					 var xmid= data.data[i].xmid;
   					 var jf= data.data[i].jf;
   					 var fzdw= data.data[i].fzdw;
   					 var define10= data.data[i].define10;
   					 var define12= data.data[i].define12;
   					 var hth= data.data[i].hth;
   					 if(xmmc==null || xmmc=='')
   					 {
   						xmmc="总计";
   					 }	 
   					 
   					if(xmmc!=null && xmmc!='')
  					 {
  						 if(xmmc.length>15)
  						 {
  							xmmc=xmmc.substring(0,15);
  						 }
  					 }
   					 var temp="<li>"+
			    				"<p>"+
			                        "<span>"+xmmc+"</span>"+
			                        "<span>"+setNumStr(ysje)+"</span>"+
			                    "</p>"+
			                    "<dl>"+
			                        "<dd>"+hth+"</dd>"+
			                        "<dd>"+define10+"</dd>"+
			                        "<dd>"+define12+"</dd>"+
			                    "</dl>"+
			                   "</li>";
					         count=count+temp;
       			  }
   			   }
    		    $("#"+id).html(count); 	
    		},
    		error : function() {
    		},
    		complete : function(XMLHttpRequest, status) {
    		}
    	});
    }
    
    

    function search_Event()
    {
    	//allLook();
    	queryTabel("已签订",'qdbz_ed_id');
    	queryTabel("未签订",'qdbz_not_id');
    	queryTabel("",'qdbz_all_id');
    }
    search_Event();
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    function setNumStr(num)
    {
    	
    	var result="";
    	
    	if(num=='0.00')
		{
    		num=0;
		}
		if(parseFloat(num)>10000)//亿
		{
			var  temp=parseFloat(num/10000).toFixed(2);
			var  endstr=temp.substring(temp.length-3);
			//alert(temp);
			if(endstr=='.00')
			{
				temp= temp.substring(0,temp.length-3);
			}
			result=temp+"亿";
		}else//万
		{
			
			var  temp=parseFloat(num).toFixed(2);
			var  endstr=temp.substring(temp.length-3);
			if(endstr=='.00')
			{
				//temp= temp.replace(".00","")
				temp= temp.substring(0,temp.length-3);
			}
			result=temp+"万";
		}
		return result;
    }
    
    
</script>
</body>
</html>