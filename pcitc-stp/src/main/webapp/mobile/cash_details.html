<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>科技管理平台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/mobile/css/mobileNew.css">
    <style>
        .layui-tab-content:nth-child(1){    background: url(/mobile/images/mobile-line.png) no-repeat center bottom;
            height: auto;
            overflow: hidden;
            padding-bottom: .1rem;
            background-size: 100%;
            padding-top: .1rem;}
    </style>
</head>
<body>
<input type="hidden" name="month" id="month" value="${month}">
<input type="hidden" name="g0GSJC" id="g0GSJC" value="${g0GSJC}">
<input type="hidden" name="companyCode" id="companyCode" value="${companyCode}">
<header>
    <div class="m_return child">
        <a href="/mobile/cash"><img src="/mobile/images/icon-back.png"/> </a>
        <h4>${g0GSJC}</h4>
       
    </div>
</header>
<main class="main cash cash-d">
    <div class="layui-row">
        <div class="layui-tab-content">
            <h4>十二个月总计 <span id="all_money_id">- 亿</span></h4>
        </div>
    </div>
    <div id="chart"></div>
    <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
            <ul id="list_id"></ul>
        </div>
    </div>
</main>
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script src="/mobile/js/rolldate.min.js"></script>
<script>
    var layer;
    (function(doc, win) {
        var docEl = doc.documentElement,
            resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
            recalc = function() {
                var clientWidth = docEl.clientWidth;
                if (!clientWidth) return;
                docEl.style.fontSize = 100 * (clientWidth / 414) + 'px';
            };
        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener('DOMContentLoaded', recalc, false);
    })(document, window);
    layui.use(['jquery','layer','element','laydate'], function(){
        var $=layui.jquery;layer=layui.layer,element=layui.element,laydate = layui.laydate;
       /*  new Rolldate({
            el: '#month',
            format: 'YYYY-MM',
            beginYear: 2016,
            endYear: $("#month").val().substr(0,4),
            value: $("#month").val(),
            confirm: function (date) {
                
            	  $("#month").val(date);
                getFlowDetail();
                  
            }
        }) */
    });
    
    
    
    function getFlowDetail()
    {
    	var month = $('#month').val();
    	month=month.replace("-","");
    	var companyCode=  $('#companyCode').val();
    	console.log("参数：\n companyCode:"+companyCode+"month="+month);
    	if(companyCode!=null && companyCode!='')
   		{
    		$.ajax({
        		type : "GET",
        		url : "/mobile/cash-flow-01?month=" + month + "&companyCode="+companyCode,
        		timeout : 9000,
        		dataType : "json",
        		cache : false,
        		headers : {
        			'Content-Type' : 'application/json'
        		},
        		success : function(data, status) 
        		{
        			 console.log("数据：\n"+JSON.stringify(data)); 
        			 var all=0;
        			 var count="";
        			 if(data.length>0)
        			 {
        				 for(var i=0;i<data.length;i++)
            			 {
        					var g0CWNY= data[i].g0CWNY;//月份
        					var k0XJYE=parseFloat(data[i].k0XJYE).toFixed(2);//科研资金净现金余额
        					all=all+parseFloat(k0XJYE);
        					
        					var classstr="";
        					if(k0XJYE<0)
        					{
        						classstr=" class='not' ";
        					
        					}
        					
        					var monthValY=g0CWNY.substr(0,4);
        				    var monthValM=g0CWNY.substr(4,2);
        				    
        				    var monthstr=monthValY+"年"+monthValM+"月";
        				    
        					var temp="<li   "+classstr+">"+
    				    				"<p>"+
    				                        "<span>"+monthstr+"</span>"+
    				                        "<span>"+setNumStr(k0XJYE)+"</span>"+
    				                    "</p>"+
    			                       "</li>";
        					count=count+temp;
            			 } 
        			 }
        			 
        			 $("#list_id").html(count); 
        			 $("#all_money_id").html((all/10000).toFixed(2)+"<lable style='font-size:14px;font-weight:normal'>亿<lable>"); 
        		},
        		error : function() {
        		},
        		complete : function(XMLHttpRequest, status) {
        		}
        	});
   		}else
  			{
  			    alert("请联系管理员配置研究院相关的数据权限");
  			}
    }
    
    getFlowDetail();
    
    function setNumStr(num)
    {
    	
    	var result="";
    	
    	if(num=='0.00')
		{
    		num=0;
		}
		if(parseFloat(num)>10000)//亿
		{
			var  temp=parseFloat(num/10000).toFixed(2);
			var  endstr=temp.substring(temp.length-3);
			//alert(temp);
			if(endstr=='.00')
			{
				temp= temp.substring(0,temp.length-3);
			}
			result=temp+"<lable >亿<lable>";
		}else//万
		{
			
			var  temp=parseFloat(num).toFixed(2);
			var  endstr=temp.substring(temp.length-3);
			if(endstr=='.00')
			{
				//temp= temp.replace(".00","")
				temp= temp.substring(0,temp.length-3);
			}
			result=temp+"<lable >万<lable>";
		}
		return result;
    }
    
</script>
</body>
</html>