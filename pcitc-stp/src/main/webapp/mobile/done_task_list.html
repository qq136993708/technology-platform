<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>已办任务</title>
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="stylesheet"          href="/mobile/css/mui/iconfont.css"/>
<link rel="stylesheet"          href="/mobile/css/mui/mui.css"/>	
<script src="/common/js/jquery-1.11.3.min.js"></script>
<script type="text/javascript"  src="/mobile/js/mui/mui.min.js"  ></script>
<script type="text/javascript"  src="/common/js/layer-v3.1.1/layer.js"  ></script>




<style type="text/css">
</style>
</head>
<body  style="background-color:#ffffff;">
<header class="mui-bar mui-bar-nav">
<a class="mui-pull-left" href="/mobile/index"  style="margin-top:10px">首页</a>
	<h1 class="mui-title"><span>已办任务（${page.totalRecords}）</span></h1>
</header>
        
<div class="mui-content" >
  <ul class="mui-table-view mui-table-view-striped mui-table-view-condensed" id="list" style="margin-top:10px">
          <#if list?exists> <#list list as vo>
          <#if vo.processDefinitionName!=''>
              <li class="mui-table-view-cell" id="${vo.id}">
		            <div class="mui-table">
		                <div class="mui-table-cell mui-col-xs-10">
		                    <h4 class="mui-ellipsis">${vo.processDefinitionName}</h4>
		                     <h5>任务节点名称: ${vo.name} </h5>
		                     <h5>处理时间: ${vo.endTimeStr}   </h5>
		                    <p class="mui-h6 mui-ellipsis">处理意见: ${vo.auditRemarks}</p>
		                </div>
		                <div class="mui-table-cell mui-col-xs-2 mui-text-right">
		                    <span class="mui-h5"><button deal_id="${vo.id}" type="button" class="mui-btn mui-btn-primary" >撤回</button></span>
						    <button look_id="${vo.processInstanceId}"  type="button" class="mui-btn mui-btn-danger"  style="margin-top:5px">查看</button>
		                </div>
		            </div>
		        </li>
		       </#if> 
         </#list> 
         </#if>
  </ul>			
  
<#if page.totalRecords gt 0>
<div class="mui-content-padded">
		<ul class="mui-pager" id="fenye_id">
		  <#if page.pageNo gt 1>
		    <li class="mui-previous"><a id="${page.pageNo-1}" >上一页</a></li>
		  </#if>
		 <li class="mui-disabled"><span style="border: 0px solid #ddd;background-color:#efeff4">共${page.totalPages}页，当前第${page.pageNo}页</span></li>
		  <#if page.totalPages gt page.pageNo>
		      <li class="mui-next" ><a id="${page.pageNo+1}" >下一页</a></li>
		  </#if>
		</ul>
	</div>
</#if>


</div>
<script type="text/javascript">
var basePath="<c:out value='${basePath}' />";
mui.init({
	swipeBack:true 
});
document.oncontextmenu=function(e){
   // e.preventDefault();
};
mui('#list').on('tap', '.mui-btn-primary', function() {
    var id = this.getAttribute("deal_id");
    /* var url=basePath+"hospital?action=viewHospital&id="+id;
    document.location.href= url; */
    layer.confirm('确定撤回此任务吗？', function() {
		var lodingMsg = layer.msg('数据处理中....');
		$.ajax({
			url : '/task/recall/' + id,
			type : 'post',
			dataType : 'json',
			headers : {
				'Content-Type' : 'application/json',
			},
			error : function() {//请求失败处理函数  
				layer.msg('操作失败！');
			},
			success : function(data) { //请求成功后处理函数。
				if (data.result && data.statusCode == 200) {
					operMSG = '操作成功! 数据加载中....';
					renderTable();
				} else if (data.statusCode == 100) {
					layer.msg('操作失败! 流程目前处于当前任务节点上！');
				} else if (data.statusCode == 400) {
					layer.msg('操作失败! 数据异常！');
				} else if (data.statusCode == 300) {
					layer.msg('操作失败! 下一步审批已经完成！');
				} else if (data.statusCode == 500) {
					layer.msg('操作失败! 流程已经结束，不允许撤回');
				} else {
					layer.msg('操作失败！');
				}
			}
		});
	});
    
	
	
}); 


mui('#list').on('tap', '.mui-btn-danger', function() {
    var processInstanceId = this.getAttribute("look_id");
    var temUrl = "/mobile/process_mobile/" + processInstanceId;
    layer.open({
		title : '详情',
		skin : 'layui-layer-lan',
		shadeClose : true,
		type : 2,
		fixed : false,
		//若使用小窗口形式，则修改 maxmin 值为 true，则注释掉area:[100%,100%]属性,同时设置area: ['900px', '450px']
		maxmin : true,
		//若直接弹出页面 ，则修改 area;[100%,100%]，同时设置 maxmin 为false
		area : [ '90%', '90%' ],
		content : temUrl
	}); 
	
	
});



mui('#fenye_id').on('tap', 'a', function() {
    var pageNo = this.getAttribute("id");
    var url="/mobile/done_task_list?pageNo="+pageNo;
    location.replace(url);
}); 


</script>
</body>
</html>
