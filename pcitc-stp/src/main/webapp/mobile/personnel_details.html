<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>科技管理平台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/mobile/css/mobileNew.css">
    <style>
        .layui-tab-content:nth-child(1){    background: url(/mobile/images/mobile-line.png) no-repeat center bottom;height: auto;overflow: hidden;padding-bottom: .1rem;background-size: 100%;padding-top: .1rem;}
        .layui-tab-item>p{color: #426570;font-size: .13rem;line-height: .27rem;text-indent: 2em;}
    </style>
</head>
<body>
<header>
    <div class="m_return child">
        <a href="/mobile/personnel"><img src="/mobile/images/icon-back.png"/> </a>
        <h4>详情</h4>
    </div>
</header>
<input name="expertName" id="expertName"  value="${zjkBaseInfo.expertName}" type="hidden">
<main class="main-c">
    <div class="main personnel-details">
        <div class="list">
            <div class="item">
                <div class="item-img">
                    <img dataType="headImg" id="${zjkBaseInfo.dataId}" src="/stp/expert/img/default.png" >
                </div>
                <div class="item-cont">
                    <p><span>${zjkBaseInfo.expertName}</span>

                    <#if zjkBaseInfo.expertProfessionalFieldName!=''>
                       <span>（${zjkBaseInfo.expertProfessionalFieldName}）</span>
                    </#if>
                    </p>
                </div>
                 <!-- <div class="item-c">
                    <p><span>职称：</span><span>${zjkBaseInfo.expertProfessinal}</span></p>
                </div>  -->
            </div>
        </div>
        <div class="layui-tab">
            <div class="tab-c">
                <ul class="layui-tab-title">
                    <li class="layui-this">人物简介</li>
                    <li>人物成就</li>
                    <li>相关课题<label id="kt_task_list_count"></label></li>
                    <li>研究专利<label id="zl_task_list_count"></label> </li>
                </ul>
            </div>
            <div class="layui-tab-content">
                <div class="layui-tab-item layui-show">
                    ${zjkBaseInfo.userDesc}
                </div>
                <div class="layui-tab-item">
                    ${zjkBaseInfo.bak6}
                </div>
                <div class="layui-tab-item">
                 <ul id="kt_task_list"> </ul>
                </div>
                <div class="layui-tab-item">
                  <!--  <table id="showTable" class="layui-table" lay-filter="tableDataCg"></table> -->
                   <ul id="zl_task_list"> </ul>
                </div>
            </div>
        </div>
    </div>
</main>
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script src="/mobile/js/mobile.js"></script>
<script>
    var  layer;
    var  table;
    var $;
    (function(doc, win) {
        var docEl = doc.documentElement,
            resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
            recalc = function() {
                var clientWidth = docEl.clientWidth;
                if (!clientWidth) return;
                docEl.style.fontSize = 100 * (clientWidth / 414) + 'px';
            };
        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener('DOMContentLoaded', recalc, false);
    })(document, window);
    
    
    layui.use(['jquery','layer','element','laydate', 'table'], function(){
        $=layui.jquery;
        layer=layui.layer;
        table = layui.table;
        element=layui.element,laydate = layui.laydate;
        
        $(".more-condition").css("height",document.body.clientHeight/100+"rem");
        $(".more-bg ul li").click(function () {
            $(this).addClass("layui-this")
        });
        $("#reset").click(function () {
            $(".more-bg ul li").removeClass("layui-this");
        });
        $("#kMore").click(function () {
            $(".more-condition").slideToggle("slow");
        });
        $(".layui-tab-title li").click(function () {
            $(".layui-col-xs4 button").addClass('layui-hide')
            $(".layui-col-xs4 button").eq($(this).index()).removeClass("layui-hide");
        });
    });
    
    
    
    
    
    
    
    
    
    
    
    
    //课题
    function kt_task_list(url,id,type)
    {
    	var v_date = (new Date()).getTime();
    	$.ajax({
    		type : type,
    		url : url,
    		timeout : 9000,
    		dataType:'json', 
    		cache : false,
    		success : function(data, status) 
    		{
    			console.log("外系统待办\n"+JSON.stringify(data));
    			var count="";
    			var dataArr=data.data;
    			if(dataArr.length>0)
   			    {
   				  for(var i=0;i<dataArr.length;i++)
       			  {
   					 var id= dataArr[i].id;
   					 var xmmc= dataArr[i].xmmc;//名称
   					 var fzdw= dataArr[i].fzdw;//负责单位
   					 var nd= dataArr[i].nd;//立项年度
   					 
   					 if(fzdw.length>8)
   					 {
   						fzdw=fzdw.substr(0,8);
   					 }
   					
   					 if(xmmc.length>11)
   					 {
   						xmmc=xmmc.substr(0,10);
   					 }
   					 var temp="<li>"+
				    				"<p>"+
				                        "<span>"+xmmc+"</span>"+
				                        "<span>"+nd+"</span>"+
				                    "</p>"+
				                    "<p><span>"+fzdw+"</span></p>"+
				             "</li>";
					count=count+temp;
		
       			  }
   			   }
    		   $("#kt_task_list").html(count); 	
    		   $("#kt_task_list_count").html(data.count); 	
    		},
    		error : function() {
    		},
    		complete : function(XMLHttpRequest, status) {
    		}
    	});
    }
    kt_task_list("/mobile/outProjectList?v_date="+(new Date()).getTime()+"&name="+$("#expertName").val(),"kt_task_list","POST");
    page("kt_task_list","/mobile/outProjectList?v_date="+(new Date()).getTime()+"&name="+$("#expertName").val(),"POST","kt_task_list");
    
    
    
    
    
    
   
    
    
    
    //专利
    function zl_task_list(url,id,type)
    {
    	var v_date = (new Date()).getTime();
    	$.ajax({
    		type : type,
    		url : url,
    		timeout : 9000,
    		dataType:'json', 
    		cache : false,
    		success : function(data, status) 
    		{
    			console.log("外系统待办\n"+JSON.stringify(data));
    			var count="";
    			var dataArr=data.data;
    			if(dataArr.length>0)
   			    {
   				  for(var i=0;i<dataArr.length;i++)
       			  {
   					 var id= dataArr[i].id;
   					 var fmmc= dataArr[i].fmmc;//名称
   					 var wxlx= dataArr[i].wxlx;//类型
   					 var qlyq= dataArr[i].qlyq;//专利描述
   					 if(fmmc==null)
					 {
   						fmmc="";
					 }
   					 
   					 if(qlyq.length>8)
   					 {
   						 qlyq=qlyq.substr(0,8);
   					 }
   					
   					 if(fmmc.length>11)
   					 {
   						fmmc=fmmc.substr(0,10);
   					 }
   					 var temp="<li>"+
				    				"<p>"+
				                        "<span>"+fmmc+"</span>"+
				                        "<span>"+wxlx+"</span>"+
				                    "</p>"+
				                    "<p><span>"+qlyq+"</span></p>"+
				             "</li>";
					count=count+temp;
		
       			  }
   			   }
    		   $("#zl_task_list").html(count); 	
    		   $("#zl_task_list_count").html(data.count); 	
    		},
    		error : function() {
    		},
    		complete : function(XMLHttpRequest, status) {
    		}
    	});
    }
    zl_task_list("/mobile/queryOutPatentList?v_date="+(new Date()).getTime()+"&name="+$("#expertName").val(),"zl_task_list","POST");
    page("zl_task_list","/mobile/queryOutPatentList?v_date="+(new Date()).getTime()+"&name="+$("#expertName").val(),"POST","zl_task_list");
    
    
    
    
    
    
    function getFileResultImg() {
        //获取通用url
        var ids = "";
        $.each($('img[dataType="headImg"]'), function (i, d) {
            ids = ids + "," + $(this).attr("id");
        });
        var ret = getFileResult(ids);
        for (let i = 0; i < ret.list.length; i++) {
            $("#" + ret.list[i].dataid).attr("src", ret.list[i].filePath);
        }
    }

    getFileResultImg();

    function photoContent(picId) {
        var ret = getFileResult(picId);
        if (ret != null && ret.list.length > 0) {
            picId = ret.list[0].id;
        }
        var base64 = "";
        $.ajax({
            type: 'get',
            dataType: 'text',
            async: false,
            url: '/sysfile/viewPic/' + picId,
            success: function (data) {
                base64 = data;
            },
            error: function (e) {
                alert("出错了");
            }
        });
        return base64;
    }

    ////加载图片
    function getFileResult(fileIds) {
        var ret = null;
        ajaxFile("/sysfile/getFilesLayuiByFormId", {fileIds: fileIds}, function (result) {
            ret = result;
        });
        return ret;
    }

    function ajaxFile(url, data, callback) {
        var result = null;
        $.ajax({
            type: 'post',
            async: false,
            url: url,
            data: data,
            dataType: 'json',
            success: function (data, status) {
                result = data;
                if (callback) {
                    callback.call(this, data, status);
                }
            },
            error: function (err, err1, err2) {
                console.log("ajaxPost发生异常，请仔细检查请求url是否正确");
            }
        });
        return result;
    }
</script>
</body>
</html>