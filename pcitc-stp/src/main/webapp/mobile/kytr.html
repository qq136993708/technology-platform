<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>科技管理平台</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
<link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
<link rel="stylesheet" href="/mobile/css/mobileNew.css">
</head>
<body>
	<header>
		<div class="m_return child">
			<a href="/mobile/temIndex">
				<img src="/mobile/images/icon-back.png" />
			</a>
			<h4>科研投投入</h4>
		</div>
	</header>
	<main class="main">
	<div class="layui-card layui-form " lay-filter="component-form-element">
		<div class="layui-card-body layui-row layui-col-space10">
			<div class="layui-col-xs4">
				<input type="text" name="nd" placeholder="请选择年份" title="年份" value="${nd}" autocomplete="off" class="form-control layui-input" id="nd">
			</div>
			<div class="layui-col-xs4" style="display: none">
				<select name="city" lay-verify="">
					<option value="">全部</option>
					<option value="010">北京</option>
					<option value="021">上海</option>
					<option value="0571">杭州</option>
				</select>
			</div>
			<div class="layui-col-xs2">
				<button class="layui-btn layui-btn-primary" onclick="search_Event()">搜索</button>
			</div>
		</div>
	</div>
	<div class="main-card first-card">
		<div class="main-card-header hasborder">
			<span class="layui_time"></span>
			科研预算执行率
		</div>
		<div class="main-card-body">
			<div class="text-total" style="font-size: 13px;">
				<span>
					年度预算总计:
					<span class="text-total-blue" id="chart1_01">
						<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
				<span>
					费用性科研投入:
					<span class="text-total-blue" id="chart1_02">
						<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
				<span>
					资本性科研投入:
					<span class="text-total-blue" id="chart1_03">
						<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
				<span>
					预算执行率:
					<span class="text-total-blue" id="chart1_04">
						<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
			</div>
			<div style="height: 272px; width: 100%;" id="chart1"></div>
		</div>
	</div>

	<div class="main-card first-card">
		<div class="main-card-header hasborder">
			<span class="layui_time"></span>
			科研预算执行率（万元）
		</div>
		<div class="main-card-body">
			<table id="myTable" class="layui-table" lay-filter="myTable">
				<thead>
					<tr>
						<th lay-data="{field:'define3', width:'20%'}" rowspan="2">企业类型</th>
						<th lay-data="{align:'center'}" colspan="3">总计</th>
						<!-- <th lay-data="{align:'center'}" colspan="3">费用性</th>
                     <th lay-data="{align:'center'}" colspan="3">资本性</th> -->
					</tr>
					<tr>
						<th lay-data="{field:'zysje', width:'28%',align:'right'}">年度预算</th>
						<th lay-data="{field:'zsjje', width:'26%',align:'right'}">实际签订</th>
						<th lay-data="{field:'zRate', width:'26%',align:'right',templet:function(d){return d.zRate+'%'}}">执行率</th>

						<!--  <th lay-data="{field:'fyxysje', width:'10%',align:'right'}">年度预算</th>
                     <th lay-data="{field:'fyxsjje', width:'10%',align:'right'}">实际签订</th>
                     <th lay-data="{field:'fyxRate', width:'8%',align:'right',templet:function(d){return d.fyxRate+'%'}}">执行率</th>

                     <th lay-data="{field:'zbxysje', width:'10%',align:'right'}">年度预算</th>
                     <th lay-data="{field:'zbxsjje', width:'10%',align:'right'}">实际签订</th>
                     <th lay-data="{field:'zbxRate', width:'8%',align:'right',templet:function(d){return d.zbxRate+'%'}}">执行率</th> -->
					</tr>
				</thead>
			</table>
		</div>
	</div>


	<div class="main-card" id="isKJBPerson_id">
		<div class="main-card-header hasborder">
			<span class="layui_time"></span>
			新开课题科研预算执行率
		</div>
		<div class="main-card-body">
			<div class="text-total">
				<span>
					新开课题预算总金额:
					<span class="text-total-blue" id="investment_chart6_01">
						<img class="loadingImg" style="" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
				<span>
					新开课题实际总金额:
					<span class="text-total-blue" id="investment_chart6_02">
						<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
			</div>

			<div class="main-chart" id="investment_chart6" style="height: 280px; width: 100%;"></div>
		</div>
	</div>

	<div class="main-card first-card">
		<div class="main-card-header hasborder">
			<span class="layui_time"></span>
			直属研究院科研预算执行率
		</div>
		<div class="main-card-body" style="height: 360px;">
			<div class="text-total">
				<span>
					年度预算总计:
					<span class="text-total-blue" id="chart7_01">
						<img class="loadingImg" style="" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
				<span>
					实际科研投入:
					<span class="text-total-blue" id="chart7_02">
						<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
				<span>
					未执行:
					<span class="text-total-blue" id="chart7_03">
						<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
				<span>
					预算执行率:
					<span class="text-total-blue" id="chart7_04">
						<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">
					</span>
				</span>
			</div>
			<div class="main-chart" id="chart7" style="height: 280px; width: 100%;"></div>
		</div>
	</div>



	</main>
	<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
	<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
	<script type="text/javascript" src="/plugins/echarts/echarts.min.js"></script>
	<script type="text/javascript" src="/plugins/echarts/walden.js"></script>
	<script type="text/javascript" src="/stp/hana/common/stp_common_line.js"></script>
	<script type="text/javascript" src="/stp/hana/common/stp_common_bar.js"></script>
	<script type="text/javascript" src="/stp/hana/common/stp_common_pie.js"></script>
	<script type="text/javascript" src="/stp/hana/home/direct_depart/direct_common.js"></script>
	<script type="text/javascript" src="/stp/hana/home/oneLevelMain/investment.js"></script>


	<script type="text/javascript">
		(function(doc, win) {
			var docEl = doc.documentElement, resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize', recalc = function() {
				var clientWidth = docEl.clientWidth;
				if (!clientWidth) return;
				docEl.style.fontSize = (clientWidth / 10.8) + 'px';
			};
			if (!doc.addEventListener) return;
			win.addEventListener(resizeEvt, recalc, false);
			doc.addEventListener('DOMContentLoaded', recalc, false);
		})(document, window);

		var echart;
		var echart6;
		var echart7;
		var tableOne = null, tableTwo = null, selectRowData;

		layui.config({
			base : '/layuiadmin/lib/extend/'
		}).extend({
			treeGridCom : 'treeGridCom'
		}).use([ 'jquery', 'table', 'form', 'laydate', 'layer' ], function() {
			var $ = layui.jquery;
			table = layui.table;
			layer = layui.layer;
			laydate = layui.laydate;
			form = layui.form;
			var nd = $("#nd").val();
			$(".layui_time").html(nd + "年");
			form.render(null, 'component-form-group');
			laydate.render({
				elem : '#nd',
				min : '2016-10-14'

				,
				type : 'year',
				done : function(value, date, endDate) {
					$(".layui_time").html(date.year);
					$("#nd").val(date.year);
					search_Event();
				}
			});
			myTable();

		});

		function initEchart() {
			var v_date = (new Date()).getTime();
			var month = $('#nd').val();
			var nd = $('#nd').val();

			var yAxis1 = [ {
				type : 'value',
				name : '亿元',
				min : 0,
				// interval: 10,
				//max:'dataMax',
				position : 'left',
				axisLabel : {
					formatter : '{value}'
				}
			} ];

			var yAxis2 = [ {
				type : 'value',
				name : '亿元',
				//min: 0,
				//interval: 10,
				//max:'dataMax',
				splitLine : {
					show : false
				},//去除网格线
				position : 'left',
				axisLabel : {
					formatter : '{value}'
				}
			}, {
				type : 'value',
				show : true,
				name : '百分比',
				//min: 0,
				//max: 100,
				//interval: 20,
				// splitLine:{show: false},//去除网格线
				position : 'right',
				axisLabel : {
					formatter : '{value}%'
				}
			} ];

			var yAxis3 = [ {
				type : 'value',
				name : '亿元',
				//min: 0,
				//interval: 10,
				//max:'dataMax',
				splitLine : {
					show : false
				},//去除网格线
				position : 'left',
				axisLabel : {
					formatter : '{value}'
				}
			} ];

			var yAxis4 = [ {
				type : 'value',
				name : '亿元',
				position : 'left',
				axisLabel : {
					formatter : '{value}'
				}
			} /* ,
							          {
							        	  type: 'value',
							              name: '亿元',
							              show: true ,
							              position: 'right',
							              splitLine:{show: false},
							              axisLabel: {
							                  formatter: '{value}'
							              }

							          } */
			];

			$("#chart1_01").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#chart1_02").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#chart1_03").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');

			var chart1_url = "/one_level_main/investment_01?nd=" + nd + "&v_date=" + v_date;
			var color = [ "#bee5d2", "#6bdf9e" ];

			// echart=       load_mutl_bar_down(chart1_url,"chart1","","",yAxis4,"");
			echart = load_mutl_bar_down_rotate(chart1_url, "chart1", "", "", yAxis3, 7, colorNew2, true);

			var investment_0101_url = "/one_level_main/investment_0101?nd=" + nd + "&v_date=" + v_date;
			setinvestmentCount(investment_0101_url);

			var chart6_url = "/one_level_main/investment_03?nd=" + nd + "&v_date=" + v_date + "&type=1";
			var colorNew2 = [ "#f4974a", "#f3cc41", "#95c740" ];
			echart6 = load_mutl_bar_down_rotate(chart6_url, "investment_chart6", "", "", yAxis3, 7, colorNew2, true);

			$("#chart7_01").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#chart7_02").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#chart7_03").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#chart7_04").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			var chart7_url = "/one_level_main/investment_02?nd=" + nd + "&v_date=" + v_date;
			var color = [ "#f3655b", "#8ab3cf", "#f19049" ];
			echart7 = load_mutl_bar_investment(chart7_url, "chart7", "", "", yAxis2, color, 10, true, function(data) {
			});
			var investment_02_count_url = "/one_level_main/investment_02_count?nd=" + nd + "&v_date=" + v_date;
			setInvestment_02_count(investment_02_count_url);
		}

		//初始化图形
		initEchart();

		window.onresize = function() {
			echart.resize();
			echart6.resize();
			echart7.resize();
		}

		//查询
		function search_Event() {
			initEchart();
			myTable();
		}

		function myTable() {

			var nd = $("#nd").val();
			var v_date = (new Date()).getTime();
			var url = '/one_level_main/investment_01_01?nd=' + nd + "&v_date=" + v_date;
			table.init('myTable', {
				url : url,
				height : "450px",
				where : {}

			});

		}

		function setinvestmentCount(url) {

			$("#chart1_01").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#chart1_02").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');
			$("#chart1_03").html('<img class="loadingImg" src="/layuiadmin/layui/images/loadingImg04.gif" alt="">');

			$.ajax({
				type : "POST",
				url : url,
				dataType : "json",
				timeout : 11000,
				cache : false,
				headers : {
					'Content-Type' : 'application/json'
				},
				success : function(data, status) {
					if (data.success == true || data.success == 'true') {
						var zysje_count = 0;
						var fyxsjje_count = 0;
						var zbxsjje_count = 0;
						var list = data.data;

						for (var i = 0; i < list.length; i++) {
							var tt = list[i].fyxsjje;

							if (typeof (tt) == "undefined") {
								tt = 0;
							}

							var zysje = list[i].zysje / 10000;//预算总计 
							var fyxsjje = tt / 10000;//费用性科研投入
							var zbxsjje = list[i].zbxsjje / 10000;//资本性科研投入
							// alert(fyxsjje);
							zysje_count = zysje_count + parseFloat(zysje);
							fyxsjje_count = fyxsjje_count + parseFloat(fyxsjje);
							zbxsjje_count = zbxsjje_count + parseFloat(zbxsjje);
						}

						$("#chart1_01").html(zysje_count.toFixed(2) + "亿元");
						$("#chart1_02").html(fyxsjje_count.toFixed(2) + "亿元");
						$("#chart1_03").html(zbxsjje_count.toFixed(2) + "亿元");
						// alert(zysje_count);
						if (zysje_count == '0') {
							$("#chart1_04").html("0%");
						} else {
							$("#chart1_04").html(percentNum(zbxsjje_count + fyxsjje_count, zysje_count));
						}

					}
				},
				error : function() {
				},
				complete : function(XMLHttpRequest, status) {

				}

			});
		}

		function setInvestment_02_count(url) {
			$.ajax({
				type : "POST",
				url : url,
				dataType : "json",
				timeout : 11000,
				cache : false,
				headers : {
					'Content-Type' : 'application/json'
				},
				success : function(data, status) {
					if (data.success == true || data.success == 'true') {

						var zysje_count = 0;
						var zsjje_count = 0;
						var wxdje_count = 0;

						var list = data.data;
						for (var i = 0; i < list.length; i++) {
							var zysje = list[i].zysje;//预算总计 
							var zsjje = list[i].zsjje;//实际签订
							var wxdje = list[i].wxdje;//未签订
							//alert(fyxsjje);
							zysje_count = zysje_count + parseFloat(zysje);
							zsjje_count = zsjje_count + parseFloat(zsjje);
							wxdje_count = wxdje_count + parseFloat(wxdje);
						}

						$("#chart7_01").html(zysje_count.toFixed(2) + "亿元");
						$("#chart7_02").html(zsjje_count.toFixed(2) + "亿元");
						$("#chart7_03").html(wxdje_count.toFixed(2) + "亿元");

						if (zysje_count == 0) {
							$("#chart7_04").html("0%");
						} else {
							$("#chart7_04").html(percentNum(zsjje_count, zysje_count));

						}

					}
				},
				error : function() {
				},
				complete : function(XMLHttpRequest, status) {

				}

			});
		}

		function percent_Num(num, num2) {

			return (Math.round(num / num2 * 10000) / 100.00);
		}

		//小数点后两位百分比
		function percentNum(num, num2) {

			//return Math.floor(num / num2 * 100) / 100+"%";
			return (Math.round(num / num2 * 10000) / 100.00 + "%");
		}
	</script>
</body>
</html>