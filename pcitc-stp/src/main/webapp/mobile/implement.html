<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>科技管理平台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/mobile/css/mobileNew.css">
    <style>
        body{
            background:#fff url(/mobile/images/mobile-bg.png) no-repeat;
            background-size: 100%;
            overflow: hidden;
        }
        .layui-tab-content:nth-child(1){    background: url(/mobile/images/mobile-line.png) no-repeat center bottom;height: auto;overflow: hidden;padding-bottom: .1rem;background-size: 100%;padding-top: .1rem;}
    </style>
</head>
<body>
<header>
    <div class="m_return child">
        <h4>任务执行人选择</h4>
    </div>
    <div class="search">
        <input type="text" name="name" id="name" value="" placeholder="请输入姓名" />
        <img src="/mobile/images/icon-search.png" alt="" id="search">
    </div>
</header>
<main class="main implement">
    <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
            <ul id="user_list">
            <!-- <#list list as vo>
                <li>
                    <span>${vo.nameBigFirstPin}</span>
                    <span>${vo.userDisp}<label style="color:#ccc">（${vo.unitName}）</label></span>
                    <span><img src="/mobile/images/icon-by.png" /> </span>
                </li>
            </#list> -->
             
            </ul>
        </div>
    </div>
    <div class="button-g">
        <button id="save_id">确定</button>
        <button >重置</button> 
    </div>
</main>
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script>
var userIds = new Array();
var userNames = new Array();
var userStr="";
    var layer;
    (function(doc, win) {
        var docEl = doc.documentElement,
            resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
            recalc = function() {
                var clientWidth = docEl.clientWidth;
                if (!clientWidth) return;
                docEl.style.fontSize = 100 * (clientWidth / 414) + 'px';
            };
        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener('DOMContentLoaded', recalc, false);
    })(document, window);
    layui.use(['jquery','layer','element','laydate'], function(){
        var $=layui.jquery;layer=layui.layer,element=layui.element,laydate = layui.laydate;
        $(".more-condition").css("height",document.body.clientHeight/100+"rem");
        $("#search").click(function () {
        	getUserList();
        });
        
        $("#save_id").click(function () {
            //$(".layui-tab-item ul li").removeClass("layui-this");
            $(".layui-tab-item ul li").each(function(){
            	if($(this).attr("class")=="layui-this")
            	{
            		var userId=$(this).attr("ui_id");
            		var userName=$(this).find(".name").html();
            		userIds.push(userId);
            		userNames.push(userName);
            		var temp=userId+","+userName+"#";
            		userStr=userStr+temp;
            	}
            })
            var userIds_str=userIds.join(',');
            var userNames_str=userNames.join(',');
            parent.document.getElementById("workOrderAllotUserName").value=userNames_str;
            parent.document.getElementById("workOrderAllotUserId").value=userIds_str;
            parent.document.getElementById("userStr").value=userStr;
            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            parent.layer.close(index);  // 关闭layer
            
        });
    });
    
    function getUserList()
    {
    	var v_date = (new Date()).getTime();
    	var name=$("#name").val();
    	var url = "/mobile/user/querySysUserListByPage?v_date=" + v_date+"&keyWord="+name;
    	$.ajax({
    		type : "GET",
    		url : url,
    		timeout : 9000,
    		dataType : "json",
    		cache : false,
    		headers : {
    			'Content-Type' : 'application/json'
    		},
    		success : function(data, status) 
    		{
    			 console.log("选下一步处理人\n "+JSON.stringify(data));
    			 var count="";
    			 if(data.length>0)
    			 {
    				 for(var i=0;i<data.length;i++)
        			 {
    					var nameBigFirstPin= data[i].nameBigFirstPin;//首字母
    					var userDisp=data[i].userDisp;//名字
    					var unitName=data[i].unitName;//全拼第一个字母（如：张三 zs）
    					//var userName=data[i].userName;
    					var userId=data[i].userId;
    					var temp="<li ui_id='"+userId+"'>"+
			                        "<span>"+nameBigFirstPin+"</span>"+
			                        "<span><span class='name'>"+userDisp+"</span><label style='color:#ccc'>（"+unitName+"）</label></span>"+
			                        "<span><img src='/mobile/images/icon-by.png' /> </span>"+
			                    "</li>";
    					count=count+temp;
        			 } 
    				
    			 }
    			 $("#user_list").html(count); 
    			 $(".layui-tab-item ul li").click(function () {
			            $(this).addClass("layui-this")
			      });
    		},
    		error : function() {
    		},
    		complete : function(XMLHttpRequest, status) {
    		}
    	});

    }
    getUserList();
    
    
</script>
</body>
</html>