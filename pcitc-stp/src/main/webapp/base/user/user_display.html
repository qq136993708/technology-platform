<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>用户详情</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
<link rel="stylesheet" href="/layuiadmin/style/common.css">

<script src="/layuiadmin/layui/layui.js"></script>
</head>
<body>
<div class="formBox">
	<form id="user-form" name="user-form" lay-filter="user-form" class="form-horizontal layui-form">
	<div class="box-body">
		<input type="hidden" name="userId" id="userId">
		<input type="hidden" name="userExtend" id="userExtend">
		<div class="layui-row">
		<div class="layui-col-xs10 layui-col-sm10 layui-col-md10">
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">登录名<span class="must-fill"></span></label>
					<div class="layui-input-block">
						<input type="text" readonly="readonly" class="layui-input readOnlyBox" id="userName" name="userName">
					</div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">邮箱<span class="must-fill"></span></label>
					<div class="layui-input-block">
						<input type="text" readonly="readonly" class="layui-input readOnlyBox" id="userMail" name="userMail">
					</div>
				</div>
			</div>
		</div>
		
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">真实姓名<span class="must-fill"></span></label>
					<div class="layui-input-block">
						<input type="text" readonly="readonly" class="layui-input readOnlyBox" class="form-control" id="userDisp" name="userDisp">
					</div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">座机号<span class="must-fill"></span></label>
					<div class="layui-input-block">
						<input type="text" readonly="readonly" class="layui-input readOnlyBox" id="userPhone" name="userPhone">
					</div>
				</div>
			</div>
		</div>
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">用户类型<span class="must-fill"></span></label>
					<div class="layui-input-block">
						<input type="text" readonly="readonly" class="layui-input readOnlyBox" id="userKind" name="userKind">
					</div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
	        <div class="layui-form-item">
	          <label class="layui-form-label">组织机构<span class="must-fill"></span></label>
	          	<div class="layui-input-block">
					<input type="text" readonly="readonly" class="layui-input readOnlyBox" id="userUnit" name="userUnit">
				</div>
	        </div>
	      </div>
		</div>
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
		        <div class="layui-form-item">
		          <label class="layui-form-label">角色<span class="must-fill"></span></label>
		          <div class="layui-input-block">
					<input type="text" readonly="readonly" class="layui-input readOnlyBox" id="userRole" name="userRole">
				  </div>
		        </div>
	      	</div>
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
		        <div class="layui-form-item">
		          <label class="layui-form-label">岗位<span class="must-fill"></span></label>
		          <div class="layui-input-block">
					<input type="text" readonly="readonly" class="layui-input readOnlyBox" id="userPost" name="userPost">
				  </div>
		        </div>
	      	</div>
		</div>
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">手机号<span class="must-fill"></span></label>
					<div class="layui-input-block">
						<input type="text" readonly="readonly" class="layui-input readOnlyBox" id="userMobile" name="userMobile">
					</div>
				</div>
			</div>
		</div>
		</div>
		<div class="layui-col-xs2 layui-col-sm2 layui-col-md2">
            <div class="layui-form-item layui-row">
                <div class="photo_box"></div>
            </div>
            <div class="layui-form-item layui-row">
                <label for="" class="layui-form-label" style="width: 200px;">照片(尺寸:2.5cm*3.5cm)<span class="must-fill">*</span></label>
            </div>
        </div>
        </div>
		<div class="layui-form-item">
	      	 <label class="layui-form-label">备注</label>
	         <div class="layui-input-block">
	         	   <textarea readonly="readonly" class="layui-textarea readOnlyBox" id="userComment" name="userComment"></textarea>
	         </div>
       </div>
	</div>
	<div class="form-bottom">
      <div class="form-bottom-btns">
      	<button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue" lay-submit="" lay-filter="submitBtn">保存</button>
      	<button type="button" class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white"  id="cancel">关闭</button>
      </div>
    </div>
</form>
<form class="form-horizontal " action="${pageContext.request.contextPath}/sysfile/uploadMultipleFile" method="post" enctype="multipart/form-data" id="fileUploadForm" style="display:none;">
	<p class="pt20">
    	<input type="file" name="file" class="dn" id="file"/>
        <input type="hidden" id="fileId" name="fileId" value="4c20bd28057543839c0db8754f417c6a"/>
        <input type="hidden" id="extraInfo" name="extraInfo" value=""/>
    </p>
</form>
</div>

<script type="text/javascript" src="/plugins/jQuery/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.all.js"></script>
<script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.core.js"></script>
<script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.excheck.min.js"></script>
<script type="text/javascript" src="/layuiadmin/modules/selectTree.js"></script>
<script type="text/javascript" src="/layuiadmin/modules/base.js"></script>
<script type="text/javascript">
	var zNodes,form,kindMap={},roleMap={},unitMap={},postMap={},unitListNodes=[],roleListNodes=[],unitSelectTree,postSelectTree,roleSelectTree;
	var userId = "${userId?default(0)}";
	$(document).ready(function() {
		//上传产品图片
		$(document).on("click",".photo_box", function(event) {
			$("#file").click();
	    });
		$(document).on("change", "#file", function(event){
			$.ajax({  
		        type : "POST",  
		        url : "/sysfile/uploadSignMultipleFile",  
		        data : new FormData($("#fileUploadForm")[0]),
		        async: false,  
		        cache: false,  
		        contentType: false,  
		        processData: false,
		        success : function(msg) {
		        	$("#userExtend").val("/sysfile/viewPicByte/"+msg.fileIds);
		        	$(".photo_box").html('<img src="/sysfile/viewPicByte/'+msg.fileIds+'" style="width: 140px;height: 173px" />');
		        }  
			}); 			
		});
		//用户类别
		ajaxPost('/dictionary/list/ROOT_XTGL_YHLX', null, function (data, status) { 
	    	$.each(data,function(i,dt){
	    		kindMap[data[i].code] = data[i];
	    	});
	    });
		//角色
		ajaxPost('/role/role-list-all', null, function (data, status) { 
	    	$.each(data,function(i,dt){
	    		roleMap[data[i].roleId] = data[i];
	    	});
	   	});
		//机构
		ajaxPost('/unit/list-data', null, function (data, status) { 
	    	$.each(data,function(i,dt){
	    		unitMap[data[i].unitId]=data[i];
	    	});
	   	});
		//岗位
		ajaxPost('/post/list-data', null, function (data, status) { 
	    	$.each(data,function(i,dt){
	    		postMap[data[i].postId]=data[i];
	    	});
	   	});
	});
	
	layui.use([ 'jquery', 'form', 'laydate', 'table', 'layer', 'element' ],
		function() {
			var $ = layui.jquery, admin = layui.admin, element = layui.element, layer = layui.layer, laydate = layui.laydate;
			form = layui.form;
			form.render();
			//初始赋值 component-form-group 当前form的lay-filter
			 if(userId != 0)
		     {
				//加载用户信息
				ajaxPost('/user/get-user', {"userId":userId}, function (data, status) {
					//回显角色、机构、岗位
					var roleText=unitText=postText= "";
					var roleArray = data.userRole.split(","),unitArray= data.userUnit.split(","),postArray=data.userPost.split(",");
					$.each(roleArray,function(i,dt){
						if(roleMap[roleArray[i]]){
							roleText += ","+roleMap[roleArray[i]].roleName;
						}
					});
					//机构树
					var unitTreeData=[];
					$.each(unitArray,function(i,dt){
						if(unitMap[unitArray[i]]){
							unitText += ","+unitMap[unitArray[i]].unitName;
						}
					});
					
					$.each(postArray,function(i,dt){
						if(postMap[postArray[i]]){
							postText += ","+postMap[postArray[i]].postName;
						}
					});
	        		form.val("user-form",data);
	        		$("#userPassword").val("");
	        		$("#userRole").val(roleText.length>0?roleText.substring(1):"");
	        		$("#userUnit").val(unitText.length>0?unitText.substring(1):"");
	        		$("#userPost").val(postText.length>0?postText.substring(1):"");
	            	$("#userKind").val(kindMap[data.userKind]?kindMap[data.userKind].name:data.userKind);
	            	
	            	if($("#userExtend").val() != null && $("#userExtend").val() !=""){
	        	     	$(".photo_box").html('<img src="'+data.userExtend+'" style="width: 140px;height: 173px" />');
	        		}
				});
		    }
			form.on('submit(submitBtn)', function(data) {
				ajaxPost("/user/upd-headimg", data.field, function(dt, status) {
					if(dt.success){
				       	var index = parent.layer.getFrameIndex(window.name);
				       	parent.layer.close(index);
					}else{
						parent.layer.alert(dt.message, {
							title : '信息'
						});
						return;
					}
				});
				return false;
			});
			$("#cancel").click(function () {
				var index = parent.layer.getFrameIndex(window.name);
			    parent.layer.close(index);
			})
	});
	
</script>
</body>
</html>