<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<#include "/common/public/publicImportIndex.html"/>
</head>
<body class="hold-transition skin-blue sidebar-mini" style="background:#fff">
	<form id="user-list-form" name="prodef-form" class="form-horizontal bv-form" novalidate="novalidate">
	<!-- Main content -->
	<section class="content">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
		<div class="content-searcXh">
			<div class="dataTables_filter" id="searchDiv">
				<!---->
				<label>
                  <span></span>
	              <input placeholder="" name="userName" class="form-control" type="search" operator="like" likeOption="true"/>
               	</label>
				<div class="btn-group">
	              <button type="button" class="btn btn-primary search" data-btn-type="search"></button>
	              <button type="button" class="btn btn-default reset" data-btn-type="reset"></button>
	          </div>
			</div>
		</div>
		<div class="content-body">
			<div class="btn-group">
				<button type="button" class="btn btn-default add" data-btn-type="add" id="btn_add"></button>
	            <button type="button" class="btn btn-default edit" data-btn-type="edit" id="btn_edit"></button>
	            <button type="button" class="btn btn-default delete" data-btn-type="delete"></button>
			</div>
			<div class="content-table">
				<div class="ct-table">
					<table id="userTable" class="table table-bordered table-striped dataTable no-footer" style="width:100%;" role="grid">
						<thead>
							<tr role="row">
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
							</tr>
						</thead>
					</table>
				</div>
			</div>
		</div>
	</section>
	<!-- page script -->
	<script>
		var userTable;
		var winId = "userWin";
		var selectId = "${selectId?default(0)}";
		$(function() {
			$('button[data-btn-type]').click(function() {
	            var action = $(this).attr('data-btn-type');
	            switch (action) {
	                case 'search':
	                	userTable.fnClearTable();
	                    break;
	                case 'reset':
	                	$("#user-list-form")[0].reset();
	                	userTable.fnClearTable();
	                    break;
	            }
	        });
			userTable = $('#userTable').dataTable({
								"bPaginate" : true,//
								//"sPaginationType" : "full_numbers",//
								"bStateSave" : true, //,ajax
								"bScrollCollapse" : true, //
								"bLengthChange" : true, //
								"aLengthMenu":[[15, 30, 45, 60, -1], [15, 30, 45, 60, "All"]],//15
								"iDisplayLength" : 15,
								"bFilter" : false, //
								"bSort" : true, //
								"bInfo" : true, //
								"bAutoWidth" : false, //
								"bJQueryUI" : false,//
								"bDestroy" : true,
								"bProcessing" : true, //
								"bServerSide" : true,//falsetrue
								//"sAjaxDataProp" : "aData",//
								"sAjaxSource" : "/user/getTableData",//ajaxurl
								"fnServerData": retrieveData, // 
								//
								"aoColumns" : [
											   {"mData" : null},
											   {"mData" : "userName"},
											   {"mData" : "userDisp"},
											   {"mData" : "userMail"},
											   {"mData" : "userPhone"},
											   {"mData" : "userMobile"}
											  ],
			                    "fnRowCallback" : function(nRow, aData, iDisplayIndex){
			                        $("td:first", nRow).html(iDisplayIndex +1);//
			                       return nRow;
			                    },
								"oLanguage" : {//
									"sProcessing" : "...",
									"sLengthMenu" : " _MENU_ ",
									"sZeroRecords" : "",
									"sInfo" : " _START_  _END_  _TOTAL_ ",
									"sInfoEmpty" : " 0  0  0 ",
									"sInfoFiltered" : "( _MAX_ )",
									"sInfoPostFix" : "",
									"sSearch" : ":",
									"sUrl" : "",
									"sEmptyTable" : "",
									"sLoadingRecords" : "...",
									"sInfoThousands" : ",",
									"oPaginate" : {
										"sFirst" : "",
										"sPrevious" : "",
										"sNext" : "",
										"sLast" : ""
									},
									"oAria" : {
										"sSortAscending" : ": ",
										"sSortDescending" : ": "
									}
								},
								"dom": 'rt<"#pBottom"><"pTop"lp><"top"i>' ,
								"fnInitComplete":function( row, data, index){//
									//tdhover
									$(".ct-table>div table td").each(function () {
										$(this).attr("title", $(this).text());
										$(this).css("cursor", 'pointer');
									});
									//
									var selectVal=$(".ct-table>div select").val();
									var tableThTdHeight=$('.ct-table>div table tr').height();
									var tableTrTdHeight=$('.ct-table>div table tbody tr').height();
									var ctHeight=(tableTrTdHeight*(parseInt(selectVal)))+tableThTdHeight+$(".pTop").height();
									$(".ct-table>div").css("height",ctHeight);
								},
								"createdRow": function ( row, data, index ) {
									$('td', row).css("height","16px");
									$('td', row).click(function(){
										$(".ct-table>div table tr").removeClass("selected");
										$('td', row).parent().addClass("selected");
										//
										/*$(".modelTableDetails").removeClass("hide");
										 var htmlobj=$.ajax({url:"/pplus/workflow/process-show.html",async:false});
										 $(".mtd-content").html(htmlobj.responseText);*/
									})
								}
							});
			
			$('button[data-btn-type]').click(function () {
	            var action = $(this).attr('data-btn-type');
	            var rowId = getTableContent();//userTable.getSelectedRowId();
	            switch (action) {
	                case 'add':
	                	modals.openWin({
							winId:new Date().getTime(),
							width:800,
							title:'',
							backdrop:"static",
							url:basePath+'user/user_page_edit', 
						    hideFunc:function(){
						    	userTable.fnClearTable();
						    }
						})
	                    break;
	                case 'edit':
	                    if (!rowId) {
	                        modals.info('');
	                        return false;
	                    }
	                    modals.openWin({
	            			winId:new Date().getTime(),
	            			width:800,
	            			backdrop:"static",
	            			title:'',
	            			url:basePath+'user/user_page_edit?userId='+rowId, 
	            		    hideFunc:function(){
	            		    	 userTable.fnClearTable();
	            		    }
	            		})
	                    break;
	                case 'delete':
	                    if (!rowId) {
	                        modals.info('');
	                        return false;
	                    }
	                    modals.confirm("", function () {
	                        ajaxPost(basePath + "user/delete/" + rowId, null, function (data) {
	                            if (data.success) {
	                            	userTable.fnClearTable();
	                            } else {
	                            	modals.error(data.message);
	                            }
	                        });
	                    });
	                    break;
	            }

	        });
		});

		function retrieveData(sSource, aoData, fnCallback) {
			aoData.push( { "name": "userName", "value": $("input[name='userName']").val() } );
			$.ajax({
				url : sSource+"?st="+(new Date().getTime()),//sAjaxSource,
	            data : JSON.stringify(aoData),//datatable,,
	            type : 'post',
	            headers: {
	            	'Content-Type' : 'application/json',
	            	'access-token':getCookie("token")
	            },
	            dataType : 'json',
	            async : false,
	            success : fnCallback,
	            error : function(msg) {
	            }
	        });
	    }
		
		function getTableContent(){
	        var nTrs = userTable.fnGetNodes();//fnGetNodesnTrs[i]itr
	        for(var i = 0; i < nTrs.length; i++){
	            if($(nTrs[i]).hasClass('selected')){
	                 return userTable.fnGetData(nTrs[i]).userId;
	            }
	        }
	    }
	   function delUser(userId) {
		   modals.confirm("", function () {
			   ajaxPost(basePath + "user/delete/" + userId, null, function (data) {
		           if (data.success) {
		               userTable.fnClearTable();
		           } else {
		        	   userTable.fnClearTable();
		               modals.error("");
		           }
		       });
		   });
	   }
	   function updaTable(){
	    	//functionTable table id
	    	$('#userTable').dataTable()._fnAjaxUpdate();
	   }
	   function removeConboboxTree(){
		   $("div .panel").remove();
		   console.log($("div .panel"));
	   }
	</script>
</form>
</body>
</html>
