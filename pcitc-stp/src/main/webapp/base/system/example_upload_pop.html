<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/style/common.css">

    <script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
    <script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
    <script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.core.js"></script>
    <script type="text/javascript" src="/layuiadmin/ztree/js/jquery.ztree.excheck.min.js"></script>
    <script type="text/javascript" src="/layuiadmin/modules/base.js"></script>
    <!--<script type="text/javascript" src="/layuiadmin/layui/lay/modules/publicMethods.js"></script>-->

</head>
<body>
<div class="formBox">
    <form id="functiongroup-form" name="functiongroup-form" lay-filter="functiongroup-form" class="form-horizontal layui-form">
        <input type="hidden" name="groupId">
        <div class="box-body">
            <div class="layui-form-item">
                <label class="layui-form-label">列表查看文件<span class="must-fill">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="filetextTable" id="filetextTable" value="fdsafdfasfaf" onclick="upload_File_table('fdsafdfasfaf');">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">文件上传A0<span class="must-fill">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="filetextA" id="filetextA" value="filetextA" onclick="upload_FileA();">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">文件上传1<span class="must-fill">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="filetext" id="filetext" value="filetext" onclick="upload_File('filetext','','edit','call_funaaa');">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">文件上传2<span class="must-fill">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="filetext2" id="filetext2" value="filetext2" onclick="upload_File('filetext2','','edit','call_fun');">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">界面单独引用publicMethods.js方法<span class="must-fill">*</span></label>
                <div class="layui-input-block">
                        <xmp>
                            1,引入layui:<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
                            2,引入publicMethods:<script type="text/javascript" src="/layuiadmin/layui/lay/modules/publicMethods.js"></script>
                            3,定义:var pl = layui.publicMethods;
                            4,调用:pl.getCurrentDate();
                        </xmp>
                </div>
            </div>

            <div class="form-bottom">
                <div class="form-bottom-btns">
                    <button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue" lay-submit="" lay-filter="submitBtn">保存</button>
                    <!--<button type="button" class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white" id="closeBtn">取消</button>-->
                </div>
            </div>
        </div>
    </form>
</div>
<script>
    // var pl = layui.publicMethods;
// console.log(pl.getCurrentDate());
// function upload_File_table(inputValueOrInputId) {
    //     var param = {};
    //     param.file_ids_value = inputValueOrInputId;
    //     param.file_opt_flag = "ff8129325ed94773bfd9f33145ccd080";//文件配置ID
    //     param.file_edit_detail = "detail";//新增、修改用edit, 显示用detail
    //     var temUrl = "/sysFilePage/uploadFileTable?param=" + encodeURIComponent(JSON.stringify(param));
    //     openBaseWin("文件上传列表查看", temUrl);
    // }
    //
    function upload_FileA() {
        var param = {};
        param.file_id_name = "filetextA";//字段ID名称
        param.callback = "call_fun";//回调函数名称
        param.file_opt_flag = "ff8129325ed94773bfd9f33145ccd080";//文件配置ID
        param.file_edit_detail = "edit";//新增、修改用edit, 显示用detail
        param.file_ids_value = $("#" + param.file_id_name).val();
        var temUrl = "/sysFilePage/uploadFile?param=" + encodeURIComponent(JSON.stringify(param));
        openBaseWin("文件上传", temUrl);
    }
    // //inputValueOrInputId:表单字段的ID或者值,不能为空，唯一值UUID，如表单<input type="text" name="id" id="id" value="16537c4bc6f_ff4a0a81">,此处可传id或者16537c4bc6f_ff4a0a81
    // //fileConfigId：系统管理-附件管理-附件配置：页面标识
    // //formType:detail：详情，edti：修改
    // function upload_File(inputValueOrInputId, fileConfigId, formType) {
    //     var param = {};
    //     if (document.getElementById(inputValueOrInputId)) {
    //         param.file_id_name = inputValueOrInputId;
    //         param.file_ids_value = $("#" + param.file_id_name).val();
    //     } else {
    //         param.file_ids_value = inputValueOrInputId;
    //     }
    //     if (param.file_ids_value == "") {
    //         alert("值不能为空");
    //         return;
    //     }
    //     param.callback = "call_fun";//回调函数名称
    //     param.file_opt_flag = fileConfigId;//文件配置ID
    //     param.file_edit_detail = formType;//新增、修改用edit, 显示用detail
    //     var temUrl = "/sysFilePage/uploadFile?param=" + encodeURIComponent(JSON.stringify(param));
    //     openBaseWin("文件上传", temUrl);
    // }
    //
    function call_funaaa(data, param) {
        //param:返回上面拼装的参数json字符串，data：json文件数组
        console.log("-------------call_funaaa");
    }
    function call_fun(data, param) {
        //param:返回上面拼装的参数json字符串，data：json文件数组
        console.log("-------------call_fun___________");
        console.log(data);
        console.log(param);
        for (var key in data) {
            console.log(key);
            var obj_file = data[key];
            console.log("文件名称：" + obj_file.fileName + "  文件大小：" + obj_file.fileSize + "  文件绝对路径:" + obj_file.filePath + "文件相对路径:" + obj_file.bak5);
        }
    }
    //
    //
    // function showdialog() {
    //     openBaseWin("选择", "/sysfileshare/dialog_user_list");
    // }

    var id = "${id?default(0)}";
    var fieldId = "${fieldId?default(0)}";
    var opt = "${opt?default(0)}";
    console.log(fieldId);
    $("input[name=fileId]").val(fieldId);
    $("input[name=stype]").val(opt);
    layui.use(['jquery', 'form', 'laydate', 'table', 'layer', 'element'],
        function () {
            var $ = layui.jquery, admin = layui.admin, element = layui.element, layer = layui.layer, laydate = layui.laydate, form = layui.form;
            form.render(null, 'functiongroup-form');
            //初始赋值 component-form-group 当前form的lay-filter
            if (fieldId != "0") {
                ajaxPost("/sysfileshare/list", {"fileId": fieldId}, function (data) {
                    console.log(data);
                    var ids = "";
                    var names = "";
                    for (var i = 0; i < data.length; i++) {
                        if (i == 0) {
                            ids = data[i].area;
                            names = data[i].bak1;
                        } else {
                            ids = ids + "|" + data[i].area;
                            names = names + "|" + data[i].bak1;
                        }
                    }
                    $("input[name=area]").val(ids);
                    $("input[name=bak1]").val(names);
                });
            }
            /* 监听提交 */
            form.on('submit(submitBtn)', function (data) {
                console.log(data.field);
                ajaxPost("/sysfileshare/savesysFileShareFile", data.field, function (dt, status) {
                    layer.msg("操作成功");
                    parent.reloadtable('sysFileId', null);
                    parent.initTree();
                    var index = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
                });
                return false;
            });
            $("#closeBtn").click(function () {
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
            })
        });
</script>
</body>
</html>
