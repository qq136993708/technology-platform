<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>科技管理平台</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
<link rel="Shortcut Icon" href="/layuiadmin/layui/images/favicon.ico" />
<link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
<link rel="stylesheet" href="/layuiadmin/style/liMarquee.css">
<link rel="stylesheet" href="/layuiadmin/style/adminStp_.css?+Math.random()" media="all">
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
	<style>
		.layui-layout-admin .layui-header .layui-layout-right{width: auto}
		.layui-layout-admin .layui-header .layui-layout-right li:nth-child(1){
			display: block;
			background: #fff;
			color: #FF5A5A;
			text-align: center;
			float: left;
			height: 35px;
			line-height: 35px;
			padding: 0px 30px;
			border-radius: 15px;
			margin: 21px;
			font-size: 20px;
		}
	</style>
</head>
<script>
    var __base_dic_store = {
        // 非树形结构数据样例
        // DIC_DEMO_DATA: {
        // 	dis: '非树形结构数据样例',
        // 	data: [
        // 		{value:'0', name: '北京'}
        // 	]
        // }
    };
</script>
<body class="layui-layout-body">
	<div id="LAY_app">
		<div class="layui-layout layui-layout-admin">
			<!--top-->
			<div class="layui-header">
				<!--logo-->
				<div class="layui-header-logo middle-block">
					<img src="/layuiadmin/layui/images/header-logo.png" />
				</div>

				<!--右侧-->
				<ul class="layui-nav layui-layout-right" lay-filter="layadmin-layout-right">
					<li class="header-nav-item">内部(涉密)禁止录入涉密信息</li>
					<li class="header-nav-item middle-block">
						<a href="javascript:;" class="header-nav-item-a">
							<span class="user-name" title="${userInfo.userDisp!}">${userInfo.userDisp!}</span>
							<span class="layui-nav-more"></span>
						</a>
						<div class="layui-hide information">
							<dl class="layui-nav-child-dl">

								<dd>
									<a id="toUserInfo" href="javascript:void(0)">基本资料</a>
								</dd>
								<dd>
									<a id="toUpdPass" href="javascript:void(0)">修改密码</a>
								</dd>
								<!--
								<dd>
									<a id="changeIndex" href="javascript:void(0)">切换</a>
								</dd>
								<dd>
									<a id="selfConfig" href="javascript:void(0)">个人设置</a>
								</dd>
								 -->
								<dd>
									<a id="logout" href="javascript:void(0)">退出登录</a>
								</dd>
							</dl>
						</div></li>
					<!--<li class="layui-nav-item">
					    <a href="javascript:;" style="color: #fff;" class="layui-nav-item-a">
							${userInfo.userDisp!}
							<span class="layui-nav-more"></span>
						</a>
						<div class="layui-hide information">
							<dl class="layui-nav-child-dl">
								
								<dd>
									<a id="myInfo" href="javascript:void(0)">个人信息</a>
								</dd>
								<dd>
									<a id="updatePassword" href="javascript:void(0)">修改密码</a>
								</dd>
								<dd>
									<a id="logout" href="javascript:void(0)">退出登录</a>
								</dd>
							</dl>
						</div></li>-->
				</ul>
			</div>

			<!-- 侧边菜单 -->
			<div class="layui-side layui-side-menu layui-side-menu-div">
				<div class="layadmin-flexible"><div></div></div>
				<div class="layui-side-scroll">
					<!--左侧导航-->
					<ul class="layui-nav layui-nav-tree" lay-shrink="all" lay-filter="layadmin-system-side-menu" id="nav${p.id}">
                    <!--<li class="layadmin-flexible"><div></div></li>-->
                           
						<!-- 系统管理员 -->
						<#if userName == 'systemadmin'>
						<li class="layui-nav-item layui-nav-itemed">
							<a href="javascript:void(0);" title="基础配置">
								<div class="item-row-block">
									<span class="icon_name sy_base_icon"></span>
									<span class="item-title">基础配置</span>
									<span class="arrow"></span>
									<i class="fa fa-angle-left pull-right"></i>
									<span class="layui-nav-more"></span>
								</div>
							</a>  
							<dl class="layui-nav-child">
								<dd class="sub-nav-item">
									<a lay-href="/user/user_page_list"  lay-text="用户管理" data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">用户管理</span>
										</div>
									</a>
								</dd>
								<dd class="sub-nav-item">
									<a lay-href="/unit/unit_tree" lay-text="机构管理" data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">机构管理</span>
										</div>
									</a>
								</dd>
								<dd class="sub-nav-item">
									<a lay-href="/function/toFuntionList" lay-text="菜单管理" data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">菜单管理</span>
										</div>
									</a>
								</dd>
							</dl>    
						</li>
						
						
						<li class="layui-nav-item">
							<a href="javascript:void(0);" title="工作流设置">
								<div class="item-row-block">
									<span class="icon_name sy_gzlsz_icon"></span>
									<span class="item-title">工作流设置</span>
									<span class="arrow"></span>
									<i class="fa fa-angle-left pull-right"></i>
									<span class="layui-nav-more"></span>
								</div>
							</a>  
							<dl class="layui-nav-child">
								<dd class="sub-nav-item">
									<a lay-href="/activiti-model/model/list" lay-text="工作流模型"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">工作流模型</span>
										</div>
									</a>
								</dd>
								<dd class="sub-nav-item">
									<a lay-href="/activiti-def/processdef/list/ini" lay-text="工作流定义"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">工作流定义</span>
										</div>
									</a>
								</dd>
								
								<dd class="sub-nav-item">
									<a lay-href="/workflow/function/config" lay-text="功能流程配置"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">功能流程配置</span>
										</div>
									</a>
								</dd>
							</dl>    
						 </li>
						 
						 
						 
						<li class="layui-nav-item">
							<a href="javascript:void(0);" title="系统设置">
								<div class="item-row-block">
									<span class="icon_name sy_xtsz_icon"></span>
									<span class="item-title">系统设置</span>
									<span class="arrow"></span>
									<i class="fa fa-angle-left pull-right"></i>
									<span class="layui-nav-more"></span>
								</div>
							</a>  
							<dl class="layui-nav-child">
								<dd class="sub-nav-item">
									<a lay-href="/dictionary/toDictionaryList?menuType=1" lay-text="数据字典"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">数据字典</span>
										</div>
									</a>
								</dd>
								
								 <dd class="sub-nav-item">
									<a lay-href="/sysJob/sysJob_list" lay-text="定时任务管理"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">定时任务管理</span>
										</div>
									</a>
								</dd>
								<dd class="sub-nav-item">
									<a lay-href="/sysNotice/sysNotice_list" lay-text="通知公告"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">通知公告</span>
										</div>
									</a>
								</dd>
							</dl>    
						 </li>
						 
						
						
						
						</#if>
                        <!-- 安全员 
                              logType 日志类型：1登陆日志，2操作日志，3错误日志 
                              userType  用户类型：1普通用户，2系统管理员，3安全员，4审计员  -->
                        <#if userName == 'securityadmin'>
						<li class="layui-nav-item layui-nav-itemed">
							<a href="javascript:void(0);" title="安全配置">
								<div class="item-row-block">
									<span class="icon_name sy_base_icon"></span>
									<span class="item-title">安全配置</span>
									<span class="arrow"></span>
									<i class="fa fa-angle-left pull-right"></i>
									<span class="layui-nav-more"></span>
								</div>
							</a>  
							<dl class="layui-nav-child">
							<dd class="sub-nav-item">
									<a lay-href="/user_secret_list" lay-text="人员密级管理"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">人员密级管理</span>
										</div>
									</a>
								</dd>
								
								<dd class="sub-nav-item">
									<a lay-href="/role/role_list" lay-text="角色管理"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">角色管理</span>
										</div>
									</a>
								</dd>
								<dd class="sub-nav-item">
									<a lay-href="/post/post_function" lay-text="岗位授权"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">岗位授权</span>
										</div>
									</a>
								</dd>
								
								<dd class="sub-nav-item">
									<a lay-href="/user_post_list" lay-text="岗位分配"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">岗位分配</span>
										</div>
									</a>
								</dd>
								
							</dl>    
						</li>
						
						<li class="layui-nav-item">
							<a href="javascript:void(0);" title="日志查询">
								<div class="item-row-block">
									<span class="icon_name sy_log_icon"></span>
									<span class="item-title">日志查询</span>
									<span class="arrow"></span>
									<i class="fa fa-angle-left pull-right"></i>
									<span class="layui-nav-more"></span>
								</div>
							</a>  
							<dl class="layui-nav-child">
								<dd class="sub-nav-item">
									<a lay-href="/syslog/to_list?logType=1&userTypes=2,3,4" lay-text="管理员登录日志"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">管理员登录日志</span>
										</div>
									</a>
								</dd>
								<dd class="sub-nav-item">
									<a lay-href="/syslog/to_list?logType=2&userTypes=2,3,4" lay-text="管理员操作日志"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">管理员操作日志</span>
										</div>
									</a>
								</dd>
								
								<dd class="sub-nav-item">
									<a lay-href="/syslog/to_list?logType=1&userTypes=1" lay-text="普通用户登录日志"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">普通用户登录日志</span>
										</div>
									</a>
								</dd>
								<dd class="sub-nav-item">
									<a lay-href="/syslog/to_list?logType=2&userTypes=1" lay-text="普通用户操作日志"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">普通用户操作日志</span>
										</div>
									</a>
								</dd>
								<dd class="sub-nav-item">
									<a lay-href="/syslog/to_list?logType=3&userTypes=1" lay-text="普通用户错误日志"  data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">普通用户错误日志</span>
										</div>
									</a>
								</dd>
							</dl>    
						 </li>
						</#if>
						
						<!-- 审计员 -->
						<#if userName == 'auditadmin'>
						<li class="layui-nav-item">
							<a href="javascript:void(0);" title="日志查询">
								<div class="item-row-block">
									<span class="icon_name sy_log_icon"></span>
									<span class="item-title">日志查询</span>
									<span class="arrow"></span>
									<i class="fa fa-angle-left pull-right"></i>
									<span class="layui-nav-more"></span>
								</div>
							</a>  
							<dl class="layui-nav-child">
								<dd class="">
									<a lay-href="/syslog/to_list?logType=1&userTypes=2,3" lay-text="管理员登录日志" data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">管理员登录日志</span>
										</div>
									</a>
								</dd>
								<dd class="">
									<a lay-href="/syslog/to_list?logType=2&userTypes=2,3" lay-text="管理员操作日志" data-functionbuttons="ALL">
										<div class="item-row-block">
											<span class="icon_name"></span>
											<span class="item-title">管理员操作日志</span>
										</div>
									</a>
								</dd>
								
							</dl>    
						</li>
						</#if>
					</ul>
				</div>
			</div>

			<div class="layadmin-pagetabs" id="LAY_app_tabs">
				<div class="layui-icon layadmin-tabs-control layui-icon-prev" layadmin-event="leftPage"></div>
				<div class="layui-icon layadmin-tabs-control layui-icon-next" layadmin-event="rightPage"></div>
				<div class="layui-icon layadmin-tabs-control layui-icon-down">
					<ul class="layui-nav layadmin-tabs-select" lay-filter="layadmin-pagetabs-nav">
						<li class="layui-nav-item" lay-unselect><a href="javascript:;"></a>
							<dl class="layui-nav-child layui-anim-fadein">
								<dd layadmin-event="closeThisTabs">
									<a href="javascript:;">关闭当前页</a>
								</dd>
								<dd layadmin-event="closeOtherTabs">
									<a href="javascript:;">关闭其它页</a>
								</dd>
								<dd layadmin-event="closeAllTabs">
									<a href="javascript:;">关闭全部页</a>
								</dd>
								<dd layadmin-event="collection" id="collection">
									<a id="collectFunction" href="javascript:void(0)">收藏/取消</a>
								</dd>
							</dl></li>
					</ul>
				</div>
				<div class="layui-tab" lay-unauto lay-allowClose="true" lay-filter="layadmin-layout-tabs">
					<ul class="layui-tab-title" id="LAY_app_tabsheader">
					</ul>
				</div>
			</div>
			<input type="text" class="selfRownum layui-hide" id="userConfig1" value="${userInfo.userConfig1?default(15)}">

			<!-- 主体内容 -->
			<div class="layui-body" id="LAY_app_body">
				<div class="layadmin-tabsbody-item layui-show">
					<iframe id="mainIframe" frameborder="0" class="layadmin-iframe"></iframe>
				</div>
			</div>
			<div class="layui-footer">
				<div>
					<p>版权所有：中国核工业集团有限公司</p>
				</div>
			</div>
			<!-- 辅助元素，一般用于移动设备下遮罩 -->
			<div class="layadmin-body-shade" layadmin-event="shade"></div>
		</div>
	</div>

	<script src="/layuiadmin/javascript/jquery.liMarquee.js"></script>
	<script src="/layuiadmin/layui/layui.js"></script>
	<script src="/layuiadmin/js/common.js"></script>
	<script>
	
		layui.config({
			base : '../layuiadmin/' //静态资源所在路径
		}).extend({
			index : 'lib/index' //主入口模块
		}).use( [ 'index', 'jquery', "publicMethods" ], function() {
      var $ = layui.jquery, publicMethods = layui.publicMethods;

      $("#navd8e0e0c1e18f4c4d940fd83c94e215ae li").click(function () {
        $("#navd8e0e0c1e18f4c4d940fd83c94e215ae li").removeClass("layui-this");
        $("#navd8e0e0c1e18f4c4d940fd83c94e215ae li").removeClass("layui-nav-itemed");
        $(this).addClass("layui-this");
        $(this).addClass("layui-nav-itemed");
      });
        $("#nav li:nth-child(1) dl dd:nth-child(1) a").click()
            $("#toUserInfo").on("click", function() {
                // layer.open({
                // 	title : "用户详情",
                // 	skin : 'layui-layer-lan',
                // 	shadeClose : true,
                // 	type : 2,
                // 	fixed : false,
                // 	//若使用小窗口形式，则修改 maxmin 值为 true，则注释掉area:[100%,100%]属性,同时设置area: ['900px', '450px']
                // 	maxmin : false,
                // 	//若直接弹出页面 ，则修改 area;[100%,100%]，同时设置 maxmin 为false
                // 	area : [ '80%', '70%' ],
                // 	content : "/user/user-dispaly?userId=${userInfo.userId}"
                // });


                //parent.layui.index.openTabsPage("/html/user/my_info.html", "用户信息");

                top.layer.open({
                    type: 2,
                    title: '用户信息',
                    area: ['800px', '80%'],
                    content: '/html/user/my_info.html',
                    btn: null
                });


            });
            $("#logout").on("click", function() {
                layer.confirm('确定要退出登录吗？', {
                    title : "退出登录"
                }, function(index) {
                    layer.close(index);
                    $.ajax({
                        type : 'post',
                        dataType : 'json',
                        async : false,
                        url : '/logout',
                        success : function(data) {
                            window.location.href = "/login";
                            //window.location.href = "./SSO/GLO/Redirect";
                        },
                        error : function(e) {
                            console.log(e);
                        }
                    });
                });
            });
            $("#toUpdPass").on("click", function() {
                // layer.open({
                // 	title : "修改密码",
                // 	skin : 'layui-layer-lan',
                // 	shadeClose : true,
                // 	type : 2,
                // 	fixed : false,
                // 	//若使用小窗口形式，则修改 maxmin 值为 true，则注释掉area:[100%,100%]属性,同时设置area: ['900px', '450px']
                // 	maxmin : false,
                // 	//若直接弹出页面 ，则修改 area;[100%,100%]，同时设置 maxmin 为false
                // 	area : [ '500px', '300px' ],
                // 	content : "/user/upd-pass?userId=${userInfo.userId}"
                // });

                //parent.layui.index.openTabsPage("/html/user/change_password.html", "修改密码");

                top.layer.open({
                    type: 2,
                    title: '修改密码',
                    area: ['500px', '400px'],
                    content: '/html/user/change_password.html',
                    btn: null
                });
            });

      $("#nav li dl dd a").hover(function() {
        $(this).find("img").removeClass("layui-hide");
        $(this).find("img").off("click").on( "click", function() {
          $.ajax({
            type : 'post',
            dataType : 'json',
            async : false,
            url : '/admin/collect?functionCode=' + $(this).parent().attr("data-code") + "&functionName=" + $(this).parent().attr("lay-text") + "&functionId=" + $(this).parent().attr("data-id"),
            success : function(data) {
              layer.msg(data.message);
              if (data.success) {
                // 动态修改当前我的收藏
                var obj = eval('(' + data.data + ')');
                if (obj.status == '1') {
                  var collectMenu = document.getElementById("dlCollect").innerHTML;
                  collectMenu = collectMenu + "<dd id='"+obj.dataId+"'><a lay-href='"+obj.collectUrl+"' lay-text='"+obj.collectName+"' data-id='"+obj.functionId+"' data-code='"+obj.functionCode+"' data-functionbuttons='ALL'>" + obj.collectName
                      + "<img title=\"取消收藏\"  src=\"/layuiadmin/layui/images/icon_collection.png\" class=\"layui-hide\"/></a></dd>"
                  document.getElementById("dlCollect").innerHTML = collectMenu;

                } else if (obj.status == '0') {
                  var dl = document.getElementById("dlCollect");
                  // 查找dl里的所有dd
                  var dds = document.getElementsByTagName('dd');
                  for (var i = dds.length - 1; i >= 0; i--) {
                    if (dds[i].id == obj.dataId) {
                      dl.removeChild(dds[i]);
                    }
                  }
                }

              }

            },
            error : function(e) { if (console && console.error) { console.error(e); } }
          });
          return false;
        });
      }, function() { 
        $(this).find("img").addClass("layui-hide");
      });

      // 菜单收藏
      $("#collectFunction").on("click", function() {
        var param = JSON.parse(window.localStorage.getItem("param"));
        $.ajax({
          type : 'post',
          dataType : 'json',
          async : false,
          url : '/admin/collect?functionCode=' + param.code + "&functionName=" + param.name + "&functionId=" + param.id,
          success : function(data) {
            layer.msg(data.message);

            if (data.success) {
              // 动态修改当前我的收藏
              var obj = eval('(' + data.data + ')');
              if (obj.status == '1') {
                var collectMenu = document.getElementById("dlCollect").innerHTML;
                collectMenu = collectMenu + "<dd id='"+obj.dataId+"'><a lay-href='"+obj.collectUrl+"' lay-text='"+obj.collectName+"' data-id='"+obj.functionId+"' data-code='"+obj.functionCode+"' data-functionbuttons='ALL'>" + obj.collectName + "</a></dd>"
                document.getElementById("dlCollect").innerHTML = collectMenu;
              } else if (obj.status == '0') {
                var dl = document.getElementById("dlCollect");
                // 查找dl里的所有dd
                var dds = document.getElementsByTagName('dd');
                for (var i = dds.length - 1; i >= 0; i--) {
                  if (dds[i].id == obj.dataId) {
                    dl.removeChild(dds[i]);
                  }
                }
              }

            }

          },
          error : function(e) {
            console.log(e);
          }
        });
      });
  
      $(document).ready(function() {
        $("#mainIframe", parent.document.body).attr("src", "/base/sysLog/log_index.html");
      });
    });
	</script>
</body>
</html>
