<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>中核科技管理平台</title>
  <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css">
  <!-- 多选下拉框样式，根据需求添加 -->
  <link rel="stylesheet" href="/layuiadmin/layui/css/modules/formSelects-v4.css" />
  <link rel="stylesheet" href="/css/layui-common.css">
  <link rel="stylesheet" href="/css/common.css">
  
  <!-- 更多样式在此引入 -->
</head>
<body class="">
<div class="layout-view-content dialog">
	<form class="layui-form" action="" id="formPlatform" lay-filter="formPlatform">
     <div class="layui-row layui-col-space20">
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
         <div class="layui-form-item">
           <label class="layui-form-label label-required"><span class="text">平台名称：</span></label>
           <div class="layui-input-block">
             <input type="text" name="platformName" lay-verify="required"
               placeholder="" autocomplete="off" class="layui-input">
           </div>
         </div>
       </div>

       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
         <div class="layui-form-item">
           <label class="layui-form-label label-required"><span class="text">研究领域：</span></label>
           <div class="layui-input-block">
             <select name="researchField" lay-verify="required" dic-base-data="ROOT_KJPT_YJLY" placeholder="请选择"></select>
           </div>
         </div>
       </div>
       
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
         <div class="layui-form-item">
           <label class="layui-form-label label-required"><span class="text">依托单位：</span></label>
           <div class="layui-input-block">
             <select name="supportingInstitutions"
              xm-select="supportingInstitutions"
              xm-select-skin="normal"
              xm-select-radio=""
              lay-verify="required"
              dic-base-data="ROOT_KJPT_YTDW_ZHJT"
              placeholder="请选择"></select>
           </div>
         </div>
       </div>
       
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
         <div class="layui-form-item">
           <label class="layui-form-label"><span class="text">科研经费：</span></label>
           <div class="layui-input-block">
             <input type="text" name="researchFunds" lay-verify="number"
               placeholder="请填写..." autocomplete="off" class="layui-input">
           </div>
         </div>
       </div>

       <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
         <div class="layui-form-item">
           <label class="layui-form-label"><span class="text">平台介绍：</span></label>
           <div class="layui-input-block">
             <textarea name="platformIntroduction" placeholder="请输入内容" class="layui-textarea"></textarea>
           </div>
         </div>
       </div>
       
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
         <div class="layui-form-item">
           <label class="layui-form-label label-required"><span class="text">主要负责人：</span></label>
           <div class="layui-input-block">
             <input type="text" name="personLiable" lay-verify="required"
               placeholder="请填写..." autocomplete="off" class="layui-input">
           </div>
         </div>
       </div>
       
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
         <div class="layui-form-item">
           <label class="layui-form-label"><span class="text">平台类型：</span></label>
           <div class="layui-input-block">
             <select name="type" dic-base-data="ROOT_KJPT_PTLX" placeholder="请选择"></select>
           </div>
         </div>
       </div>
       
       <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
         <div class="layui-form-item">
           <label class="layui-form-label"><span class="text">科研团队介绍：</span></label>
           <div class="layui-input-block">
             <textarea name="teamIntroduction" placeholder="请输入内容" class="layui-textarea"></textarea>
           </div>
         </div>
       </div>
       
       <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
         <div class="layui-form-item">
           <label class="layui-form-label"><span class="text">科研整体情况：</span></label>
           <div class="layui-input-block">
             <textarea name="overallSituation" placeholder="请输入内容" class="layui-textarea"></textarea>
           </div>
         </div>
       </div>
       
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
         <div class="layui-form-item">
           <label class="layui-form-label"><span class="text">平台评分：</span></label>
           <div class="layui-input-block">
             <input type="text" name="platformScoring" lay-verify="number"
               placeholder="" autocomplete="off" class="layui-input">
           </div>
         </div>
       </div>
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">上传图片：</span></label>
            <div class="layui-input-block">
              <input type="hidden" name="imgId" id="imgId" />
              <div class="img-view-block middle-block" id="imgFileUpload">
                <img src="" alt="请选择图片上传" />
                <div class="file-img-btn" label="imgUpload">
                  <span class="btn-icon"></span>
                  <span class="btn-text">点击此区域上传图片</span>
                </div>
                <span class="file-img-del middle-block"><span class="del" label="imgDelete">删除</span></span>
              </div>
            </div>
          </div>
        </div>
       
       <div class="dialog-footer-btn">
      		<button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="newSubmit">提交</button>
      		<button class="layui-btn layui-btn-primary close-all-dialog" type="button">关闭</button>
       </div>
     </div>
     <input type="hidden" name="id">
     <input type="hidden" name="creator">
     <input type="hidden" name="createDate">
     <input type="hidden" name="updateDate">
     <input type="hidden" name="updator">
     <input type="hidden" name="deleted">
     <input type="hidden" name="level">
   </form>
</div>
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script src="/layuiadmin/js/common.js"></script>
<script src="/layuiadmin/js/fileUpload.js"></script>
</body>
</html>

<script>
layui.use(['form', 'jquery', 'formSelects'], function(){
  var $ = layui.jquery;
  var form = layui.form;
  
  // 获取地址栏传递过来的参数
  var variable = getQueryVariable();
  function getItemInitData(item) {
    var httpUrl = '/platform-api/newInit/' + variable.level;
    if (item && item.id) {
      httpUrl = '/platform-api/load/' + item.id;
    }
    httpModule({
      url: httpUrl,
      type: 'GET',
      success: function(relData) {
        if (relData.code === '0') {
          // 给form表单赋初始值
          form.val('formPlatform', relData.data);
          // setImagesUploadState({ id: '#imgFileUpload', imgID: relData.data.imgID });
          // 更新表单数据
          form.render();
          if (relData.data.supportingInstitutions) {
            layui.formSelects.value('supportingInstitutions', [relData.data.supportingInstitutions]);
          }
        }
      }
    });
  }
  
  getItemInitData(variable);

	form.on('submit(newSubmit)', function(data) {
		httpModule({
			url: '/platform-api/save',
			data: data.field,
			type: "POST",
			success: function(e) {
				setDialogData(e); // 通知上层页面状态 - 弹窗中使用
				top.layer.closeAll(); // 关闭弹窗
			}
		});
		return false;
  })
  
  // 图片上传
  setImagesUpload({
    id: '#imgFileUpload', // 图片作用域的ID
    callback: function (data, type) {
      if (data) { $('#imgId').val(data.id) } else { $('#imgId').val('') }
    }
  });
	
});
</script>