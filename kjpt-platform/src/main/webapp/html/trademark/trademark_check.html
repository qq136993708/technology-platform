<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>中核科技管理平台</title>
  <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css">
  <!-- 多选下拉框样式，根据需求添加 -->
  <!-- <link rel="stylesheet" href="/layuiadmin/layui/css/modules/formSelects-v4.css" /> -->
  <link rel="stylesheet" href="/css/layui-common.css">
  <link rel="stylesheet" href="/css/common.css">
  <!-- 更多样式在此引入 -->

  <style>
    .more-item:not(:first-child) {
      margin-top: 20px;
    }

    #knownImagesView img{
      margin-right: 10px;
      width: 78px;
      height: 81px;
      display: inline-block;
      border: 1px solid #dddddd;
    }

    #knownImagesView{
      display: flex;
      justify-content: flex-start;
    }

    #knownImagesView .img-div {
      margin-right: 20px;
      width: 90px;
      height: 90px;
    }
  </style>
</head>

<body class="">
  <div class="layout-view-content dialog">
    <form class="layui-form" action="" id="formPlatform" lay-filter="formPlatform">

        <div class="layui-row layui-col-space20" style="display: none;">
            <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                <div class="layui-form-item">
                  <label class="layui-form-label "><span class="text">密级：</span></label>
                  <div class="layui-input-block">
                    <input type="hidden" id="secretLevel" >
                    <input type="text" name="secretLevelText" placeholder="" autocomplete="off" class="layui-input" disabled>
                  </div>
                </div>
            </div>  
          
            <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
                <div class="layui-form-item">
                    <i class="layui-icon layui-icon-vercode secret-level-helper"></i>
                    <label class="secret-level-helper">通过设置密级给信息加密，不同密级的用户有不同信息权限</label>  
                </div>
            </div>
                 
        </div>
        <!-- 知悉范围 -->
        <div id="scope_list_layout"></div>
  
        <div class="secret-level-line"></div>

      <div class="layui-row layui-col-space20">
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">单位名称:</span></label>
            <div class="layui-input-block">
              <input type="text" name="unitNameText"  disabled placeholder="" autocomplete="off"
                     class="layui-input">
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">商标名称：</span></label>
            <div class="layui-input-block">
              <input type="text" name="trademarkName"  disabled placeholder="" autocomplete="off"
                     class="layui-input">
            </div>
          </div>
        </div>

        <div class="layui-col-sm6 layui-col-md4">
          <div class="layui-form-item">
              <label class="layui-form-label label-required"><span class="text">注册号:</span></label>
              <div class="layui-input-block">
                  <input type="text" name="applicationNumber" lay-verify="required"  autocomplete="off" class="layui-input">
              </div>
          </div>
      </div>
      
      <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label class="layui-form-label"><span class="text">国际分类号：</span></label>
          <div class="layui-input-block">
            <input type="text" name="countryType" placeholder="" autocomplete="off"
                   class="layui-input">
          </div>
        </div>
      </div>

        <div id="applicant">
          <div class="more-item">
            <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
              <div class="layui-form-item">
                <label class="layui-form-label"><span class="text">申请人：</span></label>
                <div class="layui-input-block">
                  <input type="text" name="applicant"  disabled placeholder="" autocomplete="off"
                         class="layui-input applicantlist">
                </div>
              </div>
            </div>
            <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
              <div class="layui-form-item" style="padding-left: 20px;">
                <label class="layui-form-label" style="text-align: left">
                  <!--<button class="add-more-item-btn" type="button">
                    <i class="layui-icon">&#xe654;</i>
                  </button>-->
                </label>
              </div>
            </div>
          </div>
        </div>
        <!-- <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">国际分类号：</span></label>
            <div class="layui-input-block">
              <input type="text" name="countryType" placeholder="" disabled autocomplete="off"
                     class="layui-input">
            </div>
          </div>
        </div> -->

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">注册单位：</span></label>
            <div class="layui-input-block">
              <input type="text" name="registerOrg" disabled  placeholder="" autocomplete="off"
                     class="layui-input">
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">注册日期：</span></label>
            <div class="layui-input-block">
              <input type="text" name="registerDate" id="registerDate" disabled  placeholder="" autocomplete="off"
                     class="laydate-input">
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">有效期：</span></label>
            <div class="layui-input-block">
              <input type="text" name="effectiveDate" id="effectiveDate" disabled  placeholder="" autocomplete="off"
                     class="laydate-input">
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">延展有效期：</span></label>
            <div class="layui-input-block">
              <input type="text" name="extensionPeriod" id="extensionPeriod" disabled placeholder="" autocomplete="off"
                     class="laydate-input">
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">商标类型：</span></label>
            <div class="layui-input-block">
              <input type="text" name="tradeMarkType" placeholder="" disabled autocomplete="off" class="layui-input">
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">法律状态：</span></label>
            <div class="layui-input-block">
              <input type="text" name="lawStatus" placeholder="" disabled autocomplete="off" class="layui-input">
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">驰名商标：</span></label>
            <div class="layui-input-block">
              <select name="isWellKnown" lay-filter="isWellKnown" select="isWellKnown" disabled  select-skin="normal"  dic-base-data="ROOT_UNIVERSAL_WEHTHER"></select>
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">驰名商标认定日期：</span></label>
            <div class="layui-input-block">
              <input type="text" name="wellKnownDate" id="wellKnownDate" disabled placeholder="" autocomplete="off" class="laydate-input">
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">驰名商标认定机构：</span></label>
            <div class="layui-input-block">
              <input type="text" name="wellKnownOrg" placeholder="" disabled autocomplete="off" class="layui-input">
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">著名商标：</span></label>
            <div class="layui-input-block">
              <select name="isRegistered" select="isRegistered" lay-filter="isRegistered" disabled  select-skin="normal"  dic-base-data="ROOT_UNIVERSAL_WEHTHER"></select>
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">著名商标认定日期：</span></label>
            <div class="layui-input-block">
              <input type="text" name="famousDate" id="famousDate" disabled placeholder="" autocomplete="off" class="laydate-input">
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">著名商标认定机构：</span></label>
            <div class="layui-input-block">
              <input type="text" name="famousOrg" placeholder="" disabled autocomplete="off" class="layui-input">
            </div>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">商标图片：</span></label>
          </div>
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
        </div>

        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
          <label class="layui-form-label"><span class="text"></span></label>
          <div class="layui-input-block">
            <div class="layui-upload-list" id="knownImagesView">
              <!--            <img class="layui-upload-img" >-->
              <!--              <div style="background:rgba(216,216,216,1);width: 78px;height: 71px;"></div>-->
            </div>
          </div>
        </div>

        <!--<div id="file-filter-options">
          <div class="view-title-layout disabled=-disabledview-pt0">
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label "><span class="text">附件：</span></label>
            <div class="layui-input-block">
              <table></table>
            </div>
          </div>
        </div>-->

        <div class="dialog-footer-btn">
          <button class="layui-btn layui-btn-primary close-all-dialog" type="button">取消</button>
        </div>
      </div>
      <input type="hidden" name="id">
      <input type="hidden" name="creator">
      <input type="hidden" name="createDate">
      <input type="hidden" name="updateDate">
      <input type="hidden" name="updator">
      <input type="hidden" name="deleted">
      <input type="hidden" name="level">
    </form>
  </div>
  <script type="text/javascript" src="/plugins/jQuery/jquery-1.10.1.min.js"></script>
  <script src="/layuiadmin/layui/layui.js"></script>
  <script src="/layuiadmin/js/common.js"></script>
  <script src="/layuiadmin/js/fileUpload.js"></script>
</body>

</html>

<script>
  layui.use(['form', 'jquery'], function () {
    var $ = layui.jquery;
    var form = layui.form;
    var laydate = layui.laydate;


    function getItemInitData(item) {
      if (item && item.id) {
        httpUrl = '/trademarkController/load/' + item.id + "?id=" + item.id;
      }
      httpModule({
        url: httpUrl,
        type: 'GET',
        success: function (relData) {
          if (relData.code === '0') {
            var data = relData.data;
            var applicant = data.applicant;
            var applicantArray = applicant && applicant.indexOf(',')?applicant.split(','):[];
            $.ajaxSettings.async = false;
            if (applicantArray.length > 0) {
              $.each(applicantArray, function (k, v) {
                if (k == 0) {
                  data.applicant = v;
                } else {
                  addItem(v, 'view');
                }
              });
            }
            transToData(data, ['registerDate','effectiveDate','extensionPeriod','wellKnownDate', 'famousDate']);
            form.val('formPlatform', data);
            if (item && item.id) {
              data.isWellKnown == '0'? $('#wellKnownDateBox').attr("class",'') : $('#wellKnownDateBox').attr('class','layui-hide');
              data.isRegistered == '0'? $('#isRegisteredBox').attr("class",'') : $('#isRegisteredBox').attr('class','layui-hide');
            }
            form.render();

            //images
            var files = relData.data.files;
            var filesArray = files?files.split(','):[];
            if (filesArray.length > 0) {
              $.each(filesArray, function (k, v) {
                var src = '/file/imgFile/' + v;
                $('#knownImagesView').append('<div class="img-div">\n' +
                        '                <img src="' + src + '" data-field="' + v + '">\n' +
                        '              </div>');
              });
            }

            // 添加知悉范围
            setJurisdictionScope({
              elem: 'scope_list_layout',
              knowledgeScope: data.knowledgeScope,
              knowledgePerson: data.knowledgePerson,
              secretLevel: data.secretLevel,
              disabled: true
            });


          }
        }
      });
    }

    function transToData(data, fields) {
        $.each(fields, function(index, f){
           
          if(data[f]) {
            try {
              data[f] = (new Date(data[f])).format('yyyy-MM-dd');
            }
            catch (e) {
              
            }
          }  
        });
      }
    function upLoadFile(billDataID) {
      // var templet = '<div class="file-options">';
      // templet += '<span class="link-text file-options-download" data-fileid="' + billDataID + '">下载</a>';
      // templet += '</div>';
      setFileUpload({
        id: 'file-filter-options', // 附件上传作用域ID值 必传
        dataID: billDataID, // 用来查找当前单据下绑定的附件，没有则不查找
        disabled: true,
        callback: function (tableData, type) {
          /* callback 表格数据每次变更时的回调，返回表格数据与操作类型
            * type 触发变更的类型 目前只有 delete | upload
          */
          console.log(tableData, type);
        }
      })
    }

    function addItem (value, type) {
      var el = '';
      if (type && type == 'view') {
        el = $('.more-item:last-child .applicantlist');
      } else {
        el = $(this);
      }
      var parent = el.parent();
      var htmlsel = parent.parent().parent().parent('.more-item');
      var appendparent = htmlsel.parent();
      var html = htmlsel.prop("outerHTML");
      html = html.indexOf('申请人：')>=0?html.replace('申请人：', '&nbsp;'):html;
      html = html.indexOf('label-required')>=0?html.replace('label-required', ''):html;
      appendparent.append(html);
      if (type != 'view') {
        el.remove();
      }
      //赋值
      setTimeout(function () {
        if (typeof value == 'string') {
          var nextMoreItem = htmlsel.next();
          nextMoreItem.find('.layui-input-block input').val(value);
          form.render();
        }
      }, 10);
    }
    // 获取地址栏传递过来的参数
    var variable = getQueryVariable();
    getItemInitData(variable);
    
    upLoadFile(variable.id);

  });
</script>