<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>用户信息</title>
  <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css">
  <!-- 多选下拉框样式，根据需求添加 -->
  <!-- <link rel="stylesheet" href="/layuiadmin/layui/css/modules/formSelects-v4.css" /> -->
  <link rel="stylesheet" href="/css/layui-common.css">
  <link rel="stylesheet" href="/css/common.css">

  <style>
  
    .noborder {
        border: 0px;
    }
  </style>
 
  
  <!-- 更多样式在此引入 -->
</head>
<body class="">
<div class="layout-view-content">
	<form class="layui-form" action="" id="formMain" lay-filter="formMain">
     <div class="layui-row layui-col-space20">
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
         <div class="layui-form-item">
           <label class="layui-form-label "><span class="text">头像：</span></label>
           <div class="layui-input-block">
            <input type="hidden" name="userExtend" id="userExtend" />
            <div class="img-view-block middle-block" id="imgFileUpload">
              <img src="" alt="请选择图片上传" />
              <div class="file-img-btn" label="imgUpload">
                <span class="btn-icon"></span>
                <span class="btn-text">点击此区域上传图片</span>
              </div>
              <span class="file-img-del middle-block"><span class="del" label="imgDelete">删除</span></span>
            </div>
          </div>
         </div>
       </div>
     </div>   

    <div class="layui-row layui-col-space20">
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
            <div class="layui-form-item">
            <label class="layui-form-label "><span class="text">归属公司：</span></label>
            <div class="layui-input-block">
                <input type="text" id="userUnitText" readonly="true" class="layui-input noborder">
            </div>
            </div>
        </div>id
    </div>

    <div class="layui-row layui-col-space20">
      <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label class="layui-form-label "><span class="text">所属岗位：</span></label>
          <div class="layui-input-block">
            <input type="text" id="userPostText" readonly="true" class="layui-input noborder">
          </div>
        </div>
      </div>
    </div>

      <div class="layui-row layui-col-space20">
      <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label class="layui-form-label "><span class="text">姓名：</span></label>
          <div class="layui-input-block">
            <input type="text" name="userName" readonly="true" class="layui-input noborder">
          </div>
        </div>
      </div> 
 
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
         <div class="layui-form-item">
           <label class="layui-form-label "><span class="text">邮箱：</span></label>
           <div class="layui-input-block">
            <input type="text" name="userMail" class="layui-input">
           </div>
         </div>
       </div> 
 
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label class="layui-form-label "><span class="text">电话：</span></label>
          <div class="layui-input-block">
            <input type="text" name="userPhone"  class="layui-input">
          
          </div>
        </div>
      </div>
    
        
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
         <div class="layui-form-item">
           <label class="layui-form-label "><span class="text">手机：</span></label>
           <div class="layui-input-block">
            <input type="text" name="userMobile" class="layui-input">
        
           </div>
         </div>
       </div>
   
 
       <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
         <div class="layui-form-item">
           <label class="layui-form-label"><span class="text">备注：</span></label>
           <div class="layui-input-block">
             <textarea  name="userComment" class="layui-textarea"></textarea>
           </div>
         </div>
       </div>
    </div>

       <div class="layui-row layui-col-space20">
       <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label class="layui-form-label "><span class="text">用户类型：</span></label>
          <div class="layui-input-block">
            <input type="text" id="userKindText" readonly="true"  class="layui-input noborder">
          </div>
        </div>
      </div>
    </div>

      <div class="layui-row layui-col-space20">
      <div class="layui-col-xs12 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label class="layui-form-label "><span class="text">用户角色：</span></label>
          <div class="layui-input-block">
            <input type="text" id="userRoleText" readonly="true"  class="layui-input noborder">
          </div>
        </div>
      </div>
    </div>

      <div class="layui-row layui-col-space20">
      <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
        <div class="layui-form-item">
          <label class="layui-form-label "><span class="text">上次登录IP：</span></label>
          <div class="layui-input-inline margin0" style="width: 130px;">
            <input type="text" name="lastLoginIp" readonly="true" value="" class="layui-input noborder">
          </div>
          <span class="ib-block">登录时间：</span>
          <div class="layui-input-inline margin0" style="width: calc(100% - 360px);vertical-align: top;">
                <input type="text" name="lastLoginDate"   readonly="true" class="layui-input noborder">
          </div>
        </div>
        
      </div>
 
    </div>
    
    
    <div style="height:80px;"></div>
    
    <div class="dialog-footer-btn">
        <button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="newSubmit">提交</button>
        <button class="layui-btn layui-btn-primary close-all-dialog" type="button">关闭</button>
    </div>

    <input type="hidden" name="userId">

    
 
   </form>
</div>

 

<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script src="/layuiadmin/js/common.js"></script>
<script src="/layuiadmin/js/fileUpload.js"></script>
 


<script > 
 

layui.use(['form', 'layer', 'laydate', 'upload'], function(){
    var form = layui.form;
    var $ = layui.$; 
    var laydate = layui.laydate; 
 

  setImagesUpload({
    id: '#imgFileUpload', // 图片作用域的ID
    callback: function (data, type) {
      if (data) { $('#userExtend').val(data.id) } else { $('#userExtend').val('') }
    }
  });


  function getItemInitData() {
    var httpUrl = '/user/currentUserInfo';  
    httpModule({
      url: httpUrl,
      type: 'GET',
      success: function(relData) { 
          transToData(relData, ['lastLoginDate']);
          form.val('formMain', relData);
          // 更新表单数据
          form.render();

          if(relData.userExtend){
            setImagesUploadState({imgID: relData.userExtend, id: '#imgFileUpload'});
          }

          loadText('/unit/list-data', 'unitId', 'unitName', relData.userUnit, '#userUnitText');
          loadText('/post/list-data', 'postId', 'postName', relData.userPost, '#userPostText');
          loadText('/dictionary/list/ROOT_XTGL_YHLX', 'code', 'name', relData.userKind, '#userKindText');
          loadText('/role/role-list-all', 'roleId', 'roleName', relData.userRole, '#userRoleText');
      }
    });
  }

  function loadText(url, codef, textf, data, el) {
      data = data.split(',');
      httpModule({
        url: url,
        type: 'POST',
        success: function(relData) { 
            var map = {};
            $.each(relData, function(index, item){
                map[item[codef]] = item[textf];
            });
            
            var arr = [];
            $.each(data, function(index, item){
                arr.push(map[data]);
            });

            $(el).val(arr.join(','));
        }
    });
  }
  
	// 获取地址栏传递过来的参数
   getItemInitData();

	form.on('submit(newSubmit)', function(data) {

        var d = data.field;
        delete d.lastLoginIp;
        delete d.lastLoginDate;
		httpModule({
			url: '/user/updateCurrentUserInfo',
			data: d,
            type: "POST",
            
			success: function(e) {
				layer.msg(e.message);
			}
		});
		return false;
    })
     
    function transToData(data, fields) {
      $.each(fields, function(index, f){
         
        if(data[f]) {
          try {
            data[f] = (new Date(data[f])).format('yyyy-MM-dd hh:mm:ss');
          }
          catch (e) {
            
          }
        }  
      });
    }
       

  });
  
  


</script>

</body>
</html>
