<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>专利管理-专利查询</title>
  <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css">
  <link rel="stylesheet" href="/layuiadmin/layui/css/modules/formSelects-v4.css" />
  <link rel="stylesheet" href="/css/layui-common.css">
  <link rel="stylesheet" href="/css/common.css"> 
 

</head>
<body>
  <div class="layout-view-content min-label">
    <form class="layui-form layui-form-screen" action="" lay-filter="patentFormDemo">
      <div class="layui-row layui-col-space20">
        <!-- 移动：6/12 | 平板：6/12 | 桌面：4/12 -->
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="text">专利名称：</span></label>
            <div class="layui-input-block">
              <input type="text" name="patentName" placeholder="请输入" autocomplete="off" class="layui-input">
            </div>
          </div>
        </div>


 
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4 layui-col-btn">
            <div class="layui-form-item ">
                <button class="layui-btn layui-btn-normal" lay-submit lay-filter="formDemo">查询</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>

        
        
      </div>
    </form>
  
    <div class="view-title-layout">
      <div class="right">
        <button class="layui-btn border-blue" id="viewItem">查看</button>
      </div>
    </div>
    
    <table id="tableDemo"  lay-filter="tableDemo"></table>
  </div>
  
<script type="text/html" id="showUserTpl">
	<a href="javascript:shouUser('{{d.id}}')" class="layui-table-link">{{d.inventor}}</a>
</script>
 
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script src="/layuiadmin/layui/layui.js"></script>
<script src="/layuiadmin/js/common.js"></script>


<script type="text/html" id="applicationDateText">
	{{ dateFieldText(d.applicationDate) }}
</script>

  <script>
      //Demo
      layui.use(['form', 'table', 'layer', 'laydate'], function(){
          var form = layui.form;
          var $ = layui.$;
          var table = layui.table;
          var layer = layui.layer;
          var laydate = layui.laydate;

          //表格渲染
          var itemRowData = null; // 选中行的数据
          var tableRender = false;
          function queryTable(searchData) {

              if (!tableRender) {
                  tableRender = true;
                  table.render({
                      elem: '#tableDemo'
                      ,url: '/patentController/query' //数据接口
                      ,cols: [[ //表头
                          {type: 'radio', field: 'id'}
                          ,{field: 'patentName', title: '专利名称'}
                          ,{field: 'applicationDate', title: '申请日期', sort: true, templet: function(d) {
                                  return dateFieldText(d.recordDate);
                              }}
                      ]],
                      parseData: function(res) {return layuiParseData(res);},
                      request: {
                          pageName: 'pageNum', // 重置默认分页请求请求参数 page => pageIndex
                          limitName: 'pageSize' // 重置默认分页请求请求参数 limit => pageSize
                      },
                      page: true, //开启分页
                      limit: 10, // 每页数据条数,
                      limits: [5, 10, 15, 20], // 配置分页数据条数
                      done: function() {
                          itemRowData = null;
                      },
                      where: searchData
                  });
              } else {
                  table.reload('tableDemo', {where: searchData});
              }
          }
          queryTable('')




          function openDataDilog(type, id) {

              var url = '/html/patent/edit.html?type=' + type;
              var dialogTitle = '新增专利信息';
              if (type === 'edit') {
                  dialogTitle = '编辑专利信息';
                  url += '&id=' + id;
              } else if (type === 'view') {
                  dialogTitle = '专利信息查看';
                  url = '/html/patent/view.html?id=' + id;
              }

              // 打开弹窗
              top.layer.open({
                  type: 2,
                  title: dialogTitle,
                  area: ['880px', '70%'],
                  content: url,
                  btn: null,
                  end: function() {

                      var relData = getDialogData('dialog-data');

                      if (relData) {
                          if (relData.code === '0') {
                              layer.msg(dialogTitle+'成功!', {icon: 1});
                              $('[lay-filter="formDemo"]').click();
                          } else {
                              layer.msg(relData.message, {icon: 2});
                          }
                      }

                  }
              });
          }


          // 表格行被选中
          table.on('radio(tableDemo)', function(obj){
              itemRowData = obj.data;
          });


          // 查看
          $('#viewItem').on('click', function(e) {
              if (itemRowData) {
                  openDataDilog('view', itemRowData.id);
              } else {
                  layer.msg('请选择需要查看的专利项目！');
              }
          });

          // 删除
          $('#delItem').on('click', function(e) {
              if (itemRowData) {
                  layer.confirm('您确定要删除”'+itemRowData.patentName+'“吗？', {icon: 3, title:'删除提示'}, function(index){
                      layer.close(index);
                      // 确认删除
                      httpModule({
                          url: '/patentController/delete/' + itemRowData.id,
                          type: 'DELETE',
                          success: function(relData) {
                              if (relData.code === '0') {
                                  layer.msg('删除成功!', {icon: 1});
                                  $('[lay-filter="formDemo"]').click();
                              } else {
                                  layer.msg('删除失败', {icon: 2});
                              }
                          }
                      });
                  });
              } else {
                  layer.msg('请选择需要删除的专利项目！');
              }
          });





          // bindSelectorDic($("#applicationType"), 'ROOT_KJPT_ZLFW', form);
          // bindSelectorDic($("#patentType"), 'ROOT_KJPT_ZLZL', form);
      });

      function shouUser(userId) {
          alert(userId);
      }

  </script>
 
</body>
</html>