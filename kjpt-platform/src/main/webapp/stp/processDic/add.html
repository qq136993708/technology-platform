<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/ztree/css/metroStyle/metroStyle.css">
    <link rel="stylesheet" href="/layuiadmin/style/common.css">

    <script src="/layuiadmin/layui/layui.js"></script>
    <style type="text/css">
        .box-body{margin-bottom: 50px !important;padding: 0 30px;}
        textarea{width: 75%;}
    </style>
</head>
<body>
<div class="formBox">
    <form class="layui-form" name="form1" id="form1" action="" method="POST" lay-filter="component-form-group layui-container">
        <div class="box-body">
            <input type="hidden" name="type"      id="type"     value="${type}">
            <input type="hidden" name="id"        id="id"       value="${id}">
            <input type="hidden" name="parentId"  id="parentId" value="${parentId}">
             <div class="layui-form-item layui-form-text">
                <label for="" class="layui-form-label">节点名称<span class="must-fill">*</span></label>
                <div class="layui-input-block">
                  <input class="layui-input" name="name" id="name" value="${sysProcessDic.name}" lay-verify="name"  placeholder="请输入节点名称" autocomplete="off" type="text">
                </div>
            </div>
            
            
             
             <div class="layui-form-item layui-form-text">
                <label for="" class="layui-form-label">父节点</label>
                <div class="layui-input-block">
                   <input class="layui-input" name="parentName" style="cursor:pointer" readonly="readonly" onclick="parent_Name()" id="parentName" value="${sysProcessDic.parentName}" lay-verify="parentName" autocomplete="off" type="text">
                </div>
             </div>
            
            
            
            
            
             <div class="layui-form-item layui-form-text">
                <label for="" class="layui-form-label">备用1<span class="must-fill">*</span></label>
                <div class="layui-input-block">
                <input class="layui-input" name="ext1" id="ext1" value="${sysProcessDic.ext1}" lay-verify="ext1" autocomplete="off" type="text">
                </div>
            </div>
            
            
             <div class="layui-form-item layui-form-text">
                <label for="" class="layui-form-label">备用2<span class="must-fill">*</span></label>
                <div class="layui-input-block">
                  <input class="layui-input" name="ext2" id="ext2" value="${sysProcessDic.ext2}" lay-verify="ext2" autocomplete="off" type="text">
                </div>
            </div>
            

        </div>

        <div class="form-bottom" style="margin-top: 15px;">
            <div class="form-bottom-btns">
                <button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue" lay-submit="sub" lay-filter="sub">保存
                </button>
                <button type="button"   class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white" id="closeBtn">关闭
                </button>
            </div>
        </div>
    </form>
</div>
<script src="/common/js/jquery-1.11.3.min.js"></script>
<script>
    var v_date = (new Date()).getTime();
    var table, form;
    var publicMethods;
    var param = JSON.parse(window.localStorage.getItem("param"));
    var functionId = param.id;
    $('#functionId').val(functionId);
	var type=$("#type").val();
	
	
	//alert(type);
    layui.use(['jquery', 'form', 'laypage', 'laydate', 'table', 'layer', "publicMethods"], function () {
        var $ = layui.jquery,
            admin = layui.admin
            , element = layui.element
            , layer = layui.layer
            , laydate = layui.laydate;
        form = layui.form;
        table = layui.table;
        publicMethods = layui.publicMethods;
        var type = "${sysProcessDic.type?default('')}";
        var $ = layui.$, active = {
        		
        };
        form.render();
        /* 自定义验证规则  title 要验证的input的 lay-verify=""*/
        form.verify({
            name: function (value) {
                if (value.length < 2) {
                    return '名称至少得2个字符啊';
                }
            }
        });




        /* 监听提交 */
        form.on('submit(sub)', function (data) {
        
        	
        	var typev=$("#type").val();
            var url = "/process_dic/save?v_date=" + v_date;
            var backurl = "/process_dic/process_list?v_date=" + v_date+"&type="+typev;
            ajaxOpt(url, "form1", "POST", backurl, "保存成功", "保存失败");
            return false;
        });
        //关闭事件
        $("#closeBtn").click(function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        })


    });


    function ajaxOpt(url, formName, type, backurl, successMsg, failMsg) {

        $.ajax({
            type: type,
            url: url,
            dataType: "json",
            data: $("#" + formName).serialize(),
            async: false,
            cache: false,
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function (data, status) {

                if (data.success == true || data.success == 'true') {


                    layer.alert(
                        successMsg,
                        {icon: 1, closeBtn: 0},
                        function () {
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                            parent.location.href = backurl;
                        });

                } else {
                    layer.alert(failMsg);
                }

            },
            error: function () {
                layer.alert("网络访问错误");
            }

        });
    }
    
    
    
    function parent_Name() 
    {
        var temUrl = '/process_dic/choose_process?type=' + type+"&v_date="+v_date;
        publicMethods.openBaseWin("选择父节点", temUrl, "90%", "80%");
    }
    
    
    function setname(parentId,parentName)
    {
    	$('#parentId').val(parentId);
    	$('#parentName').val(parentName);
    }
    
    
    
</script>
</body>
</html>