<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>新增技术族分类</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="apple-mobile-web-app-status-bar-style" content="black"> 
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="/layuiadmin/style/common.css">
  <link rel="stylesheet" href="/css/form.css">
</head>
<body>
<div class="layout-view-content dialog">
  <form id="show-form" class="layui-form" lay-filter="show-form">
  <div class="box-body">
  <input id="parentId" name="parentId" type="hidden">
  	<div class="layui-row layui-col-space10">
      <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label for="" class="layui-form-label"><span class="must-fill">*</span>父节点名称</label>
          <div class="layui-input-block">
          	  <input class="layui-input readOnlyBox" id="parentTypeName" name="parentTypeName" lay-verify="required" type="text" disabled>
          </div>
        </div>
      </div>

      <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label for="" class="layui-form-label">分类标签</label>
          <div class="layui-input-block">
            <input class="layui-input" id="typeScope" name="typeScope" placeholder="请输入分类标签" type="text">
          </div>
        </div>
      </div>
    </div>

    <div class="layui-row layui-col-space10">
      <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label for="" class="layui-form-label"><span class="must-fill">*</span>分类名称</label>
          <div class="layui-input-block">
            <input class="layui-input" id="typeName" name="typeName" lay-verify="required" placeholder="请输入分类名称" type="text">
          </div>
        </div>
      </div>


      <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label for="" class="layui-form-label"><span class="must-fill">*</span>分类编码</label>
          <div class="layui-input-block">
            <input class="layui-input readOnlyBox" id="typeCode" name="typeCode" lay-verify="required" type="text"  disabled>
          </div>
        </div>
      </div>
    </div>

    <div class="layui-row layui-col-space10">
      <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label for="" class="layui-form-label">发展方向</label>
          <div class="layui-input-block">
            <input class="layui-input" id="directionInfo" name="directionInfo" placeholder="请输入发展方向" type="text">
          </div>
        </div>
      </div>


      <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label for="" class="layui-form-label"><span class="must-fill">*</span>分类编码</label>
          <div class="layui-input-block">
            <input class="layui-input readOnlyBox" id="typeCode" name="typeCode" lay-verify="required" type="text"  disabled>
          </div>
        </div>
      </div>
    </div>

    <div class="layui-row layui-col-space10">
      <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label for="" class="layui-form-label">创建人</label>
          <div class="layui-input-block">
            <input class="layui-input readOnlyBox" id="createUser" name="createUser" type="text" disabled>
          	<input id="createUserId" name="createUserId" type="hidden">
          </div>
        </div>
      </div>
      <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
          <label for="" class="layui-form-label">创建时间</label>
          <div class="layui-input-block">
	         <input type="text" name="createDate" id="createDate" lay-verify="createDate" class="layui-input readOnlyBox" disabled>
          </div>
        </div>
      </div>
    </div>

    <div class="layui-form-item layui-form-text">
      <label class="layui-form-label">说明</label>
      <div class="layui-input-block">
        <textarea placeholder="请输入说明" class="layui-textarea" name="remarks" id="remarks"></textarea>
      </div>
    </div>

  </div>

    <div class="dialog-footer-btn">
      <button class="layui-btn layui-btn-normal" lay-submit lay-filter="form-submit">保存</button>
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
      <button type="button" class="layui-btn layui-btn-primary"  id="closeBtn">取消</button>
    </div>
  </form>
</div>
<script src="/layuiadmin/layui/layui.js"></script>
<script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script src="/layuiadmin/js/common.js"></script>
<script>

    layui.config({
        base: '../../../../' //静态资源所在路径
    }).use([ 'form', 'laydate','table','jquery','layer'], function(){

        var $ = layui.jquery
        	,admin = layui.admin
            ,element = layui.element
            ,layer = layui.layer
            ,laydate = layui.laydate
            ,form = layui.form;
        var typeCode=''
        // 获取地址栏传递过来的参数
        var variable = getQueryVariable();
        if(variable!=null){
            httpModule({
                url: '/techFamily-api/get/'+variable.tfmTypeId,
                type: 'GET',
                success: function(relData) {
                    if (relData.success === true) {
                        // 给form表单赋初始值
                        relData.data.parentTypeName=relData.data.typeName
                        relData.data.typeName=''
                        typeCode=relData.data.typeCode
                        console.log(relData.data)
                        form.val('show-form', relData.data);
                    }
                }
            });
        }
        /*$("#parentId").attr("value", parent.temTypeId);
        $("#parentTypeName").attr("value", parent.temTypeName);*/

      	//日期时间选择器
        laydate.render({
            elem: '#createDate',
            type: 'datetime',
            value: new Date()
        });

      	// 防止重置时清空
        $("#createDate").attr("value", $("#createDate").val());

        /* 自定义验证规则  title 要验证的input的 lay-verify=""*/
        form.verify({
        });

        //关闭事件
        $("#closeBtn").click(function () {
            setDialogData('');
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        });

    	/* 监听提交 */
        form.on('submit(form-submit)', function(data){
            console.log(data)
            httpModule({
                url: '/tech-family/type/save',
                data: data.field,
                type: "POST",
                success: function(res) {
                    if(res.code!=-1){
                        res.data.typeCode=typeCode
                        setDialogData(res);
                    }
                }
            });
            /*$.ajax({
                type : 'POST',
                url : "/tech-family/type/save",
                data : JSON.stringify(data.field),
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                async: false,    // 使用同步操作
                timeout : 3000, //超时时间：3秒
                error: function (XMLHttpRequest, textStatus, errorThrown){
                    // 注意：如果发生了错误，错误信息（第二个参数）除了得到null之外，还可能
                    //是"timeout", "error", "notmodified" 和 "parsererror"。
                    if(textStatus == "timeout"){
                        alert('网络不稳定，请求超时')
                    }
                },
                success : function(data) { //请求成功后处理函数。
                    console.log(data)
                	/!*parent.messageInfo = data.message;
                	parent.active.alertEvent();
                	parent.ztreeAsyncChildNodes();*!/
                }
            });*/
            return false;
        });
    	
        $("#closeBtn").click(function () {
        	var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
            setDialogData('');
            return false;
        })
    });
    
</script>
</body>
</html>
