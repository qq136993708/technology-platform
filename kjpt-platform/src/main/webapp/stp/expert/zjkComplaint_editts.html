<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="/layuiadmin/style/common.css">

    <script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
    <script type="text/javascript" src="/layuiadmin/javascript/ckeditor5/ckeditor.js"></script>
    <script type="text/javascript" src="/plugins/jQuery/jQuery-2.2.0.min.js"></script>
    <script type="text/javascript" src="/common/js/base.js"></script>
</head>
<body>
<div class="formBox">
    <form id="zjkComplaint-form" name="zjkComplaint-form" lay-filter="zjkComplaint-form" class="form-horizontal layui-form">
        <input type="hidden" name="groupId">
        <div class="layui-row">
            <input type="hidden" name="dataId" id="dataId"/>
            <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label">专家名称<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                        <input type="text" id="zjkName" name="zjkName" lay-verify="required"  readonly="readonly" value="${zjmc}" placeholder="请输入专家名称" autocomplete="off" class="layui-input">
                        <input type="hidden" id="zjkId" name="zjkId" lay-verify="required" value="${zjid}" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>



        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
            <div class="layui-form-item">
                <label class="layui-form-label">项目名称<span class="must-fill">*</span></label>
                <div class="layui-input-block">
                    <input type="text" id="xmName" name="xmName" lay-verify="required" readonly="readonly"  value="${xmmc}" placeholder="请输入项目名称" autocomplete="off" class="layui-input">
                    <input type="hidden" id="xmId" name="xmId" lay-verify="required"  value="${xmid}" placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>
        </div>
<div class="layui-row">

    <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
        <div class="layui-form-item">
            <label class="layui-form-label">项目阶段<span class="must-fill">*</span></label>
            <div class="layui-input-block">
                <select name="xmSteps" id="xmSteps" lay-filter="xmSteps">
                </select>
            </div>
        </div>
    </div>

        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
            <div class="layui-form-item">
                <label class="layui-form-label">投诉类型<span class="must-fill">*</span></label>
                <div class="layui-input-block">
                    <select name="complaintType" id="complaintType" lay-filter="complaintType">
                    </select>
                </div>
            </div>
        </div>
</div>

        <div class="layui-row">

            <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                <div class="layui-form-item">
                    <label class="layui-form-label">投诉人名称</label>
                    <div class="layui-input-block">
                        <input type="text" id="complaintUserName"  name="complaintUserName"  placeholder="请输入投诉人名称" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>



        </div>
        <div class="layui-row">
            <div class="layui-form-item layui-form-text">
                <div class="layui-form-item">
                    <label class="layui-form-label">投诉内容<span class="must-fill">*</span></label>
                    <div class="layui-input-block">
                        <textarea name="complaintDesc" id="complaintDesc" class="ckeditor"></textarea>
                    </div>
                </div>
            </div>
        </div>


        <!--<div class="layui-row">-->

            <!--<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">-->
                <!--<div class="layui-form-item">-->
                    <!--<label class="layui-form-label">是否处理<span class="must-fill">*</span></label>-->
                    <!--<div class="layui-input-block">-->
                        <!--<select name="isComplet" id="isComplet" lay-filter="isComplet" disabled="disabled">-->
                        <!--</select>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
            <!--<div class="layui-form-item layui-form-text">-->
                <!--<div class="layui-form-item">-->
                    <!--<label class="layui-form-label">处理结果<span class="must-fill">*</span></label>-->
                    <!--<div class="layui-input-block">-->
                        <!--<textarea name="doDesc" id="doDesc" class="ckeditor" readonly="readonly"></textarea>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->


        <!--</div>-->

        <div class="form-bottom">
            <div class="form-bottom-btns">
                <button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue" lay-submit="" lay-filter="submitBtn">保存</button>
                <button type="button" class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white" id="closeBtn">取消</button>
            </div>
        </div>
    </div>
    </form>
</div>

<script>
    var xmjd = "${xmjd}";
    ajaxPost('/dictionary/list/ROOT_XTGL_XMJD', null, function (data, status) {
        $.each(data, function (i, dt) {
            if(xmjd==data[i].code){
                $("#xmSteps").append("<option value='" + data[i].code + "' selected>" + data[i].name + "</option>");
            }else {
                // $("#xmSteps").append("<option value='" + data[i].code + "'>" + data[i].name + "</option>");
            }
        });
    });
    ajaxPost('/dictionary/list/ROOT_UNIVERSAL_WEHTHER', null, function (data, status) {
        $.each(data, function (i, dt) {
            $("#isComplete").append("<option value='" + data[i].code + "'>" + data[i].name + "</option>");
        });
    });
    ajaxPost('/dictionary/list/ZJK_TSLX', null, function (data, status) {
        $.each(data, function (i, dt) {
            $("#complaintType").append("<option value='" + data[i].code + "'>" + data[i].name + "</option>");
        });
    });
    ajaxPost('/dictionary/list/ROOT_UNIVERSAL_WEHTHER', null, function (data, status) {
        $.each(data, function (i, dt) {
            $("#isComplet").append("<option value='" + data[i].code + "'>" + data[i].name + "</option>");
        });
    });
    var id = "${id?default(0)}";
    if (id != "0") {
        $("#id").val(id);
    }
    layui.use(['jquery', 'form', 'laydate', 'table', 'layer', 'element'],
        function () {
            var $ = layui.jquery, admin = layui.admin, element = layui.element, layer = layui.layer, laydate = layui.laydate, form = layui.form;
            form.render(null, 'zjkComplaint-form');
            var complaintDesc=null;
            ClassicEditor
                .create( document.querySelector( '#complaintDesc' ), {
                    language:"zh-cn"
                    ,image: {
                        toolbar: [ 'imageTextAlternative' ]
                    }
                    ,
                    ckfinder: {
                        uploadUrl: '/sysfile/ckupload5?type=Image'
                    }
                })
                .then( editor => {
                    complaintDesc = editor;
                } )
                .catch( error => {
                    console.error( error );
                } );
            //初始赋值 component-form-group 当前form的lay-filter
            // if (id != "0") {
            //     ajaxPost("/zjkComplaint/getZjkComplaintInfo", {"id": id}, function (data) {
            //         form.val("zjkComplaint-form", data);
            //         CKEDITOR.instances.complaintDesc.setData(data.complaintDesc);
            //     });
            // }
            /* 自定义验证规则  title 要验证的input的 lay-verify=""*/
            /* form.verify({
                groupName : function(value,item) {
                    if (value.length < 5) {
                        return '标题至少得5个字符啊';
                    }
                },
                orderNum : function(value){

                },
                content : function(value) {
                    layedit.sync(editIndex);
                }
            }); */
            /* 监听指定开关 */
            form.on('switch(component-form-switchTest)', function (
                data) {
                layer.msg('开关checked：'
                    + (this.checked ? 'true' : 'false'), {
                    offset: '6px'
                });
                layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF',
                    data.othis)
            });
            /*监听select框*/
            form.on('select(complaintType)', function (data) {
                if (data.value=="ZJK_TSLX_NM"){
                    $("#complaintUserName").val("");
                }
            });
            /* 监听提交 */
            form.on('submit(submitBtn)', function (data) {
                data.field.complaintDesc=complaintDesc.getData();
                data.field.isComplet="ROOT_UNIVERSAL_WEHTHER_NO";
                ajaxPost("/zjkComplaint/saveZjkComplaint", data.field, function (dt, status) {
                    layer.msg("操作成功");
                    parent.layui.table.reload('zjkChoiceTableId', {where: {param: {}}});
                    var index = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
                });
                return false;
            });
            $("#closeBtn").click(function () {
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
            })
        });
</script>
</body>
</html>