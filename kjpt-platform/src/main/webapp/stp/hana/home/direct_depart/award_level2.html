<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/adminStp.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/mainStp.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/second.css" media="all">
    <style>
        .btn_details{background:url(/layuiadmin/layui/images/operation_03.png) 2px 4px #fff no-repeat;}
        .btnMyBgImg:hover{background-size:inherit;background-position: 2px;}
        .searchBox{background:none;}
    </style>
</head>
<body>
<div class="layui-fluid">
    <div class="">
        <div class="searchBox">
            <label class="dateInput">
                <span>月份</span>
                <input type="text" name="year" placeholder="请选择月份" title="月份" value="${year}"  autocomplete="off" class="form-control" id="year">
            </label>
            <!--按钮组-->
            <div class="btnGroup">
                <button class="layui-btn layui-btn-sm fontColor-white btn_search btnMyBgImg"
                        onclick="search_Event()">查询</button>
            </div>
            <div class="btnGroup" style="float:right">
                <button id="knowledge_table" class="layui-btn layui-btn-sm fontColor-blue borderColor-blue  btnMyBgImg btn_details"
                >详情</button>
            </div>
        </div>

        <div class="layui-row layui-col-space10">
            <div class="layui-col-md6 layui-main-oil4">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>年成果鉴定数量分析
                    </div>
                    <div class="layui-row-main">
                        <div class="main-chart" id="chart1" style="height:280px;width: 100%;"></div>
                    </div>
                </div>
            </div>
            <div class="layui-col-md6 layui-main-oil6 layui-col-space10">
                <div class="layui-col-md5">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            <span class="layui-time"></span>年成果鉴定占比分析
                        </div>
                        <div class="layui-row-main">
                            <div class="main-chart" id="chart2" style="height:280px;width: 100%;"></div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md5">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            <span class="layui-time"></span>年国际先进成果鉴定占比分析
                        </div>
                        
                        <div class="layui-row-main">
                        <table id="processdef-table" class="layui-hide" lay-filter="processdef-table"></table>
                    </div>
                    
                    
                       <!--  <div class="layui-row-main">
                            <div class="main-chart" id="chart3" style="height:280px;width: 100%;"></div>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-row layui-col-space10">
            <div class="layui-col-md6 layui-main-oil4">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>年成果鉴定数量按单位分析
                    </div>
                    <div class="layui-row-main">
                        <div class="main-chart" id="chart4" style="height:280px;width: 100%;"></div>
                    </div>
                </div>
            </div>
            <div class="layui-col-md6 layui-main-oil6 layui-col-space10">
                <div class="layui-col-md5">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            <span class="layui-time"></span>年成果鉴定数量占比分析
                        </div>
                        <div class="layui-row-main">
                            <div class="main-chart" id="chart5" style="height:280px;width: 100%;"></div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md5">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            <span class="layui-time"></span>年直属研究院成果鉴定数量占比分析
                        </div>
                        <div class="layui-row-main">
                            <div class="main-chart" id="chart6" style="height:280px;width: 100%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-row layui-col-space10">
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class="layui-time"></span>年成果鉴定数量分布情况分析
                    </div>
                    <div class="layui-row-main">
                        <div class="main-chart" id="chart7" style="height:280px;width: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/common/js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
<script src="/common/js/layer-v3.1.1/layer.js"></script>
<script type="text/javascript" src="/plugins/echarts/echarts.min.js"></script>
<script type="text/javascript" src="/plugins/echarts/walden.js"></script>	
<script type="text/javascript" src="/stp/hana/common/stp_common_line.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_bar.js"></script>
<script type="text/javascript" src="/stp/hana/common/stp_common_pie.js"></script>

<script type="text/javascript">
/* var myChart1 = echarts.init(document.getElementById('chart3'));
var table;
layui.config({
    base: '/layuiadmin/'
}).extend({
    index: 'lib/index' 
}).use(['index','jquery','form', 'laydate','table','laypage'], function(){
	  $ = layui.jquery
      ,table = layui.table
      ,form = layui.form
      ,laydate = layui.laydate
	  form.render(null, 'component-form-group');
        laydate.render({
           elem: '#year'
           ,format: 'yyyy'
        });
    $(".layui-time").html($("#year").val());
        $("#knowledge_table").click(function () {
            parent.layui.index.openTabsPage("/home_achievement/award_table", "科技成果详情");
        });
        
        
}); */




var editObj=null,ptable=null,treeGridCom=null,tableId='processdef-table',layer=null;
var ptable02=null,treeGridCom=null,tableId02='processdef_table_02';
layui.config({
    base: '/layuiadmin/lib/extend/'
}).extend({
    treeGridCom:'treeGridCom'
}).use(['jquery','form', 'laydate','treeGridCom','layer'], function(){
    var $=layui.jquery;
    treeGridCom = layui.treeGridCom;//很重要
    layer=layui.layer;
    laydate = layui.laydate;
    form = layui.form;
   
    form.render(null, 'component-form-group');
    laydate.render({
       elem: '#year'
       ,format: 'yyyy'
    });
    renderTable();
    $("#knowledge_table").click(function () {
    	parent.layui.index.openTabsPage("/home_achievement/award_table", "科技成果明细");
    });
  
});


function initEchart()
{

	var v_date=(new Date()).getTime();
	var nd=$('#year').val();
    $(".layui-time").html(nd);
	var ndstr=nd+"年";
	var yAxis= [
        {
            type: 'value',
            name: '数量（个）',
            min: 0,
            max:'dataMax',
            position: 'left',
            axisLabel: {
                formatter: '{value}'
            }
        }
    ];
	
	
	
	
	
	

	var chart1_url="/home_achievement/getAwardTypeList?type=1&nd="+nd+"&v_date="+v_date;
	var echart1=load_single_bar(chart1_url,"chart1","","",yAxis);
	echart1.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		parent.layui.index.openTabsPage("/home_achievement/award_table?project_property="+xName, "科技成果明细");
          
    });
	
	
	var chart2_url="/home_achievement/getAwardTypeList?nd="+nd+"&v_date="+v_date+"&type=2";
	var echart2=loadPie(chart2_url,"chart2","","");
	echart2.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		parent.layui.index.openTabsPage("/home_achievement/award_table?project_property="+xName, "科技成果明细");
          
    });
	
	/* var chart3_url="/home_achievement/getAwardCircle?nd="+nd+"&v_date="+v_date;
	getTaiYang(chart3_url,"",""); */
	
	
	
	var chart4_url="/home_achievement/get_unit_result_count?type=1&nd="+nd+"&v_date="+v_date; 
	var echart4=load_single_bar(chart4_url,"chart4","","",yAxis);
	echart4.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		parent.layui.index.openTabsPage("/home_achievement/award_table?project_property="+xName, "科技成果明细");
          
    });
	
	
	var chart5_url="/home_achievement/get_unit_result_count?type=2&nd="+nd+"&v_date="+v_date;
	var echart5=loadPie(chart5_url,"chart5","","");
	echart5.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		parent.layui.index.openTabsPage("/home_achievement/award_table?project_property="+xName, "科技成果明细");
          
    });
	
	var chart6_url="/home_achievement/get_institution_result_count?nd="+nd+"&v_date="+v_date;
	var echart6= loadPie(chart6_url,"chart6","","");
	echart6.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		parent.layui.index.openTabsPage("/home_achievement/award_table?project_property="+xName, "科技成果明细");
          
    });
	
	
	var chart7_url="/home_achievement/getAwardUnitTypeList?nd="+nd+"&v_date="+v_date;
	var echart7=load_mutl_bar_02(chart7_url,"chart7","","",yAxis);
	echart7.on('click', function (params) {
		var xName=params.name;
		var legentName=params.seriesName;
		parent.layui.index.openTabsPage("/home_achievement/award_table?project_property="+xName, "科技成果明细");
          
    });
	
}

//初始化图形
initEchart();
//查询
function search_Event()
{
	initEchart();
	renderTable();
}





function renderTable()
{  
	
	  var month=$("#year").val();
	  var companyCode=$("#companyCode").val();
	  
	 
	  ptable=treeGridCom.render({
	        id:tableId
	        ,elem: '#'+tableId
	        ,url:'/home_achievement/getAwardCircle?nd='+month+"&companyCode="+companyCode
	        ,cellMinWidth: 200
	        ,idField:'id'//必須字段
	        ,treeId:'id'//树形id字段名称
	        ,treeUpId:'pId'//树形父id字段名称
	        ,treeShowName:'name'//以树形式显示的字段
	       // ,heightRemove:[".dHead",10]//不计算的高度,表格设定的是固定高度，此项不生效
	        ,height:'280'
	        ,isFilter:false
	        ,iconOpen:false//是否显示图标【默认显示】
	        ,isOpenDefault:true//节点默认是展开还是折叠【默认展开】
	        ,loading: false
	        ,method:'get'
	        ,cols: [[
	            {field:'name', width:'50%', title: '名称',edit:'text'},
	            {field:'extend01',  title:'数量',  style:'cursor: pointer;',align: 'left', width: '50%'}
	            
	        ]]
	        ,isPage:false
	        ,parseData:function (res) {
	            return res;
	        }
	        ,onClickRow:function (index, o) {
	            console.log(index,o,"单击！");
	        }
	        ,onDblClickRow:function (index, o) {
	            console.log(index,o,"双击");
	        }
	    });
}


   /*      
function getTaiYang(url,title,ndstr)
{
	
     var option = {
    	 title: {
    		        text: title,
    		        x:'center',
    		        y: '10px',
    		        subtext: ndstr,
    		        textStyle: {
    		            fontSize: 15,
    		            fontWeight: 'normal',
    		            color: '#000000'       
    		        },
    		        subtextStyle: {
    		            color: '#7B7B7B'        
    		        },
    		    },
    		    tooltip: {
    		        trigger: 'item',
    		        formatter: "{b}: {c}"
    		    },
    		    grid: {
    		        x: 80,
    		        y: 80,
    		        x2: 80,
    		        y2: 80
    		    },
         series: {
             type: 'sunburst',
             highlightPolicy: 'ancestor',
             data: [],
             radius: [0, '95%'],
             sort: null,
             levels: [{}, {
                 r0: '15%',
                 r: '35%',
                 itemStyle: {
                     borderWidth: 2
                 },
                 label: {
                     rotate: 'tangential'
                 }
             }, {
                 r0: '35%',
                 r: '70%',
                 label: {
                     align: 'right'
                 }
             }]
             
             
           }
         };
     
     
     
     var  chartList;
     function pieAjax_taiyang_02() 
     {
    	 
     	 myChart1.showLoading();
          $.ajax({
     	     type:"get",
     	     url: url,
     	     dataType:"json",
     	     timeout : 11000,
     	     cache: false,
     	     contentType: "application/x-www-form-urlencoded; charset=utf-8",
     	      success:function(data,status)
     	      {    
     		          if(data.success==true ||data.success=='true')
     		          {
     		        	        chartList=data.data;
     		        	        option.series.data=chartList;
     		        	        
     		        	        myChart1.setOption(option);
     		          } 
     			   },
     			   error:function()
     			   {
     				   layer.msg('图表加载失败');
     			   },
     			   complete: function (XMLHttpRequest, status) {
     				   myChart1.hideLoading();
     		            if(status == 'timeout'){
     		            	 layer.msg('超时');
     		            }
     		        }
     	    });
             
     }
     
     pieAjax_taiyang_02();
     
} */

        
</script>
</body>
</html>