<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/common.css">
    <script src="/common/js/jquery-1.11.3.min.js"></script>

    <script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
</head>
<body>
<div class="layer-box">
    <form id="planForm" class="layui-form" action="" lay-filter="component-form-group layui-container"></form>
    <div class="formBox">
        <div class="tableToolBox">
            <div class="tableBtns">
                <div class="tableTitle">WORD、EXCEL、PDF 格式文件</span>
                </div>
            </div>
        </div>
    </div>
    <div class="box-body">
        <form class="layui-form" name="form1" id="form1" action="" method="POST"
              lay-filter="component-form-group layui-container">
            <input name="id" id="id" value="${id}" type="hidden">
            <input name="documentDoc" id="documentDoc" value="${documentDoc}" type="hidden">
            <input name="docArriveGoods" id="docArriveGoods" value="${docArriveGoods}" type="hidden">
            <input name="stage" id="stage" value="${stage}" type="hidden">
            <input name="uploadState" id="uploadState" value="${uploadState}" type="hidden">
            <div class="layui-form-item" style="padding:10px">
                <label class="layui-form-label">附件</label>
                <div id="file_div" class="layui-input-block"></div>
            </div>


            <div class="form-bottom">
                <div class="form-bottom-btns">
                    <button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue"
                            lay-submit="" lay-filter="sub" id="sub">保存
                    </button>
                    <button type="button"
                            class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue"
                            id="present" >提交
                    </button>
                    <button type="button"
                            class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white"
                            id="closeBtn">关闭
                    </button>
                </div>
            </div>
       </form>
    </div>

</div>
</div>
<script type="text/javascript">
        $(function(){
            var uploadState = $("#uploadState").val();
            if(uploadState=="3" || uploadState=="4"){
                document.getElementById("sub").style.display = "none";
                document.getElementById("present").style.display = "none";
            }
        })
</script>
<script>
    var publicMethods;
    var form;
    var param = JSON.parse(window.localStorage.getItem("param"));
    var functionId = param.id;
    $('#functionId').val(functionId);

    var v_date = (new Date()).getTime();
    var stage = $("#stage").val();

    var uploadState = $("#uploadState").val();
    //alert(uploadState)
    if (uploadState=="1"){
        var file_ids = "documentDoc";
        //detail:详情，edit：编辑
        file_edit_detail = "edit";
        //统管理-附件管理-附件配置：页面标识
        file_opt_flag = "a605efbdacd04a27bac557004eddf0ec";
    }else if (uploadState=="2") {
        var file_ids = "docArriveGoods";
        //detail:详情，edit：编辑
        file_edit_detail = "edit";
        //统管理-附件管理-附件配置：页面标识
        file_opt_flag = "5f58df0018634ababa6011cc616bba09";
    }else if (uploadState=="3") {
        var file_ids = "documentDoc";
        //detail:详情，edit：编辑
        file_edit_detail = "detail";
        //统管理-附件管理-附件配置：页面标识
        file_opt_flag = "a605efbdacd04a27bac557004eddf0ec";
    }else if (uploadState=="4") {
        var file_ids = "docArriveGoods";
        //detail:详情，edit：编辑
        file_edit_detail = "detail";
        //统管理-附件管理-附件配置：页面标识
        file_opt_flag = "5f58df0018634ababa6011cc616bba09";
    }

    var equipmentIds = $("#equipmentIds").val();
    var yearFeeStr = $("#yearFeeStr").val();
    var beginYear = $("#beginYear").val();

    var table, selectRowData;
    layui.use(['form', 'table', 'laypage', 'layer', 'laydate', 'laytpl', 'jquery', "publicMethods"], function () {

        var admin = layui.admin
        element = layui.element
            , table = layui.table
            , layer = layui.layer
            , laydate = layui.laydate
            , laypage = layui.laypage
            , $ = layui.jquery;

        form = layui.form;
        publicMethods = layui.publicMethods;
        form.render();


        //添加到form.render()之后
        $("#file_div").load('/common/public/uploadlayuiload.html');


        $('.layui-btn').on('click', function () {
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
        var $ = layui.$, active = {
            selectEvent: function () {

            }
        }

        /* 监听提交 */
        form.on('submit(sub)', function (data)
        {
            var uploadState=$("#uploadState").val();
            if(uploadState=="1"){
                var url="/sre_project_taskac/updateFileDoc?v_date="+v_date;
                var backurl="/sre_project_taskac/to_list?v_date="+v_date;
            }else if(uploadState=="2"){
                var url="/sre_project_taskac/updateFileDoc?v_date="+v_date;
                var backurl="/sre_project_taskac/to_list?v_date="+v_date;
            }
            ajaxOpt(url,"form1","POST",backurl,"保存成功","保存失败");
            return false;
        });
    });




    function ajaxOpt(url, formName, type, backurl, successMsg, failMsg) {
        $.ajax({
            type: type,
            url: url,
            dataType: "json",
            data: $("#" + formName).serialize(),
            async: false,
            cache: false,
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function (data, status) {

                if (data.success == true || data.success == 'true') {


                    layer.alert(
                        successMsg,
                        {icon: 1, closeBtn: 0},
                        function () {
                            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                            parent.layer.close(index);  // 关闭layer
                            parent.location.href = backurl;
                        });

                } else {
                    layer.alert(failMsg);
                }

            },
            error: function () {
                layer.alert("网络访问错误");
            }

        });
    }


    function clearNoNum(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, "");  //清除“数字”和“.”以外的字符
        obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');//只能输入两个小数
        if (obj.value.indexOf(".") < 0 && obj.value != "") {//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
            obj.value = parseFloat(obj.value);
        }
    }

    //关闭事件
    $("#closeBtn").click(function () {
        var index = parent.layer.getFrameIndex(window.name);
        parent.layer.close(index);
    })
 $("#present").click(function () {
                var stage = $("#stage").val();
	            var s=0;
	            var applicationId=$("#id").val();
	            if(stage=="20"){
	              s=30;
	            }else if(stage=="40"){
	              s=50;
	            }
	            if(s!=0)
	            {
	             	$.ajax({
			           type : 'GET',
			           url : "/sre_project_taskac/submitAudit?id="+applicationId+"&status="+s,
			           success : function(data) {
			           layer.alert("提交成功！", {icon: 1,closeBtn: 0 }, function () 
			                       {
			                           var index = parent.layer.getFrameIndex(window.name); 
								       parent.layer.close(index); 
								       var v_date = (new Date()).getTime();
								       var backurl="/sre_project_taskac/to_list?v_date="+v_date
								       parent.location.href = backurl;
			                      });
					 
	                      },
	               });
	             }
 })

</script>
</body>
</html>