<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<link rel="stylesheet" type="text/css" href="/layuiadmin/layui/css/layui.css">
	<link rel="stylesheet" type="text/css" href="/layuiadmin/ztree/css/metroStyle/metroStyle.css">
	<link rel="stylesheet" type="text/css" href="/layuiadmin/style/common.css">
	
	<script type="text/javascript" src="/plugins/ckeditor/ckeditor.js"></script>
	<script type="text/javascript" src="/layuiadmin/layui/layui.js"></script>
	<script type="text/javascript">
	var param = JSON.parse(window.localStorage.getItem("param"));
	var file_ids = "appendFiles";
	//detail:详情，edit：编辑
	file_edit_detail = "detail";
	//统管理-附件管理-附件配置：页面标识
	file_opt_flag = param.code;
	layui.use(['jquery','form','laydate','table', 'layer', 'element','publicMethods'], function(){
    	var $ = layui.jquery, admin = layui.admin, element = layui.element, layer = layui.layer, laydate = layui.laydate,
            form = layui.form,publicMethods=layui.publicMethods,table = layui.table;	
    		//加载项目
    		publicMethods.ajaxPost("/project/apply-list-all",null, function (data) {
				$.each(data,function(i,val){
					$("#projectId").append('<option value="'+data[i].applyId+'">'+data[i].applyTitle+'</option>');
				});
		   	});
    		//日期
    		laydate.render({
                elem: '#signDate'
                ,type: 'date'
                ,value: new Date() 
            });
    		var contractId = "${contractId?default(0)}";
    		var editor = CKEDITOR.replace("contractContent");
    		if(contractId != 0)
	        {
		 		$("#contractId").val(contractId);
		 		publicMethods.ajaxPost('/project/get-contract', {"contractId":contractId}, function (data, status) {
	        		form.val("contract-form",data);
	        		console.log(data);
	        		editor.setData(data.applyContent);
	            });
	        }else{
	        	$("#appendFiles").val("${appendFiles}");
	        }
    		form.render();
    		$("#file_div").load('/common/public/uploadlayuiload.html');
    		
    		$("select[class=readOnlyBox]").parent().find('input').addClass('readOnlyBox');
    		
    		form.on('submit(submitBtn)', function(data) {
				data.field.contractContent = editor.getData();
				publicMethods.ajaxPost('/project/contract-saveorupdate', data.field, function (data, status) {
                    if (data.success) {
                    	parent.layui.table.reload('contractTable',null);
                    	parent.renderfunc();//隐藏全选按钮
                    	var index = parent.layer.getFrameIndex(window.name);
				       	parent.layer.close(index);
                    }else{
                    	parent.layer.alert(data.message, {
							title : '信息'
						});
                    	return false;
                    }
                });
				return false;
			});
    		$("#cancel").click(function () {
    		    var index = parent.layer.getFrameIndex(window.name);
    		    parent.layer.close(index);
    		})
		});
	</script>
</head>
<body>
<div class="formBox">
	<form id="contract-form" name="contract-form" lay-filter="contract-form" class="form-horizontal layui-form">
	<input type="hidden" name="contractId" id="contractId">
	<input type="hidden" name="appendFiles" id="appendFiles">
	<div class="box-body">
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
				  <label class="layui-form-label">签约项目<span class="must-fill">*</span></label>
		          <div class="layui-input-block">
					<select name="projectId" disabled="disabled" class="readOnlyBox" id="projectId" lay-verify="required"  lay-filter="">
	                	<option value="">请选择</option>
	             	</select>
				  </div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item"  id="password" >
					<label for="" class="layui-form-label">签约编码<span class="must-fill">*</span></label>
					<div class="layui-input-block">
					 	<input type="text"  readonly="readonly" class="layui-input readOnlyBox" id="contractNo" name="contractNo" placeholder="签约编码">
					</div>
				</div>
			</div>
		</div>
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">签约状态<span class="must-fill">*</span></label>
					<div class="layui-input-block">
						<select name="contractStatus" disabled="disabled" class="readOnlyBox" id="contractStatus" lay-verify="required"  lay-filter="applyId">
		                	<option value="0">请选择</option>
		                	<option value="1">签约完成</option>
		                	<option value="-1">未完成</option>
		             	</select>
					</div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">签约日期<span class="must-fill">*</span></label>
					<div class="layui-input-block">
					 	<input type="text" readonly="readonly"  class="layui-input readOnlyBox" id="signDate" name="signDate" placeholder="签约日期">
					</div>
				</div>
			</div>
		</div>
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">协议审查<span class="must-fill">*</span></label>
					<div class="layui-input-block">
						<select name="flowAgreementReview" disabled="disabled" class="readOnlyBox" id="flowAgreementReview" lay-verify="required"  lay-filter="applyId">
		                	<option value="0">待审查</option>
		                	<option value="1">已通过</option>
		             	</select>
					</div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">知识产权审查<span class="must-fill">*</span></label>
					<div class="layui-input-block">
					 	<select name="flowKnowledgeReview" disabled="disabled" class="readOnlyBox" id="flowKnowledgeReview" lay-verify="required"  lay-filter="applyId">
		                	<option value="0">待审查</option>
		                	<option value="1">已通过</option>
		             	</select>
					</div>
				</div>
			</div>
		</div>
		<div class="layui-row">
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">综合审查<span class="must-fill">*</span></label>
					<div class="layui-input-block">
						<select name="flowComprehensiveReview" disabled="disabled" class="readOnlyBox" id="flowComprehensiveReview" lay-verify="required"  lay-filter="applyId">
		                	<option value="0">待审查</option>
		                	<option value="1">已通过</option>
		             	</select>
					</div>
				</div>
			</div>
			<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
				<div class="layui-form-item">
					<label for="" class="layui-form-label">专业技术审查<span class="must-fill">*</span></label>
					<div class="layui-input-block">
					 	<select name="flowTechnologyReview" disabled="disabled" class="readOnlyBox" id="flowTechnologyReview" lay-verify="required"  lay-filter="applyId">
		                	<option value="0">待审查</option>
		                	<option value="1">已通过</option>
		             	</select>
					</div>
				</div>
			</div>
		</div>
		<div class="layui-form-item">
	      	 <label class="layui-form-label">内容</label>
	         <div class="layui-input-block">
	         	   <textarea class="layui-textarea readOnlyBox" readonly="readonly" id="contractContent" name="contractContent" placeholder=""></textarea>
	         </div>
       </div>
       <div class="layui-form-item">
	      	 <label class="layui-form-label">附件</label>
	         <div id="file_div" class="layui-input-block"></div>
       </div>
	</div>
	<!-- <div class="form-bottom">
      <div class="form-bottom-btns">
      	<button class="layui-btn layui-btn-sm fontColor-white btnMyBgImg layui-btn-mini layui-btn-blue" lay-submit="" lay-filter="submitBtn">保存</button>
      	<button type="button" class="layui-btn layui-btn-sm fontColor-default border-default btnMyBgImg layui-btn-mini layui-btn-white"  id="cancel">关闭</button>
      </div>
    </div> -->
</form>
</body>
</html>

